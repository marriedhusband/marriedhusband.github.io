/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.calendar.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.inlineCalendar.js 
*/

/*!
 * LiveJournal Inline calendar
 *
 * Copyright 2011, dmitry.petrov@sup.com
 *
 * http://docs.jquery.com/UI
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *
 * @overview Inline calendar widget.
 *
 * Widget can be attached to any existant markup.
 *
 * Date wildcards used:
 *  - %D - day ( 01 - 31 )
 *  - %M - month ( 01 - 02 )
 *  - %Y - year ( yyyy, e.g. 2002 )
 *  - %s - unix timestamp in ms
 *
 * Options:
 *  - dayRef: Format of the url that will be attached to each day in the calendar.
 *  - allRefs: Wether to attach links to days in the calendar.
 *    and override currentDate on success.
 *    Could be: true/false/Object {from: Date, to: Date} (all fields are not required)
 *  - activeFrom: Days before this will be inactive in calendar.
 *  - actoveUntil: Days after this willbe inactive incalendar.
 *  - startMonth: Widget will not allow to switch calendar pane to the month before this.
 *  - endMonth: Widget will not allow to switch calendar pane to the month after this.
 *  - startAtSunday: Wether to count sunday as the start of the week.
 *  - events: Object, containing events to show in the calendar. They will be rendered as links. Structure of the object:
 *    { "yyyy": { "mm1" : [ d1, d2, d3, d4 ], "mm2": [ d5, d6, d7 ] } }
 *
 *  Events:
 *  - daySelected: Event is triggered when user selects a day in the calendar. The second parameter passed to the
 *  function is a Date object.
 *  - dateChange Event is triggered when user click on next or prev month/year button.
 *  - currentDateChange: Events is triggered when a new date is set in calendar as current.
 *
 *  Consistent options ( setting these options is guaranteed to work correctly ):
 *  - currentDate, date - Set/get current date.
 *  - activeFrom, date - Set/get earliest active date.
 *  - activeUntil, date - Set/get last active date.
 *  - title, title - set calendar title.
 *  - events, obj - override current events object
 *
 *  @TODO: move all service functions to the widget object and merge it with the view.
 *
 */

(function( $ ) {

  var defaultOptions = {
    dayRef: '/%Y/%M/%D',
    monthRef: '', //the same, but for the months and year. Calendar will render link, if options are set
    yearRef: '',
    allRefs: false,
    currentDate: new Date(),
    //allow user to select dates in this range
    activeUntil: null,
    activeFrom: null,
    //allow user to switch months between these dates
    startMonth: new Date( 1900, 0, 1 ),
    endMonth: new Date( 2050, 0, 1 ),
    startAtSunday: LJ.ml('date.format.offset') === '0' || false,
    dateFormat: '%Y-%M-%D',
    defaultTitle: 'Calendar',
    longMonth: false,

    events: null, //object with events to show in the calendar
    displayedMonth: null, //month displayed on the calendar. If not specified at
                //startup currentDate is used instead.
    dateChange: null,

    selectors: {
      table: 'table',
      title: 'h5',
      tbody: 'tbody',

      month: '.cal-nav-month',
      year:  '.cal-nav-year',
      monthSelect: '.cal-nav-month-select',
      yearSelect:  '.cal-nav-year-select',

      prevMonth: '.cal-nav-month .cal-nav-prev',
      nextMonth: '.cal-nav-month .cal-nav-next',
      prevYear:  '.cal-nav-year .cal-nav-prev',
      nextYear:  '.cal-nav-year .cal-nav-next',

      monthLabel: '.cal-nav-month .cal-month',
      yearLabel: '.cal-nav-year .cal-year'
    },

    classNames: {
      container: '',
      inactive : 'other',
      future : 'other',
      current  : 'current',
      weekend: 'weekend',
      nextDisabled : 'cal-nav-next-dis',
      prevDisabled : 'cal-nav-prev-dis',
      cellHover : 'hover',
      longMonth: 'sidebar-cal-longmonth'
    },

    //now, all lang variables are collected from Site.ml_text and should not be modified
    mlPrefix: {
      monthNamesShort: ['monthNames', 'date.month.{name}.short'],
      monthNamesLong: ['monthNames', 'date.month.{name}.long'],
      dayNamesShort: ['dayNames', 'date.day.{name}.short']
    },

    ml: {
      monthNames: [ 'january', 'february', 'march', 'april', 'may', 'june', 'july',
               'august', 'september', 'october', 'november', 'december'],
      dayNames: ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'],
      caption: 'Calendar'
    }
  };

  function getDateNumber( d, dropDays ) {
    dropDays = dropDays || false;
    var day = d.getDate().toString();
    if( day.length === 1 ) { day = '0' + day; }
    if( dropDays ) {
      day = '';
    }

    var month = d.getMonth().toString();
    if( month.length === 1 ) { month = '0' + month; }

    return parseInt( d.getFullYear().toString() + month + day, 10);
  }

  function insideTimeRange( range, iDate ) {
    return getDateNumber( iDate, true ) >= getDateNumber( range[0], true ) &&
        getDateNumber( iDate, true ) <= getDateNumber( range[1], true );
  }

  function View(nodes, styles, o)
  {
    this.initialize = function (date) {
      this.tbody = this.catchTableStructure(date);
    };

    this.modelChanged = function (monthDate, events, switcherStates)
    {
      var monthml = o.longMonth? o.ml.monthNamesLong : o.ml.monthNamesShort;
      //we have a 30% speedup when we temporary remove tbody from dom
      this.tbody.detach();
      this.fillDates(monthDate, events);

      for (var sws in switcherStates) {
        if (switcherStates.hasOwnProperty(sws)) {
          nodes[sws][ (!switcherStates[sws]) ? 'addClass' : 'removeClass']( this.disabledStyle(sws) );
        }
      }

      var monthText = o.monthRef ?
          $( '<a>', {
            href: LJ.Util.Date.format( monthDate, o.monthRef ),
            text: monthml[ monthDate.getMonth() ] + (o.monthWithYear ?  (' ' + monthDate.getFullYear()) : '')
          } ) :
          monthml[ monthDate.getMonth() ];

      var yearText = o.yearRef ?
          $( '<a>', { href: LJ.Util.Date.format( monthDate, o.yearRef ), text: monthDate.getFullYear() } ) :
          monthDate.getFullYear();

      nodes.monthLabel.empty().append( monthText );
      nodes.yearLabel.empty().append( yearText );

      this.tbody.appendTo( nodes.table );
    };

    this.catchTableStructure = function(date) {
      var tbody = nodes.tbody[0];
      nodes.daysCells = [];
      nodes.daysSpans = [];

      var row, rowsCount = tbody.rows.length, cell, cellsCount;

      var toAdd = 6 - rowsCount;

      var rowStr = '<tr>';
      for( var i = 0; i < 7; ++i ) { rowStr += '<td><span></span></td>'; }
      rowStr += '</tr>';

      while( toAdd-- > 0 ) {
        //add missing rows if server has rendered not enough markup
        $( rowStr ).hide().appendTo( nodes.tbody );
      }
      rowsCount = 6;
      nodes.lastRow = jQuery( tbody.rows[ tbody.rows.length - 1 ] );
      date = new Date(date);

      for( row = 0; row < rowsCount; ++row ) {
        for( cell = 0, cellsCount = tbody.rows[ row ].cells.length; cell < cellsCount; ++cell ) {
          // take into account span inside td
          var node = jQuery( tbody.rows[ row ].cells[ cell ] ),
            children = node.children(),
            day = children.text().trim();

          if(day) {
            date.setDate(day);
            node.data('isActive', true);
            node.data('day', date);
          }

          nodes.daysCells.push(node);
          nodes.daysSpans.push(children);
        }
      }

      return jQuery( tbody );
    };

    this.fillDates = function (monthDate, events)
    {
      function hasEvents( date ) {
        var year = date.getFullYear(),
          month = date.getMonth(),
          day = date.getDate();

        return( events && events[ year ] && events[ year ][ month ] && events[ year ][ month ][ day ] );
      }

      var d = new Date( monthDate );
      d.setDate( 1 );

      var offset;
      if( o.startAtSunday ) {
        offset = d.getDay();
      } else {
        offset = ( d.getDay() === 0 ? 6 : d.getDay()  - 1 );
      }
      d.setDate( 1 - offset );

      for( var i = 0, l = nodes.daysCells.length; i < l; ++i ) {
        var cell = nodes.daysCells[ i ],
          span = nodes.daysSpans[ i ];

        this.formDayString( d, cell, span, hasEvents( d ), this.isActiveDate( d, monthDate ) );

        d.setDate( d.getDate() + 1 );
      }

      d.setDate( d.getDate() - 1 ); //get the date from the last cell
      //we do not use show and hide methods, because show method sets display: block;
      if( d.getDate() < 7 ) {
        nodes.lastRow.css('display', '');
      } else {
        nodes.lastRow.css('display', 'none');
      }
    };

    this.isActiveDate = function( date, currentMonth ) {
      var isActive = true;

      isActive = ( currentMonth.getFullYear() === date.getFullYear() && currentMonth.getMonth() === date.getMonth() );

      if( isActive && ( o.activeFrom || o.activeUntil ) ) {
        isActive = ( o.activeFrom && getDateNumber( o.activeFrom ) <= getDateNumber( date ) ) ||
          ( o.activeUntil && getDateNumber( o.activeUntil ) >= getDateNumber( date ) );
      }

      return isActive;
    };

    this.formDayString = function( d, cell, span, hasEvents, isActive )
    {
      d = new Date( d );
      var isCurrentDay = ( getDateNumber( d ) === getDateNumber( o.currentDate ) );

      cell.data( 'day', d );
      cell.data( 'isActive', isActive );
      cell.data( 'hasEvents', hasEvents );

      cell[isCurrentDay ? 'addClass' : 'removeClass']( styles.current );
      cell.removeClass( styles.cellHover );

      if( !isActive ) {
        cell.addClass( styles.inactive );
        span.html(d.getDate());
      } else if( hasEvents || o.allRefs ) {

        var _tmpAllRefs = true;
        if (o.allRefs && typeof o.allRefs === 'object') {
          if (o.allRefs.from && d < o.allRefs.from) {
            _tmpAllRefs = false;
          }

          if (o.allRefs.to && d > o.allRefs.to) {
            _tmpAllRefs = false;
          }
        }

        if (_tmpAllRefs) {
          cell.removeClass( styles.inactive );
          span.html( $( '<a />', {
            html: d.getDate(),
            href: LJ.Util.Date.format( d, o.dayRef ),
            target: '_self'
          }));
        } else {
          cell.removeClass(styles.inactive);
          span.html(d.getDate());
        }

      } else {
        cell.removeClass( styles.inactive );
        span.html(d.getDate());
      }
    };

    this.disabledStyle = function (sws)
    {
      if(sws === 'prevMonth' || sws === 'prevYear') {
        return styles.prevDisabled;
      } else {
        return styles.nextDisabled;
      }
    };
  }

  var Calendar = {
    options: {}, //all options were move to the default options object

    _create: function() {
      this._preInit();
      this._initialize();
      this._postInit();
    },

    _preInit: function() {
      var def = $[ this.namespace ][ this.widgetName ].getDefaults();
      this.options = jQuery.extend( true, {}, def, this.options );
      this._prepareMLVars();
    },

    _prepareMLVars: function() {
      var expandVar = function(prefix, name) {
            return LJ.ml(prefix.supplant({name: name}));
          },
          prefixData;

      for (var prefix in this.options.mlPrefix) {
        if (this.options.mlPrefix.hasOwnProperty(prefix)) {
          prefixData = this.options.mlPrefix[prefix];
          this.options.ml[prefix] = this.options.ml[prefixData[0]].map(expandVar.bind(null, prefixData[1]));
        }
      }
    },

    // @TODO: need to change the structure of initialization code to remove this method
    _initialize: function() {
      if( !this.options.displayedMonth ) {
        this.options.displayedMonth = new Date( this.options.currentDate );
      }

      this._events = this.options.events;
      this._hideTimer = null;
      this._nodes = this._nodes || { container: this.element, root: this.element };
      this._invalidateTimer = null;

      if (this.element.hasClass(this.options.classNames.longMonth)) {
        this.options.longMonth = true;
      }

      this._bindNodes();

      this.options.startMonth.setDate( 1 );

      this._view = new (this._getView())( this._nodes, this.options.classNames, this.options );
      this._view.initialize(this.options.currentDate);

      if( this._nodes.table.hasClass( 'monday' ) ) {
        this._setOption( 'startAtSunday', false );
      }

      this._nodes.monthSelect.val(this.options.displayedMonth.getMonth());
      this._nodes.yearSelect.val(this.options.displayedMonth.getFullYear());

      this._bindEvents();
    },

    _postInit: function() {
    },

    _getView: function() {
      return View;
    },

    _bindNodes: function() {
      for ( var i in this.options.selectors ) {
        if( this.options.selectors.hasOwnProperty(i) && !( i in this._nodes ) ) {
          this._nodes[ i ] = this._nodes.container.find( this.options.selectors[ i ] );
        }
      }

      var displayedMonth = LJ.Util.Date.parse(this._nodes.table.attr('data-date'), this.options.dateFormat);
      if (displayedMonth) {
        this.options.displayedMonth = displayedMonth;
      }
    },

    destroy: function() {
      $.Widget.prototype.destroy.apply(this, arguments);
    },

    _bindEvents: function() {
      var self = this;

      var switcherStates = this._getSwitcherStates( this.options.currentDate ),
        switcherMouseDown = function( item ) {
          return function (ev) {
            ev.preventDefault();
            ev.stopPropagation();
            var switcherStates = self._getSwitcherStates( self.options.currentDate );

            if( switcherStates[item] ) {
              self['_' + item]();
            }
          };
        };

      for (var sws in switcherStates) {
        if (switcherStates.hasOwnProperty(sws)) {
          this._nodes[sws].click( switcherMouseDown(sws) );
        }
      }

      this._nodes.monthSelect.change(function() {
        var d = new Date(self.options.currentDate);
        d.setMonth(this.value);
        self._setOption('currentDate', d);
      });

      this._nodes.yearSelect.change(function() {
        var d = new Date(self.options.currentDate);
        d.setFullYear(this.value);
        self._setOption('currentDate', d);
      });

      this._nodes.tbody
        .delegate( 'td', 'click', function( ev ) {
          self._cellSelectedEvent( $( this ), ev );
        } );
    },

    _switchMonth: function ( go ) {
      var event = jQuery.Event( 'dateChange' );
      event.moveForward = go > 0;
      event.switchType = Math.abs( go ) === 12 ? 'year' : ( Math.abs( go ) === 1 ? 'month' : null );

      event.date = new Date(this.options.displayedMonth.getFullYear(), this.options.displayedMonth.getMonth() + go, 1);

      this._nodes.root.trigger( event );
      this._setOption( 'displayedMonth', event.date );
    },

    _prevMonth: function () { this._switchMonth( -1 ); },
    _nextMonth: function () { this._switchMonth( 1 ); },

    _prevYear : function () { this._switchMonth( -12 ); },
    _nextYear : function () { this._switchMonth( 12 ); },

    _cellSelectedEvent: function( cell, ev ) {
      //if cell is inactive or user controls it's behavior we do not pass event to the link
      if( !cell.data('isActive' ) || this._cellSelected( cell.data( 'day' ) ) ) {
        ev.stopPropagation();
        ev.preventDefault();
      }
    },

    /**
     * @return {Boolean} returns true if user prevents default behaviour
     */
    _cellSelected: function( date ) {
      var event = jQuery.Event( 'daySelected' );
      this._nodes.root.trigger( event, [ date, LJ.Util.Date.format(date, this.options.dateFormat) ] );

      if( !event.isDefaultPrevented() ) {
        this._setOption( 'currentDate', date );
      }

      return !event.isDefaultPrevented();
    },

    _fitDate: function( date ) {
      date = new Date( date );
      var enabledMonthsRange = [ this.options.startMonth, this.options.endMonth ];

      if( !insideTimeRange( enabledMonthsRange, date ) ) {
        if( getDateNumber( date, true ) < getDateNumber( enabledMonthsRange[ 0 ], true ) ) {
          date = new Date( enabledMonthsRange[ 0 ] );
        } else {
          date = new Date( enabledMonthsRange[ 1 ] );
        }
      }

      return date;
    },

    _getSwitcherStates: function () {
      var monthDate = this.options.displayedMonth,
        yearStart = new Date( monthDate.getFullYear(), 0, 1 ),
        yearEnd = new Date( monthDate.getFullYear(), 11, 1 );

      return {
        prevMonth: this._isActivePrev( monthDate ) !== false,
        prevYear: this._isActivePrev( yearStart ) !== false,
        nextMonth: this._isActiveNext( monthDate ) !== false,
        nextYear: this._isActiveNext( yearEnd ) !== false
      };
    },

    _isActiveNext: function( date ) { return this._isActiveDate( date, 1 ); },
    _isActivePrev: function( date ) { return this._isActiveDate( date, -1 ); },
    _isActiveDate: function( date, dir ) {
      var d = new Date( date );
      d.setMonth( d.getMonth() + dir );
      d.setDate( 1 );

      return insideTimeRange( [ this.options.startMonth, this.options.endMonth ], d );
    },

    _invalidateDisplay: function() {
      var self = this;
      clearTimeout( this._invalidateTimer );

      setTimeout( function() {
        self._view.modelChanged( self.options.displayedMonth, self._events, self._getSwitcherStates() );
      }, 50 );
    },

    _setOption: function( name, value ) {
      switch( name ) {
        case 'currentDate':
          this.options.currentDate = this._fitDate( value );

          var event = jQuery.Event('currentDateChange'),
              date = new Date(this.options.currentDate);
          this._nodes.root.trigger( event, [ date, LJ.Util.Date.format(date, this.options.dateFormat) ] );

          this._setOption( 'displayedMonth', value );
          this._invalidateDisplay();
          break;
        case 'activeFrom':
          this.options.activeFrom = new Date( value );
          this._invalidateDisplay();
          break;
        case 'activeUntil':
          this.options.activeUntil = new Date( value );
          this._invalidateDisplay();
          break;
        case 'title':
          this._title = value;
          this._nodes.title.html( value );
          break;
        case 'events':
          this._events = value;
          this._invalidateDisplay();
          break;
        case 'displayedMonth':
          var newDate = this._fitDate( new Date( value ) ),
            isCurrentMonth = getDateNumber(newDate, true) === getDateNumber(this.options.displayedMonth, true);

          if( !isCurrentMonth ) {
            this.options.displayedMonth = this._fitDate( new Date( value ) );
            this._nodes.monthSelect.val(this.options.displayedMonth.getMonth());
            this._nodes.yearSelect.val(this.options.displayedMonth.getFullYear());
            this._invalidateDisplay();
          }

          break;
        case 'startMonth':
          this.options.startMonth = new Date( value );
          this._invalidateDisplay();
          break;
        case 'endMonth':
          this.options.endMonth = new Date( value );
          this._invalidateDisplay();
          break;
        case 'startAtSunday':
          this.options.startAtSunday = !!value;
          break;
        case 'monthWithYear':
          this.options.monthWithYear = Boolean(value);
          break;
        case 'dayRef':
          this.options.dayRef = value;
          this._invalidateDisplay();
          break;
      }
    },

    getElement: function( name ) {
      if( name in this._nodes ) {
        return this._nodes[ name ];
      } else {
        return null;
      }
    }

  };

  $.widget('lj.inlineCalendar', Calendar );

  jQuery.extend( $.lj.inlineCalendar, {

    getDefaults: function() {
      return defaultOptions;
    },

    setDefaults: function ( opts ) {
      if( opts ) {
        jQuery.extend( true, defaultOptions, opts );
      }
    }
  } );

} ( jQuery ) );
;

/* file-end: js/jquery/jquery.lj.inlineCalendar.js 
----------------------------------------------------------------------------------*/

!function(a,b){var c,d={showOn:"click",closeControl:!0,showCellHovers:!1,hoverDelay:400,align:"center",events:null,displayedMonth:null,bubbleClass:!1,selectors:{tmpl:".appwidget-calendar .calendar"},classNames:{showCellHovers:"all-days",popup:"b-bubble-calendar"},templates:{calendar:'<div class="popup-inner calendar" style="display: none;"> 						<h5>${caption}</h5> 						<p class="cal-nav"> 							<span class="cal-nav-month"> 								<i class="cal-nav-prev"></i> 								<span class="cal-month"></span> 								<i class="cal-nav-next cal-nav-next-dis"></i> 							</span> 							<span class="cal-nav-year"> 								<i class="cal-nav-prev cal-nav-prev"></i> 								<span class="cal-year"></span> 								<i class="cal-nav-next cal-nav-next-dis"></i> 							</span> 						</p> 						<table cellspacing="0" cellpadding="0"> 							<thead> 								<tr> 									{{each days}} 										<th class="{{if $index % 7 === weekend1 || $index % 7 === weekend2}} weekend{{/if}}{{if $index === 0}} first{{/if}}{{if $index === days.length - 1}} last{{/if}}">${day}</th> 									{{/each}} 								</tr> 							</thead> 							<tbody> 								{{each cells}} 								{{if $index % 7 === 0}}<tr>{{/if}} 								<td{{if $index % 7 === weekend1 || $index % 7 === weekend2}} class="weekend"{{/if}}><span></span></td> 								{{if $index % 7 === 6}}</tr>{{/if}} 								{{/each}} 							</tbody> 						</table></div>'}},e={options:{},_initialize:function(){c||(c=this._buildDOM()),this._nodes={container:c.clone(),root:this.element},a.lj.inlineCalendar.prototype._initialize.apply(this),this._invalidateDisplay()},_bindNodes:function(){a.lj.inlineCalendar.prototype._bindNodes.apply(this);var b=this;this._nodes.container.bubble({classNames:{containerAddClass:this.options.bubbleClass?this.options.classNames.popup:""},target:this._nodes.root,align:this.options.align,closeControl:this.options.closeControl,showOn:this.options.showOn,closeOnContentClick:!1}).bind("bubbleshow",function(){b._trigger("show")}).bind("bubblehide",function(){b._trigger("hide")}).addClass(this.options.classNames.container),this._nodes.input=this.options.input?this.options.input:this._nodes.root.is("[type=text]")?this._nodes.root:a(),this._nodes.input.mask&&this._nodes.input.mask("?dddd-dd-dd",{placeholder:" "}),this._nodes.input.input(this._parseInputValue.bind(this));var c=LJ.Util.Date.parse(this._nodes.input.val(),this.options.dateFormat);c&&(this.options.currentDate=c),this.options.showCellHovers&&this._nodes.table.addClass(this.options.classNames.showCellHovers)},destroy:function(){this._nodes.container.bubble("destroy"),a.lj.inlineCalendar.prototype.destroy.apply(this)},_buildDOM:function(){var a=this.options.ml.dayNamesShort.map(function(a){return{day:a}}),b=0,c=6,d=function(a,b){for(var c=[];a--;)c.push(b);return c};this.options.startAtSunday||(a[7]=a[0],a.shift(),b=5);for(var e=[],f=[],g=this.options.endMonth.getFullYear(),h=this.options.startMonth.getFullYear();g>=h;)e.push({year:g--});f=this.options.ml.monthNamesLong.map(function(a){return{month:a}});var i={caption:this.options.ml.caption,days:a,months:f,years:e,cells:d(42,{}),weekend1:b,weekend2:c};return-1!==this.options.templates.calendar.indexOf(" ")?jQuery.tmpl(this.options.templates.calendar,i):LJ.UI.template(this.options.templates.calendar,i)},_parseInputValue:function(){var a=LJ.Util.Date.parse(this._nodes.input.val(),this.options.dateFormat);a&&this._cellSelected(a)},_cellSelectedEvent:function(c,d){var e=this;a.lj.inlineCalendar.prototype._cellSelectedEvent.call(this,c,d),e.options.showCellHovers&&c.data("isActive")&&e._nodes.container.bubble("hide"),"a"==d.target.tagName.toLowerCase()&&(b.location.href=d.target.href)},_invalidateDisplay:function(){this._view.modelChanged(this.options.displayedMonth,this._events,this._getSwitcherStates())},_setOption:function(b,c){switch(a.lj.inlineCalendar.prototype._setOption.call(this,b,c),b){case"currentDate":this._nodes.input.val(LJ.Util.Date.format(this.options.currentDate,this.options.dateFormat))}}};a.widget("lj.calendar",a.lj.inlineCalendar,e),jQuery.extend(a.lj.calendar,{getDefaults:function(){return jQuery.extend(!0,{},a.lj.inlineCalendar.getDefaults(),d)},setDefaults:function(a){a&&jQuery.extend(d,a)}})}(jQuery,window);;

/* file-end: js/jquery/jquery.lj.calendar.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.mask.js 
*/

!function(a){var b=(a.browser.msie?"paste":"input")+".mask",c=void 0!=window.orientation;a.mask={definitions:{d:"[0-9]",w:"[A-Za-z]","*":"[A-Za-z0-9а-яА-Я]"}},a.fn.extend({unmask:function(){return this.trigger("unmask")},mask:function(d,e){if(!d&&this.length>0){var f=a(this[0]),g=f.data("tests");return a.map(f.data("buffer"),function(a,b){return g[b]?a:null}).join("")}e=a.extend({placeholder:"_",completed:null},e);var h=a.mask.definitions,g=[],i=d.length,j=null,k=d.length;return a.each(d.split(""),function(a,b){"?"==b?(k--,i=a):h[b]?(g.push(new RegExp(h[b])),null==j&&(j=g.length-1)):g.push(null)}),this.each(function(){function f(a){for(;++a<=k&&!g[a];);return a}function l(a){for(;!g[a]&&--a>=0;);for(var b=a;k>b;b++)if(g[b]){t[b]=e.placeholder;var c=f(b);if(!(k>c&&g[b].test(t[c])))break;t[b]=t[c]}q(),s.caret(Math.max(j,a))}function m(a){for(var b=a,c=e.placeholder;k>b;b++)if(g[b]){var d=f(b),h=t[b];if(t[b]=c,!(k>d&&g[d].test(h)))break;c=h}}function n(b){var d=a(this).caret(),e=b.keyCode;return u=16>e||e>16&&32>e||e>32&&41>e,d.start-d.end==0||u&&8!=e&&46!=e||p(d.start,d.end),8==e||46==e||c&&127==e?(l(d.start+(46==e?0:-1)),!1):27==e?(s.val(v),s.caret(0,r()),!1):void 0}function o(b){if(u)return u=!1,8==b.keyCode?!1:null;b=b||window.event;var c=b.charCode||b.keyCode||b.which,d=a(this).caret();if(b.ctrlKey||b.altKey||b.metaKey)return!0;if(c>=32&&125>=c||c>186){var h=f(d.start-1);if(k>h){var i=String.fromCharCode(c);if(g[h].test(i)){m(h),t[h]=i,q();var d=f(h);a(this).caret(d),e.completed&&d==k&&e.completed.call(s)}}}return!1}function p(a,b){for(var c=a;b>c&&k>c;c++)g[c]&&(t[c]=e.placeholder)}function q(){return s.val(t.join("")).val()}function r(a){for(var b=s.val(),c=-1,d=0,f=0;k>d;d++)if(g[d]){for(t[d]=e.placeholder;f++<b.length;){var h=b.charAt(f-1);if(g[d].test(h)){t[d]=h,c=d;break}}if(f>b.length)break}else t[d]==b.charAt(f)&&d!=i&&(f++,c=d);return!a&&i>c+1?(s.val(""),p(0,k)):(a||c+1>=i)&&(q(),a||s.val(s.val().substring(0,c+1))),i?d:j}var s=a(this),t=a.map(d.split(""),function(a){return"?"!=a?h[a]?e.placeholder:a:void 0}),u=!1,v=s.val();s.data("buffer",t).data("tests",g),s.attr("readonly")||s.one("unmask",function(){s.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){v=s.val();var a=r();q(),setTimeout(function(){a==d.length?s.caret(0,a):s.caret(a)},0)}).bind("blur.mask",function(){r(),s.val()!=v&&s.change()}).bind("keydown.mask",n).bind("keypress.mask",o).bind(b,function(){setTimeout(function(){s.caret(r(!0))},0)}),r()})}})}(jQuery);;

/* file-end: js/jquery/jquery.mask.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/controlstrip.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.calendarEvents.js 
*/

!function(a){var b={};a.fn.calendarEvents=function(c){function d(a,b){return"cache_"+a+b}function e(a,b){var c=this;this.calendar=a,this.events=null,this.options=b,this._ajaxActive=!1,this._currentDate;var e,f=function(b,f){"string"!=typeof a.data("noFetch")&&(clearTimeout(e),c._currentDate=d(b.getFullYear(),b.getMonth()+1),e=setTimeout(function(){c.fetchEvents(b.getFullYear(),b.getMonth()+1,f)},200))};this.calendar.bind("dateChange",function(a){var b=c.calendar[c.options.calendarType]("option","displayedMonth"),d=1===Math.abs(12*(a.date.getFullYear()-b.getFullYear())+(a.date.getMonth()-b.getMonth()));f(a.date,d)}),this.options.fetchOnFirstDisplay&&this.calendar.one("calendarshow",function(){f(new Date,!0)})}var f={calendarType:"calendar",classNames:{idle:"idle"},fetchOnFirstDisplay:!1};return e.prototype={getEvents:function(a,b,c){var d={};return d[+a]={},d[+a][+b-1]=c,d},fetchEvents:function(c,e,f){f=arguments.length>=3?!!f:!0;var g=this,h=(this.calendar[this.options.calendarType]("option","displayedMonth"),this.calendar[this.options.calendarType]("getElement",f?"month":"year")),i=this.options.classNames.idle,j=!0,k=function(){g._ajaxActive||j||h.removeClass(i)};this.calendar[this.options.calendarType]("getElement","year").removeClass(i),this.calendar[this.options.calendarType]("getElement","month").removeClass(i),h.addClass(i),this._ajaxActive=!0,setTimeout(function(){j=!1,k()},500);var l=d(c,e);processResults=function(){l===g._currentDate&&(g.events=b[l],g.calendar[g.options.calendarType]("option","events",g.getEvents(g.events.year,g.events.month,g.events.days)),g._ajaxActive=!1,k())},l in b?processResults(b[l]):a.getJSON(LiveJournal.getAjaxUrl("calendar"),{year:c,month:e},function(a){b[l]=a,processResults(a)})}},this.each(function(){new e(a(this),a.extend({},f,c))})}}(jQuery);;

/* file-end: js/jquery/jquery.calendarEvents.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/relations/menu.js 
*/

/**
 * Change relations from controlstrip/profile menu block
 */

/* ---------------------------------------------------------------------------------
   file-start: js/lib/angular/1.2.26/angular.min.js 
*/

/*
 AngularJS v1.2.26
 (c) 2010-2014 Google, Inc. http://angularjs.org
 License: MIT
*/
(function(W,X,t){'use strict';function C(b){return function(){var a=arguments[0],c,a="["+(b?b+":":"")+a+"] http://errors.angularjs.org/1.2.26/"+(b?b+"/":"")+a;for(c=1;c<arguments.length;c++)a=a+(1==c?"?":"&")+"p"+(c-1)+"="+encodeURIComponent("function"==typeof arguments[c]?arguments[c].toString().replace(/ \{[\s\S]*$/,""):"undefined"==typeof arguments[c]?"undefined":"string"!=typeof arguments[c]?JSON.stringify(arguments[c]):arguments[c]);return Error(a)}}function Pa(b){if(null==b||Ga(b))return!1;
var a=b.length;return 1===b.nodeType&&a?!0:v(b)||J(b)||0===a||"number"===typeof a&&0<a&&a-1 in b}function r(b,a,c){var d;if(b)if(P(b))for(d in b)"prototype"==d||("length"==d||"name"==d||b.hasOwnProperty&&!b.hasOwnProperty(d))||a.call(c,b[d],d);else if(J(b)||Pa(b))for(d=0;d<b.length;d++)a.call(c,b[d],d);else if(b.forEach&&b.forEach!==r)b.forEach(a,c);else for(d in b)b.hasOwnProperty(d)&&a.call(c,b[d],d);return b}function Zb(b){var a=[],c;for(c in b)b.hasOwnProperty(c)&&a.push(c);return a.sort()}function Tc(b,
a,c){for(var d=Zb(b),e=0;e<d.length;e++)a.call(c,b[d[e]],d[e]);return d}function $b(b){return function(a,c){b(c,a)}}function hb(){for(var b=ma.length,a;b;){b--;a=ma[b].charCodeAt(0);if(57==a)return ma[b]="A",ma.join("");if(90==a)ma[b]="0";else return ma[b]=String.fromCharCode(a+1),ma.join("")}ma.unshift("0");return ma.join("")}function ac(b,a){a?b.$$hashKey=a:delete b.$$hashKey}function D(b){var a=b.$$hashKey;r(arguments,function(a){a!==b&&r(a,function(a,c){b[c]=a})});ac(b,a);return b}function U(b){return parseInt(b,
10)}function bc(b,a){return D(new (D(function(){},{prototype:b})),a)}function E(){}function Qa(b){return b}function ba(b){return function(){return b}}function x(b){return"undefined"===typeof b}function y(b){return"undefined"!==typeof b}function T(b){return null!=b&&"object"===typeof b}function v(b){return"string"===typeof b}function ib(b){return"number"===typeof b}function ta(b){return"[object Date]"===za.call(b)}function P(b){return"function"===typeof b}function jb(b){return"[object RegExp]"===za.call(b)}
function Ga(b){return b&&b.document&&b.location&&b.alert&&b.setInterval}function Uc(b){return!(!b||!(b.nodeName||b.prop&&b.attr&&b.find))}function Vc(b,a,c){var d=[];r(b,function(b,f,g){d.push(a.call(c,b,f,g))});return d}function Ra(b,a){if(b.indexOf)return b.indexOf(a);for(var c=0;c<b.length;c++)if(a===b[c])return c;return-1}function Sa(b,a){var c=Ra(b,a);0<=c&&b.splice(c,1);return a}function Ha(b,a,c,d){if(Ga(b)||b&&b.$evalAsync&&b.$watch)throw Ta("cpws");if(a){if(b===a)throw Ta("cpi");c=c||[];
d=d||[];if(T(b)){var e=Ra(c,b);if(-1!==e)return d[e];c.push(b);d.push(a)}if(J(b))for(var f=a.length=0;f<b.length;f++)e=Ha(b[f],null,c,d),T(b[f])&&(c.push(b[f]),d.push(e)),a.push(e);else{var g=a.$$hashKey;J(a)?a.length=0:r(a,function(b,c){delete a[c]});for(f in b)e=Ha(b[f],null,c,d),T(b[f])&&(c.push(b[f]),d.push(e)),a[f]=e;ac(a,g)}}else if(a=b)J(b)?a=Ha(b,[],c,d):ta(b)?a=new Date(b.getTime()):jb(b)?(a=RegExp(b.source,b.toString().match(/[^\/]*$/)[0]),a.lastIndex=b.lastIndex):T(b)&&(a=Ha(b,{},c,d));
return a}function ha(b,a){if(J(b)){a=a||[];for(var c=0;c<b.length;c++)a[c]=b[c]}else if(T(b))for(c in a=a||{},b)!kb.call(b,c)||"$"===c.charAt(0)&&"$"===c.charAt(1)||(a[c]=b[c]);return a||b}function Aa(b,a){if(b===a)return!0;if(null===b||null===a)return!1;if(b!==b&&a!==a)return!0;var c=typeof b,d;if(c==typeof a&&"object"==c)if(J(b)){if(!J(a))return!1;if((c=b.length)==a.length){for(d=0;d<c;d++)if(!Aa(b[d],a[d]))return!1;return!0}}else{if(ta(b))return ta(a)?isNaN(b.getTime())&&isNaN(a.getTime())||b.getTime()===
a.getTime():!1;if(jb(b)&&jb(a))return b.toString()==a.toString();if(b&&b.$evalAsync&&b.$watch||a&&a.$evalAsync&&a.$watch||Ga(b)||Ga(a)||J(a))return!1;c={};for(d in b)if("$"!==d.charAt(0)&&!P(b[d])){if(!Aa(b[d],a[d]))return!1;c[d]=!0}for(d in a)if(!c.hasOwnProperty(d)&&"$"!==d.charAt(0)&&a[d]!==t&&!P(a[d]))return!1;return!0}return!1}function Bb(b,a){var c=2<arguments.length?Ba.call(arguments,2):[];return!P(a)||a instanceof RegExp?a:c.length?function(){return arguments.length?a.apply(b,c.concat(Ba.call(arguments,
0))):a.apply(b,c)}:function(){return arguments.length?a.apply(b,arguments):a.call(b)}}function Wc(b,a){var c=a;"string"===typeof b&&"$"===b.charAt(0)?c=t:Ga(a)?c="$WINDOW":a&&X===a?c="$DOCUMENT":a&&(a.$evalAsync&&a.$watch)&&(c="$SCOPE");return c}function na(b,a){return"undefined"===typeof b?t:JSON.stringify(b,Wc,a?"  ":null)}function cc(b){return v(b)?JSON.parse(b):b}function Ua(b){"function"===typeof b?b=!0:b&&0!==b.length?(b=K(""+b),b=!("f"==b||"0"==b||"false"==b||"no"==b||"n"==b||"[]"==b)):b=!1;
return b}function ia(b){b=w(b).clone();try{b.empty()}catch(a){}var c=w("<div>").append(b).html();try{return 3===b[0].nodeType?K(c):c.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(a,b){return"<"+K(b)})}catch(d){return K(c)}}function dc(b){try{return decodeURIComponent(b)}catch(a){}}function ec(b){var a={},c,d;r((b||"").split("&"),function(b){b&&(c=b.replace(/\+/g,"%20").split("="),d=dc(c[0]),y(d)&&(b=y(c[1])?dc(c[1]):!0,kb.call(a,d)?J(a[d])?a[d].push(b):a[d]=[a[d],b]:a[d]=b))});return a}function Cb(b){var a=
[];r(b,function(b,d){J(b)?r(b,function(b){a.push(Ca(d,!0)+(!0===b?"":"="+Ca(b,!0)))}):a.push(Ca(d,!0)+(!0===b?"":"="+Ca(b,!0)))});return a.length?a.join("&"):""}function lb(b){return Ca(b,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function Ca(b,a){return encodeURIComponent(b).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,a?"%20":"+")}function Xc(b,a){function c(a){a&&d.push(a)}var d=[b],e,f,g=["ng:app","ng-app","x-ng-app",
"data-ng-app"],k=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;r(g,function(a){g[a]=!0;c(X.getElementById(a));a=a.replace(":","\\:");b.querySelectorAll&&(r(b.querySelectorAll("."+a),c),r(b.querySelectorAll("."+a+"\\:"),c),r(b.querySelectorAll("["+a+"]"),c))});r(d,function(a){if(!e){var b=k.exec(" "+a.className+" ");b?(e=a,f=(b[2]||"").replace(/\s+/g,",")):r(a.attributes,function(b){!e&&g[b.name]&&(e=a,f=b.value)})}});e&&a(e,f?[f]:[])}function fc(b,a){var c=function(){b=w(b);if(b.injector()){var c=b[0]===X?
"document":ia(b);throw Ta("btstrpd",c.replace(/</,"&lt;").replace(/>/,"&gt;"));}a=a||[];a.unshift(["$provide",function(a){a.value("$rootElement",b)}]);a.unshift("ng");c=gc(a);c.invoke(["$rootScope","$rootElement","$compile","$injector","$animate",function(a,b,c,d,e){a.$apply(function(){b.data("$injector",d);c(b)(a)})}]);return c},d=/^NG_DEFER_BOOTSTRAP!/;if(W&&!d.test(W.name))return c();W.name=W.name.replace(d,"");Va.resumeBootstrap=function(b){r(b,function(b){a.push(b)});c()}}function mb(b,a){a=
a||"_";return b.replace(Yc,function(b,d){return(d?a:"")+b.toLowerCase()})}function Db(b,a,c){if(!b)throw Ta("areq",a||"?",c||"required");return b}function Wa(b,a,c){c&&J(b)&&(b=b[b.length-1]);Db(P(b),a,"not a function, got "+(b&&"object"===typeof b?b.constructor.name||"Object":typeof b));return b}function Da(b,a){if("hasOwnProperty"===b)throw Ta("badname",a);}function hc(b,a,c){if(!a)return b;a=a.split(".");for(var d,e=b,f=a.length,g=0;g<f;g++)d=a[g],b&&(b=(e=b)[d]);return!c&&P(b)?Bb(e,b):b}function Eb(b){var a=
b[0];b=b[b.length-1];if(a===b)return w(a);var c=[a];do{a=a.nextSibling;if(!a)break;c.push(a)}while(a!==b);return w(c)}function Zc(b){var a=C("$injector"),c=C("ng");b=b.angular||(b.angular={});b.$$minErr=b.$$minErr||C;return b.module||(b.module=function(){var b={};return function(e,f,g){if("hasOwnProperty"===e)throw c("badname","module");f&&b.hasOwnProperty(e)&&(b[e]=null);return b[e]||(b[e]=function(){function b(a,d,e){return function(){c[e||"push"]([a,d,arguments]);return n}}if(!f)throw a("nomod",
e);var c=[],d=[],l=b("$injector","invoke"),n={_invokeQueue:c,_runBlocks:d,requires:f,name:e,provider:b("$provide","provider"),factory:b("$provide","factory"),service:b("$provide","service"),value:b("$provide","value"),constant:b("$provide","constant","unshift"),animation:b("$animateProvider","register"),filter:b("$filterProvider","register"),controller:b("$controllerProvider","register"),directive:b("$compileProvider","directive"),config:l,run:function(a){d.push(a);return this}};g&&l(g);return n}())}}())}
function $c(b){D(b,{bootstrap:fc,copy:Ha,extend:D,equals:Aa,element:w,forEach:r,injector:gc,noop:E,bind:Bb,toJson:na,fromJson:cc,identity:Qa,isUndefined:x,isDefined:y,isString:v,isFunction:P,isObject:T,isNumber:ib,isElement:Uc,isArray:J,version:ad,isDate:ta,lowercase:K,uppercase:Ia,callbacks:{counter:0},$$minErr:C,$$csp:Xa});Ya=Zc(W);try{Ya("ngLocale")}catch(a){Ya("ngLocale",[]).provider("$locale",bd)}Ya("ng",["ngLocale"],["$provide",function(a){a.provider({$$sanitizeUri:cd});a.provider("$compile",
ic).directive({a:dd,input:jc,textarea:jc,form:ed,script:fd,select:gd,style:hd,option:id,ngBind:jd,ngBindHtml:kd,ngBindTemplate:ld,ngClass:md,ngClassEven:nd,ngClassOdd:od,ngCloak:pd,ngController:qd,ngForm:rd,ngHide:sd,ngIf:td,ngInclude:ud,ngInit:vd,ngNonBindable:wd,ngPluralize:xd,ngRepeat:yd,ngShow:zd,ngStyle:Ad,ngSwitch:Bd,ngSwitchWhen:Cd,ngSwitchDefault:Dd,ngOptions:Ed,ngTransclude:Fd,ngModel:Gd,ngList:Hd,ngChange:Id,required:kc,ngRequired:kc,ngValue:Jd}).directive({ngInclude:Kd}).directive(Fb).directive(lc);
a.provider({$anchorScroll:Ld,$animate:Md,$browser:Nd,$cacheFactory:Od,$controller:Pd,$document:Qd,$exceptionHandler:Rd,$filter:mc,$interpolate:Sd,$interval:Td,$http:Ud,$httpBackend:Vd,$location:Wd,$log:Xd,$parse:Yd,$rootScope:Zd,$q:$d,$sce:ae,$sceDelegate:be,$sniffer:ce,$templateCache:de,$timeout:ee,$window:fe,$$rAF:ge,$$asyncCallback:he})}])}function Za(b){return b.replace(ie,function(a,b,d,e){return e?d.toUpperCase():d}).replace(je,"Moz$1")}function Gb(b,a,c,d){function e(b){var e=c&&b?[this.filter(b)]:
[this],m=a,h,l,n,p,q,s;if(!d||null!=b)for(;e.length;)for(h=e.shift(),l=0,n=h.length;l<n;l++)for(p=w(h[l]),m?p.triggerHandler("$destroy"):m=!m,q=0,p=(s=p.children()).length;q<p;q++)e.push(Ea(s[q]));return f.apply(this,arguments)}var f=Ea.fn[b],f=f.$original||f;e.$original=f;Ea.fn[b]=e}function S(b){if(b instanceof S)return b;v(b)&&(b=aa(b));if(!(this instanceof S)){if(v(b)&&"<"!=b.charAt(0))throw Hb("nosel");return new S(b)}if(v(b)){var a=b;b=X;var c;if(c=ke.exec(a))b=[b.createElement(c[1])];else{var d=
b,e;b=d.createDocumentFragment();c=[];if(Ib.test(a)){d=b.appendChild(d.createElement("div"));e=(le.exec(a)||["",""])[1].toLowerCase();e=ea[e]||ea._default;d.innerHTML="<div>&#160;</div>"+e[1]+a.replace(me,"<$1></$2>")+e[2];d.removeChild(d.firstChild);for(a=e[0];a--;)d=d.lastChild;a=0;for(e=d.childNodes.length;a<e;++a)c.push(d.childNodes[a]);d=b.firstChild;d.textContent=""}else c.push(d.createTextNode(a));b.textContent="";b.innerHTML="";b=c}Jb(this,b);w(X.createDocumentFragment()).append(this)}else Jb(this,
b)}function Kb(b){return b.cloneNode(!0)}function Ja(b){Lb(b);var a=0;for(b=b.childNodes||[];a<b.length;a++)Ja(b[a])}function nc(b,a,c,d){if(y(d))throw Hb("offargs");var e=oa(b,"events");oa(b,"handle")&&(x(a)?r(e,function(a,c){$a(b,c,a);delete e[c]}):r(a.split(" "),function(a){x(c)?($a(b,a,e[a]),delete e[a]):Sa(e[a]||[],c)}))}function Lb(b,a){var c=b.ng339,d=ab[c];d&&(a?delete ab[c].data[a]:(d.handle&&(d.events.$destroy&&d.handle({},"$destroy"),nc(b)),delete ab[c],b.ng339=t))}function oa(b,a,c){var d=
b.ng339,d=ab[d||-1];if(y(c))d||(b.ng339=d=++ne,d=ab[d]={}),d[a]=c;else return d&&d[a]}function Mb(b,a,c){var d=oa(b,"data"),e=y(c),f=!e&&y(a),g=f&&!T(a);d||g||oa(b,"data",d={});if(e)d[a]=c;else if(f){if(g)return d&&d[a];D(d,a)}else return d}function Nb(b,a){return b.getAttribute?-1<(" "+(b.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+a+" "):!1}function nb(b,a){a&&b.setAttribute&&r(a.split(" "),function(a){b.setAttribute("class",aa((" "+(b.getAttribute("class")||"")+" ").replace(/[\n\t]/g,
" ").replace(" "+aa(a)+" "," ")))})}function ob(b,a){if(a&&b.setAttribute){var c=(" "+(b.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");r(a.split(" "),function(a){a=aa(a);-1===c.indexOf(" "+a+" ")&&(c+=a+" ")});b.setAttribute("class",aa(c))}}function Jb(b,a){if(a){a=a.nodeName||!y(a.length)||Ga(a)?[a]:a;for(var c=0;c<a.length;c++)b.push(a[c])}}function oc(b,a){return pb(b,"$"+(a||"ngController")+"Controller")}function pb(b,a,c){9==b.nodeType&&(b=b.documentElement);for(a=J(a)?a:[a];b;){for(var d=
0,e=a.length;d<e;d++)if((c=w.data(b,a[d]))!==t)return c;b=b.parentNode||11===b.nodeType&&b.host}}function pc(b){for(var a=0,c=b.childNodes;a<c.length;a++)Ja(c[a]);for(;b.firstChild;)b.removeChild(b.firstChild)}function qc(b,a){var c=qb[a.toLowerCase()];return c&&rc[b.nodeName]&&c}function oe(b,a){var c=function(c,e){c.preventDefault||(c.preventDefault=function(){c.returnValue=!1});c.stopPropagation||(c.stopPropagation=function(){c.cancelBubble=!0});c.target||(c.target=c.srcElement||X);if(x(c.defaultPrevented)){var f=
c.preventDefault;c.preventDefault=function(){c.defaultPrevented=!0;f.call(c)};c.defaultPrevented=!1}c.isDefaultPrevented=function(){return c.defaultPrevented||!1===c.returnValue};var g=ha(a[e||c.type]||[]);r(g,function(a){a.call(b,c)});8>=Q?(c.preventDefault=null,c.stopPropagation=null,c.isDefaultPrevented=null):(delete c.preventDefault,delete c.stopPropagation,delete c.isDefaultPrevented)};c.elem=b;return c}function Ka(b,a){var c=typeof b,d;"function"==c||"object"==c&&null!==b?"function"==typeof(d=
b.$$hashKey)?d=b.$$hashKey():d===t&&(d=b.$$hashKey=(a||hb)()):d=b;return c+":"+d}function bb(b,a){if(a){var c=0;this.nextUid=function(){return++c}}r(b,this.put,this)}function sc(b){var a,c;"function"===typeof b?(a=b.$inject)||(a=[],b.length&&(c=b.toString().replace(pe,""),c=c.match(qe),r(c[1].split(re),function(b){b.replace(se,function(b,c,d){a.push(d)})})),b.$inject=a):J(b)?(c=b.length-1,Wa(b[c],"fn"),a=b.slice(0,c)):Wa(b,"fn",!0);return a}function gc(b){function a(a){return function(b,c){if(T(b))r(b,
$b(a));else return a(b,c)}}function c(a,b){Da(a,"service");if(P(b)||J(b))b=n.instantiate(b);if(!b.$get)throw cb("pget",a);return l[a+k]=b}function d(a,b){return c(a,{$get:b})}function e(a){var b=[],c,d,f,k;r(a,function(a){if(!h.get(a)){h.put(a,!0);try{if(v(a))for(c=Ya(a),b=b.concat(e(c.requires)).concat(c._runBlocks),d=c._invokeQueue,f=0,k=d.length;f<k;f++){var g=d[f],m=n.get(g[0]);m[g[1]].apply(m,g[2])}else P(a)?b.push(n.invoke(a)):J(a)?b.push(n.invoke(a)):Wa(a,"module")}catch(l){throw J(a)&&(a=
a[a.length-1]),l.message&&(l.stack&&-1==l.stack.indexOf(l.message))&&(l=l.message+"\n"+l.stack),cb("modulerr",a,l.stack||l.message||l);}}});return b}function f(a,b){function c(d){if(a.hasOwnProperty(d)){if(a[d]===g)throw cb("cdep",d+" <- "+m.join(" <- "));return a[d]}try{return m.unshift(d),a[d]=g,a[d]=b(d)}catch(e){throw a[d]===g&&delete a[d],e;}finally{m.shift()}}function d(a,b,e){var f=[],k=sc(a),g,m,h;m=0;for(g=k.length;m<g;m++){h=k[m];if("string"!==typeof h)throw cb("itkn",h);f.push(e&&e.hasOwnProperty(h)?
e[h]:c(h))}J(a)&&(a=a[g]);return a.apply(b,f)}return{invoke:d,instantiate:function(a,b){var c=function(){},e;c.prototype=(J(a)?a[a.length-1]:a).prototype;c=new c;e=d(a,c,b);return T(e)||P(e)?e:c},get:c,annotate:sc,has:function(b){return l.hasOwnProperty(b+k)||a.hasOwnProperty(b)}}}var g={},k="Provider",m=[],h=new bb([],!0),l={$provide:{provider:a(c),factory:a(d),service:a(function(a,b){return d(a,["$injector",function(a){return a.instantiate(b)}])}),value:a(function(a,b){return d(a,ba(b))}),constant:a(function(a,
b){Da(a,"constant");l[a]=b;p[a]=b}),decorator:function(a,b){var c=n.get(a+k),d=c.$get;c.$get=function(){var a=q.invoke(d,c);return q.invoke(b,null,{$delegate:a})}}}},n=l.$injector=f(l,function(){throw cb("unpr",m.join(" <- "));}),p={},q=p.$injector=f(p,function(a){a=n.get(a+k);return q.invoke(a.$get,a)});r(e(b),function(a){q.invoke(a||E)});return q}function Ld(){var b=!0;this.disableAutoScrolling=function(){b=!1};this.$get=["$window","$location","$rootScope",function(a,c,d){function e(a){var b=null;
r(a,function(a){b||"a"!==K(a.nodeName)||(b=a)});return b}function f(){var b=c.hash(),d;b?(d=g.getElementById(b))?d.scrollIntoView():(d=e(g.getElementsByName(b)))?d.scrollIntoView():"top"===b&&a.scrollTo(0,0):a.scrollTo(0,0)}var g=a.document;b&&d.$watch(function(){return c.hash()},function(){d.$evalAsync(f)});return f}]}function he(){this.$get=["$$rAF","$timeout",function(b,a){return b.supported?function(a){return b(a)}:function(b){return a(b,0,!1)}}]}function te(b,a,c,d){function e(a){try{a.apply(null,
Ba.call(arguments,1))}finally{if(s--,0===s)for(;F.length;)try{F.pop()()}catch(b){c.error(b)}}}function f(a,b){(function fa(){r(u,function(a){a()});A=b(fa,a)})()}function g(){z=null;N!=k.url()&&(N=k.url(),r(ca,function(a){a(k.url())}))}var k=this,m=a[0],h=b.location,l=b.history,n=b.setTimeout,p=b.clearTimeout,q={};k.isMock=!1;var s=0,F=[];k.$$completeOutstandingRequest=e;k.$$incOutstandingRequestCount=function(){s++};k.notifyWhenNoOutstandingRequests=function(a){r(u,function(a){a()});0===s?a():F.push(a)};
var u=[],A;k.addPollFn=function(a){x(A)&&f(100,n);u.push(a);return a};var N=h.href,R=a.find("base"),z=null;k.url=function(a,c){h!==b.location&&(h=b.location);l!==b.history&&(l=b.history);if(a){if(N!=a)return N=a,d.history?c?l.replaceState(null,"",a):(l.pushState(null,"",a),R.attr("href",R.attr("href"))):(z=a,c?h.replace(a):h.href=a),k}else return z||h.href.replace(/%27/g,"'")};var ca=[],L=!1;k.onUrlChange=function(a){if(!L){if(d.history)w(b).on("popstate",g);if(d.hashchange)w(b).on("hashchange",g);
else k.addPollFn(g);L=!0}ca.push(a);return a};k.$$checkUrlChange=g;k.baseHref=function(){var a=R.attr("href");return a?a.replace(/^(https?\:)?\/\/[^\/]*/,""):""};var O={},da="",B=k.baseHref();k.cookies=function(a,b){var d,e,f,k;if(a)b===t?m.cookie=escape(a)+"=;path="+B+";expires=Thu, 01 Jan 1970 00:00:00 GMT":v(b)&&(d=(m.cookie=escape(a)+"="+escape(b)+";path="+B).length+1,4096<d&&c.warn("Cookie '"+a+"' possibly not set or overflowed because it was too large ("+d+" > 4096 bytes)!"));else{if(m.cookie!==
da)for(da=m.cookie,d=da.split("; "),O={},f=0;f<d.length;f++)e=d[f],k=e.indexOf("="),0<k&&(a=unescape(e.substring(0,k)),O[a]===t&&(O[a]=unescape(e.substring(k+1))));return O}};k.defer=function(a,b){var c;s++;c=n(function(){delete q[c];e(a)},b||0);q[c]=!0;return c};k.defer.cancel=function(a){return q[a]?(delete q[a],p(a),e(E),!0):!1}}function Nd(){this.$get=["$window","$log","$sniffer","$document",function(b,a,c,d){return new te(b,d,a,c)}]}function Od(){this.$get=function(){function b(b,d){function e(a){a!=
n&&(p?p==a&&(p=a.n):p=a,f(a.n,a.p),f(a,n),n=a,n.n=null)}function f(a,b){a!=b&&(a&&(a.p=b),b&&(b.n=a))}if(b in a)throw C("$cacheFactory")("iid",b);var g=0,k=D({},d,{id:b}),m={},h=d&&d.capacity||Number.MAX_VALUE,l={},n=null,p=null;return a[b]={put:function(a,b){if(h<Number.MAX_VALUE){var c=l[a]||(l[a]={key:a});e(c)}if(!x(b))return a in m||g++,m[a]=b,g>h&&this.remove(p.key),b},get:function(a){if(h<Number.MAX_VALUE){var b=l[a];if(!b)return;e(b)}return m[a]},remove:function(a){if(h<Number.MAX_VALUE){var b=
l[a];if(!b)return;b==n&&(n=b.p);b==p&&(p=b.n);f(b.n,b.p);delete l[a]}delete m[a];g--},removeAll:function(){m={};g=0;l={};n=p=null},destroy:function(){l=k=m=null;delete a[b]},info:function(){return D({},k,{size:g})}}}var a={};b.info=function(){var b={};r(a,function(a,e){b[e]=a.info()});return b};b.get=function(b){return a[b]};return b}}function de(){this.$get=["$cacheFactory",function(b){return b("templates")}]}function ic(b,a){var c={},d="Directive",e=/^\s*directive\:\s*([\d\w_\-]+)\s+(.*)$/,f=/(([\d\w_\-]+)(?:\:([^;]+))?;?)/,
g=/^(on[a-z]+|formaction)$/;this.directive=function m(a,e){Da(a,"directive");v(a)?(Db(e,"directiveFactory"),c.hasOwnProperty(a)||(c[a]=[],b.factory(a+d,["$injector","$exceptionHandler",function(b,d){var e=[];r(c[a],function(c,f){try{var g=b.invoke(c);P(g)?g={compile:ba(g)}:!g.compile&&g.link&&(g.compile=ba(g.link));g.priority=g.priority||0;g.index=f;g.name=g.name||a;g.require=g.require||g.controller&&g.name;g.restrict=g.restrict||"A";e.push(g)}catch(m){d(m)}});return e}])),c[a].push(e)):r(a,$b(m));
return this};this.aHrefSanitizationWhitelist=function(b){return y(b)?(a.aHrefSanitizationWhitelist(b),this):a.aHrefSanitizationWhitelist()};this.imgSrcSanitizationWhitelist=function(b){return y(b)?(a.imgSrcSanitizationWhitelist(b),this):a.imgSrcSanitizationWhitelist()};this.$get=["$injector","$interpolate","$exceptionHandler","$http","$templateCache","$parse","$controller","$rootScope","$document","$sce","$animate","$$sanitizeUri",function(a,b,l,n,p,q,s,F,u,A,N,R){function z(a,b,c,d,e){a instanceof
w||(a=w(a));r(a,function(b,c){3==b.nodeType&&b.nodeValue.match(/\S+/)&&(a[c]=w(b).wrap("<span></span>").parent()[0])});var f=L(a,b,a,c,d,e);ca(a,"ng-scope");return function(b,c,d,e){Db(b,"scope");var g=c?La.clone.call(a):a;r(d,function(a,b){g.data("$"+b+"Controller",a)});d=0;for(var m=g.length;d<m;d++){var h=g[d].nodeType;1!==h&&9!==h||g.eq(d).data("$scope",b)}c&&c(g,b);f&&f(b,g,g,e);return g}}function ca(a,b){try{a.addClass(b)}catch(c){}}function L(a,b,c,d,e,f){function g(a,c,d,e){var f,h,l,q,n,
p,s;f=c.length;var M=Array(f);for(q=0;q<f;q++)M[q]=c[q];p=q=0;for(n=m.length;q<n;p++)h=M[p],c=m[q++],f=m[q++],c?(c.scope?(l=a.$new(),w.data(h,"$scope",l)):l=a,s=c.transcludeOnThisElement?O(a,c.transclude,e):!c.templateOnThisElement&&e?e:!e&&b?O(a,b):null,c(f,l,h,d,s)):f&&f(a,h.childNodes,t,e)}for(var m=[],h,l,q,n,p=0;p<a.length;p++)h=new Ob,l=da(a[p],[],h,0===p?d:t,e),(f=l.length?H(l,a[p],h,b,c,null,[],[],f):null)&&f.scope&&ca(h.$$element,"ng-scope"),h=f&&f.terminal||!(q=a[p].childNodes)||!q.length?
null:L(q,f?(f.transcludeOnThisElement||!f.templateOnThisElement)&&f.transclude:b),m.push(f,h),n=n||f||h,f=null;return n?g:null}function O(a,b,c){return function(d,e,f){var g=!1;d||(d=a.$new(),g=d.$$transcluded=!0);e=b(d,e,f,c);if(g)e.on("$destroy",function(){d.$destroy()});return e}}function da(a,b,c,d,g){var m=c.$attr,h;switch(a.nodeType){case 1:fa(b,pa(Ma(a).toLowerCase()),"E",d,g);for(var l,q,n,p=a.attributes,s=0,F=p&&p.length;s<F;s++){var A=!1,N=!1;l=p[s];if(!Q||8<=Q||l.specified){h=l.name;q=
aa(l.value);l=pa(h);if(n=U.test(l))h=mb(l.substr(6),"-");var u=l.replace(/(Start|End)$/,"");l===u+"Start"&&(A=h,N=h.substr(0,h.length-5)+"end",h=h.substr(0,h.length-6));l=pa(h.toLowerCase());m[l]=h;if(n||!c.hasOwnProperty(l))c[l]=q,qc(a,l)&&(c[l]=!0);S(a,b,q,l);fa(b,l,"A",d,g,A,N)}}a=a.className;if(v(a)&&""!==a)for(;h=f.exec(a);)l=pa(h[2]),fa(b,l,"C",d,g)&&(c[l]=aa(h[3])),a=a.substr(h.index+h[0].length);break;case 3:K(b,a.nodeValue);break;case 8:try{if(h=e.exec(a.nodeValue))l=pa(h[1]),fa(b,l,"M",
d,g)&&(c[l]=aa(h[2]))}catch(z){}}b.sort(x);return b}function B(a,b,c){var d=[],e=0;if(b&&a.hasAttribute&&a.hasAttribute(b)){do{if(!a)throw ja("uterdir",b,c);1==a.nodeType&&(a.hasAttribute(b)&&e++,a.hasAttribute(c)&&e--);d.push(a);a=a.nextSibling}while(0<e)}else d.push(a);return w(d)}function I(a,b,c){return function(d,e,f,g,h){e=B(e[0],b,c);return a(d,e,f,g,h)}}function H(a,c,d,e,f,g,m,n,p){function F(a,b,c,d){if(a){c&&(a=I(a,c,d));a.require=G.require;a.directiveName=C;if(L===G||G.$$isolateScope)a=
tc(a,{isolateScope:!0});m.push(a)}if(b){c&&(b=I(b,c,d));b.require=G.require;b.directiveName=C;if(L===G||G.$$isolateScope)b=tc(b,{isolateScope:!0});n.push(b)}}function A(a,b,c,d){var e,f="data",g=!1;if(v(b)){for(;"^"==(e=b.charAt(0))||"?"==e;)b=b.substr(1),"^"==e&&(f="inheritedData"),g=g||"?"==e;e=null;d&&"data"===f&&(e=d[b]);e=e||c[f]("$"+b+"Controller");if(!e&&!g)throw ja("ctreq",b,a);}else J(b)&&(e=[],r(b,function(b){e.push(A(a,b,c,d))}));return e}function N(a,e,f,g,p){function F(a,b){var c;2>arguments.length&&
(b=a,a=t);K&&(c=da);return p(a,b,c)}var u,M,z,O,I,B,da={},rb;u=c===f?d:ha(d,new Ob(w(f),d.$attr));M=u.$$element;if(L){var Na=/^\s*([@=&])(\??)\s*(\w*)\s*$/;B=e.$new(!0);!H||H!==L&&H!==L.$$originalDirective?M.data("$isolateScopeNoTemplate",B):M.data("$isolateScope",B);ca(M,"ng-isolate-scope");r(L.scope,function(a,c){var d=a.match(Na)||[],f=d[3]||c,g="?"==d[2],d=d[1],m,l,n,p;B.$$isolateBindings[c]=d+f;switch(d){case "@":u.$observe(f,function(a){B[c]=a});u.$$observers[f].$$scope=e;u[f]&&(B[c]=b(u[f])(e));
break;case "=":if(g&&!u[f])break;l=q(u[f]);p=l.literal?Aa:function(a,b){return a===b||a!==a&&b!==b};n=l.assign||function(){m=B[c]=l(e);throw ja("nonassign",u[f],L.name);};m=B[c]=l(e);B.$watch(function(){var a=l(e);p(a,B[c])||(p(a,m)?n(e,a=B[c]):B[c]=a);return m=a},null,l.literal);break;case "&":l=q(u[f]);B[c]=function(a){return l(e,a)};break;default:throw ja("iscp",L.name,c,a);}})}rb=p&&F;R&&r(R,function(a){var b={$scope:a===L||a.$$isolateScope?B:e,$element:M,$attrs:u,$transclude:rb},c;I=a.controller;
"@"==I&&(I=u[a.name]);c=s(I,b);da[a.name]=c;K||M.data("$"+a.name+"Controller",c);a.controllerAs&&(b.$scope[a.controllerAs]=c)});g=0;for(z=m.length;g<z;g++)try{O=m[g],O(O.isolateScope?B:e,M,u,O.require&&A(O.directiveName,O.require,M,da),rb)}catch(G){l(G,ia(M))}g=e;L&&(L.template||null===L.templateUrl)&&(g=B);a&&a(g,f.childNodes,t,p);for(g=n.length-1;0<=g;g--)try{O=n[g],O(O.isolateScope?B:e,M,u,O.require&&A(O.directiveName,O.require,M,da),rb)}catch(y){l(y,ia(M))}}p=p||{};for(var u=-Number.MAX_VALUE,
O,R=p.controllerDirectives,L=p.newIsolateScopeDirective,H=p.templateDirective,fa=p.nonTlbTranscludeDirective,x=!1,D=!1,K=p.hasElementTranscludeDirective,Z=d.$$element=w(c),G,C,V,S=e,Q,Fa=0,qa=a.length;Fa<qa;Fa++){G=a[Fa];var U=G.$$start,Y=G.$$end;U&&(Z=B(c,U,Y));V=t;if(u>G.priority)break;if(V=G.scope)O=O||G,G.templateUrl||(db("new/isolated scope",L,G,Z),T(V)&&(L=G));C=G.name;!G.templateUrl&&G.controller&&(V=G.controller,R=R||{},db("'"+C+"' controller",R[C],G,Z),R[C]=G);if(V=G.transclude)x=!0,G.$$tlb||
(db("transclusion",fa,G,Z),fa=G),"element"==V?(K=!0,u=G.priority,V=Z,Z=d.$$element=w(X.createComment(" "+C+": "+d[C]+" ")),c=Z[0],Na(f,Ba.call(V,0),c),S=z(V,e,u,g&&g.name,{nonTlbTranscludeDirective:fa})):(V=w(Kb(c)).contents(),Z.empty(),S=z(V,e));if(G.template)if(D=!0,db("template",H,G,Z),H=G,V=P(G.template)?G.template(Z,d):G.template,V=W(V),G.replace){g=G;V=Ib.test(V)?w(aa(V)):[];c=V[0];if(1!=V.length||1!==c.nodeType)throw ja("tplrt",C,"");Na(f,Z,c);qa={$attr:{}};V=da(c,[],qa);var $=a.splice(Fa+
1,a.length-(Fa+1));L&&y(V);a=a.concat(V).concat($);E(d,qa);qa=a.length}else Z.html(V);if(G.templateUrl)D=!0,db("template",H,G,Z),H=G,G.replace&&(g=G),N=ue(a.splice(Fa,a.length-Fa),Z,d,f,x&&S,m,n,{controllerDirectives:R,newIsolateScopeDirective:L,templateDirective:H,nonTlbTranscludeDirective:fa}),qa=a.length;else if(G.compile)try{Q=G.compile(Z,d,S),P(Q)?F(null,Q,U,Y):Q&&F(Q.pre,Q.post,U,Y)}catch(ve){l(ve,ia(Z))}G.terminal&&(N.terminal=!0,u=Math.max(u,G.priority))}N.scope=O&&!0===O.scope;N.transcludeOnThisElement=
x;N.templateOnThisElement=D;N.transclude=S;p.hasElementTranscludeDirective=K;return N}function y(a){for(var b=0,c=a.length;b<c;b++)a[b]=bc(a[b],{$$isolateScope:!0})}function fa(b,e,f,g,h,q,n){if(e===h)return null;h=null;if(c.hasOwnProperty(e)){var p;e=a.get(e+d);for(var s=0,u=e.length;s<u;s++)try{p=e[s],(g===t||g>p.priority)&&-1!=p.restrict.indexOf(f)&&(q&&(p=bc(p,{$$start:q,$$end:n})),b.push(p),h=p)}catch(F){l(F)}}return h}function E(a,b){var c=b.$attr,d=a.$attr,e=a.$$element;r(a,function(d,e){"$"!=
e.charAt(0)&&(b[e]&&b[e]!==d&&(d+=("style"===e?";":" ")+b[e]),a.$set(e,d,!0,c[e]))});r(b,function(b,f){"class"==f?(ca(e,b),a["class"]=(a["class"]?a["class"]+" ":"")+b):"style"==f?(e.attr("style",e.attr("style")+";"+b),a.style=(a.style?a.style+";":"")+b):"$"==f.charAt(0)||a.hasOwnProperty(f)||(a[f]=b,d[f]=c[f])})}function ue(a,b,c,d,e,f,g,h){var m=[],l,q,s=b[0],u=a.shift(),F=D({},u,{templateUrl:null,transclude:null,replace:null,$$originalDirective:u}),N=P(u.templateUrl)?u.templateUrl(b,c):u.templateUrl;
b.empty();n.get(A.getTrustedResourceUrl(N),{cache:p}).success(function(n){var p,A;n=W(n);if(u.replace){n=Ib.test(n)?w(aa(n)):[];p=n[0];if(1!=n.length||1!==p.nodeType)throw ja("tplrt",u.name,N);n={$attr:{}};Na(d,b,p);var z=da(p,[],n);T(u.scope)&&y(z);a=z.concat(a);E(c,n)}else p=s,b.html(n);a.unshift(F);l=H(a,p,c,e,b,u,f,g,h);r(d,function(a,c){a==p&&(d[c]=b[0])});for(q=L(b[0].childNodes,e);m.length;){n=m.shift();A=m.shift();var R=m.shift(),I=m.shift(),z=b[0];if(A!==s){var B=A.className;h.hasElementTranscludeDirective&&
u.replace||(z=Kb(p));Na(R,w(A),z);ca(w(z),B)}A=l.transcludeOnThisElement?O(n,l.transclude,I):I;l(q,n,z,d,A)}m=null}).error(function(a,b,c,d){throw ja("tpload",d.url);});return function(a,b,c,d,e){a=e;m?(m.push(b),m.push(c),m.push(d),m.push(a)):(l.transcludeOnThisElement&&(a=O(b,l.transclude,e)),l(q,b,c,d,a))}}function x(a,b){var c=b.priority-a.priority;return 0!==c?c:a.name!==b.name?a.name<b.name?-1:1:a.index-b.index}function db(a,b,c,d){if(b)throw ja("multidir",b.name,c.name,a,ia(d));}function K(a,
c){var d=b(c,!0);d&&a.push({priority:0,compile:function(a){var b=a.parent().length;b&&ca(a.parent(),"ng-binding");return function(a,c){var e=c.parent(),f=e.data("$binding")||[];f.push(d);e.data("$binding",f);b||ca(e,"ng-binding");a.$watch(d,function(a){c[0].nodeValue=a})}}})}function C(a,b){if("srcdoc"==b)return A.HTML;var c=Ma(a);if("xlinkHref"==b||"FORM"==c&&"action"==b||"IMG"!=c&&("src"==b||"ngSrc"==b))return A.RESOURCE_URL}function S(a,c,d,e){var f=b(d,!0);if(f){if("multiple"===e&&"SELECT"===
Ma(a))throw ja("selmulti",ia(a));c.push({priority:100,compile:function(){return{pre:function(c,d,m){d=m.$$observers||(m.$$observers={});if(g.test(e))throw ja("nodomevents");if(f=b(m[e],!0,C(a,e)))m[e]=f(c),(d[e]||(d[e]=[])).$$inter=!0,(m.$$observers&&m.$$observers[e].$$scope||c).$watch(f,function(a,b){"class"===e&&a!=b?m.$updateClass(a,b):m.$set(e,a)})}}}})}}function Na(a,b,c){var d=b[0],e=b.length,f=d.parentNode,g,m;if(a)for(g=0,m=a.length;g<m;g++)if(a[g]==d){a[g++]=c;m=g+e-1;for(var h=a.length;g<
h;g++,m++)m<h?a[g]=a[m]:delete a[g];a.length-=e-1;break}f&&f.replaceChild(c,d);a=X.createDocumentFragment();a.appendChild(d);c[w.expando]=d[w.expando];d=1;for(e=b.length;d<e;d++)f=b[d],w(f).remove(),a.appendChild(f),delete b[d];b[0]=c;b.length=1}function tc(a,b){return D(function(){return a.apply(null,arguments)},a,b)}var Ob=function(a,b){this.$$element=a;this.$attr=b||{}};Ob.prototype={$normalize:pa,$addClass:function(a){a&&0<a.length&&N.addClass(this.$$element,a)},$removeClass:function(a){a&&0<
a.length&&N.removeClass(this.$$element,a)},$updateClass:function(a,b){var c=uc(a,b),d=uc(b,a);0===c.length?N.removeClass(this.$$element,d):0===d.length?N.addClass(this.$$element,c):N.setClass(this.$$element,c,d)},$set:function(a,b,c,d){var e=qc(this.$$element[0],a);e&&(this.$$element.prop(a,b),d=e);this[a]=b;d?this.$attr[a]=d:(d=this.$attr[a])||(this.$attr[a]=d=mb(a,"-"));e=Ma(this.$$element);if("A"===e&&"href"===a||"IMG"===e&&"src"===a)this[a]=b=R(b,"src"===a);!1!==c&&(null===b||b===t?this.$$element.removeAttr(d):
this.$$element.attr(d,b));(c=this.$$observers)&&r(c[a],function(a){try{a(b)}catch(c){l(c)}})},$observe:function(a,b){var c=this,d=c.$$observers||(c.$$observers={}),e=d[a]||(d[a]=[]);e.push(b);F.$evalAsync(function(){e.$$inter||b(c[a])});return b}};var qa=b.startSymbol(),Z=b.endSymbol(),W="{{"==qa||"}}"==Z?Qa:function(a){return a.replace(/\{\{/g,qa).replace(/}}/g,Z)},U=/^ngAttr[A-Z]/;return z}]}function pa(b){return Za(b.replace(we,""))}function uc(b,a){var c="",d=b.split(/\s+/),e=a.split(/\s+/),f=
0;a:for(;f<d.length;f++){for(var g=d[f],k=0;k<e.length;k++)if(g==e[k])continue a;c+=(0<c.length?" ":"")+g}return c}function Pd(){var b={},a=/^(\S+)(\s+as\s+(\w+))?$/;this.register=function(a,d){Da(a,"controller");T(a)?D(b,a):b[a]=d};this.$get=["$injector","$window",function(c,d){return function(e,f){var g,k,m;v(e)&&(g=e.match(a),k=g[1],m=g[3],e=b.hasOwnProperty(k)?b[k]:hc(f.$scope,k,!0)||hc(d,k,!0),Wa(e,k,!0));g=c.instantiate(e,f);if(m){if(!f||"object"!==typeof f.$scope)throw C("$controller")("noscp",
k||e.name,m);f.$scope[m]=g}return g}}]}function Qd(){this.$get=["$window",function(b){return w(b.document)}]}function Rd(){this.$get=["$log",function(b){return function(a,c){b.error.apply(b,arguments)}}]}function vc(b){var a={},c,d,e;if(!b)return a;r(b.split("\n"),function(b){e=b.indexOf(":");c=K(aa(b.substr(0,e)));d=aa(b.substr(e+1));c&&(a[c]=a[c]?a[c]+", "+d:d)});return a}function wc(b){var a=T(b)?b:t;return function(c){a||(a=vc(b));return c?a[K(c)]||null:a}}function xc(b,a,c){if(P(c))return c(b,
a);r(c,function(c){b=c(b,a)});return b}function Ud(){var b=/^\s*(\[|\{[^\{])/,a=/[\}\]]\s*$/,c=/^\)\]\}',?\n/,d={"Content-Type":"application/json;charset=utf-8"},e=this.defaults={transformResponse:[function(d){v(d)&&(d=d.replace(c,""),b.test(d)&&a.test(d)&&(d=cc(d)));return d}],transformRequest:[function(a){return T(a)&&"[object File]"!==za.call(a)&&"[object Blob]"!==za.call(a)?na(a):a}],headers:{common:{Accept:"application/json, text/plain, */*"},post:ha(d),put:ha(d),patch:ha(d)},xsrfCookieName:"XSRF-TOKEN",
xsrfHeaderName:"X-XSRF-TOKEN"},f=this.interceptors=[],g=this.responseInterceptors=[];this.$get=["$httpBackend","$browser","$cacheFactory","$rootScope","$q","$injector",function(a,b,c,d,n,p){function q(a){function b(a){var d=D({},a,{data:xc(a.data,a.headers,c.transformResponse)});return 200<=a.status&&300>a.status?d:n.reject(d)}var c={method:"get",transformRequest:e.transformRequest,transformResponse:e.transformResponse},d=function(a){var b=e.headers,c=D({},a.headers),d,f,b=D({},b.common,b[K(a.method)]);
a:for(d in b){a=K(d);for(f in c)if(K(f)===a)continue a;c[d]=b[d]}(function(a){var b;r(a,function(c,d){P(c)&&(b=c(),null!=b?a[d]=b:delete a[d])})})(c);return c}(a);D(c,a);c.headers=d;c.method=Ia(c.method);var f=[function(a){d=a.headers;var c=xc(a.data,wc(d),a.transformRequest);x(c)&&r(d,function(a,b){"content-type"===K(b)&&delete d[b]});x(a.withCredentials)&&!x(e.withCredentials)&&(a.withCredentials=e.withCredentials);return s(a,c,d).then(b,b)},t],g=n.when(c);for(r(A,function(a){(a.request||a.requestError)&&
f.unshift(a.request,a.requestError);(a.response||a.responseError)&&f.push(a.response,a.responseError)});f.length;){a=f.shift();var m=f.shift(),g=g.then(a,m)}g.success=function(a){g.then(function(b){a(b.data,b.status,b.headers,c)});return g};g.error=function(a){g.then(null,function(b){a(b.data,b.status,b.headers,c)});return g};return g}function s(c,f,g){function h(a,b,c,e){I&&(200<=a&&300>a?I.put(w,[a,b,vc(c),e]):I.remove(w));p(b,a,c,e);d.$$phase||d.$apply()}function p(a,b,d,e){b=Math.max(b,0);(200<=
b&&300>b?A.resolve:A.reject)({data:a,status:b,headers:wc(d),config:c,statusText:e})}function s(){var a=Ra(q.pendingRequests,c);-1!==a&&q.pendingRequests.splice(a,1)}var A=n.defer(),r=A.promise,I,H,w=F(c.url,c.params);q.pendingRequests.push(c);r.then(s,s);!c.cache&&!e.cache||(!1===c.cache||"GET"!==c.method&&"JSONP"!==c.method)||(I=T(c.cache)?c.cache:T(e.cache)?e.cache:u);if(I)if(H=I.get(w),y(H)){if(H&&P(H.then))return H.then(s,s),H;J(H)?p(H[1],H[0],ha(H[2]),H[3]):p(H,200,{},"OK")}else I.put(w,r);x(H)&&
((H=Pb(c.url)?b.cookies()[c.xsrfCookieName||e.xsrfCookieName]:t)&&(g[c.xsrfHeaderName||e.xsrfHeaderName]=H),a(c.method,w,f,h,g,c.timeout,c.withCredentials,c.responseType));return r}function F(a,b){if(!b)return a;var c=[];Tc(b,function(a,b){null===a||x(a)||(J(a)||(a=[a]),r(a,function(a){T(a)&&(a=ta(a)?a.toISOString():na(a));c.push(Ca(b)+"="+Ca(a))}))});0<c.length&&(a+=(-1==a.indexOf("?")?"?":"&")+c.join("&"));return a}var u=c("$http"),A=[];r(f,function(a){A.unshift(v(a)?p.get(a):p.invoke(a))});r(g,
function(a,b){var c=v(a)?p.get(a):p.invoke(a);A.splice(b,0,{response:function(a){return c(n.when(a))},responseError:function(a){return c(n.reject(a))}})});q.pendingRequests=[];(function(a){r(arguments,function(a){q[a]=function(b,c){return q(D(c||{},{method:a,url:b}))}})})("get","delete","head","jsonp");(function(a){r(arguments,function(a){q[a]=function(b,c,d){return q(D(d||{},{method:a,url:b,data:c}))}})})("post","put");q.defaults=e;return q}]}function xe(b){if(8>=Q&&(!b.match(/^(get|post|head|put|delete|options)$/i)||
!W.XMLHttpRequest))return new W.ActiveXObject("Microsoft.XMLHTTP");if(W.XMLHttpRequest)return new W.XMLHttpRequest;throw C("$httpBackend")("noxhr");}function Vd(){this.$get=["$browser","$window","$document",function(b,a,c){return ye(b,xe,b.defer,a.angular.callbacks,c[0])}]}function ye(b,a,c,d,e){function f(a,b,c){var f=e.createElement("script"),g=null;f.type="text/javascript";f.src=a;f.async=!0;g=function(a){$a(f,"load",g);$a(f,"error",g);e.body.removeChild(f);f=null;var k=-1,s="unknown";a&&("load"!==
a.type||d[b].called||(a={type:"error"}),s=a.type,k="error"===a.type?404:200);c&&c(k,s)};sb(f,"load",g);sb(f,"error",g);8>=Q&&(f.onreadystatechange=function(){v(f.readyState)&&/loaded|complete/.test(f.readyState)&&(f.onreadystatechange=null,g({type:"load"}))});e.body.appendChild(f);return g}var g=-1;return function(e,m,h,l,n,p,q,s){function F(){A=g;R&&R();z&&z.abort()}function u(a,d,e,f,g){L&&c.cancel(L);R=z=null;0===d&&(d=e?200:"file"==ua(m).protocol?404:0);a(1223===d?204:d,e,f,g||"");b.$$completeOutstandingRequest(E)}
var A;b.$$incOutstandingRequestCount();m=m||b.url();if("jsonp"==K(e)){var N="_"+(d.counter++).toString(36);d[N]=function(a){d[N].data=a;d[N].called=!0};var R=f(m.replace("JSON_CALLBACK","angular.callbacks."+N),N,function(a,b){u(l,a,d[N].data,"",b);d[N]=E})}else{var z=a(e);z.open(e,m,!0);r(n,function(a,b){y(a)&&z.setRequestHeader(b,a)});z.onreadystatechange=function(){if(z&&4==z.readyState){var a=null,b=null,c="";A!==g&&(a=z.getAllResponseHeaders(),b="response"in z?z.response:z.responseText);A===g&&
10>Q||(c=z.statusText);u(l,A||z.status,b,a,c)}};q&&(z.withCredentials=!0);if(s)try{z.responseType=s}catch(ca){if("json"!==s)throw ca;}z.send(h||null)}if(0<p)var L=c(F,p);else p&&P(p.then)&&p.then(F)}}function Sd(){var b="{{",a="}}";this.startSymbol=function(a){return a?(b=a,this):b};this.endSymbol=function(b){return b?(a=b,this):a};this.$get=["$parse","$exceptionHandler","$sce",function(c,d,e){function f(f,h,l){for(var n,p,q=0,s=[],F=f.length,u=!1,A=[];q<F;)-1!=(n=f.indexOf(b,q))&&-1!=(p=f.indexOf(a,
n+g))?(q!=n&&s.push(f.substring(q,n)),s.push(q=c(u=f.substring(n+g,p))),q.exp=u,q=p+k,u=!0):(q!=F&&s.push(f.substring(q)),q=F);(F=s.length)||(s.push(""),F=1);if(l&&1<s.length)throw yc("noconcat",f);if(!h||u)return A.length=F,q=function(a){try{for(var b=0,c=F,g;b<c;b++){if("function"==typeof(g=s[b]))if(g=g(a),g=l?e.getTrusted(l,g):e.valueOf(g),null==g)g="";else switch(typeof g){case "string":break;case "number":g=""+g;break;default:g=na(g)}A[b]=g}return A.join("")}catch(k){a=yc("interr",f,k.toString()),
d(a)}},q.exp=f,q.parts=s,q}var g=b.length,k=a.length;f.startSymbol=function(){return b};f.endSymbol=function(){return a};return f}]}function Td(){this.$get=["$rootScope","$window","$q",function(b,a,c){function d(d,g,k,m){var h=a.setInterval,l=a.clearInterval,n=c.defer(),p=n.promise,q=0,s=y(m)&&!m;k=y(k)?k:0;p.then(null,null,d);p.$$intervalId=h(function(){n.notify(q++);0<k&&q>=k&&(n.resolve(q),l(p.$$intervalId),delete e[p.$$intervalId]);s||b.$apply()},g);e[p.$$intervalId]=n;return p}var e={};d.cancel=
function(b){return b&&b.$$intervalId in e?(e[b.$$intervalId].reject("canceled"),a.clearInterval(b.$$intervalId),delete e[b.$$intervalId],!0):!1};return d}]}function bd(){this.$get=function(){return{id:"en-us",NUMBER_FORMATS:{DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{minInt:1,minFrac:0,maxFrac:3,posPre:"",posSuf:"",negPre:"-",negSuf:"",gSize:3,lgSize:3},{minInt:1,minFrac:2,maxFrac:2,posPre:"\u00a4",posSuf:"",negPre:"(\u00a4",negSuf:")",gSize:3,lgSize:3}],CURRENCY_SYM:"$"},DATETIME_FORMATS:{MONTH:"January February March April May June July August September October November December".split(" "),
SHORTMONTH:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),DAY:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),SHORTDAY:"Sun Mon Tue Wed Thu Fri Sat".split(" "),AMPMS:["AM","PM"],medium:"MMM d, y h:mm:ss a","short":"M/d/yy h:mm a",fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",mediumDate:"MMM d, y",shortDate:"M/d/yy",mediumTime:"h:mm:ss a",shortTime:"h:mm a"},pluralCat:function(b){return 1===b?"one":"other"}}}}function Qb(b){b=b.split("/");for(var a=b.length;a--;)b[a]=
lb(b[a]);return b.join("/")}function zc(b,a,c){b=ua(b,c);a.$$protocol=b.protocol;a.$$host=b.hostname;a.$$port=U(b.port)||ze[b.protocol]||null}function Ac(b,a,c){var d="/"!==b.charAt(0);d&&(b="/"+b);b=ua(b,c);a.$$path=decodeURIComponent(d&&"/"===b.pathname.charAt(0)?b.pathname.substring(1):b.pathname);a.$$search=ec(b.search);a.$$hash=decodeURIComponent(b.hash);a.$$path&&"/"!=a.$$path.charAt(0)&&(a.$$path="/"+a.$$path)}function ra(b,a){if(0===a.indexOf(b))return a.substr(b.length)}function eb(b){var a=
b.indexOf("#");return-1==a?b:b.substr(0,a)}function Rb(b){return b.substr(0,eb(b).lastIndexOf("/")+1)}function Bc(b,a){this.$$html5=!0;a=a||"";var c=Rb(b);zc(b,this,b);this.$$parse=function(a){var e=ra(c,a);if(!v(e))throw Sb("ipthprfx",a,c);Ac(e,this,b);this.$$path||(this.$$path="/");this.$$compose()};this.$$compose=function(){var a=Cb(this.$$search),b=this.$$hash?"#"+lb(this.$$hash):"";this.$$url=Qb(this.$$path)+(a?"?"+a:"")+b;this.$$absUrl=c+this.$$url.substr(1)};this.$$rewrite=function(d){var e;
if((e=ra(b,d))!==t)return d=e,(e=ra(a,e))!==t?c+(ra("/",e)||e):b+d;if((e=ra(c,d))!==t)return c+e;if(c==d+"/")return c}}function Tb(b,a){var c=Rb(b);zc(b,this,b);this.$$parse=function(d){var e=ra(b,d)||ra(c,d),e="#"==e.charAt(0)?ra(a,e):this.$$html5?e:"";if(!v(e))throw Sb("ihshprfx",d,a);Ac(e,this,b);d=this.$$path;var f=/^\/[A-Z]:(\/.*)/;0===e.indexOf(b)&&(e=e.replace(b,""));f.exec(e)||(d=(e=f.exec(d))?e[1]:d);this.$$path=d;this.$$compose()};this.$$compose=function(){var c=Cb(this.$$search),e=this.$$hash?
"#"+lb(this.$$hash):"";this.$$url=Qb(this.$$path)+(c?"?"+c:"")+e;this.$$absUrl=b+(this.$$url?a+this.$$url:"")};this.$$rewrite=function(a){if(eb(b)==eb(a))return a}}function Ub(b,a){this.$$html5=!0;Tb.apply(this,arguments);var c=Rb(b);this.$$rewrite=function(d){var e;if(b==eb(d))return d;if(e=ra(c,d))return b+a+e;if(c===d+"/")return c};this.$$compose=function(){var c=Cb(this.$$search),e=this.$$hash?"#"+lb(this.$$hash):"";this.$$url=Qb(this.$$path)+(c?"?"+c:"")+e;this.$$absUrl=b+a+this.$$url}}function tb(b){return function(){return this[b]}}
function Cc(b,a){return function(c){if(x(c))return this[b];this[b]=a(c);this.$$compose();return this}}function Wd(){var b="",a=!1;this.hashPrefix=function(a){return y(a)?(b=a,this):b};this.html5Mode=function(b){return y(b)?(a=b,this):a};this.$get=["$rootScope","$browser","$sniffer","$rootElement",function(c,d,e,f){function g(a){c.$broadcast("$locationChangeSuccess",k.absUrl(),a)}var k,m,h=d.baseHref(),l=d.url(),n;a?(n=l.substring(0,l.indexOf("/",l.indexOf("//")+2))+(h||"/"),m=e.history?Bc:Ub):(n=
eb(l),m=Tb);k=new m(n,"#"+b);k.$$parse(k.$$rewrite(l));var p=/^\s*(javascript|mailto):/i;f.on("click",function(a){if(!a.ctrlKey&&!a.metaKey&&2!=a.which){for(var e=w(a.target);"a"!==K(e[0].nodeName);)if(e[0]===f[0]||!(e=e.parent())[0])return;var g=e.prop("href");T(g)&&"[object SVGAnimatedString]"===g.toString()&&(g=ua(g.animVal).href);if(!p.test(g)){if(m===Ub){var h=e.attr("href")||e.attr("xlink:href");if(h&&0>h.indexOf("://"))if(g="#"+b,"/"==h[0])g=n+g+h;else if("#"==h[0])g=n+g+(k.path()||"/")+h;
else{var l=k.path().split("/"),h=h.split("/");2!==l.length||l[1]||(l.length=1);for(var q=0;q<h.length;q++)"."!=h[q]&&(".."==h[q]?l.pop():h[q].length&&l.push(h[q]));g=n+g+l.join("/")}}l=k.$$rewrite(g);g&&(!e.attr("target")&&l&&!a.isDefaultPrevented())&&(a.preventDefault(),l!=d.url()&&(k.$$parse(l),c.$apply(),W.angular["ff-684208-preventDefault"]=!0))}}});k.absUrl()!=l&&d.url(k.absUrl(),!0);d.onUrlChange(function(a){k.absUrl()!=a&&(c.$evalAsync(function(){var b=k.absUrl();k.$$parse(a);c.$broadcast("$locationChangeStart",
a,b).defaultPrevented?(k.$$parse(b),d.url(b)):g(b)}),c.$$phase||c.$digest())});var q=0;c.$watch(function(){var a=d.url(),b=k.$$replace;q&&a==k.absUrl()||(q++,c.$evalAsync(function(){c.$broadcast("$locationChangeStart",k.absUrl(),a).defaultPrevented?k.$$parse(a):(d.url(k.absUrl(),b),g(a))}));k.$$replace=!1;return q});return k}]}function Xd(){var b=!0,a=this;this.debugEnabled=function(a){return y(a)?(b=a,this):b};this.$get=["$window",function(c){function d(a){a instanceof Error&&(a.stack?a=a.message&&
-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line));return a}function e(a){var b=c.console||{},e=b[a]||b.log||E;a=!1;try{a=!!e.apply}catch(m){}return a?function(){var a=[];r(arguments,function(b){a.push(d(b))});return e.apply(b,a)}:function(a,b){e(a,null==b?"":b)}}return{log:e("log"),info:e("info"),warn:e("warn"),error:e("error"),debug:function(){var c=e("debug");return function(){b&&c.apply(a,arguments)}}()}}]}function ka(b,
a){if("__defineGetter__"===b||"__defineSetter__"===b||"__lookupGetter__"===b||"__lookupSetter__"===b||"__proto__"===b)throw la("isecfld",a);return b}function va(b,a){if(b){if(b.constructor===b)throw la("isecfn",a);if(b.document&&b.location&&b.alert&&b.setInterval)throw la("isecwindow",a);if(b.children&&(b.nodeName||b.prop&&b.attr&&b.find))throw la("isecdom",a);if(b===Object)throw la("isecobj",a);}return b}function ub(b,a,c,d,e){va(b,d);e=e||{};a=a.split(".");for(var f,g=0;1<a.length;g++){f=ka(a.shift(),
d);var k=va(b[f],d);k||(k={},b[f]=k);b=k;b.then&&e.unwrapPromises&&(wa(d),"$$v"in b||function(a){a.then(function(b){a.$$v=b})}(b),b.$$v===t&&(b.$$v={}),b=b.$$v)}f=ka(a.shift(),d);va(b[f],d);return b[f]=c}function Dc(b,a,c,d,e,f,g){ka(b,f);ka(a,f);ka(c,f);ka(d,f);ka(e,f);return g.unwrapPromises?function(g,m){var h=m&&m.hasOwnProperty(b)?m:g,l;if(null==h)return h;(h=h[b])&&h.then&&(wa(f),"$$v"in h||(l=h,l.$$v=t,l.then(function(a){l.$$v=a})),h=h.$$v);if(!a)return h;if(null==h)return t;(h=h[a])&&h.then&&
(wa(f),"$$v"in h||(l=h,l.$$v=t,l.then(function(a){l.$$v=a})),h=h.$$v);if(!c)return h;if(null==h)return t;(h=h[c])&&h.then&&(wa(f),"$$v"in h||(l=h,l.$$v=t,l.then(function(a){l.$$v=a})),h=h.$$v);if(!d)return h;if(null==h)return t;(h=h[d])&&h.then&&(wa(f),"$$v"in h||(l=h,l.$$v=t,l.then(function(a){l.$$v=a})),h=h.$$v);if(!e)return h;if(null==h)return t;(h=h[e])&&h.then&&(wa(f),"$$v"in h||(l=h,l.$$v=t,l.then(function(a){l.$$v=a})),h=h.$$v);return h}:function(f,g){var h=g&&g.hasOwnProperty(b)?g:f;if(null==
h)return h;h=h[b];if(!a)return h;if(null==h)return t;h=h[a];if(!c)return h;if(null==h)return t;h=h[c];if(!d)return h;if(null==h)return t;h=h[d];return e?null==h?t:h=h[e]:h}}function Ec(b,a,c){if(Vb.hasOwnProperty(b))return Vb[b];var d=b.split("."),e=d.length,f;if(a.csp)f=6>e?Dc(d[0],d[1],d[2],d[3],d[4],c,a):function(b,f){var g=0,k;do k=Dc(d[g++],d[g++],d[g++],d[g++],d[g++],c,a)(b,f),f=t,b=k;while(g<e);return k};else{var g="var p;\n";r(d,function(b,d){ka(b,c);g+="if(s == null) return undefined;\ns="+
(d?"s":'((k&&k.hasOwnProperty("'+b+'"))?k:s)')+'["'+b+'"];\n'+(a.unwrapPromises?'if (s && s.then) {\n pw("'+c.replace(/(["\r\n])/g,"\\$1")+'");\n if (!("$$v" in s)) {\n p=s;\n p.$$v = undefined;\n p.then(function(v) {p.$$v=v;});\n}\n s=s.$$v\n}\n':"")});var g=g+"return s;",k=new Function("s","k","pw",g);k.toString=ba(g);f=a.unwrapPromises?function(a,b){return k(a,b,wa)}:k}"hasOwnProperty"!==b&&(Vb[b]=f);return f}function Yd(){var b={},a={csp:!1,unwrapPromises:!1,logPromiseWarnings:!0};this.unwrapPromises=
function(b){return y(b)?(a.unwrapPromises=!!b,this):a.unwrapPromises};this.logPromiseWarnings=function(b){return y(b)?(a.logPromiseWarnings=b,this):a.logPromiseWarnings};this.$get=["$filter","$sniffer","$log",function(c,d,e){a.csp=d.csp;wa=function(b){a.logPromiseWarnings&&!Fc.hasOwnProperty(b)&&(Fc[b]=!0,e.warn("[$parse] Promise found in the expression `"+b+"`. Automatic unwrapping of promises in Angular expressions is deprecated."))};return function(d){var e;switch(typeof d){case "string":if(b.hasOwnProperty(d))return b[d];
e=new Wb(a);e=(new fb(e,c,a)).parse(d);"hasOwnProperty"!==d&&(b[d]=e);return e;case "function":return d;default:return E}}}]}function $d(){this.$get=["$rootScope","$exceptionHandler",function(b,a){return Ae(function(a){b.$evalAsync(a)},a)}]}function Ae(b,a){function c(a){return a}function d(a){return g(a)}var e=function(){var g=[],h,l;return l={resolve:function(a){if(g){var c=g;g=t;h=f(a);c.length&&b(function(){for(var a,b=0,d=c.length;b<d;b++)a=c[b],h.then(a[0],a[1],a[2])})}},reject:function(a){l.resolve(k(a))},
notify:function(a){if(g){var c=g;g.length&&b(function(){for(var b,d=0,e=c.length;d<e;d++)b=c[d],b[2](a)})}},promise:{then:function(b,f,k){var l=e(),F=function(d){try{l.resolve((P(b)?b:c)(d))}catch(e){l.reject(e),a(e)}},u=function(b){try{l.resolve((P(f)?f:d)(b))}catch(c){l.reject(c),a(c)}},A=function(b){try{l.notify((P(k)?k:c)(b))}catch(d){a(d)}};g?g.push([F,u,A]):h.then(F,u,A);return l.promise},"catch":function(a){return this.then(null,a)},"finally":function(a){function b(a,c){var d=e();c?d.resolve(a):
d.reject(a);return d.promise}function d(e,f){var g=null;try{g=(a||c)()}catch(k){return b(k,!1)}return g&&P(g.then)?g.then(function(){return b(e,f)},function(a){return b(a,!1)}):b(e,f)}return this.then(function(a){return d(a,!0)},function(a){return d(a,!1)})}}}},f=function(a){return a&&P(a.then)?a:{then:function(c){var d=e();b(function(){d.resolve(c(a))});return d.promise}}},g=function(a){var b=e();b.reject(a);return b.promise},k=function(c){return{then:function(f,g){var k=e();b(function(){try{k.resolve((P(g)?
g:d)(c))}catch(b){k.reject(b),a(b)}});return k.promise}}};return{defer:e,reject:g,when:function(k,h,l,n){var p=e(),q,s=function(b){try{return(P(h)?h:c)(b)}catch(d){return a(d),g(d)}},F=function(b){try{return(P(l)?l:d)(b)}catch(c){return a(c),g(c)}},u=function(b){try{return(P(n)?n:c)(b)}catch(d){a(d)}};b(function(){f(k).then(function(a){q||(q=!0,p.resolve(f(a).then(s,F,u)))},function(a){q||(q=!0,p.resolve(F(a)))},function(a){q||p.notify(u(a))})});return p.promise},all:function(a){var b=e(),c=0,d=J(a)?
[]:{};r(a,function(a,e){c++;f(a).then(function(a){d.hasOwnProperty(e)||(d[e]=a,--c||b.resolve(d))},function(a){d.hasOwnProperty(e)||b.reject(a)})});0===c&&b.resolve(d);return b.promise}}}function ge(){this.$get=["$window","$timeout",function(b,a){var c=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame,d=b.cancelAnimationFrame||b.webkitCancelAnimationFrame||b.mozCancelAnimationFrame||b.webkitCancelRequestAnimationFrame,e=!!c,f=e?function(a){var b=c(a);return function(){d(b)}}:
function(b){var c=a(b,16.66,!1);return function(){a.cancel(c)}};f.supported=e;return f}]}function Zd(){var b=10,a=C("$rootScope"),c=null;this.digestTtl=function(a){arguments.length&&(b=a);return b};this.$get=["$injector","$exceptionHandler","$parse","$browser",function(d,e,f,g){function k(){this.$id=hb();this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null;this["this"]=this.$root=this;this.$$destroyed=!1;this.$$asyncQueue=[];this.$$postDigestQueue=
[];this.$$listeners={};this.$$listenerCount={};this.$$isolateBindings={}}function m(b){if(p.$$phase)throw a("inprog",p.$$phase);p.$$phase=b}function h(a,b){var c=f(a);Wa(c,b);return c}function l(a,b,c){do a.$$listenerCount[c]-=b,0===a.$$listenerCount[c]&&delete a.$$listenerCount[c];while(a=a.$parent)}function n(){}k.prototype={constructor:k,$new:function(a){a?(a=new k,a.$root=this.$root,a.$$asyncQueue=this.$$asyncQueue,a.$$postDigestQueue=this.$$postDigestQueue):(this.$$childScopeClass||(this.$$childScopeClass=
function(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null;this.$$listeners={};this.$$listenerCount={};this.$id=hb();this.$$childScopeClass=null},this.$$childScopeClass.prototype=this),a=new this.$$childScopeClass);a["this"]=a;a.$parent=this;a.$$prevSibling=this.$$childTail;this.$$childHead?this.$$childTail=this.$$childTail.$$nextSibling=a:this.$$childHead=this.$$childTail=a;return a},$watch:function(a,b,d){var e=h(a,"watch"),f=this.$$watchers,g={fn:b,last:n,get:e,exp:a,
eq:!!d};c=null;if(!P(b)){var k=h(b||E,"listener");g.fn=function(a,b,c){k(c)}}if("string"==typeof a&&e.constant){var l=g.fn;g.fn=function(a,b,c){l.call(this,a,b,c);Sa(f,g)}}f||(f=this.$$watchers=[]);f.unshift(g);return function(){Sa(f,g);c=null}},$watchCollection:function(a,b){var c=this,d,e,g,k=1<b.length,h=0,l=f(a),m=[],p={},n=!0,r=0;return this.$watch(function(){d=l(c);var a,b,f;if(T(d))if(Pa(d))for(e!==m&&(e=m,r=e.length=0,h++),a=d.length,r!==a&&(h++,e.length=r=a),b=0;b<a;b++)f=e[b]!==e[b]&&d[b]!==
d[b],f||e[b]===d[b]||(h++,e[b]=d[b]);else{e!==p&&(e=p={},r=0,h++);a=0;for(b in d)d.hasOwnProperty(b)&&(a++,e.hasOwnProperty(b)?(f=e[b]!==e[b]&&d[b]!==d[b],f||e[b]===d[b]||(h++,e[b]=d[b])):(r++,e[b]=d[b],h++));if(r>a)for(b in h++,e)e.hasOwnProperty(b)&&!d.hasOwnProperty(b)&&(r--,delete e[b])}else e!==d&&(e=d,h++);return h},function(){n?(n=!1,b(d,d,c)):b(d,g,c);if(k)if(T(d))if(Pa(d)){g=Array(d.length);for(var a=0;a<d.length;a++)g[a]=d[a]}else for(a in g={},d)kb.call(d,a)&&(g[a]=d[a]);else g=d})},$digest:function(){var d,
f,k,h,l=this.$$asyncQueue,r=this.$$postDigestQueue,R,z,t=b,L,O=[],w,B,I;m("$digest");g.$$checkUrlChange();c=null;do{z=!1;for(L=this;l.length;){try{I=l.shift(),I.scope.$eval(I.expression)}catch(H){p.$$phase=null,e(H)}c=null}a:do{if(h=L.$$watchers)for(R=h.length;R--;)try{if(d=h[R])if((f=d.get(L))!==(k=d.last)&&!(d.eq?Aa(f,k):"number"===typeof f&&"number"===typeof k&&isNaN(f)&&isNaN(k)))z=!0,c=d,d.last=d.eq?Ha(f,null):f,d.fn(f,k===n?f:k,L),5>t&&(w=4-t,O[w]||(O[w]=[]),B=P(d.exp)?"fn: "+(d.exp.name||d.exp.toString()):
d.exp,B+="; newVal: "+na(f)+"; oldVal: "+na(k),O[w].push(B));else if(d===c){z=!1;break a}}catch(y){p.$$phase=null,e(y)}if(!(h=L.$$childHead||L!==this&&L.$$nextSibling))for(;L!==this&&!(h=L.$$nextSibling);)L=L.$parent}while(L=h);if((z||l.length)&&!t--)throw p.$$phase=null,a("infdig",b,na(O));}while(z||l.length);for(p.$$phase=null;r.length;)try{r.shift()()}catch(v){e(v)}},$destroy:function(){if(!this.$$destroyed){var a=this.$parent;this.$broadcast("$destroy");this.$$destroyed=!0;this!==p&&(r(this.$$listenerCount,
Bb(null,l,this)),a.$$childHead==this&&(a.$$childHead=this.$$nextSibling),a.$$childTail==this&&(a.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$parent=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=this.$root=null,this.$$listeners={},this.$$watchers=this.$$asyncQueue=this.$$postDigestQueue=[],this.$destroy=this.$digest=this.$apply=E,this.$on=
this.$watch=function(){return E})}},$eval:function(a,b){return f(a)(this,b)},$evalAsync:function(a){p.$$phase||p.$$asyncQueue.length||g.defer(function(){p.$$asyncQueue.length&&p.$digest()});this.$$asyncQueue.push({scope:this,expression:a})},$$postDigest:function(a){this.$$postDigestQueue.push(a)},$apply:function(a){try{return m("$apply"),this.$eval(a)}catch(b){e(b)}finally{p.$$phase=null;try{p.$digest()}catch(c){throw e(c),c;}}},$on:function(a,b){var c=this.$$listeners[a];c||(this.$$listeners[a]=
c=[]);c.push(b);var d=this;do d.$$listenerCount[a]||(d.$$listenerCount[a]=0),d.$$listenerCount[a]++;while(d=d.$parent);var e=this;return function(){c[Ra(c,b)]=null;l(e,1,a)}},$emit:function(a,b){var c=[],d,f=this,g=!1,k={name:a,targetScope:f,stopPropagation:function(){g=!0},preventDefault:function(){k.defaultPrevented=!0},defaultPrevented:!1},h=[k].concat(Ba.call(arguments,1)),l,m;do{d=f.$$listeners[a]||c;k.currentScope=f;l=0;for(m=d.length;l<m;l++)if(d[l])try{d[l].apply(null,h)}catch(p){e(p)}else d.splice(l,
1),l--,m--;if(g)break;f=f.$parent}while(f);return k},$broadcast:function(a,b){for(var c=this,d=this,f={name:a,targetScope:this,preventDefault:function(){f.defaultPrevented=!0},defaultPrevented:!1},g=[f].concat(Ba.call(arguments,1)),k,h;c=d;){f.currentScope=c;d=c.$$listeners[a]||[];k=0;for(h=d.length;k<h;k++)if(d[k])try{d[k].apply(null,g)}catch(l){e(l)}else d.splice(k,1),k--,h--;if(!(d=c.$$listenerCount[a]&&c.$$childHead||c!==this&&c.$$nextSibling))for(;c!==this&&!(d=c.$$nextSibling);)c=c.$parent}return f}};
var p=new k;return p}]}function cd(){var b=/^\s*(https?|ftp|mailto|tel|file):/,a=/^\s*((https?|ftp|file):|data:image\/)/;this.aHrefSanitizationWhitelist=function(a){return y(a)?(b=a,this):b};this.imgSrcSanitizationWhitelist=function(b){return y(b)?(a=b,this):a};this.$get=function(){return function(c,d){var e=d?a:b,f;if(!Q||8<=Q)if(f=ua(c).href,""!==f&&!f.match(e))return"unsafe:"+f;return c}}}function Be(b){if("self"===b)return b;if(v(b)){if(-1<b.indexOf("***"))throw xa("iwcard",b);b=b.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,
"\\$1").replace(/\x08/g,"\\x08").replace("\\*\\*",".*").replace("\\*","[^:/.?&;]*");return RegExp("^"+b+"$")}if(jb(b))return RegExp("^"+b.source+"$");throw xa("imatcher");}function Gc(b){var a=[];y(b)&&r(b,function(b){a.push(Be(b))});return a}function be(){this.SCE_CONTEXTS=ga;var b=["self"],a=[];this.resourceUrlWhitelist=function(a){arguments.length&&(b=Gc(a));return b};this.resourceUrlBlacklist=function(b){arguments.length&&(a=Gc(b));return a};this.$get=["$injector",function(c){function d(a){var b=
function(a){this.$$unwrapTrustedValue=function(){return a}};a&&(b.prototype=new a);b.prototype.valueOf=function(){return this.$$unwrapTrustedValue()};b.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()};return b}var e=function(a){throw xa("unsafe");};c.has("$sanitize")&&(e=c.get("$sanitize"));var f=d(),g={};g[ga.HTML]=d(f);g[ga.CSS]=d(f);g[ga.URL]=d(f);g[ga.JS]=d(f);g[ga.RESOURCE_URL]=d(g[ga.URL]);return{trustAs:function(a,b){var c=g.hasOwnProperty(a)?g[a]:null;if(!c)throw xa("icontext",
a,b);if(null===b||b===t||""===b)return b;if("string"!==typeof b)throw xa("itype",a);return new c(b)},getTrusted:function(c,d){if(null===d||d===t||""===d)return d;var f=g.hasOwnProperty(c)?g[c]:null;if(f&&d instanceof f)return d.$$unwrapTrustedValue();if(c===ga.RESOURCE_URL){var f=ua(d.toString()),l,n,p=!1;l=0;for(n=b.length;l<n;l++)if("self"===b[l]?Pb(f):b[l].exec(f.href)){p=!0;break}if(p)for(l=0,n=a.length;l<n;l++)if("self"===a[l]?Pb(f):a[l].exec(f.href)){p=!1;break}if(p)return d;throw xa("insecurl",
d.toString());}if(c===ga.HTML)return e(d);throw xa("unsafe");},valueOf:function(a){return a instanceof f?a.$$unwrapTrustedValue():a}}}]}function ae(){var b=!0;this.enabled=function(a){arguments.length&&(b=!!a);return b};this.$get=["$parse","$sniffer","$sceDelegate",function(a,c,d){if(b&&c.msie&&8>c.msieDocumentMode)throw xa("iequirks");var e=ha(ga);e.isEnabled=function(){return b};e.trustAs=d.trustAs;e.getTrusted=d.getTrusted;e.valueOf=d.valueOf;b||(e.trustAs=e.getTrusted=function(a,b){return b},
e.valueOf=Qa);e.parseAs=function(b,c){var d=a(c);return d.literal&&d.constant?d:function(a,c){return e.getTrusted(b,d(a,c))}};var f=e.parseAs,g=e.getTrusted,k=e.trustAs;r(ga,function(a,b){var c=K(b);e[Za("parse_as_"+c)]=function(b){return f(a,b)};e[Za("get_trusted_"+c)]=function(b){return g(a,b)};e[Za("trust_as_"+c)]=function(b){return k(a,b)}});return e}]}function ce(){this.$get=["$window","$document",function(b,a){var c={},d=U((/android (\d+)/.exec(K((b.navigator||{}).userAgent))||[])[1]),e=/Boxee/i.test((b.navigator||
{}).userAgent),f=a[0]||{},g=f.documentMode,k,m=/^(Moz|webkit|O|ms)(?=[A-Z])/,h=f.body&&f.body.style,l=!1,n=!1;if(h){for(var p in h)if(l=m.exec(p)){k=l[0];k=k.substr(0,1).toUpperCase()+k.substr(1);break}k||(k="WebkitOpacity"in h&&"webkit");l=!!("transition"in h||k+"Transition"in h);n=!!("animation"in h||k+"Animation"in h);!d||l&&n||(l=v(f.body.style.webkitTransition),n=v(f.body.style.webkitAnimation))}return{history:!(!b.history||!b.history.pushState||4>d||e),hashchange:"onhashchange"in b&&(!g||7<
g),hasEvent:function(a){if("input"==a&&9==Q)return!1;if(x(c[a])){var b=f.createElement("div");c[a]="on"+a in b}return c[a]},csp:Xa(),vendorPrefix:k,transitions:l,animations:n,android:d,msie:Q,msieDocumentMode:g}}]}function ee(){this.$get=["$rootScope","$browser","$q","$exceptionHandler",function(b,a,c,d){function e(e,k,m){var h=c.defer(),l=h.promise,n=y(m)&&!m;k=a.defer(function(){try{h.resolve(e())}catch(a){h.reject(a),d(a)}finally{delete f[l.$$timeoutId]}n||b.$apply()},k);l.$$timeoutId=k;f[k]=h;
return l}var f={};e.cancel=function(b){return b&&b.$$timeoutId in f?(f[b.$$timeoutId].reject("canceled"),delete f[b.$$timeoutId],a.defer.cancel(b.$$timeoutId)):!1};return e}]}function ua(b,a){var c=b;Q&&(Y.setAttribute("href",c),c=Y.href);Y.setAttribute("href",c);return{href:Y.href,protocol:Y.protocol?Y.protocol.replace(/:$/,""):"",host:Y.host,search:Y.search?Y.search.replace(/^\?/,""):"",hash:Y.hash?Y.hash.replace(/^#/,""):"",hostname:Y.hostname,port:Y.port,pathname:"/"===Y.pathname.charAt(0)?Y.pathname:
"/"+Y.pathname}}function Pb(b){b=v(b)?ua(b):b;return b.protocol===Hc.protocol&&b.host===Hc.host}function fe(){this.$get=ba(W)}function mc(b){function a(d,e){if(T(d)){var f={};r(d,function(b,c){f[c]=a(c,b)});return f}return b.factory(d+c,e)}var c="Filter";this.register=a;this.$get=["$injector",function(a){return function(b){return a.get(b+c)}}];a("currency",Ic);a("date",Jc);a("filter",Ce);a("json",De);a("limitTo",Ee);a("lowercase",Fe);a("number",Kc);a("orderBy",Lc);a("uppercase",Ge)}function Ce(){return function(b,
a,c){if(!J(b))return b;var d=typeof c,e=[];e.check=function(a){for(var b=0;b<e.length;b++)if(!e[b](a))return!1;return!0};"function"!==d&&(c="boolean"===d&&c?function(a,b){return Va.equals(a,b)}:function(a,b){if(a&&b&&"object"===typeof a&&"object"===typeof b){for(var d in a)if("$"!==d.charAt(0)&&kb.call(a,d)&&c(a[d],b[d]))return!0;return!1}b=(""+b).toLowerCase();return-1<(""+a).toLowerCase().indexOf(b)});var f=function(a,b){if("string"==typeof b&&"!"===b.charAt(0))return!f(a,b.substr(1));switch(typeof a){case "boolean":case "number":case "string":return c(a,
b);case "object":switch(typeof b){case "object":return c(a,b);default:for(var d in a)if("$"!==d.charAt(0)&&f(a[d],b))return!0}return!1;case "array":for(d=0;d<a.length;d++)if(f(a[d],b))return!0;return!1;default:return!1}};switch(typeof a){case "boolean":case "number":case "string":a={$:a};case "object":for(var g in a)(function(b){"undefined"!==typeof a[b]&&e.push(function(c){return f("$"==b?c:c&&c[b],a[b])})})(g);break;case "function":e.push(a);break;default:return b}d=[];for(g=0;g<b.length;g++){var k=
b[g];e.check(k)&&d.push(k)}return d}}function Ic(b){var a=b.NUMBER_FORMATS;return function(b,d){x(d)&&(d=a.CURRENCY_SYM);return Mc(b,a.PATTERNS[1],a.GROUP_SEP,a.DECIMAL_SEP,2).replace(/\u00A4/g,d)}}function Kc(b){var a=b.NUMBER_FORMATS;return function(b,d){return Mc(b,a.PATTERNS[0],a.GROUP_SEP,a.DECIMAL_SEP,d)}}function Mc(b,a,c,d,e){if(null==b||!isFinite(b)||T(b))return"";var f=0>b;b=Math.abs(b);var g=b+"",k="",m=[],h=!1;if(-1!==g.indexOf("e")){var l=g.match(/([\d\.]+)e(-?)(\d+)/);l&&"-"==l[2]&&
l[3]>e+1?(g="0",b=0):(k=g,h=!0)}if(h)0<e&&(-1<b&&1>b)&&(k=b.toFixed(e));else{g=(g.split(Nc)[1]||"").length;x(e)&&(e=Math.min(Math.max(a.minFrac,g),a.maxFrac));b=+(Math.round(+(b.toString()+"e"+e)).toString()+"e"+-e);0===b&&(f=!1);b=(""+b).split(Nc);g=b[0];b=b[1]||"";var l=0,n=a.lgSize,p=a.gSize;if(g.length>=n+p)for(l=g.length-n,h=0;h<l;h++)0===(l-h)%p&&0!==h&&(k+=c),k+=g.charAt(h);for(h=l;h<g.length;h++)0===(g.length-h)%n&&0!==h&&(k+=c),k+=g.charAt(h);for(;b.length<e;)b+="0";e&&"0"!==e&&(k+=d+b.substr(0,
e))}m.push(f?a.negPre:a.posPre);m.push(k);m.push(f?a.negSuf:a.posSuf);return m.join("")}function Xb(b,a,c){var d="";0>b&&(d="-",b=-b);for(b=""+b;b.length<a;)b="0"+b;c&&(b=b.substr(b.length-a));return d+b}function $(b,a,c,d){c=c||0;return function(e){e=e["get"+b]();if(0<c||e>-c)e+=c;0===e&&-12==c&&(e=12);return Xb(e,a,d)}}function vb(b,a){return function(c,d){var e=c["get"+b](),f=Ia(a?"SHORT"+b:b);return d[f][e]}}function Jc(b){function a(a){var b;if(b=a.match(c)){a=new Date(0);var f=0,g=0,k=b[8]?
a.setUTCFullYear:a.setFullYear,m=b[8]?a.setUTCHours:a.setHours;b[9]&&(f=U(b[9]+b[10]),g=U(b[9]+b[11]));k.call(a,U(b[1]),U(b[2])-1,U(b[3]));f=U(b[4]||0)-f;g=U(b[5]||0)-g;k=U(b[6]||0);b=Math.round(1E3*parseFloat("0."+(b[7]||0)));m.call(a,f,g,k,b)}return a}var c=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(c,e){var f="",g=[],k,m;e=e||"mediumDate";e=b.DATETIME_FORMATS[e]||e;v(c)&&(c=He.test(c)?U(c):a(c));ib(c)&&(c=new Date(c));
if(!ta(c))return c;for(;e;)(m=Ie.exec(e))?(g=g.concat(Ba.call(m,1)),e=g.pop()):(g.push(e),e=null);r(g,function(a){k=Je[a];f+=k?k(c,b.DATETIME_FORMATS):a.replace(/(^'|'$)/g,"").replace(/''/g,"'")});return f}}function De(){return function(b){return na(b,!0)}}function Ee(){return function(b,a){if(!J(b)&&!v(b))return b;a=Infinity===Math.abs(Number(a))?Number(a):U(a);if(v(b))return a?0<=a?b.slice(0,a):b.slice(a,b.length):"";var c=[],d,e;a>b.length?a=b.length:a<-b.length&&(a=-b.length);0<a?(d=0,e=a):(d=
b.length+a,e=b.length);for(;d<e;d++)c.push(b[d]);return c}}function Lc(b){return function(a,c,d){function e(a,b){return Ua(b)?function(b,c){return a(c,b)}:a}function f(a,b){var c=typeof a,d=typeof b;return c==d?(ta(a)&&ta(b)&&(a=a.valueOf(),b=b.valueOf()),"string"==c&&(a=a.toLowerCase(),b=b.toLowerCase()),a===b?0:a<b?-1:1):c<d?-1:1}if(!Pa(a)||!c)return a;c=J(c)?c:[c];c=Vc(c,function(a){var c=!1,d=a||Qa;if(v(a)){if("+"==a.charAt(0)||"-"==a.charAt(0))c="-"==a.charAt(0),a=a.substring(1);d=b(a);if(d.constant){var g=
d();return e(function(a,b){return f(a[g],b[g])},c)}}return e(function(a,b){return f(d(a),d(b))},c)});for(var g=[],k=0;k<a.length;k++)g.push(a[k]);return g.sort(e(function(a,b){for(var d=0;d<c.length;d++){var e=c[d](a,b);if(0!==e)return e}return 0},d))}}function ya(b){P(b)&&(b={link:b});b.restrict=b.restrict||"AC";return ba(b)}function Oc(b,a,c,d){function e(a,c){c=c?"-"+mb(c,"-"):"";d.setClass(b,(a?wb:xb)+c,(a?xb:wb)+c)}var f=this,g=b.parent().controller("form")||yb,k=0,m=f.$error={},h=[];f.$name=
a.name||a.ngForm;f.$dirty=!1;f.$pristine=!0;f.$valid=!0;f.$invalid=!1;g.$addControl(f);b.addClass(Oa);e(!0);f.$addControl=function(a){Da(a.$name,"input");h.push(a);a.$name&&(f[a.$name]=a)};f.$removeControl=function(a){a.$name&&f[a.$name]===a&&delete f[a.$name];r(m,function(b,c){f.$setValidity(c,!0,a)});Sa(h,a)};f.$setValidity=function(a,b,c){var d=m[a];if(b)d&&(Sa(d,c),d.length||(k--,k||(e(b),f.$valid=!0,f.$invalid=!1),m[a]=!1,e(!0,a),g.$setValidity(a,!0,f)));else{k||e(b);if(d){if(-1!=Ra(d,c))return}else m[a]=
d=[],k++,e(!1,a),g.$setValidity(a,!1,f);d.push(c);f.$valid=!1;f.$invalid=!0}};f.$setDirty=function(){d.removeClass(b,Oa);d.addClass(b,zb);f.$dirty=!0;f.$pristine=!1;g.$setDirty()};f.$setPristine=function(){d.removeClass(b,zb);d.addClass(b,Oa);f.$dirty=!1;f.$pristine=!0;r(h,function(a){a.$setPristine()})}}function sa(b,a,c,d){b.$setValidity(a,c);return c?d:t}function Pc(b,a){var c,d;if(a)for(c=0;c<a.length;++c)if(d=a[c],b[d])return!0;return!1}function Ke(b,a,c,d,e){T(e)&&(b.$$hasNativeValidators=!0,
b.$parsers.push(function(f){if(b.$error[a]||Pc(e,d)||!Pc(e,c))return f;b.$setValidity(a,!1)}))}function Ab(b,a,c,d,e,f){var g=a.prop(Le),k=a[0].placeholder,m={},h=K(a[0].type);d.$$validityState=g;if(!e.android){var l=!1;a.on("compositionstart",function(a){l=!0});a.on("compositionend",function(){l=!1;n()})}var n=function(e){if(!l){var f=a.val();if(Q&&"input"===(e||m).type&&a[0].placeholder!==k)k=a[0].placeholder;else if("password"!==h&&Ua(c.ngTrim||"T")&&(f=aa(f)),e=g&&d.$$hasNativeValidators,d.$viewValue!==
f||""===f&&e)b.$root.$$phase?d.$setViewValue(f):b.$apply(function(){d.$setViewValue(f)})}};if(e.hasEvent("input"))a.on("input",n);else{var p,q=function(){p||(p=f.defer(function(){n();p=null}))};a.on("keydown",function(a){a=a.keyCode;91===a||(15<a&&19>a||37<=a&&40>=a)||q()});if(e.hasEvent("paste"))a.on("paste cut",q)}a.on("change",n);d.$render=function(){a.val(d.$isEmpty(d.$viewValue)?"":d.$viewValue)};var s=c.ngPattern;s&&((e=s.match(/^\/(.*)\/([gim]*)$/))?(s=RegExp(e[1],e[2]),e=function(a){return sa(d,
"pattern",d.$isEmpty(a)||s.test(a),a)}):e=function(c){var e=b.$eval(s);if(!e||!e.test)throw C("ngPattern")("noregexp",s,e,ia(a));return sa(d,"pattern",d.$isEmpty(c)||e.test(c),c)},d.$formatters.push(e),d.$parsers.push(e));if(c.ngMinlength){var r=U(c.ngMinlength);e=function(a){return sa(d,"minlength",d.$isEmpty(a)||a.length>=r,a)};d.$parsers.push(e);d.$formatters.push(e)}if(c.ngMaxlength){var u=U(c.ngMaxlength);e=function(a){return sa(d,"maxlength",d.$isEmpty(a)||a.length<=u,a)};d.$parsers.push(e);
d.$formatters.push(e)}}function Yb(b,a){b="ngClass"+b;return["$animate",function(c){function d(a,b){var c=[],d=0;a:for(;d<a.length;d++){for(var e=a[d],l=0;l<b.length;l++)if(e==b[l])continue a;c.push(e)}return c}function e(a){if(!J(a)){if(v(a))return a.split(" ");if(T(a)){var b=[];r(a,function(a,c){a&&(b=b.concat(c.split(" ")))});return b}}return a}return{restrict:"AC",link:function(f,g,k){function m(a,b){var c=g.data("$classCounts")||{},d=[];r(a,function(a){if(0<b||c[a])c[a]=(c[a]||0)+b,c[a]===+(0<
b)&&d.push(a)});g.data("$classCounts",c);return d.join(" ")}function h(b){if(!0===a||f.$index%2===a){var h=e(b||[]);if(!l){var q=m(h,1);k.$addClass(q)}else if(!Aa(b,l)){var s=e(l),q=d(h,s),h=d(s,h),h=m(h,-1),q=m(q,1);0===q.length?c.removeClass(g,h):0===h.length?c.addClass(g,q):c.setClass(g,q,h)}}l=ha(b)}var l;f.$watch(k[b],h,!0);k.$observe("class",function(a){h(f.$eval(k[b]))});"ngClass"!==b&&f.$watch("$index",function(c,d){var g=c&1;if(g!==(d&1)){var h=e(f.$eval(k[b]));g===a?(g=m(h,1),k.$addClass(g)):
(g=m(h,-1),k.$removeClass(g))}})}}}]}var Le="validity",K=function(b){return v(b)?b.toLowerCase():b},kb=Object.prototype.hasOwnProperty,Ia=function(b){return v(b)?b.toUpperCase():b},Q,w,Ea,Ba=[].slice,Me=[].push,za=Object.prototype.toString,Ta=C("ng"),Va=W.angular||(W.angular={}),Ya,Ma,ma=["0","0","0"];Q=U((/msie (\d+)/.exec(K(navigator.userAgent))||[])[1]);isNaN(Q)&&(Q=U((/trident\/.*; rv:(\d+)/.exec(K(navigator.userAgent))||[])[1]));E.$inject=[];Qa.$inject=[];var J=function(){return P(Array.isArray)?
Array.isArray:function(b){return"[object Array]"===za.call(b)}}(),aa=function(){return String.prototype.trim?function(b){return v(b)?b.trim():b}:function(b){return v(b)?b.replace(/^\s\s*/,"").replace(/\s\s*$/,""):b}}();Ma=9>Q?function(b){b=b.nodeName?b:b[0];return b.scopeName&&"HTML"!=b.scopeName?Ia(b.scopeName+":"+b.nodeName):b.nodeName}:function(b){return b.nodeName?b.nodeName:b[0].nodeName};var Xa=function(){if(y(Xa.isActive_))return Xa.isActive_;var b=!(!X.querySelector("[ng-csp]")&&!X.querySelector("[data-ng-csp]"));
if(!b)try{new Function("")}catch(a){b=!0}return Xa.isActive_=b},Yc=/[A-Z]/g,ad={full:"1.2.26",major:1,minor:2,dot:26,codeName:"captivating-disinterest"};S.expando="ng339";var ab=S.cache={},ne=1,sb=W.document.addEventListener?function(b,a,c){b.addEventListener(a,c,!1)}:function(b,a,c){b.attachEvent("on"+a,c)},$a=W.document.removeEventListener?function(b,a,c){b.removeEventListener(a,c,!1)}:function(b,a,c){b.detachEvent("on"+a,c)};S._data=function(b){return this.cache[b[this.expando]]||{}};var ie=/([\:\-\_]+(.))/g,
je=/^moz([A-Z])/,Hb=C("jqLite"),ke=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,Ib=/<|&#?\w+;/,le=/<([\w:]+)/,me=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ea={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ea.optgroup=ea.option;ea.tbody=ea.tfoot=ea.colgroup=ea.caption=ea.thead;ea.th=
ea.td;var La=S.prototype={ready:function(b){function a(){c||(c=!0,b())}var c=!1;"complete"===X.readyState?setTimeout(a):(this.on("DOMContentLoaded",a),S(W).on("load",a))},toString:function(){var b=[];r(this,function(a){b.push(""+a)});return"["+b.join(", ")+"]"},eq:function(b){return 0<=b?w(this[b]):w(this[this.length+b])},length:0,push:Me,sort:[].sort,splice:[].splice},qb={};r("multiple selected checked disabled readOnly required open".split(" "),function(b){qb[K(b)]=b});var rc={};r("input select option textarea button form details".split(" "),
function(b){rc[Ia(b)]=!0});r({data:Mb,removeData:Lb},function(b,a){S[a]=b});r({data:Mb,inheritedData:pb,scope:function(b){return w.data(b,"$scope")||pb(b.parentNode||b,["$isolateScope","$scope"])},isolateScope:function(b){return w.data(b,"$isolateScope")||w.data(b,"$isolateScopeNoTemplate")},controller:oc,injector:function(b){return pb(b,"$injector")},removeAttr:function(b,a){b.removeAttribute(a)},hasClass:Nb,css:function(b,a,c){a=Za(a);if(y(c))b.style[a]=c;else{var d;8>=Q&&(d=b.currentStyle&&b.currentStyle[a],
""===d&&(d="auto"));d=d||b.style[a];8>=Q&&(d=""===d?t:d);return d}},attr:function(b,a,c){var d=K(a);if(qb[d])if(y(c))c?(b[a]=!0,b.setAttribute(a,d)):(b[a]=!1,b.removeAttribute(d));else return b[a]||(b.attributes.getNamedItem(a)||E).specified?d:t;else if(y(c))b.setAttribute(a,c);else if(b.getAttribute)return b=b.getAttribute(a,2),null===b?t:b},prop:function(b,a,c){if(y(c))b[a]=c;else return b[a]},text:function(){function b(b,d){var e=a[b.nodeType];if(x(d))return e?b[e]:"";b[e]=d}var a=[];9>Q?(a[1]=
"innerText",a[3]="nodeValue"):a[1]=a[3]="textContent";b.$dv="";return b}(),val:function(b,a){if(x(a)){if("SELECT"===Ma(b)&&b.multiple){var c=[];r(b.options,function(a){a.selected&&c.push(a.value||a.text)});return 0===c.length?null:c}return b.value}b.value=a},html:function(b,a){if(x(a))return b.innerHTML;for(var c=0,d=b.childNodes;c<d.length;c++)Ja(d[c]);b.innerHTML=a},empty:pc},function(b,a){S.prototype[a]=function(a,d){var e,f,g=this.length;if(b!==pc&&(2==b.length&&b!==Nb&&b!==oc?a:d)===t){if(T(a)){for(e=
0;e<g;e++)if(b===Mb)b(this[e],a);else for(f in a)b(this[e],f,a[f]);return this}e=b.$dv;g=e===t?Math.min(g,1):g;for(f=0;f<g;f++){var k=b(this[f],a,d);e=e?e+k:k}return e}for(e=0;e<g;e++)b(this[e],a,d);return this}});r({removeData:Lb,dealoc:Ja,on:function a(c,d,e,f){if(y(f))throw Hb("onargs");var g=oa(c,"events"),k=oa(c,"handle");g||oa(c,"events",g={});k||oa(c,"handle",k=oe(c,g));r(d.split(" "),function(d){var f=g[d];if(!f){if("mouseenter"==d||"mouseleave"==d){var l=X.body.contains||X.body.compareDocumentPosition?
function(a,c){var d=9===a.nodeType?a.documentElement:a,e=c&&c.parentNode;return a===e||!!(e&&1===e.nodeType&&(d.contains?d.contains(e):a.compareDocumentPosition&&a.compareDocumentPosition(e)&16))}:function(a,c){if(c)for(;c=c.parentNode;)if(c===a)return!0;return!1};g[d]=[];a(c,{mouseleave:"mouseout",mouseenter:"mouseover"}[d],function(a){var c=a.relatedTarget;c&&(c===this||l(this,c))||k(a,d)})}else sb(c,d,k),g[d]=[];f=g[d]}f.push(e)})},off:nc,one:function(a,c,d){a=w(a);a.on(c,function f(){a.off(c,
d);a.off(c,f)});a.on(c,d)},replaceWith:function(a,c){var d,e=a.parentNode;Ja(a);r(new S(c),function(c){d?e.insertBefore(c,d.nextSibling):e.replaceChild(c,a);d=c})},children:function(a){var c=[];r(a.childNodes,function(a){1===a.nodeType&&c.push(a)});return c},contents:function(a){return a.contentDocument||a.childNodes||[]},append:function(a,c){r(new S(c),function(c){1!==a.nodeType&&11!==a.nodeType||a.appendChild(c)})},prepend:function(a,c){if(1===a.nodeType){var d=a.firstChild;r(new S(c),function(c){a.insertBefore(c,
d)})}},wrap:function(a,c){c=w(c)[0];var d=a.parentNode;d&&d.replaceChild(c,a);c.appendChild(a)},remove:function(a){Ja(a);var c=a.parentNode;c&&c.removeChild(a)},after:function(a,c){var d=a,e=a.parentNode;r(new S(c),function(a){e.insertBefore(a,d.nextSibling);d=a})},addClass:ob,removeClass:nb,toggleClass:function(a,c,d){c&&r(c.split(" "),function(c){var f=d;x(f)&&(f=!Nb(a,c));(f?ob:nb)(a,c)})},parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},next:function(a){if(a.nextElementSibling)return a.nextElementSibling;
for(a=a.nextSibling;null!=a&&1!==a.nodeType;)a=a.nextSibling;return a},find:function(a,c){return a.getElementsByTagName?a.getElementsByTagName(c):[]},clone:Kb,triggerHandler:function(a,c,d){var e,f;e=c.type||c;var g=(oa(a,"events")||{})[e];g&&(e={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return!0===this.defaultPrevented},stopPropagation:E,type:e,target:a},c.type&&(e=D(e,c)),c=ha(g),f=d?[e].concat(d):[e],r(c,function(c){c.apply(a,f)}))}},function(a,c){S.prototype[c]=
function(c,e,f){for(var g,k=0;k<this.length;k++)x(g)?(g=a(this[k],c,e,f),y(g)&&(g=w(g))):Jb(g,a(this[k],c,e,f));return y(g)?g:this};S.prototype.bind=S.prototype.on;S.prototype.unbind=S.prototype.off});bb.prototype={put:function(a,c){this[Ka(a,this.nextUid)]=c},get:function(a){return this[Ka(a,this.nextUid)]},remove:function(a){var c=this[a=Ka(a,this.nextUid)];delete this[a];return c}};var qe=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,re=/,/,se=/^\s*(_?)(\S+?)\1\s*$/,pe=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,
cb=C("$injector"),Ne=C("$animate"),Md=["$provide",function(a){this.$$selectors={};this.register=function(c,d){var e=c+"-animation";if(c&&"."!=c.charAt(0))throw Ne("notcsel",c);this.$$selectors[c.substr(1)]=e;a.factory(e,d)};this.classNameFilter=function(a){1===arguments.length&&(this.$$classNameFilter=a instanceof RegExp?a:null);return this.$$classNameFilter};this.$get=["$timeout","$$asyncCallback",function(a,d){return{enter:function(a,c,g,k){g?g.after(a):(c&&c[0]||(c=g.parent()),c.append(a));k&&
d(k)},leave:function(a,c){a.remove();c&&d(c)},move:function(a,c,d,k){this.enter(a,c,d,k)},addClass:function(a,c,g){c=v(c)?c:J(c)?c.join(" "):"";r(a,function(a){ob(a,c)});g&&d(g)},removeClass:function(a,c,g){c=v(c)?c:J(c)?c.join(" "):"";r(a,function(a){nb(a,c)});g&&d(g)},setClass:function(a,c,g,k){r(a,function(a){ob(a,c);nb(a,g)});k&&d(k)},enabled:E}}]}],ja=C("$compile");ic.$inject=["$provide","$$sanitizeUriProvider"];var we=/^(x[\:\-_]|data[\:\-_])/i,yc=C("$interpolate"),Oe=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,
ze={http:80,https:443,ftp:21},Sb=C("$location");Ub.prototype=Tb.prototype=Bc.prototype={$$html5:!1,$$replace:!1,absUrl:tb("$$absUrl"),url:function(a){if(x(a))return this.$$url;a=Oe.exec(a);a[1]&&this.path(decodeURIComponent(a[1]));(a[2]||a[1])&&this.search(a[3]||"");this.hash(a[5]||"");return this},protocol:tb("$$protocol"),host:tb("$$host"),port:tb("$$port"),path:Cc("$$path",function(a){a=a?a.toString():"";return"/"==a.charAt(0)?a:"/"+a}),search:function(a,c){switch(arguments.length){case 0:return this.$$search;
case 1:if(v(a)||ib(a))a=a.toString(),this.$$search=ec(a);else if(T(a))r(a,function(c,e){null==c&&delete a[e]}),this.$$search=a;else throw Sb("isrcharg");break;default:x(c)||null===c?delete this.$$search[a]:this.$$search[a]=c}this.$$compose();return this},hash:Cc("$$hash",function(a){return a?a.toString():""}),replace:function(){this.$$replace=!0;return this}};var la=C("$parse"),Fc={},wa,Pe=Function.prototype.call,Qe=Function.prototype.apply,Qc=Function.prototype.bind,gb={"null":function(){return null},
"true":function(){return!0},"false":function(){return!1},undefined:E,"+":function(a,c,d,e){d=d(a,c);e=e(a,c);return y(d)?y(e)?d+e:d:y(e)?e:t},"-":function(a,c,d,e){d=d(a,c);e=e(a,c);return(y(d)?d:0)-(y(e)?e:0)},"*":function(a,c,d,e){return d(a,c)*e(a,c)},"/":function(a,c,d,e){return d(a,c)/e(a,c)},"%":function(a,c,d,e){return d(a,c)%e(a,c)},"^":function(a,c,d,e){return d(a,c)^e(a,c)},"=":E,"===":function(a,c,d,e){return d(a,c)===e(a,c)},"!==":function(a,c,d,e){return d(a,c)!==e(a,c)},"==":function(a,
c,d,e){return d(a,c)==e(a,c)},"!=":function(a,c,d,e){return d(a,c)!=e(a,c)},"<":function(a,c,d,e){return d(a,c)<e(a,c)},">":function(a,c,d,e){return d(a,c)>e(a,c)},"<=":function(a,c,d,e){return d(a,c)<=e(a,c)},">=":function(a,c,d,e){return d(a,c)>=e(a,c)},"&&":function(a,c,d,e){return d(a,c)&&e(a,c)},"||":function(a,c,d,e){return d(a,c)||e(a,c)},"&":function(a,c,d,e){return d(a,c)&e(a,c)},"|":function(a,c,d,e){return e(a,c)(a,c,d(a,c))},"!":function(a,c,d){return!d(a,c)}},Re={n:"\n",f:"\f",r:"\r",
t:"\t",v:"\v","'":"'",'"':'"'},Wb=function(a){this.options=a};Wb.prototype={constructor:Wb,lex:function(a){this.text=a;this.index=0;this.ch=t;this.lastCh=":";for(this.tokens=[];this.index<this.text.length;){this.ch=this.text.charAt(this.index);if(this.is("\"'"))this.readString(this.ch);else if(this.isNumber(this.ch)||this.is(".")&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdent(this.ch))this.readIdent();else if(this.is("(){}[].,;:?"))this.tokens.push({index:this.index,text:this.ch}),
this.index++;else if(this.isWhitespace(this.ch)){this.index++;continue}else{a=this.ch+this.peek();var c=a+this.peek(2),d=gb[this.ch],e=gb[a],f=gb[c];f?(this.tokens.push({index:this.index,text:c,fn:f}),this.index+=3):e?(this.tokens.push({index:this.index,text:a,fn:e}),this.index+=2):d?(this.tokens.push({index:this.index,text:this.ch,fn:d}),this.index+=1):this.throwError("Unexpected next character ",this.index,this.index+1)}this.lastCh=this.ch}return this.tokens},is:function(a){return-1!==a.indexOf(this.ch)},
was:function(a){return-1!==a.indexOf(this.lastCh)},peek:function(a){a=a||1;return this.index+a<this.text.length?this.text.charAt(this.index+a):!1},isNumber:function(a){return"0"<=a&&"9">=a},isWhitespace:function(a){return" "===a||"\r"===a||"\t"===a||"\n"===a||"\v"===a||"\u00a0"===a},isIdent:function(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a||"_"===a||"$"===a},isExpOperator:function(a){return"-"===a||"+"===a||this.isNumber(a)},throwError:function(a,c,d){d=d||this.index;c=y(c)?"s "+c+"-"+this.index+" ["+
this.text.substring(c,d)+"]":" "+d;throw la("lexerr",a,c,this.text);},readNumber:function(){for(var a="",c=this.index;this.index<this.text.length;){var d=K(this.text.charAt(this.index));if("."==d||this.isNumber(d))a+=d;else{var e=this.peek();if("e"==d&&this.isExpOperator(e))a+=d;else if(this.isExpOperator(d)&&e&&this.isNumber(e)&&"e"==a.charAt(a.length-1))a+=d;else if(!this.isExpOperator(d)||e&&this.isNumber(e)||"e"!=a.charAt(a.length-1))break;else this.throwError("Invalid exponent")}this.index++}a*=
1;this.tokens.push({index:c,text:a,literal:!0,constant:!0,fn:function(){return a}})},readIdent:function(){for(var a=this,c="",d=this.index,e,f,g,k;this.index<this.text.length;){k=this.text.charAt(this.index);if("."===k||this.isIdent(k)||this.isNumber(k))"."===k&&(e=this.index),c+=k;else break;this.index++}if(e)for(f=this.index;f<this.text.length;){k=this.text.charAt(f);if("("===k){g=c.substr(e-d+1);c=c.substr(0,e-d);this.index=f;break}if(this.isWhitespace(k))f++;else break}d={index:d,text:c};if(gb.hasOwnProperty(c))d.fn=
gb[c],d.literal=!0,d.constant=!0;else{var m=Ec(c,this.options,this.text);d.fn=D(function(a,c){return m(a,c)},{assign:function(d,e){return ub(d,c,e,a.text,a.options)}})}this.tokens.push(d);g&&(this.tokens.push({index:e,text:"."}),this.tokens.push({index:e+1,text:g}))},readString:function(a){var c=this.index;this.index++;for(var d="",e=a,f=!1;this.index<this.text.length;){var g=this.text.charAt(this.index),e=e+g;if(f)"u"===g?(f=this.text.substring(this.index+1,this.index+5),f.match(/[\da-f]{4}/i)||
this.throwError("Invalid unicode escape [\\u"+f+"]"),this.index+=4,d+=String.fromCharCode(parseInt(f,16))):d+=Re[g]||g,f=!1;else if("\\"===g)f=!0;else{if(g===a){this.index++;this.tokens.push({index:c,text:e,string:d,literal:!0,constant:!0,fn:function(){return d}});return}d+=g}this.index++}this.throwError("Unterminated quote",c)}};var fb=function(a,c,d){this.lexer=a;this.$filter=c;this.options=d};fb.ZERO=D(function(){return 0},{constant:!0});fb.prototype={constructor:fb,parse:function(a){this.text=
a;this.tokens=this.lexer.lex(a);a=this.statements();0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]);a.literal=!!a.literal;a.constant=!!a.constant;return a},primary:function(){var a;if(this.expect("("))a=this.filterChain(),this.consume(")");else if(this.expect("["))a=this.arrayDeclaration();else if(this.expect("{"))a=this.object();else{var c=this.expect();(a=c.fn)||this.throwError("not a primary expression",c);a.literal=!!c.literal;a.constant=!!c.constant}for(var d;c=
this.expect("(","[",".");)"("===c.text?(a=this.functionCall(a,d),d=null):"["===c.text?(d=a,a=this.objectIndex(a)):"."===c.text?(d=a,a=this.fieldAccess(a)):this.throwError("IMPOSSIBLE");return a},throwError:function(a,c){throw la("syntax",c.text,a,c.index+1,this.text,this.text.substring(c.index));},peekToken:function(){if(0===this.tokens.length)throw la("ueoe",this.text);return this.tokens[0]},peek:function(a,c,d,e){if(0<this.tokens.length){var f=this.tokens[0],g=f.text;if(g===a||g===c||g===d||g===
e||!(a||c||d||e))return f}return!1},expect:function(a,c,d,e){return(a=this.peek(a,c,d,e))?(this.tokens.shift(),a):!1},consume:function(a){this.expect(a)||this.throwError("is unexpected, expecting ["+a+"]",this.peek())},unaryFn:function(a,c){return D(function(d,e){return a(d,e,c)},{constant:c.constant})},ternaryFn:function(a,c,d){return D(function(e,f){return a(e,f)?c(e,f):d(e,f)},{constant:a.constant&&c.constant&&d.constant})},binaryFn:function(a,c,d){return D(function(e,f){return c(e,f,a,d)},{constant:a.constant&&
d.constant})},statements:function(){for(var a=[];;)if(0<this.tokens.length&&!this.peek("}",")",";","]")&&a.push(this.filterChain()),!this.expect(";"))return 1===a.length?a[0]:function(c,d){for(var e,f=0;f<a.length;f++){var g=a[f];g&&(e=g(c,d))}return e}},filterChain:function(){for(var a=this.expression(),c;;)if(c=this.expect("|"))a=this.binaryFn(a,c.fn,this.filter());else return a},filter:function(){for(var a=this.expect(),c=this.$filter(a.text),d=[];;)if(a=this.expect(":"))d.push(this.expression());
else{var e=function(a,e,k){k=[k];for(var m=0;m<d.length;m++)k.push(d[m](a,e));return c.apply(a,k)};return function(){return e}}},expression:function(){return this.assignment()},assignment:function(){var a=this.ternary(),c,d;return(d=this.expect("="))?(a.assign||this.throwError("implies assignment but ["+this.text.substring(0,d.index)+"] can not be assigned to",d),c=this.ternary(),function(d,f){return a.assign(d,c(d,f),f)}):a},ternary:function(){var a=this.logicalOR(),c,d;if(this.expect("?")){c=this.assignment();
if(d=this.expect(":"))return this.ternaryFn(a,c,this.assignment());this.throwError("expected :",d)}else return a},logicalOR:function(){for(var a=this.logicalAND(),c;;)if(c=this.expect("||"))a=this.binaryFn(a,c.fn,this.logicalAND());else return a},logicalAND:function(){var a=this.equality(),c;if(c=this.expect("&&"))a=this.binaryFn(a,c.fn,this.logicalAND());return a},equality:function(){var a=this.relational(),c;if(c=this.expect("==","!=","===","!=="))a=this.binaryFn(a,c.fn,this.equality());return a},
relational:function(){var a=this.additive(),c;if(c=this.expect("<",">","<=",">="))a=this.binaryFn(a,c.fn,this.relational());return a},additive:function(){for(var a=this.multiplicative(),c;c=this.expect("+","-");)a=this.binaryFn(a,c.fn,this.multiplicative());return a},multiplicative:function(){for(var a=this.unary(),c;c=this.expect("*","/","%");)a=this.binaryFn(a,c.fn,this.unary());return a},unary:function(){var a;return this.expect("+")?this.primary():(a=this.expect("-"))?this.binaryFn(fb.ZERO,a.fn,
this.unary()):(a=this.expect("!"))?this.unaryFn(a.fn,this.unary()):this.primary()},fieldAccess:function(a){var c=this,d=this.expect().text,e=Ec(d,this.options,this.text);return D(function(c,d,k){return e(k||a(c,d))},{assign:function(e,g,k){(k=a(e,k))||a.assign(e,k={});return ub(k,d,g,c.text,c.options)}})},objectIndex:function(a){var c=this,d=this.expression();this.consume("]");return D(function(e,f){var g=a(e,f),k=d(e,f),m;ka(k,c.text);if(!g)return t;(g=va(g[k],c.text))&&(g.then&&c.options.unwrapPromises)&&
(m=g,"$$v"in g||(m.$$v=t,m.then(function(a){m.$$v=a})),g=g.$$v);return g},{assign:function(e,f,g){var k=ka(d(e,g),c.text);(g=va(a(e,g),c.text))||a.assign(e,g={});return g[k]=f}})},functionCall:function(a,c){var d=[];if(")"!==this.peekToken().text){do d.push(this.expression());while(this.expect(","))}this.consume(")");var e=this;return function(f,g){for(var k=[],m=c?c(f,g):f,h=0;h<d.length;h++)k.push(va(d[h](f,g),e.text));h=a(f,g,m)||E;va(m,e.text);var l=e.text;if(h){if(h.constructor===h)throw la("isecfn",
l);if(h===Pe||h===Qe||Qc&&h===Qc)throw la("isecff",l);}k=h.apply?h.apply(m,k):h(k[0],k[1],k[2],k[3],k[4]);return va(k,e.text)}},arrayDeclaration:function(){var a=[],c=!0;if("]"!==this.peekToken().text){do{if(this.peek("]"))break;var d=this.expression();a.push(d);d.constant||(c=!1)}while(this.expect(","))}this.consume("]");return D(function(c,d){for(var g=[],k=0;k<a.length;k++)g.push(a[k](c,d));return g},{literal:!0,constant:c})},object:function(){var a=[],c=!0;if("}"!==this.peekToken().text){do{if(this.peek("}"))break;
var d=this.expect(),d=d.string||d.text;this.consume(":");var e=this.expression();a.push({key:d,value:e});e.constant||(c=!1)}while(this.expect(","))}this.consume("}");return D(function(c,d){for(var e={},m=0;m<a.length;m++){var h=a[m];e[h.key]=h.value(c,d)}return e},{literal:!0,constant:c})}};var Vb={},xa=C("$sce"),ga={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"},Y=X.createElement("a"),Hc=ua(W.location.href,!0);mc.$inject=["$provide"];Ic.$inject=["$locale"];Kc.$inject=["$locale"];
var Nc=".",Je={yyyy:$("FullYear",4),yy:$("FullYear",2,0,!0),y:$("FullYear",1),MMMM:vb("Month"),MMM:vb("Month",!0),MM:$("Month",2,1),M:$("Month",1,1),dd:$("Date",2),d:$("Date",1),HH:$("Hours",2),H:$("Hours",1),hh:$("Hours",2,-12),h:$("Hours",1,-12),mm:$("Minutes",2),m:$("Minutes",1),ss:$("Seconds",2),s:$("Seconds",1),sss:$("Milliseconds",3),EEEE:vb("Day"),EEE:vb("Day",!0),a:function(a,c){return 12>a.getHours()?c.AMPMS[0]:c.AMPMS[1]},Z:function(a){a=-1*a.getTimezoneOffset();return a=(0<=a?"+":"")+(Xb(Math[0<
a?"floor":"ceil"](a/60),2)+Xb(Math.abs(a%60),2))}},Ie=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,He=/^\-?\d+$/;Jc.$inject=["$locale"];var Fe=ba(K),Ge=ba(Ia);Lc.$inject=["$parse"];var dd=ba({restrict:"E",compile:function(a,c){8>=Q&&(c.href||c.name||c.$set("href",""),a.append(X.createComment("IE fix")));if(!c.href&&!c.xlinkHref&&!c.name)return function(a,c){var f="[object SVGAnimatedString]"===za.call(c.prop("href"))?"xlink:href":"href";c.on("click",function(a){c.attr(f)||
a.preventDefault()})}}}),Fb={};r(qb,function(a,c){if("multiple"!=a){var d=pa("ng-"+c);Fb[d]=function(){return{priority:100,link:function(a,f,g){a.$watch(g[d],function(a){g.$set(c,!!a)})}}}}});r(["src","srcset","href"],function(a){var c=pa("ng-"+a);Fb[c]=function(){return{priority:99,link:function(d,e,f){var g=a,k=a;"href"===a&&"[object SVGAnimatedString]"===za.call(e.prop("href"))&&(k="xlinkHref",f.$attr[k]="xlink:href",g=null);f.$observe(c,function(c){c?(f.$set(k,c),Q&&g&&e.prop(g,f[k])):"href"===
a&&f.$set(k,null)})}}}});var yb={$addControl:E,$removeControl:E,$setValidity:E,$setDirty:E,$setPristine:E};Oc.$inject=["$element","$attrs","$scope","$animate"];var Rc=function(a){return["$timeout",function(c){return{name:"form",restrict:a?"EAC":"E",controller:Oc,compile:function(){return{pre:function(a,e,f,g){if(!f.action){var k=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1};sb(e[0],"submit",k);e.on("$destroy",function(){c(function(){$a(e[0],"submit",k)},0,!1)})}var m=e.parent().controller("form"),
h=f.name||f.ngForm;h&&ub(a,h,g,h);if(m)e.on("$destroy",function(){m.$removeControl(g);h&&ub(a,h,t,h);D(g,yb)})}}}}}]},ed=Rc(),rd=Rc(!0),Se=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,Te=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,Ue=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,Sc={text:Ab,number:function(a,c,d,e,f,g){Ab(a,c,d,e,f,g);e.$parsers.push(function(a){var c=e.$isEmpty(a);if(c||Ue.test(a))return e.$setValidity("number",
!0),""===a?null:c?a:parseFloat(a);e.$setValidity("number",!1);return t});Ke(e,"number",Ve,null,e.$$validityState);e.$formatters.push(function(a){return e.$isEmpty(a)?"":""+a});d.min&&(a=function(a){var c=parseFloat(d.min);return sa(e,"min",e.$isEmpty(a)||a>=c,a)},e.$parsers.push(a),e.$formatters.push(a));d.max&&(a=function(a){var c=parseFloat(d.max);return sa(e,"max",e.$isEmpty(a)||a<=c,a)},e.$parsers.push(a),e.$formatters.push(a));e.$formatters.push(function(a){return sa(e,"number",e.$isEmpty(a)||
ib(a),a)})},url:function(a,c,d,e,f,g){Ab(a,c,d,e,f,g);a=function(a){return sa(e,"url",e.$isEmpty(a)||Se.test(a),a)};e.$formatters.push(a);e.$parsers.push(a)},email:function(a,c,d,e,f,g){Ab(a,c,d,e,f,g);a=function(a){return sa(e,"email",e.$isEmpty(a)||Te.test(a),a)};e.$formatters.push(a);e.$parsers.push(a)},radio:function(a,c,d,e){x(d.name)&&c.attr("name",hb());c.on("click",function(){c[0].checked&&a.$apply(function(){e.$setViewValue(d.value)})});e.$render=function(){c[0].checked=d.value==e.$viewValue};
d.$observe("value",e.$render)},checkbox:function(a,c,d,e){var f=d.ngTrueValue,g=d.ngFalseValue;v(f)||(f=!0);v(g)||(g=!1);c.on("click",function(){a.$apply(function(){e.$setViewValue(c[0].checked)})});e.$render=function(){c[0].checked=e.$viewValue};e.$isEmpty=function(a){return a!==f};e.$formatters.push(function(a){return a===f});e.$parsers.push(function(a){return a?f:g})},hidden:E,button:E,submit:E,reset:E,file:E},Ve=["badInput"],jc=["$browser","$sniffer",function(a,c){return{restrict:"E",require:"?ngModel",
link:function(d,e,f,g){g&&(Sc[K(f.type)]||Sc.text)(d,e,f,g,c,a)}}}],wb="ng-valid",xb="ng-invalid",Oa="ng-pristine",zb="ng-dirty",We=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate",function(a,c,d,e,f,g){function k(a,c){c=c?"-"+mb(c,"-"):"";g.removeClass(e,(a?xb:wb)+c);g.addClass(e,(a?wb:xb)+c)}this.$modelValue=this.$viewValue=Number.NaN;this.$parsers=[];this.$formatters=[];this.$viewChangeListeners=[];this.$pristine=!0;this.$dirty=!1;this.$valid=!0;this.$invalid=!1;this.$name=
d.name;var m=f(d.ngModel),h=m.assign;if(!h)throw C("ngModel")("nonassign",d.ngModel,ia(e));this.$render=E;this.$isEmpty=function(a){return x(a)||""===a||null===a||a!==a};var l=e.inheritedData("$formController")||yb,n=0,p=this.$error={};e.addClass(Oa);k(!0);this.$setValidity=function(a,c){p[a]!==!c&&(c?(p[a]&&n--,n||(k(!0),this.$valid=!0,this.$invalid=!1)):(k(!1),this.$invalid=!0,this.$valid=!1,n++),p[a]=!c,k(c,a),l.$setValidity(a,c,this))};this.$setPristine=function(){this.$dirty=!1;this.$pristine=
!0;g.removeClass(e,zb);g.addClass(e,Oa)};this.$setViewValue=function(d){this.$viewValue=d;this.$pristine&&(this.$dirty=!0,this.$pristine=!1,g.removeClass(e,Oa),g.addClass(e,zb),l.$setDirty());r(this.$parsers,function(a){d=a(d)});this.$modelValue!==d&&(this.$modelValue=d,h(a,d),r(this.$viewChangeListeners,function(a){try{a()}catch(d){c(d)}}))};var q=this;a.$watch(function(){var c=m(a);if(q.$modelValue!==c){var d=q.$formatters,e=d.length;for(q.$modelValue=c;e--;)c=d[e](c);q.$viewValue!==c&&(q.$viewValue=
c,q.$render())}return c})}],Gd=function(){return{require:["ngModel","^?form"],controller:We,link:function(a,c,d,e){var f=e[0],g=e[1]||yb;g.$addControl(f);a.$on("$destroy",function(){g.$removeControl(f)})}}},Id=ba({require:"ngModel",link:function(a,c,d,e){e.$viewChangeListeners.push(function(){a.$eval(d.ngChange)})}}),kc=function(){return{require:"?ngModel",link:function(a,c,d,e){if(e){d.required=!0;var f=function(a){if(d.required&&e.$isEmpty(a))e.$setValidity("required",!1);else return e.$setValidity("required",
!0),a};e.$formatters.push(f);e.$parsers.unshift(f);d.$observe("required",function(){f(e.$viewValue)})}}}},Hd=function(){return{require:"ngModel",link:function(a,c,d,e){var f=(a=/\/(.*)\//.exec(d.ngList))&&RegExp(a[1])||d.ngList||",";e.$parsers.push(function(a){if(!x(a)){var c=[];a&&r(a.split(f),function(a){a&&c.push(aa(a))});return c}});e.$formatters.push(function(a){return J(a)?a.join(", "):t});e.$isEmpty=function(a){return!a||!a.length}}}},Xe=/^(true|false|\d+)$/,Jd=function(){return{priority:100,
compile:function(a,c){return Xe.test(c.ngValue)?function(a,c,f){f.$set("value",a.$eval(f.ngValue))}:function(a,c,f){a.$watch(f.ngValue,function(a){f.$set("value",a)})}}}},jd=ya({compile:function(a){a.addClass("ng-binding");return function(a,d,e){d.data("$binding",e.ngBind);a.$watch(e.ngBind,function(a){d.text(a==t?"":a)})}}}),ld=["$interpolate",function(a){return function(c,d,e){c=a(d.attr(e.$attr.ngBindTemplate));d.addClass("ng-binding").data("$binding",c);e.$observe("ngBindTemplate",function(a){d.text(a)})}}],
kd=["$sce","$parse",function(a,c){return{compile:function(d){d.addClass("ng-binding");return function(d,f,g){f.data("$binding",g.ngBindHtml);var k=c(g.ngBindHtml);d.$watch(function(){return(k(d)||"").toString()},function(c){f.html(a.getTrustedHtml(k(d))||"")})}}}}],md=Yb("",!0),od=Yb("Odd",0),nd=Yb("Even",1),pd=ya({compile:function(a,c){c.$set("ngCloak",t);a.removeClass("ng-cloak")}}),qd=[function(){return{scope:!0,controller:"@",priority:500}}],lc={},Ye={blur:!0,focus:!0};r("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),
function(a){var c=pa("ng-"+a);lc[c]=["$parse","$rootScope",function(d,e){return{compile:function(f,g){var k=d(g[c]);return function(c,d){d.on(a,function(d){var f=function(){k(c,{$event:d})};Ye[a]&&e.$$phase?c.$evalAsync(f):c.$apply(f)})}}}}]});var td=["$animate",function(a){return{transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(c,d,e,f,g){var k,m,h;c.$watch(e.ngIf,function(f){Ua(f)?m||(m=c.$new(),g(m,function(c){c[c.length++]=X.createComment(" end ngIf: "+e.ngIf+
" ");k={clone:c};a.enter(c,d.parent(),d)})):(h&&(h.remove(),h=null),m&&(m.$destroy(),m=null),k&&(h=Eb(k.clone),a.leave(h,function(){h=null}),k=null))})}}}],ud=["$http","$templateCache","$anchorScroll","$animate","$sce",function(a,c,d,e,f){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:Va.noop,compile:function(g,k){var m=k.ngInclude||k.src,h=k.onload||"",l=k.autoscroll;return function(g,k,q,r,F){var u=0,t,w,R,z=function(){w&&(w.remove(),w=null);t&&(t.$destroy(),t=null);
R&&(e.leave(R,function(){w=null}),w=R,R=null)};g.$watch(f.parseAsResourceUrl(m),function(f){var m=function(){!y(l)||l&&!g.$eval(l)||d()},q=++u;f?(a.get(f,{cache:c}).success(function(a){if(q===u){var c=g.$new();r.template=a;a=F(c,function(a){z();e.enter(a,null,k,m)});t=c;R=a;t.$emit("$includeContentLoaded");g.$eval(h)}}).error(function(){q===u&&z()}),g.$emit("$includeContentRequested")):(z(),r.template=null)})}}}}],Kd=["$compile",function(a){return{restrict:"ECA",priority:-400,require:"ngInclude",
link:function(c,d,e,f){d.html(f.template);a(d.contents())(c)}}}],vd=ya({priority:450,compile:function(){return{pre:function(a,c,d){a.$eval(d.ngInit)}}}}),wd=ya({terminal:!0,priority:1E3}),xd=["$locale","$interpolate",function(a,c){var d=/{}/g;return{restrict:"EA",link:function(e,f,g){var k=g.count,m=g.$attr.when&&f.attr(g.$attr.when),h=g.offset||0,l=e.$eval(m)||{},n={},p=c.startSymbol(),q=c.endSymbol(),s=/^when(Minus)?(.+)$/;r(g,function(a,c){s.test(c)&&(l[K(c.replace("when","").replace("Minus","-"))]=
f.attr(g.$attr[c]))});r(l,function(a,e){n[e]=c(a.replace(d,p+k+"-"+h+q))});e.$watch(function(){var c=parseFloat(e.$eval(k));if(isNaN(c))return"";c in l||(c=a.pluralCat(c-h));return n[c](e,f,!0)},function(a){f.text(a)})}}}],yd=["$parse","$animate",function(a,c){var d=C("ngRepeat");return{transclude:"element",priority:1E3,terminal:!0,$$tlb:!0,link:function(e,f,g,k,m){var h=g.ngRepeat,l=h.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),n,p,q,s,t,u,A={$id:Ka};if(!l)throw d("iexp",
h);g=l[1];k=l[2];(l=l[3])?(n=a(l),p=function(a,c,d){u&&(A[u]=a);A[t]=c;A.$index=d;return n(e,A)}):(q=function(a,c){return Ka(c)},s=function(a){return a});l=g.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/);if(!l)throw d("iidexp",g);t=l[3]||l[1];u=l[2];var y={};e.$watchCollection(k,function(a){var g,k,l=f[0],n,A={},B,I,H,v,E,C,x,J=[];if(Pa(a))C=a,E=p||q;else{E=p||s;C=[];for(H in a)a.hasOwnProperty(H)&&"$"!=H.charAt(0)&&C.push(H);C.sort()}B=C.length;k=J.length=C.length;for(g=0;g<k;g++)if(H=a===
C?g:C[g],v=a[H],n=E(H,v,g),Da(n,"`track by` id"),y.hasOwnProperty(n))x=y[n],delete y[n],A[n]=x,J[g]=x;else{if(A.hasOwnProperty(n))throw r(J,function(a){a&&a.scope&&(y[a.id]=a)}),d("dupes",h,n,na(v));J[g]={id:n};A[n]=!1}for(H in y)y.hasOwnProperty(H)&&(x=y[H],g=Eb(x.clone),c.leave(g),r(g,function(a){a.$$NG_REMOVED=!0}),x.scope.$destroy());g=0;for(k=C.length;g<k;g++){H=a===C?g:C[g];v=a[H];x=J[g];J[g-1]&&(l=J[g-1].clone[J[g-1].clone.length-1]);if(x.scope){I=x.scope;n=l;do n=n.nextSibling;while(n&&n.$$NG_REMOVED);
x.clone[0]!=n&&c.move(Eb(x.clone),null,w(l));l=x.clone[x.clone.length-1]}else I=e.$new();I[t]=v;u&&(I[u]=H);I.$index=g;I.$first=0===g;I.$last=g===B-1;I.$middle=!(I.$first||I.$last);I.$odd=!(I.$even=0===(g&1));x.scope||m(I,function(a){a[a.length++]=X.createComment(" end ngRepeat: "+h+" ");c.enter(a,null,w(l));l=a;x.scope=I;x.clone=a;A[x.id]=x})}y=A})}}}],zd=["$animate",function(a){return function(c,d,e){c.$watch(e.ngShow,function(c){a[Ua(c)?"removeClass":"addClass"](d,"ng-hide")})}}],sd=["$animate",
function(a){return function(c,d,e){c.$watch(e.ngHide,function(c){a[Ua(c)?"addClass":"removeClass"](d,"ng-hide")})}}],Ad=ya(function(a,c,d){a.$watch(d.ngStyle,function(a,d){d&&a!==d&&r(d,function(a,d){c.css(d,"")});a&&c.css(a)},!0)}),Bd=["$animate",function(a){return{restrict:"EA",require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(c,d,e,f){var g=[],k=[],m=[],h=[];c.$watch(e.ngSwitch||e.on,function(d){var n,p;n=0;for(p=m.length;n<p;++n)m[n].remove();n=m.length=0;for(p=
h.length;n<p;++n){var q=k[n];h[n].$destroy();m[n]=q;a.leave(q,function(){m.splice(n,1)})}k.length=0;h.length=0;if(g=f.cases["!"+d]||f.cases["?"])c.$eval(e.change),r(g,function(d){var e=c.$new();h.push(e);d.transclude(e,function(c){var e=d.element;k.push(c);a.enter(c,e.parent(),e)})})})}}}],Cd=ya({transclude:"element",priority:800,require:"^ngSwitch",link:function(a,c,d,e,f){e.cases["!"+d.ngSwitchWhen]=e.cases["!"+d.ngSwitchWhen]||[];e.cases["!"+d.ngSwitchWhen].push({transclude:f,element:c})}}),Dd=
ya({transclude:"element",priority:800,require:"^ngSwitch",link:function(a,c,d,e,f){e.cases["?"]=e.cases["?"]||[];e.cases["?"].push({transclude:f,element:c})}}),Fd=ya({link:function(a,c,d,e,f){if(!f)throw C("ngTransclude")("orphan",ia(c));f(function(a){c.empty();c.append(a)})}}),fd=["$templateCache",function(a){return{restrict:"E",terminal:!0,compile:function(c,d){"text/ng-template"==d.type&&a.put(d.id,c[0].text)}}}],Ze=C("ngOptions"),Ed=ba({terminal:!0}),gd=["$compile","$parse",function(a,c){var d=
/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,e={$setViewValue:E};return{restrict:"E",require:["select","?ngModel"],controller:["$element","$scope","$attrs",function(a,c,d){var m=this,h={},l=e,n;m.databound=d.ngModel;m.init=function(a,c,d){l=a;n=d};m.addOption=function(c){Da(c,'"option value"');h[c]=!0;l.$viewValue==c&&(a.val(c),n.parent()&&n.remove())};
m.removeOption=function(a){this.hasOption(a)&&(delete h[a],l.$viewValue==a&&this.renderUnknownOption(a))};m.renderUnknownOption=function(c){c="? "+Ka(c)+" ?";n.val(c);a.prepend(n);a.val(c);n.prop("selected",!0)};m.hasOption=function(a){return h.hasOwnProperty(a)};c.$on("$destroy",function(){m.renderUnknownOption=E})}],link:function(e,g,k,m){function h(a,c,d,e){d.$render=function(){var a=d.$viewValue;e.hasOption(a)?(v.parent()&&v.remove(),c.val(a),""===a&&u.prop("selected",!0)):x(a)&&u?c.val(""):e.renderUnknownOption(a)};
c.on("change",function(){a.$apply(function(){v.parent()&&v.remove();d.$setViewValue(c.val())})})}function l(a,c,d){var e;d.$render=function(){var a=new bb(d.$viewValue);r(c.find("option"),function(c){c.selected=y(a.get(c.value))})};a.$watch(function(){Aa(e,d.$viewValue)||(e=ha(d.$viewValue),d.$render())});c.on("change",function(){a.$apply(function(){var a=[];r(c.find("option"),function(c){c.selected&&a.push(c.value)});d.$setViewValue(a)})})}function n(e,f,g){function k(){var a={"":[]},c=[""],d,h,
s,t,v;s=g.$modelValue;t=w(e)||[];var E=n?Zb(t):t,I,M,B;M={};B=!1;if(q)if(h=g.$modelValue,x&&J(h))for(B=new bb([]),d={},v=0;v<h.length;v++)d[m]=h[v],B.put(x(e,d),h[v]);else B=new bb(h);v=B;var D,K;for(B=0;I=E.length,B<I;B++){h=B;if(n){h=E[B];if("$"===h.charAt(0))continue;M[n]=h}M[m]=t[h];d=r(e,M)||"";(h=a[d])||(h=a[d]=[],c.push(d));q?d=y(v.remove(x?x(e,M):u(e,M))):(x?(d={},d[m]=s,d=x(e,d)===x(e,M)):d=s===u(e,M),v=v||d);D=l(e,M);D=y(D)?D:"";h.push({id:x?x(e,M):n?E[B]:B,label:D,selected:d})}q||(F||null===
s?a[""].unshift({id:"",label:"",selected:!v}):v||a[""].unshift({id:"?",label:"",selected:!0}));M=0;for(E=c.length;M<E;M++){d=c[M];h=a[d];z.length<=M?(s={element:C.clone().attr("label",d),label:h.label},t=[s],z.push(t),f.append(s.element)):(t=z[M],s=t[0],s.label!=d&&s.element.attr("label",s.label=d));D=null;B=0;for(I=h.length;B<I;B++)d=h[B],(v=t[B+1])?(D=v.element,v.label!==d.label&&D.text(v.label=d.label),v.id!==d.id&&D.val(v.id=d.id),D[0].selected!==d.selected&&(D.prop("selected",v.selected=d.selected),
Q&&D.prop("selected",v.selected))):(""===d.id&&F?K=F:(K=A.clone()).val(d.id).prop("selected",d.selected).attr("selected",d.selected).text(d.label),t.push({element:K,label:d.label,id:d.id,selected:d.selected}),p.addOption(d.label,K),D?D.after(K):s.element.append(K),D=K);for(B++;t.length>B;)d=t.pop(),p.removeOption(d.label),d.element.remove()}for(;z.length>M;)z.pop()[0].element.remove()}var h;if(!(h=s.match(d)))throw Ze("iexp",s,ia(f));var l=c(h[2]||h[1]),m=h[4]||h[6],n=h[5],r=c(h[3]||""),u=c(h[2]?
h[1]:m),w=c(h[7]),x=h[8]?c(h[8]):null,z=[[{element:f,label:""}]];F&&(a(F)(e),F.removeClass("ng-scope"),F.remove());f.empty();f.on("change",function(){e.$apply(function(){var a,c=w(e)||[],d={},h,l,p,r,s,v,y;if(q)for(l=[],r=0,v=z.length;r<v;r++)for(a=z[r],p=1,s=a.length;p<s;p++){if((h=a[p].element)[0].selected){h=h.val();n&&(d[n]=h);if(x)for(y=0;y<c.length&&(d[m]=c[y],x(e,d)!=h);y++);else d[m]=c[h];l.push(u(e,d))}}else if(h=f.val(),"?"==h)l=t;else if(""===h)l=null;else if(x)for(y=0;y<c.length;y++){if(d[m]=
c[y],x(e,d)==h){l=u(e,d);break}}else d[m]=c[h],n&&(d[n]=h),l=u(e,d);g.$setViewValue(l);k()})});g.$render=k;e.$watchCollection(w,k);e.$watchCollection(function(){var a={},c=w(e);if(c){for(var d=Array(c.length),f=0,g=c.length;f<g;f++)a[m]=c[f],d[f]=l(e,a);return d}},k);q&&e.$watchCollection(function(){return g.$modelValue},k)}if(m[1]){var p=m[0];m=m[1];var q=k.multiple,s=k.ngOptions,F=!1,u,A=w(X.createElement("option")),C=w(X.createElement("optgroup")),v=A.clone();k=0;for(var z=g.children(),E=z.length;k<
E;k++)if(""===z[k].value){u=F=z.eq(k);break}p.init(m,F,v);q&&(m.$isEmpty=function(a){return!a||0===a.length});s?n(e,g,m):q?l(e,g,m):h(e,g,m,p)}}}}],id=["$interpolate",function(a){var c={addOption:E,removeOption:E};return{restrict:"E",priority:100,compile:function(d,e){if(x(e.value)){var f=a(d.text(),!0);f||e.$set("value",d.text())}return function(a,d,e){var h=d.parent(),l=h.data("$selectController")||h.parent().data("$selectController");l&&l.databound?d.prop("selected",!1):l=c;f?a.$watch(f,function(a,
c){e.$set("value",a);a!==c&&l.removeOption(c);l.addOption(a)}):l.addOption(e.value);d.on("$destroy",function(){l.removeOption(e.value)})}}}}],hd=ba({restrict:"E",terminal:!0});W.angular.bootstrap?console.log("WARNING: Tried to load angular more than once."):((Ea=W.jQuery)&&Ea.fn.on?(w=Ea,D(Ea.fn,{scope:La.scope,isolateScope:La.isolateScope,controller:La.controller,injector:La.injector,inheritedData:La.inheritedData}),Gb("remove",!0,!0,!1),Gb("empty",!1,!1,!1),Gb("html",!1,!1,!0)):w=S,Va.element=w,
$c(Va),w(X).ready(function(){Xc(X,fc)}))})(window,document);!window.angular.$$csp()&&window.angular.element(document).find("head").prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide{display:none !important;}ng\\:form{display:block;}.ng-animate-block-transitions{transition:0s all!important;-webkit-transition:0s all!important;}.ng-hide-add-active,.ng-hide-remove{display:block!important;}</style>');
//# sourceMappingURL=angular.min.js.map
;

/* file-end: js/lib/angular/1.2.26/angular.min.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/common.js 
*/

/*
 * Include LJ.Templates as module dependency to have access to templates,
 * required using require_template. Don't forget to require this file.
 *
 * @example
 *   js:
 *     angular.module('MyModule', ['LJ.Templates']);
 *
 *   html:
 *     <div ng-include src="'ljMessages.ng.tmpl'">
 *
 * If you need direct access to template as a string, use $templateCache.
 *
 * Notice:
 *   By default required templates will be named in $templateCache as filename,
 *   e.g. `angular/widgets/social/twitter.ng.tmpl` will have name `twitter.ng.tmpl`
 *
 *   If two files have same name, but located in different folders, e.g.
 *   `angular/widgets/social/v1/twitter.ng.tmpl` and `angular/widgets/social/v2/twitter.ng.tmpl`
 *   files will be named as a file and folder they are located in =>
 *   `v1/twitter.ng.tmpl` and `v2/twitter.ng.tmpl`
 *
 */

angular.module('LJ.Templates', []).run(['$templateCache', function($templateCache) {
  var templates = angular.copy( LJ.get('template') );
  var temp = [];

  function getDups(array, regexp) {
    return array.filter(function (item) {
      return item.match(regexp) && item;
    });
  }

  function getContains(string1, string2) {
    var index = 0;

    for (var i = 0; i < string1.length; i++) {
      if ( string2.indexOf( string1.substr(0, i + 1) ) !== -1 ) {
        index = i + 1;
      }
    }

    return string1.slice(0, index);
  }

  angular.forEach(templates, function (value, key) {
    temp.push(key.split('').reverse().join(''));
  });

  // Convert templates to uniq names
  temp.forEach(function (value) {
    var match = value.match(/([\-\w\.]*)/),
        name, regexp, dups, max, pathPattern;

    if ( !(match && match[1]) ) {
      return;
    }

    regexp = new RegExp( match[1].replace(/\./g, '\\.') + '\/' );

    dups = getDups(temp, regexp);

    max = value.length - 1;

    dups.forEach(function (dup) {
      var contains = getContains(value, dup);
      var length = contains.length;

      max = max > length ? length : max;
    });

    if (dups.length === 1) {
      name = value.split('').reverse().join('');
      templates[name.split('/').pop()] = templates[name];

      delete templates[name];

      return;
    }

    dups.push(value);

    pathPattern = new RegExp('\\/?(\\w*.{' + max + '})$');

    dups.forEach(function (item) {
      var exec;

      item = item.split('').reverse().join('');
      exec = pathPattern.exec(item);

      if (templates.hasOwnProperty(item) && (exec && exec[1]) ) {
        templates[exec[1]] = templates[item];

        if (exec[1] !== item) {
          delete templates[item];
        }
      }
    });

  });

  angular.forEach(templates, function (value, key) {
    if ( key.indexOf('/') !== -1 ) {
      console.warn('Template `%s` has been registered with path', key);
    }

    $templateCache.put(key, value);
  });
}]);

/*
 * Common directives
 */

angular.module('LJ.Directives', [])

/**
 * Insert html and do not watch for changes
 */
.directive('ljHtml', ['$parse', function ($parse) {
  return {
    compile: function (element, attrs) {
      var getter = $parse( attrs.ljHtml );

      return function link(scope, element) {
        element.html( getter(scope) || '' );
      };
    }
  };
}])

/**
 * Insert html and watch for changes
 */
.directive('ljHtmlLive', ['$parse', function ($parse) {
  return {
    scope: true,
    restrict: 'A',
    compile: function (element, attrs) {
      var getValue = $parse(attrs.ljHtmlLive);

      return function link(scope, element) {
        scope.$watch(function () {
          return getValue(scope);
        }, function (value) {
          element.html( value || '' );
        });
      };
    }
  };
}])

/**
 * Replace ng-include root with it's content,
 * if you have to just include template into the DOM.
 * Notice: should be used in conjunction with ng-include
 *
 * @example
 *
 *     <div ng-include="'Settings.html'" include-replace></div>
 */
.directive('includeReplace', function () {
  return {
    require: 'ngInclude',
    link: function (scope, element) {
      element.replaceWith( element.contents() );
    }
  };
})

/**
 * Notice:
 *   lj-ml-compile could be only used on node without any other directives,
 *   otherwise their behavior will be duplicated (ng-click handlers for example)
 *
 * @example Replacing <span> text with ml variable value
 *
 *     <span lj-ml="user.text.save"></span>
 *
 * @example Replacing attribute value
 *
 *     <input lj-ml="user.text.save" lj-ml-attr="placeholder" />
 *
 * @example Compile angular attributes inside of ml-variable. In this case some.ml => "Total users: {{count}}"
 *          And {{count}} is something that is in the scope
 *          Notice: it's deprecated and should be avoided in the future. Ml-variables should not rely on js-code!
 *
 *     <span lj-ml="some.ml" lj-ml-compile></span>
 *
 * @example Object notation syntax (like ng-class)
 *
 *     <span lj-ml="{
 *         'some.filter': isFilter,
 *         'some.group':  isGroup
 *     }"></span>
 *
 * @example Simple lj-ml-resolve - `reply_count` substitution
 *
 *     <span
 *       lj-ml="entryunit.comments"
 *       lj-ml-resolve="{reply_count: item.comments_cnt}"
 *       ></span>
 *
 * @example lj-ml-resolve with deferred (async)
 *    <!-- wait for substitutions like [[username]] -->
 *    <span lj-ml="user.text.save" lj-ml-resolve="mlResolve" />
 *
 *    var mlDefer = $q.defer();
 *
 *    // Notice:
 *    //   Object with `promise` key is needed!!!
 *    //   If promise is assigned directly (e.g. $scope.mlResolve = mlDefer.promise),
 *    //   it will be resolved to `undefined`
 *    $scope.mlResolve = { promise: mlDefer.promise }
 *    mlDefer.resolve({ username: 'good' })
 *
 * @example lj-ml-dynamic with watching expression
 *    lj-ml-dynamic cannot be empty
 *
 *    <!-- update value when lj-ml or lj-ml-dynamic value changed -->
 *    <span
 *      lj-ml="flatmedia.album.count.video"
 *      lj-ml-resolve="{ count: album.records.length }"
 *      lj-ml-dynamic="album.records.length"
 *      ></span>
 *
 */
.directive('ljMl', ['$parse', '$compile', function($parse, $compile) {
  return {

    link: function(scope, element, attrs) {

      // dynamic ml changes
      if ( attrs.hasOwnProperty('ljMlDynamic') ) {

        // watch ljMlDynamic attribute values changes
        scope.$watch(function () {
          return scope.$eval(attrs.ljMlDynamic);
        }, function () {
          processMl(attrs.ljMl);
        });
      } else {
        processMl(attrs.ljMl);
      }

      function processMl(mlVar) {
        var resolve;

        // ml has been processed yet
        if ( attrs.mlParsed ) {
          return;
        }

        // we don't need substitutions
        if ( !attrs.ljMlResolve ) {
          replaceMl(mlVar);
          return;
        }

        resolve = $parse(attrs.ljMlResolve)(scope);

        if ( !resolve.promise ) {
          replaceMl(mlVar, resolve);
          return;
        }

        // if object has promise key => wait for promise resolve
        resolve.promise.then(function (data) {
          replaceMl(mlVar, data);
        });
      }

      // replace variable with value
      function replaceMl(mlVar, dictionary) {
        var ml = LJ.ml(objNotation( mlVar ), dictionary);

        // attribute
        if ( attrs.ljMlAttr ) {
          element.attr(attrs.ljMlAttr, ml);
        } else {
          // html
          element.html(ml);
        }

        if ( attrs.hasOwnProperty('ljMlCompile') ) {
          // prevent cycled compilation of lj-ml directive
          element.attr('ml-parsed', true);
          $compile(element)(scope);
        }
      }

      /**
       * Allow object notation for ml
       * @param  {String} mlVar Variable value to check
       * @return {String}       Result ml variable value
       */
      function objNotation(mlVar) {
        if ( mlVar.indexOf('{') === -1 ) {
          return mlVar;
        }

        var obj = scope.$eval(mlVar),
            prop;

        if ( obj && typeof obj === 'object' ) {
          for (prop in obj) {
            if ( obj.hasOwnProperty(prop) && obj[prop] ) {
              return prop;
            }
          }
        }

        return mlVar;
      }
    }
  };
}])
.directive('ljSwitchOff', ['$document', '$parse',
                 function ( $document ,  $parse ) {
  /*
   * When area outside of element is clicked or ESC is pressed
   * 'showPopup' will be set to false and 'doSomething()' will be evaluated.
   *
   * <div ng-show="showPopup" lj-switch-off="showPopup" lj-switch-off-action="doSomething()"></div>
   *
   * Skip switching:
   * Notice: now skipping of switch is working for all `lj-switch-off` directives (is not grouped)
   * <span lj-switch-off-skip>This element prevents switching via `lj-switch-off` directive</span>
   *
   */

  return {
    restrict: 'A',
    link: function (scope, element, attrs) {
      var state    = $parse(attrs.ljSwitchOff),
          _clicked = false;

      element.on('click', function () {
        _clicked = true;
      });

      $document
        .on('keydown', keyPressed)
        .on('click', '[lj-switch-off-skip]', preventSwitching)
        .on('click', documentClick);

      // cleanup
      scope.$on('$destroy', function () {
        $document
          .off('keydown', keyPressed)
          .off('click', '[lj-switch-off-skip]', preventSwitching)
          .off('click', documentClick);
      });

      function close() {
        if (attrs.ljSwitchOffAction) {
          scope.$eval(attrs.ljSwitchOffAction);
        }

        state.assign(scope, false);
      }

      function preventSwitching() {
        _clicked = true;
      }

      function documentClick(event) {

        // right click in Firefox is closing the bubble
        if (event.button === 2) {
          return;
        }

        if ( !_clicked && state(scope, { $event: event }) ) {
          scope.$apply(close);
        }

        _clicked = false;
      }

      function keyPressed(event) {
        /** ESC */
        if ( event.which === 27 && state(scope, { $event: event }) ) {
          scope.$apply(close);
        }
      }
    }
  };
}]).
directive('ljDisabled', [function() {
  /*
   * Toggles disabled state for LiveJournal button
   *
   * <div class="b-ljbutton b-ljbutton-submit">
   *   <button lj-disabled="!comment">Submit comment</button>
   * </div>
   */
  return function (scope, element, attrs) {
    scope.$watch(attrs.ljDisabled, function(value) {
      element.prop('disabled', value);
      element.parent().toggleClass('b-ljbutton-disabled', value);
    });
  };
}])
.directive('focusAndSelect', ['$timeout', function ($timeout) {
  /*
   * Focus and select an input or textarea when expression is true
   *
   * <input focus-and-select="show">
   */
  return {
    restrict: 'A',
    link: function (scope, element, attrs) {
      var attr = attrs.focusAndSelect,
          timeout = 50; // scroll can jump under 50ms

      scope.$watch(attr, function (value, prev) {
        if (value) {
          $timeout(function () {
            element[0].focus();
            element[0].select();
          }, timeout);
        } else if (prev) {
          // fix: blur for IE
          element[0].blur();
        }
      });
    }
  };
}])

/**
 * Debounced update of scope variable on <input /> changes
 *   [lj-debounce-delay]: option for set delay duration (in milliseconds). Default: 300
 *
 * @example
 *
 *   <!-- $scope.model.search will be updated with debounce delay 200ms ->
 *   <input type="search" lj-debounce="model.search" lj-debounce-delay="200" />
 */
.directive('ljDebounce', ['$parse', function ($parse) {
  return {
    link: function (scope, element, attrs) {
      var getter = $parse(attrs.ljDebounce),
          setter = getter.assign,
          delay  = attrs.ljDebounceDelay ? scope.$eval(attrs.ljDebounceDelay) : 300,
          events = 'change paste keyup search',
          handler,
          unwatch,
          _value;

      // changes of variable should be reflected in element
      unwatch = scope.$watch(function () {
        _value = getter(scope);
        return _value;
      }, function (value) {
        element.val(value);
      });

      handler = LJ.Function.debounce(function () {
        var value = element.val();

        if (value !== _value) {
          scope.$apply(function () {
            setter(scope, value);
          });
        }
      }, delay);

      element.on(events, handler);

      scope.$on('$destroy', function () {
        element.off(events, handler);
        unwatch();
      });
    }
  };
}])

/**
 * Scroll to the element, when ljScroll="expression" is true
 * Options:
 *   - lj-scroll-up: scroll to the top only
 *
 * HTML:
 *   <h1 lj-scroll="model.state.scrollTop"></h1>
 *
 * JS:
 *   // scroll to element will be done and prop state will be `false` again
 *   model.state.scrollTop = true;
 */
.directive('ljScroll', ['$parse', function($parse) {
  return {
    restrict: 'A',
    compile: function (element, attrs) {
      var $window = angular.element(window),
          root = angular.element('html, body'),
          ljScroll = $parse(attrs.ljScroll),
          isUp = attrs.hasOwnProperty('ljScrollUp');

      return function link(scope, element) {
        scope.$watch(function () {
          return ljScroll(scope);
        }, function (value) {
          var top;

          if (value) {
            top = element.offset().top;

            // scroll to element only if we are below
            if ( !isUp || (isUp && $window.scrollTop() > top) ) {
              root.animate({
                scrollTop: top
              });
            }

            // reset state to false
            ljScroll.assign(scope, false);
          }
        });
      };
    }
  };
}])

.directive('ljScreenable', [function() {
  var $document = angular.element(document);

  return {
    link: function ($scope, element, attrs) {
      var event = attrs.ljScreenable;

      function check () {
        if ( element.is(':screenable') ) {

          // wait for angular bindings applied; eg. data-url="{{ item.url }}"
          $scope.$evalAsync(function () {
            LJ.Event.trigger(event, element.get(0));
          });

          $document.off('scroll', check);
        }
      }

      $document.on('scroll', check);

      $scope.$on('$destroy', function () {
        $document.off('scroll', check);
      });

      check();
    }
  };
}])

.directive('ngXlinkHref', ['$timeout', function ($timeout) {
  return {
    link: function ($scope, $element, $attr) {
      $attr.$observe('ngXlinkHref', function (value) {
        if (value) {
          // Fix for FF.LJSUP-19910
          $attr.$set('xlink:href', '');

          $timeout(function () {
            $attr.$set('xlink:href', value);
          }, 300);
        }
      });
    }
  };
}])

/**
 * General wrapper for svg symbols
 *
 *   <span lj-svg-icon="fi-repost"></span>
 *   <span lj-svg-icon="{{link.repost_icon}}"></span>
 *
 * This will be replaced with:
 *
 *    <svg class="svgicon"><use xlink:href="#fi-repost"></use></svg>
 */
.directive('ljSvgIcon', ['$location', function ($location) {
  return {
    scope: {
      icon: '@ljSvgIcon'
    },

    link: function ($scope) {
      var temp = $scope.icon.split('--');

      $scope.style = $scope.icon;

      if ( temp.length > 1) {
        $scope.style += ' ' + temp[0];
      }

      $scope.$watch(function () {
        return $location.absUrl();
      }, function (url) {
        $scope.base = url.replace(/\?.*/, '');
      });
    },

    template: [
      '<svg xmlns="http://www.w3.org/2000/svg" xml:base="{{base}}" class="svgicon" ng-class="style" style="pointer-events: none; visibility: hidden;">',
        '<use xlink:href="" ng-xlink-href="{{\'#\' + icon}}"></use>',
      '</svg>'
    ].join('')
  };
}])

.directive('ljCut', [function () {
  return {
    link: function (scope, element) {
      var options = element.data('widget-options');

      element.ljcut(options);
    }
  };
}])

.directive('ljSticky', [function () {
  var $document = angular.element(document);

  return {
    link: function ($scope, $element){
      function onScrollHandler () {
         $element.toggleClass('js-sticky', $document.scrollTop() >= $element.offset().top);
      }

      $document.on('scroll', onScrollHandler);

      $scope.$on('$destroy', function () {
        $document.off('scroll', onScrollHandler);
      });

    }
  };
}])

/**
* Filter for safe url
*
*   <a href="url | trustAsResourceUrl"></a>
*/
.filter('trustAsResourceUrl', ['$sce', function($sce) {
  return function (url) {
    return $sce.trustAsResourceUrl(url);
  };
}]);
;

/* file-end: js/core/angular/common.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/bubble.js 
*/


/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/ref.js 
*/

/**
 * Define ref in HTML:
 *   <div lj-ref="my-target" />
 *
 * Scroll to ref:
 *   Ref.scrollTo('ref', { onlyUp: true });
 */

;(function () {
  'use strict';

  angular.module('LJ.Ref', [])
    .factory('Ref', [function () {
      var refs = {},
          factory = {
            add: add,
            remove: remove,
            get: get,

            scrollTo: _scrollTo
          };

      function add(id, element) {
        if ( refs[id] ) {
          console.error('Ref element with id `%s` has been registered before.', id);
          return;
        }

        refs[id] = element;
      }

      function remove(id) {
        if ( refs[id] ) {
          delete refs[id];
        }
      }

      function get(id) {
        var ref = refs[id];

        if ( !ref ) {
          console.error('Ref `%s` not found.', id);
        }

        return ref;
      }

      /**
       * Scroll to ref element
       * @param {String} ref                        Ref id
       * @param {Object} [options]                  Scroll options
       * @param {Boolean} [options.onlyUp]          Scroll to the up only. Prevent scrolling down
       * @param {Boolean} [options.onlyOutOfScreen] Scroll to ref if it displays out of viewport
       * @param {Boolean} [options.toParent]        Scroll parent element instead of <body> to ref.
       */
      function _scrollTo(ref, options) {
        if ( typeof options === 'undefined' ) {
          options = {};
        }

        var element = get(ref),
            rootElement = angular.element('html, body');

        if ( !element ) {
          console.error('Could not scroll to the ref `%s` that has not been already defined.', ref);
          return;
        }

        var top = element.offset().top;

        // do not scroll down if it is restricted
        if ( options.onlyUp && angular.element(window).scrollTop() <= top ) {
          return;
        }

        if ( options.onlyOutOfScreen && !outOfScreen(element) ) {
          return;
        }

        if ( options.toParent ) {
          rootElement = element.parent();
          top = 0;
        }

        rootElement.animate({
          scrollTop: top
        });
      }

      function outOfScreen(element) {
        var _window = angular.element(window),
            screenTop = _window.scrollTop(),
            screenBottom = screenTop + _window.height(),
            elementTop = element.offset().top;

        return elementTop > screenBottom || elementTop < screenTop;
      }

      return factory;
    }])
    .directive('ljRef', ['Ref', function (Ref) {
      return {
        restrict: 'A',
        scope: true,
        link: function ($scope, $element, $attrs) {
          var id = $attrs.ljRef;

          Ref.add(id, $element);

          $scope.$on('$destroy', function () {
            Ref.remove(id);
          });
        }
      };
    }]);
}());
;

/* file-end: js/core/angular/ref.js 
----------------------------------------------------------------------------------*/

Site.page.template['Widgets/ljBubble.tmpl'] = '<div\n    class=\"\n        b-popup\n        bubble-node\n        b-popup-withclosecontrol\n        b-bubble-{{bubble.name}}\n        \"\n    ng-show=\"show\"\n    lj-switch-off=\"show\"\n    lj-switch-off-action=\"bubble.close()\"\n    ng-style=\"{ left: position.x, top: position.y, visibility: visibility }\"\n    ng-class=\"{\n        \'b-popup-noclosecontrol\': !bubble.options.closeControl\n    }\"\n    lj-switch-off-skip>\n    <div class=\"b-popup-outer\">\n        <div class=\"b-popup-inner\">\n            <i class=\"i-popup-arr\" ng-class=\"arrowClass()\">\n                <i class=\"i-popup-arr-brdr-outer\">\n                    <i class=\"i-popup-arr-brdr-inner\">\n                        <i class=\"i-popup-arr-bg\"></i>\n                    </i>\n                </i>\n            </i>\n            <div ng-include src=\"template\"></div>\n            <i class=\"i-popup-close\" ng-click=\"bubble.close()\"></i>\n        </div>\n    </div>\n</div>\n';
/**
 * LJ bubble directive
 *
 * Options:
 *   - closeControl: show close control or not. Default: true
 *   - alwaysLeft / alwaysRight:  always place bubble left / right. Default: false
 *   - alwaysTop / alwaysBottom:  always place bubble top / bottom. Default: false
 *
 * @example
 *   html:
 *     <!--
 *       Following will add click handler to button
 *       and include myBubble.tmpl inside bubble.
 *     -->
 *     <button lj-bubble="{
 *         name: 'myBubble',
 *         template: 'settings.ng.tmpl',
 *         closeControl: false
 *       }"
 *       >Show bubble!</button>
 *
 *   js:
 *     angular.module('MyModule', ['LJ.Bubble'])
 *     .controller('MyCtrl', ['$scope', 'Bubble', function($scope, Bubble) {
 *
 *       // Use Bubble.open to control bubble from JS.
 *       // You can pass jQuery node to reposition the bubble from the original placement.
 *       Bubble.open('myBubble', { 'some-stuff': 'optional' }, jQuery('.b-some-other-block'));
 *     }]);
 *
 * @todo
 *   Refactor detection of current bubble open
 *   Refactor disableClick option of directive
 *
 * @authors
 *   Artem Tyurin (artem.tyurin@sup.com)
 *   Valeriy Vasin (valeriy.vasin@sup.com)
 */

(function($) {
  'use strict';

  angular.module('LJ.Bubble', ['LJ.Templates', 'LJ.Directives', 'LJ.Ref'])
  .factory('Bubble', ['$rootScope', '$compile', 'Ref', function ($rootScope, $compile, Ref) {
    var factory  = {},

        // bubbles options
        _options = {},

        // body className flag
        bubbleOpenClass = 'p-openpopup';

    // currently opened bubble name
    factory.current = null;

    // we can change bubble node while opening bubble
    factory.node = null;

    /**
     * Register bubble from service
     * @example
     *   Bubble.register({ name: 'share', template: 'share.ng.tmpl' });
     */
    factory.register = (function () {
      // cache for registerd from service bubbles
      var cache = {};

      function register(opts, scope) {
        if ( !opts || !opts.name || !opts.template ) {
          throw new Error('Incorrect bubble options. You should provide name and template.', opts);
        }

        var name = opts.name;

        // click is always disabled when register from factory
        opts.disableClick = true;

        // bubble has been registered before - increase counter
        if ( cache[name] ) {
          cache[name].count += 1;
          return unregister.bind(null, name);
        }

        // create lj-bubble node with params
        var bubbleNode = $('<div />').attr('lj-bubble', JSON.stringify(opts));

        // create new isolated scope for the bubble if we not provided it
        var isScopeCreated = typeof scope === 'undefined';

        if ( isScopeCreated ) {
          scope = $rootScope.$new(true);
        }

        bubbleNode.appendTo('body');
        $compile(bubbleNode)(scope);

        cache[name] = {
          count: 1,
          node: bubbleNode,
          scope: scope,
          isScopeCreated: isScopeCreated
        };

        // unregistration function
        return unregister.bind(null, name);
      }

      function unregister(name) {
        var opts = cache[name];

        if ( !opts ) {
          // nothing to unregister
          return;
        }

        opts.count -= 1;

        // perform remove
        if ( opts.count === 0 ) {

          // do not destroy scope we have not created
          if ( !opts.isScopeCreated ) {
            opts.scope.$destroy();
          }

          opts.node.remove();
          delete cache[name];
        }
      }

      return register;
    }());

    /**
     * Register bubble and copy options as prototype.
     * @param {String} name Bubble name
     */
    factory._register = function (name, options) {

      if ( _options.hasOwnProperty(name) ) {
        console.warn('Warning: bubble with name `%s` has been registered before!', name);
        return false;
      }

      var opts = angular.isDefined(options) ? angular.copy(options) : {};

      // extend with default options
      opts = angular.extend({
        closeControl: true
      }, opts);

      _options[name] = Object.create(opts);
    };

    factory._unregister = function (name) {
      delete _options[name];

      if (factory.current === name) {
        factory.current = null;
      }
    };

    /**
     * Open bubble with provided name
     * @param {String}        name       Bubble name
     * @param {Object}        [options]  Options that will be available for bubble
     * @param {jQuery|String} [node]     jQuery: Node relative to which bubble will be positioned
     *                                   String: Registered ref id
     */
    factory.open = function (name, options, node) {
      if ( !_options.hasOwnProperty(name) ) {
        throw new Error('Bubble `'+ name +'` can\'t be opened, it has not been registered yet.');
      }

      if ( options instanceof jQuery ) {
        node = options;
        options = {};
      }

      if ( typeof options === 'string' ) {
        node = Ref.get(options);
        options = {};
      }

      if (typeof options === 'object') {
        factory.options(name, options);
      }

      if (node instanceof jQuery) {
        factory.node = node;
      }

      if (typeof node === 'string') {
        factory.node = Ref.get(node);
      }

      factory.current = name;
      $rootScope.$broadcast('bubble:open'        , name, options, node);
      $rootScope.$broadcast('bubble:open:' + name, name, options, node);
      angular.element('body').addClass(bubbleOpenClass);
    };

    /**
     * Close all opened bubbles
     * @param {String} [name] Close bubble
     */
    factory.close = function () {
      var name = factory.current,
          options = _options[name],
          option;

      $rootScope.$broadcast('bubble:close'        , name, options, factory.node);
      $rootScope.$broadcast('bubble:close:' + name, name, options, factory.node);

      // clear current bubble options
      for (option in options) {
        if ( options.hasOwnProperty(option) ) {
          delete options[option];
        }
      }

      factory.current = null;
      factory.node = null;
      angular.element('body').removeClass(bubbleOpenClass);
    };

    /**
     * Set context for opened bubble
     * @param  {String} name    Bubble name
     * @param  {Object} options Opening context (arguments)
     * @return {Object}         Bubble options
     */
    factory.options = function (name, options) {
      if (typeof options === 'undefined' || options === _options[name]) {
        return _options[name];
      }

      return angular.copy(options, _options[name]);
    };

    return factory;
  }])
  .directive('ljBubble', ['Bubble', '$parse', '$compile', '$timeout', '$templateCache',
                 function( Bubble,   $parse,   $compile,   $timeout,   $templateCache ) {
    return {
      scope: true,
      link: function(scope, element, attrs) {
        var options = $parse(attrs.ljBubble)(scope),
            name    = options.name,
            bubble  = $compile($templateCache.get('ljBubble.tmpl'))(scope),
            arrow   = bubble.find('.i-popup-arr'),
            $window = angular.element(window);

        scope.show = false;

        Bubble._register(name, options);

        scope.template = options.template || (name + '.html');
        scope.bubble = {
          name: name,
          close: Bubble.close,
          options: Bubble.options(name)
        };

        scope.arrow = {
          vertical:   't', /* top  (t) or bottom (b) */
          horizontal: 'l'  /* left (l) or right  (r) */
        };

        scope.position = {
          x: -9999,
          y: -9999
        };

        scope.visibility = 'hidden';

        scope.arrowClass = function () {
          var opts = scope.bubble.options,
              vertical = scope.arrow.vertical ,
              horizontal = scope.arrow.horizontal;

          return opts.aside || options.aside ?
            'i-popup-arr' + horizontal + vertical :
            'i-popup-arr' + vertical + horizontal;
        };

        scope.$watch(function() {
          return Bubble.current;
        }, function(value) {
          hideFromViewport();

          $timeout(function() {
            scope.show = value === name;

            if (value && scope.show) {
              $timeout(setPosition);
            }
          });
        }, true);

        function setPosition() {
          // try to use top/left coords
          var vertical   = scope.arrow.vertical,
              horizontal = scope.arrow.horizontal,
              opts = function (option) {
                return scope.bubble.options[option] || options[option];
              };

          scope.visibility = 'hidden';

          // calculate positions initially
          recalculatePositions();

          // if there is not enough vertical space,
          // bubble shows at the top of the target
          if ( isOutOfViewportY() ) {

            // we should change arrow position if possible
            scope.arrow.vertical = vertical === 'b'  ?
                                  ( opts('alwaysBottom')   ? 't' : 'b'):
                                  ( opts('alwaysTop')      ? 'b' : 't');
          }

          // if there is not enough horizontal space,
          // bubble shows at the right of the target
          if ( isOutOfViewportX() ) {
            // we should change arrow position
            scope.arrow.horizontal = horizontal === 'l' ?
                                    ( opts('alwaysLeft')   ? 'r' : 'l') :
                                    ( opts('alwaysRight')  ? 'l' : 'r');
          }

          // top/left coords can't be used
          if (
              scope.arrow.horizontal !== horizontal ||
              scope.arrow.vertical   !== vertical
          ) {
            // positions should be recalculated
            // timeout is needed to apply arrow positions
            $timeout(function () {
              recalculatePositions();
              scope.visibility = 'visible';
            });
          } else {
            scope.visibility = 'visible';
          }
        }

        function recalculatePositions() {
          var el      = Bubble.node || element,
              centerX = el.offset().left + Math.floor(el.outerWidth() / 2),
              forceX  = scope.bubble.options.forceX || 0,
              forceY  = scope.bubble.options.forceY || 0;

          if ( scope.bubble.options.aside || options.aside ) {

            scope.position.x = scope.arrow.horizontal === 'r' ?
              el.offset().left - bubble.outerWidth() - arrow.outerWidth() + forceX :
              el.offset().left + el.outerWidth() + arrow.outerWidth() + forceX;

            scope.position.y = el.offset().top - arrow.position().top + ( el.outerHeight() - arrow.outerHeight() )/ 2 + forceY;

          } else {

            scope.position.x = centerX - arrow.position().left - Math.floor(arrow.outerWidth() / 2) - 2 + forceX;

            scope.position.y = scope.arrow.vertical === 't' ?
                               el.offset().top + el.outerHeight() + arrow.outerHeight() + forceY :
                               el.offset().top - arrow.outerHeight() - bubble.outerHeight() + forceY;
          }
        }

        function hideFromViewport() {
          scope.position.x = -9999;
        }

        function isOutOfViewportY() {
          var scrollTop = $window.scrollTop();

          if ( scope.position.y < scrollTop || scope.bubble.options.aside ) {
            return true;
          }

          return scope.position.y + bubble.outerHeight() > scrollTop + $window.outerHeight();
        }

        function isOutOfViewportX() {
          var scrollLeft = $window.scrollLeft();

          if ( scope.position.x < scrollLeft || scope.bubble.options.aside ) {
            return true;
          }

          return scope.position.x + bubble.outerWidth() > scrollLeft + $window.outerWidth();
        }

        /**
         * Bubble target click handler
         * @param  {jQuery.Event} event Click event object
         */
        function onTargetClick(event) {
          event.preventDefault();

          if ( Bubble.current === options.name ) {
            return;
          }

          $timeout(function() {
            Bubble.open(options.name);
          });
        }

        function onResize() {
          if (scope.show) {
            $timeout(setPosition);
          }
        }

        if ( !options.disableClick ) {
          element.on('click', onTargetClick);
        }

        $window.on('resize', onResize);

        if ( options.recalculateOnScroll ) {
          $window.on('scroll', onResize);
        }

        $('body').append(bubble);

        scope.$on('$destroy', function () {
          element.off('click', onTargetClick);
          $window.off('resize', onResize);
          $window.off('scroll', onResize);
          Bubble._unregister(name);
          bubble.remove();
        });
      }
    };
  }]);
})(jQuery);
;

/* file-end: js/core/angular/bubble.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/ljUser.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/api.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/messages.js 
*/


Site.page.template['angular/ljMessages.ng.tmpl'] = '<div\n    class=\"b-msgsystem-wrapper b-msgsystem-wrapper-fixed\"\n    ng-hide=\"directive.messages.length === 0\"\n    >\n    <div\n        ng-repeat=\"message in directive.messages\"\n        class=\"b-msgsystem b-msgsystem-type-{{message.type}}\"\n        ng-animate=\"\'b-msgsystem\'\"\n        >\n        <header\n            class=\"b-msgsystem-head\"\n            lj-html=\"message.title\"\n            ng-if=\"message.title\"\n            ></header>\n        <div class=\"b-msgsystem-wrap\">\n            <div class=\"b-msgsystem-body\" lj-html=\"message.body\"></div>\n        </div>\n        <span class=\"b-msgsystem-close\" ng-click=\"directive.close(message)\">\n            <span class=\"b-msgsystem-close-text\" lj-ml=\"component.messages.close\"></span>\n            <span class=\"b-msgsystem-close-ctrl\" lj-ml=\"component.messages.close\" lj-ml-attr=\"title\">&times;</span>\n        </span>\n    </div>\n</div>\n';
LJ.injectStyle('/* System Message\n----------------------------------- */\n.b-msgsystem-wrapper {\n    width: 100%;\n    height: auto;\n    }\n    .b-msgsystem-wrapper.b-msgsystem-wrapper-fixed {\n        position: absolute;\n        top: 0;\n        left: 0;\n        z-index: 1001;\n        overflow: hidden;\n        padding: 0 0 10px;\n        }\n    .s-schemius .b-msgsystem-wrapper.b-msgsystem-wrapper-fixed {\n        top: 60px;\n        }\n\n    .g-sensor .b-msgsystem-wrapper.b-msgsystem-wrapper-fixed,\n    .mobile-msg .b-msgsystem-wrapper.b-msgsystem-wrapper-fixed {\n        position: static;\n        padding: 0;\n        background-image: none;\n        }\n\n.b-msgsystem {\n    position: relative;\n    min-height: 50px;\n    padding: 10px 140px 10px 120px;\n    font: 14px/1.357 Arial, Helvetica, sans-serif;\n    }\n    .b-msgsystem DD,\n    .b-msgsystem DT,\n    .b-msgsystem TH,\n    .b-msgsystem TD,\n    .b-msgsystem P,\n    .b-msgsystem DIV,\n    .b-msgsystem LI,\n    .b-msgsystem PRE,\n    .b-msgsystem CODE,\n    .b-msgsystem KBD {\n        font-size: 100%;\n        }\n    .b-msgsystem .i-ljuser-userhead {\n        vertical-align: top !important;\n        margin: 3px 0 0 0;\n        }\n.b-msgsystem:after {\n    position: absolute;\n    bottom: -10px;\n    left: 0;\n    display: block;\n    content: \'\';\n    width: 100%;\n    height: 10px;\n    background-image: -webkit-linear-gradient(top, rgba(53, 99, 161, 0.3), rgba(53, 99, 161, 0));\n    background-image:    -moz-linear-gradient(top, rgba(53, 99, 161, 0.3), rgba(53, 99, 161, 0));\n    background-image:      -o-linear-gradient(top, rgba(53, 99, 161, 0.3), rgba(53, 99, 161, 0));\n    background-image:   linear-gradient(to bottom, rgba(53, 99, 161, 0.3), rgba(53, 99, 161, 0));\n    -webkit-background-size: 10px 10px;\n         -o-background-size: 10px 10px;\n            background-size: 10px 10px;\n    background-position: 0 100%;\n    background-repeat: repeat-x;\n    }\n    .b-msgsystem-head {\n        margin: 0 0 0.357em;\n        padding: 0;\n        font-size: 1.142em;\n        font-weight: bold;\n        }\n    .b-msgsystem-wrap {\n        line-height: 50px;\n        min-height: 50px;\n        }\n\n    .b-msgsystem-head ~ .b-msgsystem-wrap {\n        line-height: inherit;\n        min-height: 0;\n        }\n\n    .b-msgsystem-body {\n        display: inline-block;\n        vertical-align: middle;\n        line-height: 1.571;\n        font-size: 1em;\n        color: #787878;\n        }\n\n.b-msgsystem .i-ljuser-username,\n.b-msgsystem .i-ljuser-username:link,\n.b-msgsystem .i-ljuser-username:visited {\n    color: #0051B7 !important;\n    }\n.b-msgsystem .i-ljuser-username:hover,\n.b-msgsystem .i-ljuser-username:active {\n    color: #C00 !important;\n    }\n\n.b-msgsystem-type-error {\n    background: #FFEFEF no-repeat 2.7em 50% url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA7CAYAAADFJfKzAAAKeElEQVRo3tVbCVBURxp2ACMBRWaiOICCIMQDLFDjuaWGxERDUmYVIpaKEl1dN0aN1xrRoBDBAwwi4m0irhpjJB4rri7GI2q5luJ9gMageAAKiJwCwr/9U/9QPc17MwOZgbGrvpqZ9/r//++b7v67X7/3mjUzXVEQLARYchDPaWxei8KLs2JozvAGQwsGaw5vCr9bUL3mZMeLN3uB1jP9PlReXRjpn/HtqsjHUXFJWcvjr+asWJv1dMXaF89WJgB+4m88juexHtZHO/oDzEq4guuWSKwFI/rW7bBlkx5FrT6as3zNy6cr4qG+QDu0Rz/oj1q9OdftFY0tUiO0RmRswBine0uil2VHxeXmLFsDxgL6Q7/onxPdaGNbwXXXNzo7qFumLYqambU0Nj87cjWYCsz/c4yD8WhsW5m6lfnWtE6eOsvnQXhM6pOlsdBYwHgYlxvTJhGs4MamTercsAmPwmMKH0esAl14unE7FBw9AaU30qDiSQ68KiyCqrKXgAU/8Tcex/NYD+vr84lxMT7y4MaywthCsfvYXp8fvuThkuhqBpBD/sEjUJHzDBpS0A7tdfnH+MgD+RAvowjWEnprfvjazLAVIAckWfWyHIxR0E/+waOgKx7jE28swVpCL81eFHF/0TKQwpO1W6H8cRaYoqBf9C8XG3n9WcF8MrI9M23epIzQyGoGEJHFxhlUVYNJC/OPcaTiI6/T0+Z+ToLrnbR4oTY7Rof0+X1+eOm9+REgIu/wMWjMgvGkeDB+hVsDx73DJS2DBStoHrN2smutvDX7m0t35y0BEbnJKdAUBeNK8WE8L3u2cVDRtGRliFhNq2L/b3V6yqy56bPDQERm/BZoyoLxpXid+fvsUORN/PW2bm33ndx7QMebM0Of3/5qIfDIWJUAUF3dpGKhqgr+WBkPIjfGtwB5C91ZZ/bFNajdyYnTo25OXwAiyh49AXMoZZmPQIof8kb+pEM2Oys0rern5uF09Yt5eden/RN4PN6VBOZUHv+YBCJH5I38udZVyHXhmlbdP/rzyVenzgERr0rLzEos8pHiyfhP4VrXQi4D4w6C6mzIlymXJ88CHpmJuw1bBBQVw7nl38HeT0bBLyPHwpVN26CqolL/MGR1sC7aoC36QF96k1XiTyByZfyPoQ7SUyczaxJTy37OLh0uTpzxMnXiDOBRcv+h3sCVpaWwa7A/rGnrroWDY/+mO6mxc1hHtENfFSUlOmOWPHgIIlfkP8jFzQX1SCUqC5qfWm/xHznqQsg04HFj4VKDWvXKxh/qENbg/q+nZO3wnJwd+tRXbiyMBJEz6kA9pMtCsgsfCgiOPR88FXg82LHHILEp0+fJkr4Yt17W7sLqdbJ26FNfQX4iZ9Qh1ZU1WRjXlm1TPptw5NyYycAj73yqQWL/tyJWlnT63gOydnhOzu7cslX6l5GMn8gZdaAebs2saMavmBjUxwNDbp8JmgQ8ijMyDRJb9CQbNr3dsw7hf/UfApVl8pkcz2Ed0Q59oU99pfh+JoicmY401COsqGqnHOzfTicDJuT+FhgCPMoLXhi+dr2dDvsCx0O82hMS2neFwxOnQXF2jn7CrM7hSV/W2KAt+kBfBs0Aefkgcj4RMD4H9ZCuFrxYHMT2DM4nRgRXnBwRDDwMmTqadL4tKQWR8/G/jitGPaSrNklZ0g/cnO5wfPgYEPE6FCneqId01RGLmcsl5eOgimMfBwGPqooKsxZayVpW5JziP6qYxGou+yw1Yt/UiD08NCDv6LBA4FGeX2DWYl/m5oHIOXnoyKeoh5t+LOu07IH3h6f954MRwOPF73+YtdjCexkgcmY60uVatnbM7h44LCX5veHAI+vU2T+3nZJ2F65uSYRfZ4fC/s8mwJ6hI2uA3/EYnsM6DS3IT+SMOqTGrFY23tTHL+Hfgz8BHjfiN9d/V5BtgF9evxW2931PdsEgIrGPH1xatwXKXxTWKxbyEzmjDqlsrDXPLujWM+TAwI+Ax/HxUw2PzBb117ftgs2de2kJWd/RG3YOHAb7Ro6DQ8FTaoDf8RieExcT6KOa7UgYlIkZP5Ez6pCbZ2tXUK42rbyTBnxQ/suAD4HH83T93ayUTe4HgkJqCG/o5AP//WIOpP28DwoyHui96sE6WBdt0BZ97B8VUuNTV0FeIlfk36mlXXepFZTW2pjBfVuvQaf29n0feKRG6l6jFrHN7MTe78KeYQFwZ98heFXe8DsDaHtn/yH42T+wxmeRjq0g5CVyRf6oQ2ptrHXVgxl5cWffOXveYcQFVMpcW5Y+y63plpknTxt/J5H5RN8Yo+78WgJSPJG/MO1oXcDXXs/ioG5vbeOz03fg8909BgGPC99GSxLKTr0CVZWvTLeZyHznXL5W99JwaQyIHJE38qfkVOd6VmungsGBoVNMl54bd/n8BUTkp90xi7k172YaSPFD3sifdEjuVGi6so2mK/dopeyf6NX3xQ7vfsDjMEsaTV0wSycHBIPIjfEtRN5cF7aRuztQu7vI4Mjgubhjt6jtXfuAiCNjJzepWIwvxSvCzSsaeRN/2d1FrbsBDPiUimsLC4vu6z19b25jc6aIizFrmkQoxpXis8HT95atpSVON67E31bXXQGtOwI0R3kMV6lHbPXoUfa9Rw8QcWFlXKMKxXhSPLZ4+Bb7K9t9Sq2qNuSOgNi6Klpbdp3l6B661d2nmgFEHGJjuPpVlWnHKPOPcaTiI69ZavevkSe38Nd7r6fOXTzKaG4M3mFOHhs3s2WdFJI+CoBn126aRCj6Rf9ysb9x6oRrYG/i6VCfu3ha92dpnlJTKveJcPTYubFDN5DDb18vYbv4RUYRWcHuBpxeEA664jE+O5AX8VNz86pVfW5G891ZSRM0jgffUIeOCRucu1QzgBxOzl0E+ekNu2RDO7TX5R/jIw8S6kkLfmVD7rzXeaaCxkGt4H8onUPXOnqWrHN8G3Rhz5BP4UxYJNw9kAxPr92A4qzs2ss3/MTfeBzPn10cVVNfn0+Mi/E5oc7Er0HPVEg+LUPpXCPYx8/GPjDGwf12QjsPaCxgPIwrI9S4jweRYycaI97NFYo+M+wdo+Mc3ArjHdzBVGD+izAOxqNk1Il4GE2onGAlJQM3Sve+7s2th8y3d/4htk3HgjVt3MBYQH/M7zZP5p/F6UHx3Ci+0thCJZ9dpKzXluY1DwYvhp5tLK0GT2nlELHUvv351SrX8jiVK9QXzK4C7dEP+kO/5N+D4rWl+CZ5dlHyqVSaz1T0L7vSGPKiFujdxsLq3SAb1cy5durvF7d2Or7cvv2daPsOud8pXUpWK10AP/E3HsfzWG+0jeortEN78uNFfl0pjorimvSpVMnnjenftaPk5UhXGzieutDY8mXoReT7MvRj6M+hHx3vTfV8ya4L+XEhv29RHJvGet5Y9klyGjt29M+3oyzpQlsjnkS+G7UUiulOn150vAvVcyc7Z/KjIr+2TfEkuc53BOifb0ljSkXjS02Z05nGXAcSpPnuTOfVVF9F9q3IX5O+I2DQ2x+092NLpFvT/q2SxGigpOMacbbcazBm/dqLwkTv9bwWLzWZ3Rtb/weCZK6FTFk50QAAAABJRU5ErkJggg==\');\n    color: #CB1427;\n    }\n    .b-msgsystem-type-error + .b-msgsystem-type-error {\n        border-top: 1px solid #FFDFDF;\n        }\n.b-msgsystem-type-warning {\n    background: #FCF8E3 no-repeat 2.7em 50% url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA7CAYAAADFJfKzAAAJyUlEQVRo3tVbDVRUxxVmWUAEREHFBSpEhUarFrXRiCdHkxxzmkSt1arxaKMSlJrE+IPWvwRUBEzCUWKAClYDFhNrqoBRTBQDgpQ2AWUNsqIYDQqKAiIEEBC5nUvvcmaH93YXw8I653wH9u3ce79vZ+bOvHnzLCxMVxQESwFKDuJ3WpunovDirBisGWwYejHYcugtfO5F9azJjhdv9gJtVwZMcVJnbnj9+oUtYaUFIUdva0Ivll8Ou3O3KKzm3pVwwL/4Ga/j91gP66Md/QBmJVzBdUsk1mtVwJT+mpxN/qUF206VX97eeLcoFDoLtEN79IP+qNWtuW6v6G6RWqFtIiNDZ7ldy/1gx53CkMpyzXboKqA/9Iv+OdHdNrYVXHe1edbLxUGTs3FV2aWt928XbgNTgfmvxjgYj8a2lalbmW9N29QvlvqU5AedLyvYAt0FjIdxuTFtEsEKbmza5aWtXnxLHVRbejEI9OHulWh4UHYSGqoLoLnhNrQ018DjloeABf/iZ7yO32M9rG/IJ8bF+MiDG8uKrhaK3cf+h7OBW2/mv9/KAHKoupkMzQ/L4UkK2qG9Pv8YH3kgH+LVJYJ1hBZmBUaXnN8EcqgqSWYt1ghdUdAP+tMXj/GJ6irBOkIvpL0XciN3PUihrDASmupLwRQF/aJ/udjI65cK5pORfdaxAP8fv1vXygAiyjQxAK2PwaSF+cc4UvGRV2bKMj8S3OmkxQu1S4yaM6H434EN13ICQURlyQnozoLxpHgwfrX7ds56jktaRgtW0Dxm6zaoj1NhxooLV7NXgYiKn76CnigYV4oP45nvPaS/M01LVsaI1bYq9v8+WUl+64qyVoCIEnUk9GTB+FK8ziX7bUbexN9g67Z332ULxj1zKf3tak3GO8Djet6HOIh6VCyO4eu5YSByY3wfIG+hO+vNvrgGdcz48s3wS2f+AiIe1t4EcygNtSUgxQ95I3/SIZudFdpWfdHX0039jX/VD6eXAo9SzT/AnEqpJhFEjupT/lXIn2tdhVwXbmvV5L2zl6m/9gMRLY8azEos8pHiyfgHcK1rKZeBcQfBOfvIgrQLJxYBj5KL+8EcC/ISuTL+Z1AH6emQmbWJyWHiWNfBuSkLG/OOLQQe9Q9uGBW8/EYuJEW8AjHL+0DsigFwer8fG18VRozBe2110QZt0Qf6MlSQl8gV+U8e7+6BeqQSlSXNT33/vmPqvO+T5wOPgjPrjBJ6/3YRxL47AKID7HVwKOR51uWa9HTHprY6ol3sioFtPg2Vgm//CiJn1IF6SJelZBc+vnd65H+PzAUeP6kTjBKbnvguRAXYSeLHfPlFSPH5JFk79GmoID+RM+qQ6sraLIxry4Gn42d8k3N4NvCovPUfo8Qe+2QmRC2zk4T6TLSsnTotStYOfRpcRjJ+ImfUgXq4NbPCgl8xMajSD8y4nP3FTOBRd/+6UWJzkoIZwd6SKC3KlLW7VXRW1g59Gip11TdA5Mx0FKEeYUXVPuVg/3bLODCtMjNxOvBoelht5ERfAQkbnoVPl9rqIPVvbxi0TY2Z18EOfRmT3BrrK0HknJ4w7S7qIV29eLE4iPsxuKfHv9qckfAq8Hjc0tyJlU0FnDu8Hg6HvgBHP57a1n1bH7cYvll//KitLtqgLfowRiiWR831IHJOj/99HeohXe1JSkkfcHN68Lf7XwERT0OR4o16SFcHsZi5PE7Hvdyctvdl4NGZlu2J8qipHkTOp+NeqiOx2ts+pVZsb63YkzGTq07tmQI8mhrum7XYxroKEDmnRk++h3q46UfZoWVTIicVnYx+AXjUVFw1a7G1FcUgcmY6rsi1bPuYPRT+XNqJ3ROBx53idLMWi/xEzqhDaszqZOO4zb+N+WrXeOBx6ewusxaL/ETOqEMqG+vMs5sWD12SEjEOeKTHzzUY8Fpeikmhd5nK+ImcUYfcPNu+gvJ0tR119EOfpqSPfIBHdfllvQF3LVKYFHIFeYlckf8w996jpVZQOmtjhqEJQSMyj4SPAh7nU7foFbvzTQuTQq4gL5Er8kcdUmtjnbsezMhb3vJce3j7CBDxqKnOzObXOpDiifyFaUfnBr79fhYH9a9cbHwOBntXH9r6a+Dx/fEgsxKbezwYRI7IG/lTcupwP6uzU8HgwjAs4m2PuM+DhoGI+3c0ZiG0qqwApPghb+RPOiR3KrRd2U7blcd62/kmbPKsSXz/GeCRGjOjx4W2sn3jE1GvgciN8a1F3lwXtpN7OtC+u8jgyuAdvEgVfmCjB4j4OvZPPSoW40vx2rZEFYG8ib/s7qLO0wAGPKXi2ctaMXrParfChPXuICLvZFiPCMW4UnxiV7tp7G0tcbrxJP72+p4K6DwRoDnK6w++DrP2B6oefrZWBSJyT4R2b0Ji8aR47AtU1b0+wX4mtarKmCcCYus609pyxJrZ/TbvW+PSygAijn86w6ib81/2aKelLY5UfOS1ela/jciTW/gbfNbT4SkeZbQhDKOCF/SN27uyP0jh6EeToeKm2jSPKJlf9C8X+4P5fXENPIp4unTmKZ7O81map1SUyn1CFjp+HrfCCeSQdWgN26+q7RKRzY0/w7l/BoK+eIzPQeRF/FTcvGrVmYfRfHd2ogkax8OYTXPtY/a849jKAHI4e/A9qLr9ZPMx2qG9Pv8YH3mQUG9a8Ds9yZP3DmcqaBy0C17+mu3mqACH+pjlDqAPh0MnQfaXG6A49wjcK8lnW55lbNej5v8HQ9hf/IzX8fvsf21sq2/IJ8bF+JxQd+L3RGcqJE/LUDrXCvZ5abTVnIglvS9Hs1377gLGw7gyQrv2eBA5dqMxMsraymLCymk2Ebvfsq2NYvu8pgLz/zPGwXiUjIYRjy4TKifYiZLBEEr3Y4YOUkxd/0fr+F1+Ng92+9tAVwH9Mb8JXq6WU1mcsRRvCMV36mqhkmcXKesNpHnNi2Ekw7gBjoopAVOVIdvnW30XucSq6RM/K+gsmF0z2qMf9Id+yb8XxRtI8U1ydlHyVCrNZ870K3vSGBpJLTB+QB+LF+f5Wq5aO93ys+A5yvQdC5RXI/6srNy5SFkfuVgJ+Bc/43X8Huu9MclyNdqhPfkZSX49KY4zxTXpqVTJ88b06zpS8nKluw0cT8NpbI1h+B2Rf55hIoMvh4l0fTzVG0N2w8mPB/ntT3Hsuuu8sexJcho7jvTLD6Is6UFbI95E/jfUUihmNP0dSdeHU72hZOdOfpzJr31PnCTX+44A/fIONKacaXypKHO605gbTIK0/7vT9yqq70z2fchfj74jYNTbH7T3Y0+k+9L+rROJ0cKJrmvF2XOvwZj1ay8KE73X81S81GR2b2z9DzRDXz0l+Xs9AAAAAElFTkSuQmCC\');\n    color: #C09853;\n    }\n    .b-msgsystem-type-warning + .b-msgsystem-type-warning {\n        border-top: 1px solid #F9F1C7;\n        }\n.b-msgsystem-type-success {\n    background: #DFF0D8 no-repeat 2.7em 50% url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA7CAYAAADFJfKzAAAKXElEQVRo3tVbCVRV1xX1MwsIgkoRFBwgscikBkTSRq2miRpjnIixDkkVMdYposUhMgq2tQaM4JCotUZNamNjTDROC61jspyXAxqJKAoEBRFkRjh9m5zPujze+/9j+YCXtdfnv3vPOXv/e++5901t2hivaBgmMpgKkNdpbZ6LIoozk2AuwUKCpQQrAW1l3y25nTnbieJbvUCrQfMGOSy+vHh4dEZ0fFxW3O74nPjLCbkJOQkPEgpXPlxJ+MR3HEc92qE97PgHaFXCNcKwBDFLiWiHZWnLpsXdjzsYnxtfLgmixgJ2sIcf+ONeNxeGvaa5RWqF1oocnTjGZXl65Mq4nBV5K36Op6YC/MEv/Auim21ua4ThauH0opPtkrRl82Ky4x7F5qwgY0HyX4A4iMdz28zYvSz2ptWMfTP8Iu9GnY/JjqXmAuIhrjCnjSJYI8xN6wXnw6dG3Y8uisqKIV1Y92ADfff4AF0pvUrZldlU+LSIyqrLCAWf+I7jqEc7tNfnE3ERHzyEuaxpaqEYPjbhVyKiP7wXXSOB1PDVo730c2UuPUuBHex1+Ud88AAf5tUkgusLvR6RvDQzktQAkuXV5dQUBX72SP50xZP4rG0qwfWEzruwIHbxnQ9JCWuyk+l+RRYZo8Av/KvFBq//V7CYjGzCTsyetuj2shoJJEdK9idULf0Zs8A/4ijFB68Zx2e/x4IbnbREodbjt08MDE9fUhr+0xKS49v8A9ScBfGUeEj8isZsDnlJSFoGC9bwOmbVzsXOYc71hRfm34ogOb7J208tURBXiY/E82IHz46OvCyZGSJW26sY/+2mnXh/4dybi0iOpMwUasmC+Eq8pp2ctRS8mb/e3q0bvn1D+3ebdS284E9pC0nEXzOSqEb6a8mCOZxw+yOSc5P4PgZv2XDWmX2xB7WbciwsYea1BSTHvbL71BrK3bJ7pMQPvMGfdahmZ422V90H93CZfnlefuiV+STis6x/UWsqn2XtIjlH8AZ/oXc1akO4tlfH7pkc+sfLc0mO0qelrUos+CjxlPjPEHrXRC0D4wqC4x9OhR2eenE2idicuYNaY9mSuZPkXCX+R6CD9TTIzNrEZNs5qGvXSedmlU86P4tEZJRkGhS8qKKYYs6k0OB/v0uv7Q6l5Es7qLK6Sq8d2qAtbGALH/Clr9yReMm5gn+XV7q5QY9SojLh9cl+6KZRIe+cDSMRi67GGCS0pKqMXtoxnizX+NXD6L1zdGZw1KGN3A6+iiv1T50/S/zknKEDeliXieIQHvntxMSQH0JJxNa7hiWmtRe3NyCsxaE7p1TtUKdmB5/6CvjJOUOH0lDWZmHsLTu9eWjygbGnp5GIM3nnDBIbejhSlfTfzm5WtUOdmt30Q8v1xgU/OWfogB5hz6xpI+6YJDiPTJ2S9tbJ90jE7eK7BomN+369KunPb6hvL1GnZhd9Ollv3IziTJJzlnTcgB7ZjqpuycH4dhlxbEreG8enkoiCikKDxGY9yaXOG19pQNhn2ygqrVI/z0Ud2sjt4As+9ZW8ikck5zzi6JRc6GFdlqJYTOL2ElyHHZ1cOezYZBJhSDbVlqt5t2j4V2Fk/XEfsk8OpIn7F1JO8UO9dmiDtrCBLXzAl0GJUVpv5ZxfT51UDD2sqy5JmfIXXJzu+vvUiSTH81CUeEMP62ogFpnLbcihCZVDDk8gEZXVla1aaElVKck5/+7Q28UsVnvaZ6oV21YrduD+8fmDDoaQiEcVj1u12Ifl+STnPHDfuAfQIyw/pg16Nvjr0Td+8904EvFjYUarFnurKIPknCUdN9V6tm7OBnzxxuEB+8aQiKM5Z1q1WPCTc4YOpTlbLxv7bnw1JXDvWyTio6ubdQZLzfye8suMN9TzSgtqY6gV8JNzhg6lbFxvne25JODdfntGkoiQ1Nk6yZQ9La/d2yZd2KZzPW30KZzkCz7hGzHUCvjJOUOH2jpbt4Nq627n7b97eIX/f0aQiLSCdJ3EsGHHGYvLJwNrdz3pBZnPLBK28AFf8KnrZAC85FzB37qnvY/SDqre3lhCD6+tQ//r8+UwEhF1Psmg07SIE6vrdkCBO0No6clE+jo9le4UZlFV9dMGNjiGOrRBW9ho7eFL34YGvORcwR86lPbG9c56kJHdowLCvXa9RnIUVxl2peJM9iUK+nxCg+0fdkZunw4hzy2v1wL/45i8HWxPZ1/UGwd8lHiCv2zZqXcCX3c+i0lt2cXW74UdQwte/OJVErH8bKLBQxHnqEfunqEJ+8LJIaW/6kZfC7RBW9gYevUy8mwSyTmCN/hzcmpwPlvvSoUEJwk93f4etNFj5xCS4/qj9EbPQSSXE/fPUcqlnbVDc+aRmFrgfxxDna4EpFSu5N8kJX7gDf6sQ/FKhXYoW2uHsnWfDgO6/XNQYfftg0nEyP1hLb6uVtfU0PB900nOTeJbBN7CELZWuztQd3VRQmcJns5RfRLctg0kOcYemN2iYhFfiZdzbN9V4M38Va8u1rsbIAFPqbhrLE19XNYHX3Pd+luSI/7chhYRirhKfFw2BF83sTHDcuPO/G103RWod0eA1ygP2ze7jnbe/HKZ85aXSY4VZ9c1q1DEU+LhvCm42GZ4l1Hcq86G3BGQ964j7y1/3f4Dr6VOm4JrJJAcI7+ZSU9rjHt/Fv4RRyk+eLWf77UYPIWNv957PQ3u4nFG6y7B2z7Sd2OHT4NICa/snkyXHqYZRSj8wr9abPvlPtgDezNPp8bcxat3f5bXKWdO5X52sb47HDYGkho+OL7SoAvbhpQnlSW04MRfSFc8ic928GJ+zsK6ataYm9HicHbgBRrzwd92iVeK/fqAGgmkhjnHVlBa/k/PJBJ2sNflH/HBg4V68obf4VnuvDd4poLnQZ1gq/c9ltom9y2xXdePdCF41zsUcXI1fXnrIF18kEZZxblUWPGkVhQ+8R3HUb/41Ora9vp8Ii7iC0Jdmd8zPVOh+LQMp3OtYD+zwU7j2q7yS7NO7kvNBcRDXBWhTft4EDt24Tni3cbcJNBirscqqzV+RVZr/cloWOP3BHEQj5NRT+bRZELVBDtwMujO6d5f08NmqHnEC/+wSPR9bPGxHzUZJH+S360mnrZDpTh9OF53ju/Q1EIVn13krNeJ1zUPCb0l9NV0tBhoNqNbrHmc1w/mib4V5km+1Ggk+lbCHn7gD37ZvwfH68TxjfLsouJTqbyeOfKv7M5zqDf3QECbjhaDTEJc55mEe2wxjeyVarqy94+mq7zzTFd7l5gm+lDtJ77juFSPdiZvu86HXa39L356s193juPIcY36VKri88b869px8urMZxuYT714bvlL6Mfk+0sIkjBAQBAfD+B2/mzXi/24sd8OHMe6uZ43Vn2SnOeOHf/yv+Is6caXRjyZvBf3FMT48GdvPt6L2/VgO1f248h+bVriSXKd7wjwL2/Lc8qR55czZ05XnnNdWZD2f1eud+b2jmzfjv216DsCBr39wdd+bJi0PV+/dWAxWjjwca04G+E1mFb92ovGSO/1PBcvNbW6N7b+B2yJlhtD2EeEAAAAAElFTkSuQmCC\');\n    color: #468847;\n    }\n    .b-msgsystem-type-success + .b-msgsystem-type-success {\n        border-top: 1px solid #BFE1B1;\n        }\n.b-msgsystem-type-info {\n    background: #D9EDF7 no-repeat 2.7em 50% url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA7CAYAAADFJfKzAAAK6UlEQVR42tVbCVBUVxYdQEVpINIsQRgQUeLKgNEYnZpKdEonVpwJbnEdt3JEGQ0uDGNEBhQ3iEbcUFBBUVR0BEFBURBQxJEgMSibK6Ls0Cwt0NAsd96lXpvfrz/dSNE0OVWnoLv/u/ec/9677/3fv3+nRmhRajPU4ZD5jLb5LYAx14ewL2E/Ql3C/hwOYF7r0uP6YjvGfK832H/ywvVGHuGZX/tcy9+1K64oYs+tkkzfhLIS34TyWr/bFYB/8TW+j5/jcXg8tsP2/MY1b1KHCtMlQo09I3JX7owrvLk7vqxxT0I5fCixHbbHOBgP49L4Oj1rmp2L1OQcN38L7+iXe3bdKq0kYqG7iPEwLsaXme7Jua3FGa79zAYP1996OW/9jriSqp03S0FdJPGrMQ/mw7yYX629zPRmf+eDsQ7eMQUZPnHF0FPEfJhXNqe7zTAAmBKuIAwhfNDW1pbR0tISVltbu9b3araL9/VC8bYbRaCMx+6VQ1xuDWQVN0BxrRTEkhaQSFsBgX/xNb6Pn+NxeLyqmJh3U1jGMiJRjzOXtbpqchBhGChBDREZk1UNXrFveRn9uArKxFLoArAdtmdjsmxzD3+yjcgV4LDukmEAWEpYAQTNLa1w7eFLWHfyNkzb/l+Y4nURXILiIe5RPsiQXlAHntfevGdUZhU0NrdCNwDjoGkam5/uF3MOd8kwAAQBRVTac/jDplAwWnqElyuP3mw/GYjQtDI4nFwMhTVNoA5gXIzvcfU1LzeE/ezDGlZldA4QtLS2wfqQRDSkktsv3QdEYXUTkGZqBcYPTCmB76Py+djmcjxlBTWsumgBwAEg8DiXImfIZHkA/HV3JKwhw9d+o3xPm688BrUNTdCTiM0SgXvkS0VGvBDP8Qwej0VLpWEAcAaC0KTs92am74iAF6XVIAMaG+8eJmf41i+voacR86QS3C4/V+CG8JxHxlZ2Qros9VFmdiRhMxAE3HgEc/dehabmFkC8KG+AjAIxIPyvZciZPXc3FzSBQ4lvYMOlpwpcFXTPg9gxwPmrqncnAIO0V9VNruG5cD6tGBBhd3PkzN5+XACaAM5hv7hXgNq4/O5Cds14p1U2zHDmhVZDQ8NEiUTiLZVKE+4/LU1eez4bkElPRYDAosQ1K3onAU2hQCRBbQpccTR5N/FiSKirrDpr0bOhZ/PpFIvVZzJFa8KeAPJNlQQQk70uvjeK666mcS6tCPXJcfXZTBHq5/Qur1ltejYM5/lGrXIOzQSkZ2QuIN5UiOV6FeevptHQ1IIaFUj0O3N6V5uvV/vQOwjCpYGp8StPPQJkSEoBILAYcc3mvBVBR3iUXw6eF+7BuhO32wteTX0jqML9vCLYEpbSvmM7Hv8Y6iRS6AxOp75BnXIk+hPQB/pRqMycqxl9i9ETrZaffNi4PDgDkHFPygCB4mVGjZcFtG9A+BB4KxOEy+Q3ICNdT9FljB97ItMUNi24zJVU14EqvK6sR51yRP1WDl9Yox++QqVN16ePvtp8ct6SE+kgY1JeBSBwZ8XdbOB2kUVBhRg/491xzfSLBj78kl/e4S7tH2Rb2hlsuZyFWuWIPtAP9aXNO4Rn+sb4LwpMAxkvpxcCwu/KT3JC0p6VAAt2aWJ3Y208g+FgTEaHbezWBkNncCa1ALXKEX2wQ5lbhQWEprN/jI+bf/R/IKNPdDYg7mS/VXnWo3960aFwK+cg4EPw7ScdtnF0OwOdwYOXItQqR/SBftAXtypr0x2HAaH5LP+k3LlHUkHGBcfuAwJ75QvP8HYR49zPwglSRFhgURn+XQiv8M1n7wIfymvqwXr1cd42OJo6g/yKOtQqR+IjD/3I76jokkPHt8VM/+TKWQfvApeya9S8QhE8eFaMxpVWYodNoQqjoFHaAh3hXm4RjHD99SRhgdt4KokWQdUQvWsCVvNM/6Qy9IO+ZEsQtzgNJLT8Zn+S9Bv/ZOBS2tLK9iAuRTgEeSsmHo9LSWzGK3hZWtPJi/UWuJtTCNd/ftW+pn8I6sl6y2r+2/7EOvSDvrhFSoe+MCK0mrEvEViyRrlXP8PWnoS3lWLQNPh0ox/0xWdWSGg93S9eOv2HBOCS27N4W4adW7hOag7Ys83Aav7KL76OmhVSfzoyswNkZqfuviGa5nsLuKyqa5Kbk6zZH6LSQZOoEDcCq3nqruvl6Iez/Ogo9OzkbdF5f951A7h8XloLXHiFp8p2SXgzjpwMCWgSL8rEwGomPp6yPaswZ/+4JTz+yx2xwOWd3BJgUVZTj8UHK7PGgfpYzeiDmbOK1Xi86/GAP227BlweisuC3gzUx2pGH0w1Vlxnh8/bsnySVzRwufhIouotW3K2WqkMqI/VjD7YdVZhB6VnZjNmwtbIpgmeV4DLvGKl6yXOX7WyI6AuVivqFwwaas/uoBT2xoS2DhtC74zbEgFc7ojM6JVmURerFfWjD3ZvrHDVQ2g9bKG3m+PmS8CyrrEZehNQD59O1I8+2KsehetZQsv+Jr93GON2rtrePRy43H45HXoTfCLSgdWIulE/+mCuZxXvVBCaEQ4dumJf0Ci388Ayt6gKegOy3oqATx/qRv3og71TwV7A68mGsr7t2EmfrA+tHb4xDLic/eN10DRayeLutDcWWG1Erxh1c4awHjOEFe8uEg4itLOa573bzvUMsFxwIA40CczPp8t6gc9e1E31895dZIeyHqEx4WCtvrr2Ns6B2bbrQoGlX3QGaAKYl0+PjXNQjrauwB51U/0CdgizQ1mH07vmhMMGjneaZeMSIrH55ylg6Rv1EHoQmI/mZugSXPfR2K+daK+a830joKp3hXRvOdJ0xkYPqzXBbYTAcva+GHpHQX3A+JiHLz/qIvq+R51Ur1Dldz0UWsyOyoxwCOEYs7leQZarTwAfp+2IgMyCClAHMC7G7yi32Zz/BKA+qtOsU9/isZWZs+6a01LuYDLP55z5qiDoiO7kpppY0gTdgXcSKfw7LAWU5SN6wlAX1WeOetnvZ1WaZYazEaElnQ+OQiePALOVgW2E0BE3nk6GvC6ux9gO2yuLj/lRBxqluixQp+pv3lUbFhAKuYYNp7p4mCw7Um+y4igo42TvS7D1/D24kvYcMl+XQ3FV3ftHE/Avvsb38XPPC6ntx6uKiXkxP8eoJdUn6IpRtjr3o4GMOYYd+o+aMtdo0b5c4fIA6CliPszLGlX+tEzXDWNgCzpHxmjp9J2g/xfXvQOXHBQPXHoY1EUS/x3mwXyYl+a3UGa0uwwb0WIwhJZ7Rx0z26mCGZtPGS72rzFccgi6ixiPxD3d52O7qSTPWJpvCM1v1L1GWcO0aNGqZ0rXtWGEowk/1TYw+XLAFGcf/bk70wwWH2gy+PtB+FCSdlJsj3EwHsal8YfRfKaYn312Ua1PpdL1TEjP8mA6h0bTHviMCJ2sO2H++gHT/xWi5+SdqPet7zPB/L2VgoX76wWLDgD+xdf4Pn6Ox+l+vmADtsP2GIfGs6PxzWk+A/ap1B553pieXUNavAYRWtP5NILOLUfCcVT854QTCSdxOJG+/xk9zpG2G0HjWNO4xjSPHvu8cY8/SU7njiE98x8TWlKhttgzVPwo7Clqxp7+HU3fH0GPs6XtLGkcIY0r4HuSXKO/EaBnXh/nFBVqSoefBTVgRWnN+d+Sfm5OjxfS9gYYj+83Ar3u1x/03o8ARVPxA2kFFXJohO9zzAloO03/+kO1aXX8rkdDJn/7v9j6P5SDt02QcYOYAAAAAElFTkSuQmCC\');\n    color: #3A87AD;\n    }\n    .b-msgsystem-type-info + .b-msgsystem-type-info {\n        border-top: 1px solid #B3DBEF;\n        }\n\n.b-msgsystem-close {\n    position: absolute;\n    right: 0;\n    top: 50%;\n    width: 100px;\n    margin: -0.714em 0 0;\n    padding: 0 2em 0 0;\n    text-align: right;\n    cursor: pointer;\n    -webkit-user-select: none;\n       -moz-user-select: none;\n        -ms-user-select: none;\n            user-select: none;\n    color: #000;\n    }\n.b-msgsystem-close:hover {\n    color: #C00;\n    }\n    .b-msgsystem-close-text {\n        border-bottom: 1px dotted;\n        }\n    .b-msgsystem-close-ctrl {\n        margin: 0 0 0 0.1em;\n        vertical-align: middle;\n        font-size: 1.3em;\n        }\n\n\n/* xs-size screen (45em) ~ 630px */\n@media all and (max-width: 45em) {\n    .b-msgsystem {\n        padding: 10px 50px 10px 44px;\n        background-position: 10px 10px;\n        -webkit-background-size: 24px;\n             -o-background-size: 24px;\n                background-size: 24px;\n        }\n\n    .b-msgsystem-close {\n        position: absolute;\n        top: 0;\n        right: 0;\n        bottom: 0;\n        margin: 0;\n        width: 50px;\n        }\n        .b-msgsystem-close-text {\n            display: none;\n            }\n        .b-msgsystem-close-ctrl {\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            margin: -0.6em 0 0 -0.2em;\n            text-shadow: 0 -1px 0 rgba(255, 255, 255, 0.5);\n            font-size: 1.7em;\n            color: rgba(0, 0, 0, 0.5);\n            }\n}\n\n/* Toggle */\n.b-msgsystem {\n    top: 0;\n    opacity: 1;\n    -webkit-transition: 0.3s top, 0.3s opacity;\n       -moz-transition: 0.3s top, 0.3s opacity;\n        -ms-transition: 0.3s top, 0.3s opacity;\n         -o-transition: 0.3s top, 0.3s opacity;\n            transition: 0.3s top, 0.3s opacity;\n    }\n.b-msgsystem-enter,\n.b-msgsystem-leave {\n    top: -100px;\n    opacity: 0;\n    }\n\n');
//= require_ml component.messages.close

/*
 * LiveJournal page messages
 * https://conf.sup.com/pages/viewpage.action?pageId=6161047#id-1AddRemoveLinksandButtonsFRSCR-Warnings
 *
 * Available methods:
 * - error
 * - info
 * - success
 * - warning
 *
 * @example
 *   // show error message
 *   Message.error('Call the cops');
 *
 *   // show error message with title
 *   Messages.error({ body: 'Call the cops!', title: 'Title is optional' });
 *
 *   // General form of message showing (providing type directly)
 *   Messages.add({ type: 'error', body: 'Call the cops!', title: 'Title is optional' });
 *
 * @example
 *   Alternatively, you can use it from Perl controller:
 *
 *   LJ::need_var(messages => [{
 *     title => 'hello',
 *     body => 'world',
 *     type => 'success'
 *   }]);
 */

(function() {
'use strict';

angular.module('LJ.Messages', ['LJ.Templates', 'LJ.Directives'])
  .run(['$compile', '$rootScope', function($compile, $rootScope) {
      $compile(
        '<div lj-messages></div>'
      )($rootScope)
      .appendTo('body');
  }])
  .factory('Messages', [function() {
    var messages = [];
    var factory = {
      get:    get,
      add:    add,
      remove: remove,
      clear:  clear
    };
    var MESSAGE_TYPES = ['error', 'info', 'success', 'warning'];

    // is needed for filtering of messages on the page
    var _cache = {};

    // show messages that come from server
    if ( LJ.get('messages') ) {
      LJ.get('messages').forEach(add);
    }

    /**
     * Add message
     * @param {Object} message         Message object
     * @param {String} message.type    Message type: one of `MESSAGE_TYPES`
     * @param {String} [message.title] Title of the message
     * @param {String} message.body    Body of the message
     */
    function add(message) {
      if ( MESSAGE_TYPES.indexOf(message.type) === -1 ) {
        return;
      }

      // check if message with same body is currently on the page
      if ( _cache[message.body] ) {
        return;
      }

      _cache[message.body] = true;
      messages.push(message);

      return factory;
    }

    MESSAGE_TYPES.forEach(function (type) {
      factory[type] = function (message) {
        if ( typeof message === 'string' ) {
          message = { body: message };
        }
        message.type = type;
        add(message);
      };
    });

    function clear() {
      messages.length = 0;
      _cache = {};
    }

    function remove(message) {
      messages = messages.filter(function (_message) {
        return _message !== message;
      });

      delete _cache[message.body];
      return factory;
    }

    function get() {
      return messages;
    }

    return factory;
  }])
  .directive('ljMessages', ['$timeout', 'Messages',
                   function( $timeout,   Messages ) {
    return {
      templateUrl: 'ljMessages.ng.tmpl',
      scope: true,
      controllerAs: 'directive',
      controller: ['$scope', function ($scope) {
        var that = this;

        this.messages = Messages.get();
        this.close    = Messages.remove;

        $scope.$watchCollection(Messages.get, function (messages) {
          that.messages = messages;
        });
      }]
    };
  }]);

})();
;

/* file-end: js/core/angular/messages.js 
----------------------------------------------------------------------------------*/

/**
 * @description Angular wrapper of LJ.Api
 * @author Valeriy Vasin (valeriy.vasin@sup.com)
 *
 * @method call
 * @description
 * Available options:
 *  - cache: turn on/off caching for the request
 *  - silent: turn on/off messages (error/info etc)
 *  - meta: result will be returned with meta information
 *          is needed to determine is response from cache or not at the moment
 *          If provided promise will be resolved with object that contains fields:
 *          - response:  {*}       - server response
 *          - fromCache: {Boolean} - is response from cache or not
 *
 * @example Fetch without caching
 *   Api.call('rpc.method', {param: 'value'});
 *
 * @example Fetch with caching
 *   Api.call('rpc.method', { param: 'value' }, { cache: true });
 *
 * @example Usage of meta information
 *   Api.call('ratings.journals_top', params, { cache: true, meta: true })
 *     .then(function (result) {
 *       var response = result.response;
 *
 *       // cache users if result is from server
 *       if ( !result.fromCache ) {
 *
 *         Users.Cache.add(
 *           response.journals.map( LJ.Function.get('user') )
 *         );
 *       }
 *     });
 *
 * @example Turn off messages for the request
 *   Api.call('rpc.method', {param: 'value'}, {silent: true});
 *
 *
 * @method  invalidate
 * @example Cache invalidation
 *   Api.invalidate('rpc.method', {some: 'params'});
 */

angular.module('LJ.Api', ['LJ.Messages'])
  .factory('Api', ['$cacheFactory', '$rootScope', '$q', 'Messages',
         function ( $cacheFactory,   $rootScope,   $q,   Messages ) {

      var factory = {
        call: call,
        invalidate: invalidate
      };
      var cachePromises = $cacheFactory('LJApiPromises');

      /**
       * Get cache key for method and params
       * @param  {String} method   Method name
       * @param  {Object} [params] Method params
       */
      function getCacheKey(method, params) {
        return typeof params === 'undefined' ?
               method :
               method + JSON.stringify( _sortedByKeys(params) );
      }

      /**
       * Get newly greated object with properties that added in sorted order
       *
       * Notice:
       *   If not object provided - it will be returned without changes
       *
       * @param  {Object} obj Object to sort properties of
       * @return {Object}     Object with sorted properties
       */
      function _sortedByKeys(obj) {
        if ( !angular.isObject(obj) ) {
          return obj;
        }

        var sorted = {};

        Object.keys(obj).sort().forEach(function (key) {
          sorted[key] = _sortedByKeys( obj[key] );
        });

        return sorted;
      }

      /**
       * Invalidate cached data
       *
       * @param  {String} method    Methods for which we should invalidate cache
       * @param  {Object} [params]  Params for which we should invalicate cache
       */
      function invalidate(method, params) {
        cachePromises.remove(
          getCacheKey(method, params)
        );
      }

      /**
       * Call JSON Rpc API
       *
       * @param {String}    method            JSON Rpc method
       * @param {Object}    [params]          JSON Rpc method params
       * @param {Function}  [callback]        Callback to call after data recieved
       * @param {Object}    [options]         Additional api options
       * @param {Boolean}   [options.cache]   Cache options: turn on/off cache for request
       * @param {Boolean}   [options.silent]  Turn on/off messages (error/info etc)
       * @param {Boolean}   [options.meta]    If set to `true` - result will be returned with meta
       *                                      information, e.g. { response, fromCache }
       *
       * @return {Promise}   Promise that will be resolved when data received
       */
      function call(method, params, callback, options) {
        var defer = $q.defer(),
            defaults = { cache: false, silent: false, meta: false },
            fromCache = false,
            promise,
            cacheKey;

        // only `Object` and `null` are allowed, otherwise - empty object
        if ( typeof params !== 'object' || params === null ) {
          params = {};
        }

        if (typeof callback === 'object') {
          options = callback;
          callback = null;
        }

        options = angular.extend(defaults, options || {});

        cacheKey = getCacheKey(method, params);

        if ( options.cache ) {
          promise = cachePromises.get(cacheKey);

          if (promise) {
            fromCache = true;
          }
        }

        if ( !fromCache ) {
          promise = defer.promise;

          LJ.Api.call(method, params, function (response) {
            if (response.error) {
              defer.reject(response.error);
            } else {
              defer.resolve(response);
            }

            $rootScope.$apply();
          });

          // save original promise
          if ( options.cache ) {
            cachePromises.put(cacheKey, promise);
          }
        }

        // trigger events
        LJ.Event.trigger('api:request:change', method, true);
        promise.then(function() {
          LJ.Event.trigger('api:request:change', method, false);
        });

        // show errors/messages
        if ( !options.silent ) {
          promise.then(function showMessage(response) {
            var message = response.message;

            if (typeof message === 'undefined') {
              return;
            }

            message.body = message.content;
            Messages.add(message);
          }, function showErrorMessage(error) {

            // no error message provided
            if ( typeof error.message === 'undefined' ) {
              return;
            }

            // Do not show internal api error
            // See: lj.api.js#handleError
            if ( error.code === 1 ) {
              return;
            }

            Messages.error({ body: error.message });
          });
        }

        // add meta information
        if ( options.meta ) {
          promise = promise.then(function (response) {
            return {
              response:  response,
              fromCache: fromCache
            };
          });
        }

        if (typeof callback === 'function') {
          promise.then(callback);
        }

        return promise;
      }

      return factory;
    }
  ]);
;

/* file-end: js/core/angular/api.js 
----------------------------------------------------------------------------------*/


/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/users.js 
*/


/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/options.js 
*/

angular.module("LJ.Options",[]).factory("Options",[function(){return{create:function(a){function b(b,c){"undefined"==typeof c?angular.extend(a,b):a[b]=c}function c(b){return a[b]}function d(){return a}if("undefined"==typeof a&&(a={}),"object"!=typeof a)throw new TypeError("Options should be an object.");return{set:b,get:c,raw:d}}}}]);;

/* file-end: js/core/angular/options.js 
----------------------------------------------------------------------------------*/

;(function () {
  'use strict';

  angular.module('Users', ['LJ.Api', 'LJ.Options'])

    // Relations wrapper. Currently works through js/relations/relations.js
    .factory('Relations', ['$q', '$timeout', 'UsersCache',
                 function ( $q,   $timeout,   UsersCache ) {

      /**
       * // add friend without options. State will be changed immediately
       * Relations.toggleFriend('test', true);
       *
       * // unsubscribe, but don't change user props immediately
       * Relations.toggleSubscription('test', false, { immediate: false });
       */

      /**
       * Helper that helps to interact with exiting relations
       * @param {String}   username        Username of user we are changing relation
       * @param {String}   action          Action to perform
       * @param {Object}   [options]       Options
       * @param {Boolean}  [options.wait]  Wait for response before updating user props
       * @return {Promise} Promise that will be resolved after action is completed
       */
      function _action(username, action, options) {
        var defer = $q.defer(),

            // immediate update user props
            updateProps = {
              addFriend:    { is_invite_sent: true },
              removeFriend: { is_friend: false },
              subscribe:    { is_subscribedon: true },
              unsubscribe:  { is_subscribedon: false },
              join:         { is_invite_sent: true },
              leave:        { is_member: false },
              setBan:       { is_banned: true },
              setUnban:     { is_banned: false }
            },

            // revert properties values if error happens
            revertProps = {
              addFriend:    { is_invite_sent: false },
              removeFriend: { is_friend: true },
              subscribe:    { is_subscribedon: false },
              unsubscribe:  { is_subscribedon: true },
              join:         { is_invite_sent: false },
              leave:        { is_member: true },
              setBan:       { is_banned: false },
              setUnban:     { is_banned: true }
            },

            // save current props
            userProps = angular.copy( UsersCache.get(username) || {} );

        if (typeof options === 'undefined') {
          options = {};
        }

        if ( !options.wait ) {
          UsersCache.update(username, updateProps[action] || {});
        }

        LJ.Event.trigger('relations.change', {
          username: username,
          action: action,
          callback: function (data) {
            $timeout(function () {
              if (data.error) {

                // rollback props
                if ( !options.wait ) {
                  UsersCache.update( username, angular.extend(revertProps[action], userProps) );
                }

                defer.reject(data.error.message);
                return;
              }

              var props = LJ.Object.pick(data,
                'is_banned',
                'is_friend',
                'is_member',
                'is_subscriber',
                'is_subscribedon',
                'is_friend_of',
                'is_invite_sent'
              );

              // update user props
              UsersCache.update(username, props);
              defer.resolve(data);
            });
          }
        });

        return defer.promise;
      }

      /**
       * Toggles subscription status of a user with provided username
       *
       * @param {String}   username        Username
       * @param {Boolean}  state           State: subscribe (true) or unsubscribe (false)
       * @param {Object}   [options]       Options
       * @param {Boolean}  [options.wait]  Wait for response before updating user props
       * @return {Promise}                 Promise that will be resolved with data after
       *                                   subscription status will be changed
       */
      function toggleSubscription(username, state, options) {
        var promise = _action(username, state ? 'subscribe' : 'unsubscribe', options);

        // reset filter mask after unsubscribe
        if ( !state ) {
          promise.then(function () {
            UsersCache.update(username, { filtermask: 0 });
          });
        }

        return promise;
      }

      /**
       * Toggles friend status of a user with provided username
       *
       * @param {String}   username        Username
       * @param {Boolean}  state           State: add friend (true) or remove from friend (false)
       * @param {Object}   [options]       Options
       * @param {Boolean}  [options.wait]  Wait for response before updating user props
       * @return {Promise}                 Promise that will be resolved with data after
       *                                   friend status will be changed
       */
      function toggleFriend(username, state, options) {
        return _action(username, state ? 'addFriend' : 'removeFriend', options);
      }

      /**
       * Join/leave community
       *
       * @param {String}   username        Username
       * @param {Boolean}  state           State: add friend (true) or remove from friend (false)
       * @param {Object}   [options]       Options
       * @param {Boolean}  [options.wait]  Wait for response before updating user props
       * @return {Promise}                 Promise that will be resolved with data after action completeness
       */
      function toggleMember(username, state, options) {
        return _action(username, state ? 'join' : 'leave', options);
      }

      /**
       * Ban/unban usern
       *
       * @param {String}   username        Username
       * @param {Boolean}  state           State: ban (true) or unban user (false)
       * @param {Object}   [options]       Options
       * @param {Boolean}  [options.wait]  Wait for response before updating user props
       * @return {Promise}                 Promise that will be resolved with data after action is completed
       */
      function toggleBan(username, state, options) {
        return _action(username, state ? 'setBan' : 'setUnban', options);
      }

      /**
       * Ban/unban user everywhere
       *
       * @param {String}   username       Username
       * @param {Boolean}  state          State: ban (true) or unban user (false) everywhere
       * @param {Object}   [options]      Options
       * @param {Boolean}  [options.wait] Wait for response before updating user props
       * @return {Promise}                Promise that will be resolved with data after action is completed
       */
      function toggleBanEverywhere(username, state, options) {
        return _action(username, state ? 'banEverywhere' : 'unbanEverywhere', options);
      }

      return {
        toggleFriend:        toggleFriend,
        toggleSubscription:  toggleSubscription,
        toggleMember:        toggleMember,
        toggleBan:           toggleBan,
        toggleBanEverywhere: toggleBanEverywhere
      };
    }])

    // mask operations
    .factory('Mask', function () {
      var factory = {};

      /**
       * Notice: first bit of a mask is not used
       */

       /**
         * Notice:
         *   Our max filter id is equal 31: last bit (of 32) could be equal to 1
         *
         *   JavaScript bitwise operators converts numbers to signed integers:
         *   https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators#Signed_32-bit_integers
         *
         *   If max bit is equal to 1, it will be converted to negative number.
         *
         *   That is why we should manually interpret number as unsigned integer
         */
        function unsigned(number) {
          return number >>> 0;
        }

      /**
       * Change mask accroding to provided operations
       *
       * @param {Number}       mask             Mask field
       * @param {Object}       actions          Operations
       * @param {Number|Array} [actions.add]    Group id(s) to be added in
       * @param {Number|Array} [actions.remove] Group id(s) to be removed from
       *
       * @return {Number} Updated mask
       */
      factory.change = function (mask, actions) {
        var add    = actions.add,
            remove = actions.remove;

        // add
        if (typeof add !== 'undefined') {
          if ( !Array.isArray(add) ) {
            add = [add];
          }

          mask = add.reduce(function (mask, id) {
            return unsigned( mask | Math.pow(2, id) );
          }, mask);
        }

        // remove
        if (typeof remove !== 'undefined') {
          if ( !Array.isArray(remove) ) {
            remove = [remove];
          }

          mask = remove.reduce(function (mask, id) {
            var filterMask = (Math.pow(2, 32) - 1) - Math.pow(2, id);

            return unsigned( mask & filterMask );
          }, mask);
        }

        return mask;
      };

      /**
       * Check mask for inclusion in group
       *
       * @param  {Number} mask    Mask
       * @param  {Number} groupId Group id
       * @return {Boolean}        Result of the check
       */
      factory.check = function (mask, groupId) {
          var groupMask = Math.pow(2, groupId);

          // convert to Boolean, because `&` returns number (group id)
          return Boolean(mask & groupMask);
      };

      return factory;
    })

    /**
     * Service is responsible for retrieving, caching and updating users
     *
     * // get by username
     * UsersCache.get('test');
     *
     * // get all available users
     * UsersCache.get();
     *
     * // get users that satisfy filtering function
     * UsersCache.get( LJ.Function.get('is_community') );
     */
    .factory('UsersCache', ['$q', '$cacheFactory', 'Options',
                  function ( $q,   $cacheFactory,   Options ) {

      var _cache = $cacheFactory('users'),
          options = Options.create({
            journal: LJ.get('remoteUser')
          }),
          factory;

      /**
       * Add / update user(s) to cache
       * @param  {Array|Object} users Models to cache
       * @return {Array|Object}       Cached models
       */
      function add(users) {
        if (typeof users === 'undefined') {
          return;
        }

        var hash = _cache.get( options.get('journal') ) || {},
            result = users;

        if ( !Array.isArray(users) ) {
          users = [users];
        }

        users.forEach(function (user) {
          if (!user || typeof user !== 'object' || typeof user.username === 'undefined') {
            return;
          }

          var existed = hash[user.username];

          hash[user.username] = existed ? angular.extend(existed, user) : user;
        });

        _cache.put(options.get('journal'), hash);

        return result;
      }

      /**
       * Check if user exists in cache
       *
       * @param {String}   username Username
       * @return {Boolean}          Checking result
       */
      function exists(username) {
        var cachedUsers = _cache.get( options.get('journal') );

        return Boolean( cachedUsers[username] );
      }

      /**
       * User(s) getter
       * @param  {String|Function} [username] Get users by username if string passed,
       *                                      apply filtering function for all users if function passed,
       *                                      return all users, if nothing has been passed
       * @return {Object|Array|NULL}          Result
       *
       * @example
       *
       *     // get by username
       *     get('test');
       *
       *     // get all communities
       *     get( LJ.Function.get('is_community') );
       *
       *     // get all users
       *     get();
       */
      function get(username) {
        var type = typeof username,
            cache;



        if (type === 'string') {
          cache = _cache.get( options.get('journal') );
          return cache && cache[username] ? cache[username] : null;
        }

        if (type === 'function') {
          // get users with filter function
          return _users(username);
        }

        if (type === 'undefined') {
          // get all users
          return _users();
        }

        throw new TypeError('Incorrect argument passed.');
      }

      /**
       * Getter helper
       * @param  {Function} [filter] Filter function
       * @return {Array}             List of users
       */
      function _users(filter) {
        var cachedUsers = _cache.get( options.get('journal') ),
            result = [],
            username;

        for (username in cachedUsers) {
          if ( cachedUsers.hasOwnProperty(username) ) {

            // skip users that not satisfy filter function
            if (filter && !filter( cachedUsers[username] )) {
              continue;
            }

            result.push(cachedUsers[username]);
          }
        }

        return result;
      }

      /**
       * Update user props
       *
       * @param  {String} username Username of user to update
       * @param  {Object} props    Props to update
       * @return {Object}          Updated user
       */
      function update(username, props) {
        var user = get(username) || { username: username };

        angular.extend(user, props);
        add(user);

        return user;
      }

      factory = {
        // cache users
        add:    add,
        update: update,

        // work with options
        set: options.set,

        // work with users
        get: get,
        exists: exists
      };

      return factory;
    }])

    .factory('Users', ['$q', '$timeout', 'Api', 'Mask', 'UsersCache', 'Options',
             function ( $q,   $timeout,   Api,   Mask,   UsersCache,   Options ) {

        var rpc = {
              friends: {
                read:    'relations.list_friends',
                readOne: 'relations.get_friend',
                update:  'groups.update_users'
              },

              subscriptions: {
                read:    'relations.list_subscriptions',
                readOne: 'relations.get_subscription',
                update:  'filters.update_users'
              }
            },
            options = Options.create({
              type:    'friends',
              journal: LJ.get('remoteUser')
            });

        function _rpc(rpcType) {
          return rpc[ options.get('type') ][rpcType];
        }

        /**
         * Check if user should be extracted from cache according friend/subscription status
         * @param  {Object}  user User model
         * @return {Boolean}      Result
         */
        function _isUserCorrect(user) {
          if (options.get('type') === 'subscriptions') {
            return Boolean( user.is_subscribedon );
          }

          // we are able to add any user to group, that is why any know user is correct for groups
          return true;
        }

        /**
         * Mask getter
         *
         * @param  {Object} user    User object
         * @param {Number}  [value] Mask value to set
         * @return {Number}         Mask
         */
        function mask(user, value) {
          if (typeof value === 'undefined') {
            return user[ maskField() ] || 1;
          }

          user[ maskField() ] = value;
        }

        function maskField() {
          return options.get('type') === 'subscriptions' ? 'filtermask' : 'groupmask';
        }

        function fetchUser(username, fields, options) {
          return Api.call('user.get', { target: username, fields: fields }, options)
            .then(function (response) {
              var user = response.user;

              UsersCache.add(user);
              return user;
            });
        }

        /**
         * Fetch friends of current user
         * @param  {Object} [fields]      Fields to fetch,
         *                                e.g. { groupmask: 1, is_personal: 1, is_identity: 1 }
         * @param  {Object} [apiOptions]  Api options: {cache: true}
         * @return {Promise}              Promise that will be resolved with data
         */
        function fetchFriends(fields, apiOptions) {
          return Api.call('relations.list_friends', {
            journal: options.get('journal'),
            fields:  fields
          }, apiOptions).then( _setFlagAndCache('is_friend') );
        }

        function fetchGroupUsers(fields) {
          return Api.call('groups.list_users', {
            journal: options.get('journal'),
            fields:  fields
          }).then(function (response) {
            UsersCache.add(response.users);
            return response;
          });
        }

        function fetchSubscriptions(fields) {
          return Api.call('relations.list_subscriptions', {
            journal: options.get('journal'),
            fields:  fields
          }).then( _setFlagAndCache('is_subscribedon') );
        }

        function fetchBanned(fields) {
          return Api.call('relations.list_banned', {
            journal: options.get('journal'),
            fields:  fields
          }).then( _setFlagAndCache('is_banned') );
        }

        /**
         * Fetch helper method: set flag for fetched users, cache and return them
         * @return {Function} Function to use inside of .then()
         */
        function _setFlagAndCache(flag) {
          return function (response) {
            var users = response.users;

            users.forEach(
              LJ.Function.set(flag, true)
            );

            UsersCache.add(users);
            return users;
          };
        }

        function fetchCount(type) {
          return Api.call('relations.'+ type +'_count').then(function (response) {
            return response.count;
          });
        }

        /**
         * Sync user(s) model(s) with server
         *
         * @param  {Array|Object} users User model or collection of models
         * @return {Promise}            Promise that will be resolved after server response
         */
        function sync(users) {
          if ( !angular.isArray(users) ) {
            users = [users];
          }

          if (users.length === 0) {
            return $q.reject('You should provide users to sync.');
          }

          return Api.call(_rpc('update'), {
            users:   users,
            journal: options.get('journal')
          }).then(function (response) {
            UsersCache.add(response.users);
            return response;
          });
        }

        /**
         * Check is user listed in group/filter with `id`
         *
         * @method  isUserInGroup
         *
         * @param  {String}  username Username
         * @param  {Number}  id       Filter/Group id (1..30)
         * @return {Boolean}          Result
         */
        function isUserInGroup(username, id) {
          var user = UsersCache.get(username);

          return user ? Mask.check(mask(user), id) : false;
        }

        /**
         * @todo Remove this method and replace it usage in controller
         *
         * Temp method for extracting only existing users by usernames
         *
         * @param  {Array}  usernames   Username(s)
         * @return {Array}              Array of existing users
         */
        function getExisting(usernames) {
          return usernames.filter(UsersCache.exists)
            .map(UsersCache.get)
            .filter(_isUserCorrect);
        }

        /**
          * Filter users that are in exact group
          *
          * @method fromGroup
          *
          * @param  {Object} options          Options for users filtering
          * @param  {Number} options.id       Group id: (1..31)
          * @param  {Number} [options.limit]  Limit of users to extract
          * @param  {String} [options.filter] Filter username string
          * @return {Array}                   Array of users that are in group
          */
        function fromGroup(options) {
          var filter = (options.filter || '').toLowerCase(),
              users = UsersCache.get(function (user) {

                // filter friends/subscription
                if ( !_isUserCorrect(user) ) {
                  return false;
                }

                if ( !Mask.check(mask(user), options.id) ) {
                  return false;
                }

                if ( filter && user.display_username.toLowerCase().indexOf(filter) === -1 ) {
                  return false;
                }

                return true;
              });

          if (options.limit) {
            users = users.slice(0, options.limit);
          }

          return users;
        }

        /**
          * Filter users that are out of exact group
          *
          * @method outOfGroup
          *
          * @param {Object} options           Options for users filtering
          * @param {Number} options.id        Group id: (1..30)
          * @param {Number} [options.limit]   Limit of users to extract
          * @param {String} [options.filter]  Filter username string
          * @return {Array}                   Array of users that are out of group
          */
        function outOfGroup(options) {
          var filter = (options.filter || '').toLowerCase(),
              users = UsersCache.get(function (user) {

                // filter friends/subscription
                if ( !_isUserCorrect(user) ) {
                  return false;
                }

                if ( Mask.check(mask(user), options.id) ) {
                  return false;
                }

                if ( filter && user.display_username.toLowerCase().indexOf(filter) === -1 ) {
                  return false;
                }

                return true;
              });

          if (options.limit) {
            users = users.slice(0, options.limit);
          }

          return users;
        }

        /**
         * Add users to group
         *
         * @method addToGroup
         *
         * @param  {Number}         id          Group id
         * @param  {String|Array}   usernames   Username(s) of users to add
         * @return {Promise}                    Promise that will be resolved
         *                                      with synced users
         */
        function addToGroup(id, usernames) {
          if ( !Array.isArray(usernames) ) {
            usernames = [usernames];
          }

          var users;

          if (options.get('type') === 'subscriptions') {
            // for subscriptions we should filter non-existed
            users = getExisting(usernames);
          } else {
            users = usernames.map(function (username) {
              return UsersCache.get(username) || { username: username };
            });
          }

          users.forEach(function (user) {
            mask(user, Mask.change(mask(user), { add: id }));
          });

          return sync(users);
        }

        /**
         * Remove users from group
         *
         * @method removeFromGroup
         *
         * @param {Number}        id                Group id
         * @param {String|Array}  usernames         Username(s) of users to remove
         * @param {Object}        [options]         Options
         * @param {Boolean}       [options.silent]  Remove users from group without sync
         *
         * @return {Promise|Undefined}        Promise that will be resolved
         *                                    with synced users or Undefined, if options.silent provided
         */
        function removeFromGroup(id, usernames, options) {
          if ( !Array.isArray(usernames) ) {
            usernames = [usernames];
          }

          var existing = getExisting(usernames);

          // update mask
          existing.forEach(function (user) {
            mask(user, Mask.change(mask(user), { remove: id }));
          });

          // return without sync if silent
          if (options && options.silent) {
            return;
          }

          return sync(existing);
        }

        /**
         * Set alias for user
         *
         * @param  {String}  username Username
         * @param  {String}  value    User alias
         * @return {Promise}          Promise that will be resolved with data when complete
         */
        function alias(username, value) {
          UsersCache.update(username, { alias: value });
          return Api.call('user.alias_set', { target: username, alias: value });
        }

        /**
         * Sort helper
         *
         * @param {String}   prop Property. Available: username or display_username
         * @return {Function}      Comparator function
         *
         * @example
         *
         *    users.sort( Users.comparator('username') );
         */
        function comparator(prop) {
          return function (a, b) {
            return a[prop].toLowerCase().localeCompare(
              b[prop].toLowerCase()
            );
          };
        }

        /**
         * Patched version of options.set
         *
         * If we set journal for users it should also set journal for cache
         */
        function set() {
          var old = options.get('journal'),
              journal;

          options.set.apply(null, arguments);
          journal = options.get('journal');

          // update journal of cache if it changed
          if ( journal !== old ) {
            UsersCache.set('journal', journal);
          }
        }

        return {
          USERHEAD_FIELDS: {
            alias:        1,
            journal_url:  1,
            profile_url:  1,
            userhead_url: 1,
            is_invisible: 1,
            journaltype:  1
          },

          // options
          set: set,
          get: options.get,

          Cache: UsersCache,

          // work with server
          fetchUser:          fetchUser,
          fetchBanned:        fetchBanned,
          fetchFriends:       fetchFriends,
          fetchGroupUsers:    fetchGroupUsers,
          fetchSubscriptions: fetchSubscriptions,

          fetchCount: fetchCount,

          sync: sync,

          alias: alias,

          isUserInGroup: isUserInGroup,
          getExisting: getExisting,
          fromGroup: fromGroup,
          outOfGroup: outOfGroup,
          addToGroup: addToGroup,
          removeFromGroup: removeFromGroup,

          comparator: comparator
        };
    }]);
}());
;

/* file-end: js/core/angular/users.js 
----------------------------------------------------------------------------------*/

Site.page.template['angular/ljUser.ng.tmpl'] = '<span\n    class=\"\n        ljuser\n        i-ljuser\n        i-ljuser-type-{{user.journaltype}}\n        \"\n    ng-class=\"{\n        \'i-ljuser-deleted\': user.is_invisible,\n        \'i-ljuser-nopopup noctxpopup\': user.noctxpopup,\n        \'i-ljuser-withalias\': user.alias,\n        \'i-ljuser-showalias\': user.showalias\n    }\"\n    data-ljuser=\"{{user.username}}\"\n    lj:user=\"{{user.username}}\"\n    ><!--\n\n    Userhead\n    --><a\n        class=\"i-ljuser-profile\"\n        ng-href=\"{{user.profile_url}}\"\n        ng-attr-target=\"{{user.target ? user.target : \'_self\'}}\"\n        ><!--\n        --><img\n            class=\"i-ljuser-userhead\"\n            ng-src=\"{{user.userhead_url}}\"\n            ><!--\n    --></a><!--\n\n    Username\n    --><a\n        class=\"i-ljuser-username\"\n        ng-href=\"{{user.journal_url}}\"\n        ng-attr-title=\"{{user.alias}}\"\n        ng-attr-target=\"{{user.target ? user.target : \'_self\'}}\"\n        ><b ng-bind=\"user.display_name\"></b></a><!--\n\n    Alias\n    --><span\n        class=\"i-ljuser-alias\"\n        ng-bind=\"user.alias\"\n        ></span><!--\n\n--></span>\n';
angular.module("LJ.User",["LJ.Api","LJ.Templates","Users"]).factory("ljUser",["$rootScope","Api","$q","$templateCache","$compile","$timeout","Users",function(a,b,c,d,e,f,g){function h(a){var b=c.defer(),d=g.Cache.get(a);return d&&d.userhead_url?(b.resolve(d),b.promise):g.fetchUser(a,g.USERHEAD_FIELDS,{cache:!0})}function i(b,d){var i=c.defer(),l=a.$new();return h(b).then(function(){var a;l.user=angular.extend({},g.Cache.get(b),d||{}),a=e(k)(l),f(function(){i.resolve(j.empty().append(a).html()),l.$destroy()})}),i.promise}var j=angular.element("<div />"),k=d.get("ljUser.ng.tmpl");return{prepare:h,get:i}}]).directive("ljUserDynamic",["$parse","Users","ljUser",function(a,b,c){return{templateUrl:"ljUser.ng.tmpl",replace:!0,scope:!0,compile:function(d,e){var f=a(e.ljUserDynamic),g=a(e.ljUserDynamicOptions);return function(a){var d=f(a),e=g(a);a.user=angular.extend({username:d,display_username:d},e||{}),c.prepare(d).then(function(){a.$watch(function(){return b.Cache.get(d)},function(b){angular.extend(a.user,b)},!0)})}}}}]);;

/* file-end: js/core/angular/ljUser.js 
----------------------------------------------------------------------------------*/


/* ---------------------------------------------------------------------------------
   file-start: js/settings/services/filters/filters.js 
*/




;(function () {
  'use strict';

  angular.module('GroupsAndFilters.Services.Filters', ['LJ.Api', 'LJ.Options', 'Users'])

    // filter for output filters and groups
    .filter('filtersOrder', function () {
      return function filtersOrder(filters) {
        // copy array to prevent digest loop during sort
        var copy = filters.slice(0);

        copy.sort(function (a, b) {
          if ( a.id === 31 ) {
            return -1;
          }

          if (b.id === 31) {
            return 1;
          }

          var aName = a.name.toLowerCase(),
              bName = b.name.toLowerCase();

          return aName > bName ? 1 : -1;
        });

        // return sorted copy
        return copy;
      };
    })

    .factory('FilterGroupFactory', ['$q', '$timeout', 'Api', 'Options', 'Users',
                          function ( $q,   $timeout,   Api,   Options,   Users ) {

        /**
         * Filter/Group factory
         *
         * @class FilterGroupFactory
         * @type {Angular.Service}
         * @constructor
         * @private
         */
        function Factory() {
          angular.extend(
            this,
            {
              MAX_COUNT: 31,

              // filters cache
              filters: [],


              // API key: filters/groups
              key: 'filters',

              // RPC endpoints: should be redefined
              rpc: {}
            },
            Options.create({
              journal: LJ.get('remoteUser')
            })
          );
        }

        /**
         * Get filter JSON params, exclude not needed
         *
         * @method toJSON
         * @param  {Object} filter Filter object
         * @return {Object}    Filtered fields
         */
        Factory.prototype.toJSON = function (filter) {
          var json = angular.copy(filter);
          delete json.checked;
          delete json.users;
          return json;
        };

        /**
         * Generate id for new filter/group based on existed:
         * next free id (that is not used by any existed filter)
         *
         * @method nextId
         * @return {Number} Generated next id
         */
        Factory.prototype.nextId = function () {
          var id  = null,
              ids = this.filters.map( LJ.Function.get('id') ),

              // id = 0 - is not used
              i = 1,
              max = this.MAX_COUNT;

          while (i < max && id === null) {
            if ( ids.indexOf(i) === -1) {
              id = i;
            }
            i += 1;
          }

          return id;
        };

        /**
         * Sync current state of filter(s) with server
         *
         * @method sync
         * @param  {Array|Object} filters Filter instance(s)
         */
        Factory.prototype.sync = function (filters) {
          var params = {};

          // wrap single filter to array
          if ( !angular.isArray(filters) ) {
            filters = [filters];
          }

          params[this.key] = filters.map(this.toJSON);
          params.journal   = this.get('journal');

          return Api.call(this.rpc.update, params);
        };

        /**
         * Fetch filters from server
         *
         * @method fetch
         *
         * @param {Object}  [options]             Request option
         * @param {Boolean} [options.cache=false] Cache request or not
         *
         * @return {Promise} Promise that will be resolved with filters data
         */
        Factory.prototype.fetch = function (options) {
          var that = this,
              params = {
                journal: this.get('journal')
              };

          options = angular.extend(options || {}, { cache: false });

          return Api.call(this.rpc.read, params, options).then(function (response) {
            // save fetched filters
            that.filters = response[that.key];
            return that.filters;
          });
        };

        /**
         * Check is filter/group name uniq
         * @param  {String}  name Filter/group name to check
         * @return {Boolean}      Check result
         */
        Factory.prototype._isNameUniq = function (name) {
          var names = this.filters.map(function (filter) {
            return filter.name.toLowerCase();
          });

          name = name.toLowerCase();

          return names.indexOf(name) === -1;
        };

        /**
         * Create filter
         *
         * @method create
         * @param  {String} name  Filter name
         * @return {Promise}      Promise that will be resolved with created
         *                        filter data
         */
        Factory.prototype.create = function (name) {
          var filter;

          name = name.trim();

          if ( name.length === 0 ) {
            return $q.reject(
              this.key === 'filters' ?
              LJ.ml('api.error.filters.filter_name_not_specified') :
              LJ.ml('api.error.groups.group_name_not_specified')
            );
          }

          // check if filter name is uniq
          if ( !this._isNameUniq(name) ) {
            return $q.reject(
              this.key === 'filters' ?
              LJ.ml('api.error.filters.filter_already_exist', { name: name }) :
              LJ.ml('api.error.groups.group_already_exist', { name: name })
            );
          }

          filter = {
            id:      this.nextId(),
            name:    name,
            users:   [],
            public:  false,
            journal: this.get('journal')
          };

          this.filters.push(filter);

          return Api.call(this.rpc.create, filter);
        };

        /**
         * Remove filter(s)
         *
         * @method remove
         * @param  {Object|Object[]} filters  Filters to remove
         * @return {Promise}                  Promise that will be resolved
         *                                    with removed filters data
         */
        Factory.prototype.remove = function (filters) {
          var that   = this,
              params = {};

          filters = Array.isArray(filters) ? filters : [filters];

          params[this.key] = filters.map( LJ.Function.get('id') );
          params.journal   = this.get('journal');

          // splice filters
          filters.forEach(function (filter) {
            that.filters.splice( that.filters.indexOf(filter), 1 );
          });

          return Api.call(this.rpc.remove, params);
        };

        /**
         * Get filter/group count
         * @method getCount
         * @return {Promise} Promise that will be resolved when server respond
         */
        Factory.prototype.getCount = function () {
          return Api.call(this.rpc.count, {
            journal: this.get('journal')
          }).then( LJ.Function.get('count') );
        };

        /**
         * Get filters/groups for user
         * @param  {String} username Username of the user
         * @return {Array}           Array of filters
         */
        Factory.prototype.by = function (username) {
          var user = Users.Cache.get(username);

          if ( !user ) {
            return [];
          }


          return this.filters.filter(function (filter) {
            return Users.isUserInGroup(username, filter.id);
          });
        };

        return Factory;
      }
    ])

    .factory('Filter', ['FilterGroupFactory', function (Factory) {
      /**
       * @class Filter
       * @extends FilterGroupFactory
       * @constructor
       */
      function Filter() {
        /**
         * RPC endpoints
         * @property {Object} rpc
         *
         * @property {String} rpc.create  Create filter endpoint
         * @property {String} rpc.read    Read filters endpoint
         * @property {String} rpc.update  Update filter(s) endpoint
         * @property {String} rpc.remove  Remove filter(s) endpoint
         * @property {String} rpc.count   Count filters endpoint
         */
        this.rpc = {
          create: 'filters.create',
          read:   'filters.list',
          update: 'filters.update',
          remove: 'filters.remove',
          count:  'filters.count'
        };

        /**
         * API key: filters/groups
         * @property {String} key
         */
        this.key = 'filters';
      }

      Filter.prototype = new Factory();

      /**
       * Update privacy for filter(s)
       *
       * @method _setPrivacy
       * @private
       * @param {Objects[]|Object} filters  Filter(s) object(s) to set privacy
       * @param {String} privacy            Privacy to be set: 'public' or 'private'
       * @return {Promise}                  Promise that will be resolved when sync is done
       */
      Filter.prototype._setPrivacy = function (filters, privacy) {
        filters = Array.isArray(filters) ? filters : [filters];

        filters.forEach( LJ.Function.set('public', privacy === 'public') );

        return this.sync(filters);
      };

      /**
       * Update filter(s) privacy to private
       *
       * @method private
       * @param {Object|Object[]} filters   Filter(s) to update
       * @return {Promise}          Promise that will be resolved
       *                    with update filters data
       */
      Filter.prototype.private = function (filters) {
        return this._setPrivacy(filters, 'private');
      };

      /**
       * Update filter(s) privacy to public
       *
       * @method public Set privacy to public
       * @param {Object|Object[]} filters   Filter(s) to update
       * @return {Promise}                  Promise that will be resolved
       *                                    with update filters data
       */
      Filter.prototype.public = function (filters) {
        return this._setPrivacy(filters, 'public');
      };

      return new Filter();
    }])

    .factory('Group', ['FilterGroupFactory', function (Factory) {

      /**
       * @class Group
       * @extends FilterGroupFactory
       * @constructor
       */
      function Group() {
        /**
         * RPC endpoints
         * @property {Object} rpc
         *
         * @property {String} rpc.create  Create group endpoint
         * @property {String} rpc.read    Read groups endpoint
         * @property {String} rpc.update  Update group(s) endpoint
         * @property {String} rpc.remove  Remove group(s) endpoint
         * @property {String} rpc.count   Count groups endpoint
         */
        this.rpc = {
          create: 'groups.create',
          read:   'groups.list',
          update: 'groups.update',
          remove: 'groups.remove',
          count:  'groups.count'
        };

        /**
         * Key for group and filter distinction
         *
         * @property {String} key
         * @type {String}
         */
        this.key = 'groups';
      }

      Group.prototype = new Factory();

      return new Group();
    }]);
}());
;

/* file-end: js/settings/services/filters/filters.js 
----------------------------------------------------------------------------------*/


/* ---------------------------------------------------------------------------------
   file-start: js/settings/directives/filtersFor.js 
*/


LJ.injectStyle('.b-filterset{max-width:290px;font:14px/1.4 Arial,sans-serif;color:#000}.b-filterset DD,.b-filterset DT,.b-filterset TH,.b-filterset TD,.b-filterset P,.b-filterset DIV,.b-filterset SPAN,.b-filterset EM,.b-filterset STRONG,.b-filterset B,.b-filterset I,.b-filterset LI,.b-filterset LABEL,.b-filterset PRE,.b-filterset CODE,.b-filterset KBD{font-size:100%}.b-filterset .i-ljuser-userhead{vertical-align:top!important;margin:1px 0 0!important;border:none!important}.b-filterset .i-ljuser-username:link,.b-filterset .i-ljuser-username:visited,.b-filterset .i-ljuser-username:hover,.b-filterset .i-ljuser-username:active{color:#0051B7!important;text-decoration:none!important;border:none!important}.b-filterset .b-filterset-title{font-weight:700!important}.b-filterset .b-filterset-title,.b-filterset .b-filterset-subtitle{margin:0 1.142em .5em 0!important;color:#222!important}.b-filterset-list{position:relative;z-index:1;overflow:auto;max-height:14em;min-width:220px;margin:0 0 .3em;padding:0;background-attachment:scroll;-moz-background-clip:border-box;background-clip:border-box;background-image:-webkit-radial-gradient(farthest-side at 50% 0,rgba(0,0,0,.1),transparent),-webkit-radial-gradient(farthest-side at 50% 100%,rgba(0,0,0,.1),transparent);background-image:-o-radial-gradient(farthest-side at 50% 0,rgba(0,0,0,.1),transparent),-o-radial-gradient(farthest-side at 50% 100%,rgba(0,0,0,.1),transparent);background-image:-moz-radial-gradient(farthest-side at 50% 0,rgba(0,0,0,.1),transparent),-moz-radial-gradient(farthest-side at 50% 100%,rgba(0,0,0,.1),transparent);background-image:radial-gradient(farthest-side at 50% 0,rgba(0,0,0,.1),transparent),radial-gradient(farthest-side at 50% 100%,rgba(0,0,0,.1),transparent);-moz-background-origin:padding-box;background-origin:padding-box;background-position:0 0,0 100%;background-repeat:no-repeat;-moz-background-size:100% 7px;background-size:100% 7px}.b-filterset-list:before,.b-filterset-list:after{position:relative;z-index:-1;display:block;content:\"\";height:14px;margin:0 0 -14px;background:-webkit-linear-gradient(top,#F4F5F6,#F4F5F6 30%,rgba(244,245,246,0)) 0 0;background:-moz-linear-gradient(top,#F4F5F6,#F4F5F6 30%,rgba(244,245,246,0)) 0 0;background:-o-linear-gradient(top,#F4F5F6,#F4F5F6 30%,rgba(244,245,246,0)) 0 0;background:linear-gradient(to bottom,#F4F5F6,#F4F5F6 30%,rgba(244,245,246,0)) 0 0}.b-filterset-list:after{margin:-14px 0 0;background:-webkit-linear-gradient(top,rgba(228,229,233,0),#E4E5E9 70%,#E4E5E9) 0 0;background:-moz-linear-gradient(top,rgba(228,229,233,0),#E4E5E9 70%,#E4E5E9) 0 0;background:-o-linear-gradient(top,rgba(228,229,233,0),#E4E5E9 70%,#E4E5E9) 0 0;background:linear-gradient(to bottom,rgba(228,229,233,0),#E4E5E9 70%,#E4E5E9) 0 0}.b-filterset-list LI{margin:0;padding:0;list-style-type:none}.b-filterset-list LI.loading{background:url(/img/preloader/preloader-blue-gray.gif?v=16423) no-repeat 100% 50%}.b-filterset-list LABEL{display:block;white-space:nowrap;line-height:1.333;font-size:.857em}.b-filterset-list LABEL:hover{background:#7292BD;color:#FFF}.b-filterset-addnew-input{display:block;margin:0 0 .5em;white-space:nowrap;line-height:1.333;font-size:.857em}.b-filterset-addnew{margin:.5em 0 0}.b-filterset-pseudo{font-size:.857em;color:#0051B7}.b-filterset-submit{text-align:right}.b-filterset-loader:after,.b-filterset-loader:before{display:inline-block;visibility:hidden;content:\'\';width:21px;height:21px;margin:-2px 0 0 4px;background:url(/img/preloader/preloader-blue-gray.gif?v=16423) no-repeat 50% 50%;vertical-align:middle}.b-filterset-loader-before:after,.b-filterset-loader-after:before{display:none}.b-filterset-loading .b-filterset-loader-after:after,.b-filterset-loading .b-filterset-loader-before:before{visibility:visible}');
Site.page.template['angular/controlstrip/filters.ng.tmpl'] = '<div class=\"b-filterset-body\" ng-class=\"{ \'b-filterset-loading\': model.loading }\">\n    <ul class=\"b-filterset-section b-filterset-list\">\n        <li ng-repeat=\"filter in filters | filtersOrder\" ng-class=\"{ \'loading\': loading[filter.id] }\">\n            <label>\n                <input\n                    ng-checked=\"checked = isActive(filter.id)\"\n                    ng-change=\"toggleFilter(filter.id, checked)\"\n                    ng-model=\"checked\"\n                    type=\"checkbox\"\n                    class=\"b-filterset-checkbox\"\n                    >{{filter.name}}\n            </label>\n        </li>\n\n        <li ng-show=\"model.showCreateDialog\">\n            <span class=\"b-filterset-addnew-input\" >\n                <form ng-submit=\"createFilter()\">\n                    <input\n                        ng-model=\"model.newFilter\"\n                        focus-and-select=\"model.showCreateDialog\"\n                        type=\"text\"\n                        />\n                    <input type=\"submit\" lj-ml=\"filterset.button.save\" lj-ml-attr=\"value\" />\n                </form>\n            </span>\n        </li>\n    </ul>\n\n    <div\n        ng-hide=\"model.showCreateDialog || isFiltersCountReached()\"\n        class=\"b-filterset-section b-filterset-addnew\">\n        <span\n            ng-if=\"isFiltersFor\"\n            ng-click=\"model.showCreateDialog = true\"\n            lj-ml=\"filterset.link.addnewfilter\"\n            class=\"b-filterset-pseudo b-pseudo\"\n            ></span>\n        <span\n            ng-if=\"isGroupsFor\"\n            ng-click=\"model.showCreateDialog = true\"\n            lj-ml=\"filterset.link.addnewgroup\"\n            class=\"b-filterset-pseudo b-pseudo\"\n            ></span>\n    </div>\n</div>\n';
!function(){"use strict";function a(a,b,c,d,e,f){function g(){return Array.isArray(a.usernames)?a.usernames:[a.usernames]}a.loading={},a.filters=[],c.fetch({cache:!0}).then(function(b){a.filters=b}),a.model={newFilter:"",showCreateDialog:!1},a.toggleFilter=function(b,c){var e;f.clear(),a.loading[b]=!0,e=c?d.addToGroup(b,g()):d.removeFromGroup(b,g()),e.then(function(){a.loading[b]=!1})},a.isActive=function(a){var b=g().every(function(b){return d.isUserInGroup(b,a)});return b},a.isCountReached=function(){return a.filters.length>=c.MAX_COUNT},a.createFilter=function(){var b=a.model.newFilter.trim();a.resetFilter(),0!==b.length&&(a.model.loading=!0,c.create(b).then(function(b){var c=b.filter;d.addToGroup(c.id,g()).then(function(){a.model.loading=!1})}))},a.resetFilter=function(){a.model.newFilter="",a.model.showCreateDialog=!1},a.$on("bubble:open:controlstrip",a.resetFilter)}angular.module("Filters.List",[]).controller("FiltersForCtrl",["$scope","$q","Filter","Users","Bubble","Messages",a]).controller("GroupsForCtrl",["$scope","$q","Group","Users","Bubble","Messages",a]).directive("filtersFor",[function(){return{controller:"FiltersForCtrl",scope:{usernames:"=filtersFor"},templateUrl:"filters.ng.tmpl",link:function(a){a.isFiltersFor=!0}}}]).directive("groupsFor",[function(){return{controller:"GroupsForCtrl",scope:{usernames:"=groupsFor"},templateUrl:"filters.ng.tmpl",link:function(a){a.isGroupsFor=!0}}}])}();;

/* file-end: js/settings/directives/filtersFor.js 
----------------------------------------------------------------------------------*/

Site.page.template['angular/controlstrip/controlstrip.ng.tmpl'] = '<div\n  class=\"b-filterset\"\n  ng-class=\"{ \'b-filterset-loading\': loading }\"\n  >\n\n  <!-- subscribe user -->\n  <div class=\"b-filterset-title\" ng-show=\"mode == \'subscribe\'\" lj-ml=\"filterset.title.subscribed.journal\" lj-ml-resolve=\"mlResolve\"></div>\n\n  <!-- add user -->\n  <div class=\"b-filterset-title\" ng-show=\"mode == \'add\'\" lj-ml=\"filterset.title.addfriend.journal\" lj-ml-resolve=\"mlResolve\"></div>\n  <div class=\"b-filterset-subtitle\" ng-show=\"mode == \'add\'\" lj-ml=\"filterset.subtitle.addfriend.journal\" lj-ml-resolve=\"mlResolve\"></div>\n\n  <!-- subscribe community -->\n  <div class=\"b-filterset-title\" ng-show=\"mode == \'watch\'\" lj-ml=\"filterset.title.subscribed.community\" lj-ml-resolve=\"mlResolve\"></div>\n\n  <!-- join community -->\n  <div class=\"b-filterset-title\" ng-show=\"mode == \'join\' || mode == \'joinSubscribed\'\" lj-ml=\"filterset.title.join\"></div>\n  <div class=\"b-filterset-subtitle\" ng-show=\"mode == \'join\'\" lj-ml=\"filterset.subtitle.join\" lj-ml-resolve=\"mlResolve\"></div>\n  <div class=\"b-filterset-section b-filterset-submit\" ng-show=\"mode == \'join\'\">\n      <div class=\"b-ljbutton b-filterset-loader b-filterset-loader-before\">\n          <input type=\"submit\" lj-ml=\"filterset.submit.subscribe\" lj-ml-attr=\"value\" ng-click=\"subscribeAfterJoin()\" />\n      </div>\n  </div>\n\n  <!-- filters section -->\n  <!-- Notice: extra div here is because of bug in AngularJS: https://github.com/angular/angular.js/issues/3981 -->\n\n  <div ng-show=\"mode !== \'join\'\">\n    <div\n      class=\"b-filterset-subtitle b-filterset-loader b-filterset-loader-after\"\n      lj-ml=\"filterset.subtitle.filters\"\n      ></div>\n      <div filters-for=\"username\"></div>\n  </div>\n</div>\n';
/*global ContextualPopup, Hourglass */

;(function ($) {
  'use strict';

/**
 * Event tracking helper
 */
function trackEvent(value) {
  LJ.Track.event('Relations', 'Menu', value);
}

angular.module('Relations.Menu', [
  'LJ.Templates',
  'LJ.Bubble',
  'LJ.Directives',
  'LJ.User',
  'LJ.Messages',
  'GroupsAndFilters.Services.Filters',
  'Users',
  'Filters.List'
  ])

  // fix interactions with history API
  .value('$anchorScroll', null)

  .controller('MenuCtrl', ['$scope', 'Bubble', '$timeout', '$q', 'ljUser', 'Filter', 'Users', 'Relations', 'Messages',
                 function ( $scope,   Bubble,   $timeout,   $q,   ljUser,   Filter,   Users,   Relations,   Messages ) {

    var status   = $('.w-cs-status'),
        username = LJ.get('journal.username'),
        hourglass,
        mlDefer;

    // turn on subscriptions mode
    Users.set({ type: 'subscriptions' });

    // need it in scope to show lj-user-dynamic
    $scope.username = username;
    $scope.filters  = [];
    $scope.status   = LJ.get('controlstrip.status');

    // cache current journal
    Users.Cache.add( LJ.get('journal') );

    // override error showing method
    ContextualPopup.showNote = angular.identity;

    mlDefer = $q.defer();
    $scope.mlResolve = { promise: mlDefer.promise };
    ljUser.get(username, {
      noctxpopup: true
    }).then(function (html) {
      mlDefer.resolve({ username: html });
    });

    // watch current journal and update states
    $scope.$watch(function () {
      return Users.Cache.get(username);
    }, function (user) {
      $scope.states = LJ.Object.pick(user, 'is_friend', 'is_member', 'is_subscribedon', 'is_invite_sent');
    }, true);

    /**
     * Toggle loading state
     * @param  {Boolean} state  If `true`: show loader, otherwise: hide loader
     */
    $scope.toggleLoading = function (state) {
      $scope.loading = state;
    };

    // clear messages when relations change request starts
    LJ.Event.on('relations.change', function () {
      $timeout(Messages.clear);
    });

    function changeRelation(action, $event) {
      var relationPromise;

      if ( $event ) {
        showHourglass($event);
      }

      switch (action) {
        case 'addFriend':
          relationPromise = Relations.toggleFriend(username, true, { wait: true });
          break;
        case 'removeFriend':
          relationPromise = Relations.toggleFriend(username, false, { wait: true });
          break;
        case 'join':
          relationPromise = Relations.toggleMember(username, true, { wait: true });
          break;
        case 'leave':
          relationPromise = Relations.toggleMember(username, false, { wait: true });
          break;
        case 'subscribe':
          relationPromise = Relations.toggleSubscription(username, true, { wait: true });
          break;
        case 'unsubscribe':
          relationPromise = Relations.toggleSubscription(username, false, { wait: true });
          break;
      }

      // Notice: .finally() is not allowed in IE8,
      // that is why we need call it with ['finally']() notation
      return relationPromise['finally'](hideHourglass).then(function (data) {

        // Hide contextual popup if we are changing status from contextual popup
        // in control strip.
        if ( ContextualPopup.currentElement === status.find('.ljuser img').get(0) ) {
          ContextualPopup.hide();
        }

        // show error
        if (data.error) {
          return $q.reject(data.error.message);
        }

        // show messages
        if (data.message) {
          data.message.body = data.message.content;
          Messages.add(data.message);
        }

        // update controlstrip status
        if (typeof data.controlstrip_status !== 'undefined') {
          $scope.status = data.controlstrip_status;
        }

        // We should fetch data updates to show filters dialog when:
        // 1) we are subscribing to user/community
        // 2) we are adding friend (add friend also subscribes us to user)
        // 3) we are joining community that we have been subscribed to already
        if ( action === 'subscribe' || action === 'addFriend' || (action === 'join' && data.is_subscribedon) ) {
          return fetchFilters();
        }

        // Reset filters. This line fixes incorrect ng-checked directive behavior:
        // When lots of digest loops in a time it could stay not synced with data
        // This code could be removed after fixing performance issue
        $scope.filters = [];
      }, function onFail(message) {
        Messages.error({ body: message });
      });
    }

    /**
     * Fetch filters data and user filtermask
     * @return {Promise}  Promise that will be resolved when data is ready
     */
    function fetchFilters() {
      var user = Users.Cache.get(username),
          userPromise;

      // we could fetch filters and filtermask only if we subscribed to user
      if ( !user.is_subscribedon ) {
        return $q.reject();
      }

      if ( !user.filtermask ) {
        // fetch filtermask
        userPromise = Users.fetchUser(username, { filtermask: 1 });
      } else {
        // filtermask has been fetched before
        userPromise = $q.defer().resolve();
      }

      return $q.all({
        filters: Filter.fetch({ cache: true }),
        user:    userPromise
      }).then(function (results) {
        $scope.filters = results.filters;
      });
    }

    $scope.subscribe = function ($event) {
      $event.preventDefault();
      trackEvent('subscribe');

      changeRelation('subscribe', $event).then(function () {
        if ( $scope.states.is_subscribedon ) {
          $scope.mode = 'subscribe';
          Bubble.open('controlstrip', 'unsubscribe');
        }
      });
    };

    $scope.unsubscribe = function ($event) {
      $event.preventDefault();
      trackEvent('unsubscribe');
      changeRelation('unsubscribe', $event);
    };

    $scope.addFriend = function ($event) {
      $event.preventDefault();
      trackEvent('add friend');
      changeRelation('addFriend', $event).then(function () {
        if ( $scope.states.is_friend ) {
          $scope.mode = 'add';
          Bubble.open('controlstrip', 'removeFriend');
        }
      });
    };

    $scope.removeFriend = function ($event) {
      $event.preventDefault();
      trackEvent('remove friend');
      changeRelation('removeFriend', $event);
    };

    $scope.watch = function ($event) {
      $event.preventDefault();
      trackEvent('subscribe to community');
      changeRelation('subscribe', $event).then(function () {
        if ( $scope.states.is_subscribedon ) {
          $scope.mode = 'watch';
          Bubble.open('controlstrip', 'unwatch');
        }
      });
    };

    $scope.unwatch = function ($event) {
      $event.preventDefault();
      trackEvent('unsubscribe from community');
      changeRelation('unsubscribe', $event);
    };

    $scope.join = function ($event) {
      $event.preventDefault();
      trackEvent('join community');
      changeRelation('join', $event).then(function () {
        if ( $scope.states.is_member ) {
          $scope.mode = $scope.states.is_subscribedon ? 'joinSubscribed' : 'join';
          Bubble.open('controlstrip', 'leave');
        }
      });
    };

    $scope.leave = function ($event) {
      $event.preventDefault();
      trackEvent('leave community');
      changeRelation('leave', $event);
    };

    /**
     * Subscribe to community updates in a bubble after join action
     */
    $scope.subscribeAfterJoin = function () {
      $scope.toggleLoading(true);
      trackEvent('subscribe to community (after join)');
      changeRelation('subscribe').then(function () {
        $scope.toggleLoading(false);
        $scope.mode = 'watch';
      });
    };

    /**
     * Show hourglass for event
     *
     * @param  {jQuery.Event} event jQuery event (click)
     */
    function showHourglass(event) {
      if (hourglass) {
        hideHourglass();
      }

      hourglass = new Hourglass().setEvent(event).show();
    }

    /**
     * Hide hourglass
     */
    function hideHourglass() {
      if (hourglass) {
        hourglass.remove();
        hourglass = null;
      }
    }
  }]);

}(jQuery));
;

/* file-end: js/relations/menu.js 
----------------------------------------------------------------------------------*/

/**
 * @author Valeriy Vasin (valeriy.vasin@sup.com)
 * @description Controlstrip functionality
 */

;(function ($) {
  'use strict';

  // currently in IE8 when documentMode IE7 Standards is ON, some stuff is not working properly (e.g. ng-class)
  // Use fallback for that browser. Angular functionality should be turned off
  var IE7mode = Boolean(typeof document.documentMode !== 'undefined' && document.documentMode < 8);

  /**
   * Add community filter functionality for control strip
   */
  function initFilter() {
    var bubble,
        form,
        input,
        submit;

    // filter is available only for logged in users
    if ( !LJ.get('remoteUser') ) {
      return;
    }

    bubble = $('#lj_controlstrip_new .w-cs-filter-inner');

    // exit if filter content is not currently on the page
    if ( bubble.length === 0 ) {
      return;
    }

    form = $('#sortByPoster');
    input = form.find('[name=poster]');
    submit = form.find('[type=image]');

    bubble.bubble({
      target: '#lj_controlstrip_new .w-cs-filter-icon',
      showOn: 'click',
      closeControl: false
    });

    input.input(function () {
      if( this.value.length ) {
        submit.css('opacity', 1)
          .prop('disabled', false);
      } else {
        submit.css('opacity', 0)
          .prop('disabled', true);
      }
    });

    form.on('submit', function (e) {
      if( !input.val().length ) {
        e.preventDefault();
      }
    });
  }

  /**
   * Add labled placeholders for the control strip
   */
  function addLabledPlaceholders() {
    $('#lj_controlstrip_new input[placeholder]').labeledPlaceholder();
  }

  /**
   * Initialize control strip
   */
  function init() {
    initFilter();
    addLabledPlaceholders();

    if ( LJ.Flags.isEnabled('new_friends_and_subscriptions') && !IE7mode ) {
      // init angular
      angular.bootstrap( $('[data-controlstrip]'), ['Relations.Menu']);
    }

    // calendar
    (function initCalendar() {
      var calendarLink = $('#lj_controlstrip_new .w-cs-i-calendar a'),

          // checks if we are on /friends page or not. There special calendar behavior is needed
          journalViewFriends = /^\/friends/.test( location.pathname ),
          journalUrlBase = LJ.get('current_journal.url_journal'),

          earlyDate = LJ.get('controlstrip.calendar.earlyDate'),
          lastDate  = LJ.get('controlstrip.calendar.lastDate');

      if ( calendarLink.length ) {
        calendarLink
          .calendar({
            showOn: 'click',
            closeControl: false,

            dayRef:  journalUrlBase + '/' + (journalViewFriends ? 'friends/' : '') + '%Y/%M/%D',
            allRefs: journalViewFriends,

            startMonth: earlyDate ? parseDate( LJ.get('controlstrip.calendar.earlyDate') ) : new Date(),
            endMonth:   lastDate  ? parseDate( LJ.get('controlstrip.calendar.lastDate') )  : new Date(),

            classNames: {
              container: 'w-cs-calendar'
            },

            ml: {
              caption: LJ.ml('web.controlstrip.view.calendar')
            }
          })
          .on('daySelected', function (event) {
            event.preventDefault();
          });

          if ( !journalViewFriends ) {
            calendarLink.calendarEvents( { fetchOnFirstDisplay: true } );
          }
      }

      /**
       * Convert string e.g. "2009,10,27" to Date object
       * @return {Date} Parsed Date
       */
      function parseDate(str) {
        var date = str.split(',').map(Number);

        return new Date(date[0], date[1], date[2]);
      }
    }());

    $('.b-loginpopup').bubble({
      target: '.i-auth-control',
      closeControl: false,
      showOn: 'click'
    });

    $('input.text').labeledPlaceholder();
  }

  $(function () {

    // load control strip if it's not available on document ready
    // Notice: some s2 users could turn off control strip for all users
    if (!document.getElementById('lj_controlstrip') && !document.getElementById('lj_controlstrip_new')) {
      // fetch control strip from server
      $.get(
        LiveJournal.getAjaxUrl('controlstrip'),
        { user: LJ.get('currentJournal') },
        function (data) {
          $(data).appendTo(document.body);
          init();
        }
      );
    } else {
      init();
    }
  });

}(jQuery));
;

/* file-end: js/controlstrip.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.repostbutton.js 
*/

LJ.UI.registerTemplate('templates-CleanHtml-PaidRepost', "<span class=\" b-flatrepost repost-button {{if $data.reposted}} b-flatrepost-reposted {{/if}} {{if $data.count}} b-flatrepost-counted {{/if}} {{if $data.budget || $data.cost}} b-flatrepost-gained {{/if}} {{if $data.owner}} b-flatrepost-disabled {{/if}} {{if $data.login}} b-flatrepost-disabled {{/if}} \" ><a href=\"javascript:void(0);\" data-href=\"{{html $data.url}}\" class=\"b-flatrepost-name\" title=\"{{if $data.reposted}}{{html LJ.mltext(\'entry.reference.label.title\')}}{{else}}{{if $data.login}}{{html LJ.mltext(\'repost.button.title.login\')}}{{else}}{{if $data.owner}}{{html LJ.mltext(\'repost.button.title.myown\')}}{{else}}{{html LJ.mltext(\'repost.button.title\')}}{{/if}}{{/if}}{{/if}}\" ><span class=\"b-flatrepost-gain\" title=\"{{html $data.budget}}{{html LJ.mltext(\'paidrepost.button.title.curr\')}}\" >{{if !$data.owner}}+{{html $data.cost}}{{else $data.budget}}{{html $data.budget}}{{/if}}</span></a><span class=\"b-flatrepost-counter\" title=\"{{html LJ.mltext(\'repost.button.counter\')}}\" >{{html $data.count}}</span></span> ", 'JQuery.stat');
LJ.UI.registerTemplate('templates-CleanHtml-Repost', "<span class=\" b-flatrepost repost-button {{if $data.reposted}} b-flatrepost-reposted {{/if}} {{if $data.count}} b-flatrepost-counted {{/if}} {{if $data.budget}} b-flatrepost-gained {{/if}} {{if $data.owner}} b-flatrepost-disabled {{/if}} {{if $data.login}} b-flatrepost-disabled {{/if}} \" ><a href=\"javascript:void(0);\" data-href=\"{{html $data.url}}\" class=\"b-flatrepost-name\" title=\"{{if $data.reposted}}{{html LJ.mltext(\'entry.reference.label.title\')}}{{else}}{{if $data.login}}{{html LJ.mltext(\'repost.button.title.login\')}}{{else}}{{if $data.owner}}{{html LJ.mltext(\'repost.button.title.myown\')}}{{else}}{{html LJ.mltext(\'repost.button.title\')}}{{/if}}{{/if}}{{/if}}\" ><span class=\"b-flatrepost-gain\" title=\"{{html $data.budget}}{{html LJ.mltext(\'paidrepost.button.title.curr\')}}\" >{{if !$data.owner}}+{{html $data.cost}}{{else $data.budget}}{{html $data.budget}}{{/if}}</span></a><span class=\"b-flatrepost-counter\" title=\"{{html LJ.mltext(\'repost.button.counter\')}}\" >{{html $data.count}}</span></span> ", 'JQuery.stat');
LJ.UI.registerTemplate('templates-CleanHtml-reposted', "{{if $data.content}} {{each ($value.users || $data.users)}}{{if !((!$index) && !($value.dropComma || $data.dropComma))}}, {{/if}}<a href=\"{{html ($value.url || $data.url)}}\">{{html ($value.user || $data.user)}}</a>{{/each}} {{else}} <div class=\"b-reposted-popup\"> <div class=\"b-reposted-popup-header\">{{html LJ.mltext(\'repost.popup.head\')}}</div> <div class=\"b-reposted-popup-content b-reposted-popup-load\"></div> <div class=\"b-reposted-popup-footer\"><a href=\"javascript:void(0);\">{{html LJ.mltext(\'repost.popup.footer\')}}</a></div> </div> {{/if}} ", 'JQuery.stat');
/**
 * @name $.lj.repostbutton
 * @requires $.ui.core, $.ui.widget, $.lj.basicWidget, $.lj.bubble
 * @class Represents repost button
 * @author dmitry.petrov@sup.com (Dmitry Petrov), anazarov@sup.com (Alexander Nazarov)
 */
;(function ($) {
  'use strict';

  /** @lends $.lj.repostbutton.prototype */
  $.widget('lj.repostbutton', $.lj.basicWidget, {
    options: {
      classNames: {
        active: 'repost-button-active',
        inactive: 'repost-button-inactive',
        popupLoad: 'b-reposted-popup-load',
        popupNomore: 'b-reposted-popup-footer-hide',
        repostError: 'repost-error'
      },

      selectors: {
        counterParent: '.lj-button-c',
        button: '.lj-button-b',
        counter: '.lj-like-item-count',
        buttonLink: '.lj-button-link',
        popupContent: '.b-reposted-popup-content',
        popupFooter: '.b-reposted-popup-footer',
        popupMore: '.b-reposted-popup-footer > a'
      },

      templates: {
        popup: 'templates-CleanHtml-reposted'
      },

      url: '',
      reposted: false,
      cost: 0,
      budget: 0,
      paid: false
    },

    _create: function() {

      this.options.classNames = {
        active: 'b-flatrepost-reposted',
        inactive: 'b-flatrepost-disabled',
        popupLoad: 'b-reposted-popup-load',
        popupNomore: 'b-reposted-popup-footer-hide',
        repostError: 'repost-error'
      };

      this.options.selectors = {
        counterParent: '.b-flatrepost-counter',
        button: '.b-flatrepost-name',
        counter: '.b-flatrepost-counter',
        buttonLink: '.b-flatrepost-name',
        popupContent: '.b-reposted-popup-content',
        popupFooter: '.b-reposted-popup-footer',
        popupMore: '.b-reposted-popup-footer > a'
      };

      $.lj.basicWidget.prototype._create.apply(this);

      if (!this.options.url) {
        console.warn(this.widgetName, ': no url in options, initialization won\'t continue');
      }

      this._journal = LJ.get('currentJournal');
      this._count = null;
      this._remote = LJ.get('remoteUser');
      this._reposted = this.options.reposted;
      this._el('buttonLink');
      this._href = this.element.find(this._s('button')).data('href');
      this._href = LJ.Util.Journal.parseLink(this._href) || {};

      if (!this._canRepost()) {
        this.element.addClass(this._cl('inactive'));
        this._buttonLink.removeAttr('title');
        this._lock();
      }

      this._popup = null;
      this._popupContent = null;
      this._popupLocked = false;
      this._lastUser = null;
      this._el('counterParent');
      this._el('counter');

      if (!Number(this._counter.html())) { this._hideCounter(); }

      this._bindControls();
    },

    _hideCounter: function () {
      this._counterParent.addClass('empty');
    },

    _showCounter: function () {
      this._counterParent.removeClass('empty');
    },

    _bindControls: function() {
      var repost = this;

      this.element.on('click', this._s('button'), this._onUpdateButton.bind(this));

      this._counterParent.one('click', function() {
        if ( !Number(repost._counter.html()) ) {
          return;
        }

        repost._popup = repost._tmpl('popup');
        repost._el('popupFooter', repost._popup);
        repost._popupContent = repost._popup.find(repost._s('popupContent'));

        repost._popup.bubble({
          showOn: 'click',
          align: 'side',
          alwaysShowUnderTarget: true,
          target: repost._counterParent
        })
        .on('bubblehide', function () {
          repost._lastUser = null;
          repost._popupContent.empty();
          repost._popupFooter.removeClass(repost._cl('popupNomore'));
        })
        .on('bubbleshow', function () {
          repost._loadRepostedList();
        })
        .on('click', repost._s('popupMore'), repost._loadRepostedList.bind(repost));

        Function.defer(function() {
          repost._popup.bubble('show');
        });
      });

      $.lj.basicWidget.prototype._bindControls.apply(repost);
    },

    _loadRepostedList: function(ev) {
      var repost = this;

      if (ev) { ev.preventDefault(); }
      if (this._popupLocked) { return; }

      this._popupLocked = true;
      this._popupContent.addClass(this._cl('popupLoad'));

      LJ.Api.call('repost.get_list', { url: this.options.url, last: this._lastUser }, function(answer) {
        repost._popupContent.removeClass(repost._cl('popupLoad'));
        repost._popupLocked = false;
        if (answer.error) {
          repost._handleAnswer(answer);
        } else {
          repost._render(answer.users, answer.nomore, answer.count);
          repost._lastUser = answer.last;
        }
      });
    },

    _render: function(users, nomore, count) {
      var repost = this;

      /* Display users */
      if (users.length > 0) {
        repost._tmpl('popup', {
          content: true,
          dropComma: !!repost._lastUser,
          users: users
        }).appendTo(repost._popupContent);
      }

      this._updateCounter(count);

      /* Hide 'Show More' button */
      if (nomore) {
        repost._popupFooter.addClass(repost._cl('popupNomore'));
      }
    },

    _onUpdateButton: function(ev) {
      if (!this.locked()) {
        this.toggleRepost();
      }
      ev.preventDefault();
    },

    _handleAnswer: function(answer) {
      if (answer.hasOwnProperty('delete')) {
        if (answer.message) {
          this._showMessage(answer.message);
        }

        /* LJSUP-13479: Repost type or cost changed */
        if ( this.paid !== Boolean(answer.paid) || this.paid && (this.cost !== answer.cost) ) {
          this.element.replaceWith(LJ.Social.renderRepostButton(this.options.url, answer));
          return;
        }
      }

      if (answer.error) {
        if (answer.error.message) {
          this._showMessage(answer.error.message);
        }

        if (answer.error.data) {
          // Redraw button completely with new data
          this.element.replaceWith(LJ.Social.renderRepostButton(this.options.url, answer.error.data));
          return;
        }
      } else {
        this._updateButton( !this._reposted );
      }

      if (!answer.hasOwnProperty('count') && answer.hasOwnProperty('delete')) {
        answer.count = this._count - 1;
      }

      this._updateCounter(answer.count);
      this._unlock();
    },

    _showMessage: function (message) {
      var errorBubble = $('<div />', {
        'class': this._cl('repostError'),
        text: message
      })
      .bubble({
        target: this.element,
        align: 'center',
        hide: function () {
          errorBubble.remove();
        }
      })
      .bubble('show');
    },

    _updateButton: function(reposted) {
      this._reposted = reposted;
      this.element.toggleClass(this._cl('active'), this._reposted);
    },

    _updateCounter: function (count) {
      if (typeof count !== 'undefined') {
        this._count = Number(count);
        this._counter.html(this._count);
      }

      if (!Number(this._counter.html())) {
        this._hideCounter();
      } else {
        this._showCounter();
      }
    },

    _canRepost: function () {
      if (LJ.get('preview')) { return false; }
      if (!this._remote) { return false; }
      if (LJ.get('remote_is_identity')) { return false; }
      if (this._remote === this._href.journal) { return false; }

      return true;
    },

    toggleRepost: function() {
      var repost = this,
        args = {
          url: this.options.url
        };

      if (!this._canRepost()) { return; }

      if (this._count === null) {
        this._count = parseInt( this._el('counter').html(), 10) || 0;
      }

      this._lock();
      if (this._reposted) {
        LJ.Api.call('repost.delete', args, function (answer) {
          /* LJSUP-12559: Reload page when repost is deleted in remote user's journal */
          if (
                !answer.error &&
                !answer.reposted &&
                repost._journal === repost._remote &&
                !location.href.match(/\/(friends|times|feed)\b/)
             ) {
            location.reload();
          } else {
            repost._handleAnswer(answer);
          }
        });
      } else {
        args.timezone = LJ.Util.Date.timezone();

        if (this.options.paid) {
          args.cost = this.options.cost;
        }

        LJ.Api.call('repost.create', args, this._handleAnswer.bind(this));
      }
    }
  });
}(jQuery));

;

/* file-end: js/jquery/jquery.lj.repostbutton.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/s2.js 
*/



/* ---------------------------------------------------------------------------------
   file-start: js/discovery/directives.js 
*/



Site.page.template['angular/ljImage.ng.tmpl'] = '<a ng-href=\"{{link}}\">\n    <figure class=\"b-journalpicture\">\n        <img\n            class=\"b-journalpicture-image\"\n            title=\"{{textContent}}\"\n            alt=\"{{textContent}}\"\n            ng-src=\"{{source}}\"\n            ng-style=\"dimensions\"\n            >\n        <figcaption class=\"b-journalpicture-caption\" lj-html=\"content\"></figcaption>\n    </figure>\n</a>\n';
Site.page.template['angular/ljGallery.ng.tmpl'] = '<div\n    class=\"b-journalgallery\"\n    ng-style=\"dimensions\"\n    ng-class=\"{\n        \'b-journalgallery-hightpriority\': isTall\n    }\"\n    >\n    <div\n        class=\"b-journalgallery-container\"\n        ng-style=\"dimensions\"\n        >\n        <figure\n            class=\"b-journalgallery-picture\"\n            ng-repeat=\"item in items\"\n            ng-style=\"dimensions\"\n            ng-if=\"isNearby($index)\"\n            ng-class=\"{\n                \'b-journalgallery-picture-prev\': $index < state.index,\n                \'b-journalgallery-picture-current\': $index === state.index,\n                \'b-journalgallery-picture-next\': $index > state.index\n            }\"\n            >\n            <div class=\"b-journalgallery-wrapper\">\n                <img\n                    ng-src=\"{{item.src}}\"\n                    class=\"b-journalgallery-image\"\n                    lj-gallery-load\n                    >\n            </div>\n            <figcaption class=\"b-journalgallery-caption\">\n                <span\n                    class=\"b-journalgallery-caption-title\"\n                    lj-html=\"item.content\"></span>\n            </figcaption>\n        </figure>\n    </div>\n    <span\n        class=\"b-journalgallery-counter\"\n        ng-bind=\"(state.index + 1) + \'/\' + (state.total+1)\"\n        ></span>\n    <span\n        class=\"b-journalgallery-nav b-journalgallery-nav-prev\"\n        ng-show=\"state.index !== 0\"\n        ng-click=\"prev()\"\n        ></span>\n    <span\n        class=\"b-journalgallery-nav b-journalgallery-nav-next\"\n        ng-show=\"state.index < state.total\"\n        ng-click=\"next()\"\n        ></span>\n</div>\n';
Site.page.template['angular/discovery/ljSuggest.ng.tmpl'] = '<div\n    class=\"b-mainpage-seealso\"\n    ng-if=\"suggest\"\n    >\n\n    <!-- head -->\n    <h3\n        class=\"b-mainpage-seealso-head\"\n        lj-ml=\"discovery.article.seealso\"\n        ></h3>\n\n    <!-- items -->\n    <ul class=\"b-mainpage-seealso-items\">\n        <li\n            class=\"b-mainpage-seealso-item\"\n            ng-repeat=\"suggested in suggest\"\n            >\n            <a\n                ng-href=\"{{suggested.url}}\"\n                class=\"b-mainpage-seealso-link\"\n                >\n                <span\n                    class=\"b-mainpage-seealso-pic\"\n                    ng-if=\"suggested.image\"\n                    ng-style=\"{ backgroundImage: \'url({{suggested.image}})\' }\"\n                    ></span>\n                <span\n                    class=\"b-mainpage-seealso-title\"\n                    lj-html=\"suggested.subject\"\n                    ></span>\n            </a>\n            <span class=\"b-mainpage-seealso-user\" ng-if=\"suggested.user\">\n                <span\n                    lj-user-dynamic=\"suggested.user.username\"\n                    lj-user-dynamic-options=\"{target: \'_blank\'}\"\n                    ></span>\n            </span>\n        </li>\n    </ul><!-- /items -->\n\n</div>';
Site.page.template['angular/widgets/authors/posts.ng.tmpl'] = '<!-- author\'s posts -->\n\n<div\n    class=\"\n        b-authorsposts\n        l-flatslide-aside-block\n        \"\n    ng-class=\"{\n        \'b-authorsposts-loading\': state.isLoading,\n        \'b-authorsposts-empty\': !posts.length\n    }\"\n    >\n\n    <!-- head -->\n    <header class=\"b-authorsposts-head\">\n        <h3\n            class=\"b-authorsposts-title\"\n            lj-ml=\"main.authorsposts.head\"\n            >\n        </h3>\n    </header>\n\n    <!-- body -->\n    <div class=\"b-authorsposts-body\">\n\n        <!-- items -->\n        <ul class=\"b-authorsposts-items\">\n\n            <!-- item -->\n            <li class=\"b-authorsposts-item\"\n                ng-repeat=\"post in posts\">\n\n                <!-- link -->\n                <a\n                    class=\"b-authorsposts-link\"\n                    ng-href=\"{{ post.url }}\"\n                    >\n                    <!-- pic -->\n                    <span\n                        class=\"b-authorsposts-pic\"\n                        style=\"background-image: url({{post.image}});\"\n                        ng-if=\"post.image\"\n                        ></span>\n                    <!-- subject -->\n                    <span\n                        class=\"b-authorsposts-subject\"\n                        lj-html=\"post.subject\"\n                        ></span>\n                </a>\n\n            </li>\n\n        </ul>\n\n        <!-- dummy loader -->\n        <div class=\"b-authorsposts-dummy\">\n            <div class=\"b-authorsposts-dummy-item\">\n                <span class=\"b-authorsposts-dummy-pic\"></span>\n                <div class=\"b-authorsposts-dummy-caption\">\n                    <span class=\"b-authorsposts-dummy-subject\"></span>\n                </div>\n            </div>\n            <div class=\"b-authorsposts-dummy-item\">\n                <span class=\"b-authorsposts-dummy-pic\"></span>\n                <div class=\"b-authorsposts-dummy-caption\">\n                    <span class=\"b-authorsposts-dummy-subject\"></span>\n                </div>\n            </div>\n            <div class=\"b-authorsposts-dummy-item\">\n                <span class=\"b-authorsposts-dummy-pic\"></span>\n                <div class=\"b-authorsposts-dummy-caption\">\n                    <span class=\"b-authorsposts-dummy-subject\"></span>\n                </div>\n            </div>\n        </div>\n\n    </div><!-- /body -->\n\n</div><!-- /authorsposts -->\n\n\n';
LJ.injectStyle('/* Journal Gallery\n----------------------------------- */\n/*\n<lj-gallery height=\"[x]\" width=\"[x]\">\n    <lj-gallery-item src=\"[image url]\" href=\"[link url]\"> подпись </lj-gallery-item>\n    <lj-gallery-item src=\"[image url]\" href=\"[link url]\"> подпись </lj-gallery-item>\n    <lj-gallery-item src=\"[image url]\" href=\"[link url]\"> подпись </lj-gallery-item>\n</lj-gallery>\n*/\n.b-journalgallery {\n    overflow: hidden;\n    display: block;\n    position: relative;\n    width: 100%;\n    margin: 0 auto;\n    padding: 0 0 70px;\n    font: 0.8125rem/1.1 \"ProximaNovaSemibold\",Tahoma,Arial,sans-serif;\n    }\n    /* container */\n    .b-journalgallery-container {\n        position: relative;\n        background: #FFF;\n        }\n        /* picture */\n        .b-journalgallery-picture {\n            position: absolute;\n            width: 100%;\n            margin: 0;\n            background: url(/img/preloader/preloader-disc-blue-white-16.gif?v=39502) no-repeat 50% 50%;\n            -webkit-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n            -moz-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n            -ms-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n            -o-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n            transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n            text-align: center;\n            }\n        .b-journalgallery-picture:after {\n            content: \'\';\n            display: inline-block;\n            height: 100%;\n            margin: 0 0 0 -0.05em; /* To offset spacing. May vary by font */\n            vertical-align: middle;\n            }\n            .b-journalgallery-wrapper {\n                display: inline-block;\n                vertical-align: middle;\n                max-width: 99%;\n                max-width: calc(100% - 0.3em);\n                }\n            .b-journalgallery-hightpriority .b-journalgallery-wrapper {\n                display: inline;\n                }\n                .b-journalgallery-image {\n                    position: relative;\n                    max-width: 100%;\n                    margin: 0;\n                    vertical-align: top;\n                    opacity: 1;\n                    -webkit-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n                    -moz-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n                    -ms-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n                    -o-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n                    transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n                    width: auto \\9;\n                    height: auto \\9;\n                    }\n                .b-journalgallery-hightpriority .b-journalgallery-image {\n                    max-height: 100%;\n                    }\n            .b-journalgallery-caption {\n                position: absolute;\n                top: 100%;\n                left: 0;\n                right: 0;\n                height: 70px; /* eq to b-journalgallery padding-bottom */\n                margin: 0;\n                padding: 0;\n                border: 0;\n                text-align: center;\n                background: #FFF;\n                color: #829399;\n                }\n                .b-journalgallery-caption-title {\n                    overflow: hidden;\n                    position: absolute;\n                    top: 0;\n                    right: 40px;\n                    left: 40px;\n                    height: 2.2em;\n                    margin: 0;\n                    padding: 10px 2px 0;\n                    }\n        .b-journalgallery-picture-loaded {\n            background-image: none;\n            }\n            .b-journalgallery-picture-loaded .b-journalgallery-image {\n                opacity: 1;\n                }\n        .b-journalgallery-picture-prev {\n            -webkit-transform: translate3d(-100%, 0, 0);\n            -moz-transform: translate3d(-100%, 0, 0);\n            -ms-transform: translate3d(-100%, 0, 0);\n            -o-transform: translate3d(-100%, 0, 0);\n            transform: translate3d(-100%, 0, 0);\n            opacity: 0;\n            }\n        .b-journalgallery-picture-next {\n            -webkit-transform: translate3d(100%, 0, 0);\n            -moz-transform: translate3d(100%, 0, 0);\n            -ms-transform: translate3d(100%, 0, 0);\n            -o-transform: translate3d(100%, 0, 0);\n            transform: translate3d(100%, 0, 0);\n            opacity: 0;\n            }\n        .b-journalgallery-picture-current {\n            -webkit-transform: translate3d(0, 0, 0);\n            -moz-transform: translate3d(0, 0, 0);\n            -ms-transform: translate3d(0, 0, 0);\n            -o-transform: translate3d(0, 0, 0);\n            transform: translate3d(0, 0, 0);\n            }\n    /* counter */\n    .b-journalgallery-counter {\n        position: absolute;\n        bottom: 44px;\n        right: 0;\n        margin: 0;\n        padding: 2px;\n        border: 0;\n        text-align: right;\n        color: #829399;\n        }\n    /* prev-next arrows */\n    .b-journalgallery-nav {\n        position: absolute;\n        top: 0;\n        bottom: 70px; /* .b-journalgallery {padding-bottom} */\n        margin: 0;\n        padding: 0;\n        border: 0;\n        cursor: pointer;\n        font: 0/0 a;\n        }\n    .b-journalgallery-nav:before {\n        content: \" \";\n        position: absolute;\n        top: 50%;\n        width: 50px;\n        height: 50px;\n        margin: -25px 0 0;\n        padding: 0;\n        border: 0;\n        border-radius: 3px;\n        background: #839399;\n        }\n    .b-journalgallery-nav:hover:before {\n        background: #09C;\n        }\n    .b-discoveryarticle .b-journalgallery-nav:hover:before {\n        background: #39BF71;\n        }\n    .b-journalgallery-nav:after {\n        content: \" \";\n        position: absolute;\n        top: 50%;\n        width: 9px;\n        height: 16px;\n        margin: -8px 0 0;\n        padding: 0;\n        background: url(/img/icons/journalgallery.png?v=39648) no-repeat 0 0;\n        }\n    /* prev */\n    .b-journalgallery-nav-prev {\n        left: 0;\n        width: 30%;\n        }\n    .b-journalgallery-nav-prev:before {\n        left: 20px;\n        }\n    .b-journalgallery-nav-prev:after {\n        left: 40px;\n        }\n    /* next */\n    .b-journalgallery-nav-next {\n        right: 0;\n        width: 70%;\n        }\n    .b-journalgallery-nav-next:before {\n        right: 20px;\n        }\n    .b-journalgallery-nav-next:after {\n        right: 40px;\n        background-position: 0 -17px;\n        }\n\n\n');
LJ.injectStyle('/* AUTHOR\'S POSTS */\n\n\n\n.b-authorsposts {\n    }\n\n    /* head */\n    .b-authorsposts-head {\n        margin: 0 0 16px;\n        margin: 0 0 1rem;\n        padding: 0;\n        }\n    .b-feedwidgets .b-authorsposts-head {\n        margin: 0 0 13px;\n        margin: 0 0 0.8125rem;\n        }\n        .b-authorsposts-title {\n            margin: 0;\n            padding: 0;\n            font-style: normal;\n            font-weight: normal;\n            font-size: 20px;\n            font-size: 1.25rem;\n            text-transform: uppercase;\n            color: #829399;\n            }\n\n    /* body */\n    .b-authorsposts-body {\n        margin: 0;\n        padding: 0;\n        }\n    .b-feedwidgets .b-authorsposts-body {\n        font-size: 14px;\n        font-size: 0.875rem;\n        }\n\n        /* items */\n        .b-authorsposts-items {\n            margin: 0;\n            padding: 0;\n            list-style: none;\n            }\n\n            /* item */\n            .b-authorsposts-item {\n                margin: 16px 0 0;\n                margin: 1rem 0 0;\n                padding: 0;\n                }\n            .b-authorsposts-item:first-child {\n                margin-top: 0;\n                }\n\n                /* link */\n                .b-authorsposts-link {\n                    position: relative;\n                    display: block;\n                    margin: 0;\n                    padding: 0;\n                    }\n                .b-discoveryarticle .b-authorsposts-link:link,\n                .b-discoveryarticle .b-authorsposts-link:visited {\n                    color: #242f33\n                    }\n                .b-discoveryarticle .b-authorsposts-link:hover,\n                .b-discoveryarticle .b-authorsposts-link:active {\n                    color: #00a3d9;\n                    }\n\n                    /* pic */\n                    .b-authorsposts-pic {\n                        display: block;\n                        height: 200px;\n                        margin: 0 0 0.5em;\n                        background-position: 50% 50%;\n                        background-repeat: no-repeat;\n                        background-size: cover;\n                        }\n\n                    /* subject */\n                    .b-authorsposts-subject {\n                        display: block;\n                        margin: 0;\n                        font-size: 1.25em;\n                        line-height: 1.2;\n                        }\n\n        /* dummy loader */\n        .b-authorsposts-dummy {\n            display: none;\n            margin: 0;\n            padding: 0;\n            list-style: none;\n            }\n            .b-authorsposts-dummy-item {\n                margin: 32px 0 0;\n                margin: 2rem 0 0;\n                padding: 0;\n                }\n            .b-authorsposts-dummy-item:first-child {\n                margin-top: 0;\n                }\n                /* image */\n                .b-authorsposts-dummy-pic {\n                    display: inline-block;\n                    width: 300px;\n                    height: 200px;\n                    margin: 0 0 8px;\n                    margin: 0 0 0.5rem;\n                    padding: 0;\n                    background: #F8F8F8;\n                    -webkit-animation: loading-authorsposts 1s infinite;\n                    -moz-animation:    loading-authorsposts 1s infinite;\n                    -o-animation:      loading-authorsposts 1s infinite;\n                    animation:         loading-authorsposts 1s infinite;\n                    }\n                /* hide at /feed page (LJSUP-18145) */\n                .b-feedwidgets .b-authorsposts-dummy-pic {\n                    display: none;\n                    }\n                /* caption */\n                .b-authorsposts-dummy-caption {\n                    display: block;\n                    height: 48px;\n                    height: 3rem;\n                    margin: 0 0 8px;\n                    margin: 0 0 0.5rem;\n                    padding: 0;\n                    }\n                    .b-authorsposts-dummy-subject {\n                        position: relative;\n                        display: block;\n                        width: 250px;\n                        height: 19px;\n                        height: 1.2rem;\n                        margin: 0 0 32px;\n                        margin: 0 0 2rem;\n                        padding: 0;\n                        background: #F8F8F8;\n                        -webkit-animation: loading-authorsposts 1s infinite;\n                        -moz-animation:    loading-authorsposts 1s infinite;\n                        -o-animation:      loading-authorsposts 1s infinite;\n                        animation:         loading-authorsposts 1s infinite;\n                        }\n                    .b-authorsposts-dummy-subject:after {\n                        content: \" \";\n                        position: absolute;\n                        top: 24px;\n                        top: 1.5rem;\n                        left: 0;\n                        width: 200px;\n                        height: 19px;\n                        height: 1.2rem;\n                        margin: 0;\n                        padding: 0;\n                        background: #F8F8F8;\n                        }\n                /* meta */\n                .b-authorsposts-dummy-meta {\n                    display: inline-block;\n                    width: 120px;\n                    height: 16px;\n                    height: 1rem;\n                    margin: 0;\n                    padding: 0;\n                    background: #F8F8F8;\n                    -webkit-animation: loading-authorsposts 1s infinite;\n                    -moz-animation:    loading-authorsposts 1s infinite;\n                    -o-animation:      loading-authorsposts 1s infinite;\n                    animation:         loading-authorsposts 1s infinite;\n                    }\n                @-webkit-keyframes loading-authorsposts {\n                    0%   { background: #F8F8F8; }\n                    50%  { background: #FBFBFB; }\n                    100% { background: #F8F8F8; }\n                }\n                @-moz-keyframes loading-authorsposts {\n                    0%   { background: #F8F8F8; }\n                    50%  { background: #FBFBFB; }\n                    100% { background: #F8F8F8; }\n                }\n                @-o-keyframes loading-authorsposts {\n                    0%   { background: #F8F8F8; }\n                    50%  { background: #FBFBFB; }\n                    100% { background: #F8F8F8; }\n                }\n                @keyframes loading-authorsposts {\n                    0%   { background: #F8F8F8; }\n                    50%  { background: #FBFBFB; }\n                    100% { background: #F8F8F8; }\n                }\n\n/* loading */\n.b-authorsposts-loading {\n    }\n    .b-authorsposts-loading .b-authorsposts-body {\n        min-height: 300px;\n        }\n        .b-authorsposts-loading .b-authorsposts-dummy {\n            display: block;\n            }\n        .b-authorsposts-loading .b-authorsposts-items {\n            visibility: hidden;\n            }\n\n\n\n/* empty */\n.b-authorsposts-empty {\n    display: none;\n    }\n    /* hide */\n    .b-authorsposts-empty .b-authorsposts-head {\n        display: none;\n        }\n    .b-authorsposts-empty .b-authorsposts-body {\n        display: none;\n        }\n\n\n\n@media all and (max-width: 1000px) {\n\n    .b-authorsposts {\n        width: auto;\n        max-width: 650px;\n        }\n        .b-authorsposts-item {\n            display: block;\n            width: auto;\n            margin-bottom: 1.5em;\n            }\n            .b-authorsposts-link {\n                margin-right: 0;\n                }\n\n}\n\n\n\n@media all and (max-width: 800px) {\n\n    .b-authorsposts {\n        width: 300px;\n        }\n}\n\n\n\n@media all and (max-width: 650px) {\n\n    .b-authorsposts {\n        width: auto;\n        max-width: 300px;\n        padding-left: 15px;\n        padding-right: 15px;\n        }\n}\n\n\n');
angular.module('Discovery.Tags', [
  'LJ.Templates',
  'LJ.Api'
])
/**
 * Discovery tags bootstrap. Should be used in conjunction with lj-html directive
 */
.directive('ljDiscoveryTags', ['$compile', function ($compile) {
  var TAGS = [
    'lj-gallery',
    '[lj-memories]',
    '[lj-lazy]',
    '[lj-share]',
    '[lj-cut]',
    '[lj-screenable]',
    '[lj-remove-repost]'
  ];

  return {
    restrict: 'A',
    terminal: true,
    link: function (scope, element) {
      $compile( element.find( TAGS.join(',') ) )(scope);
    }
  };
}])
.directive('ljGallery', ['$templateCache', '$compile',
               function ( $templateCache,   $compile ) {
    return {
      restrict: 'E',
      scope: true,
      link: function (scope, element, attrs) {
        scope.dimensions = {
          maxWidth:  attrs.width + 'px',
          height: attrs.height || 350
        };

        scope.items = element.find('lj-gallery-item').map(function(){
          var image = angular.element(this).find('img'),
              link = angular.element(this).find('a'),
              capture = angular.element(this).find('lj-gallery-item-capture');

          return {
            content: capture.html(),
            src: image.attr('src'),
            href: link.attr('href')
          };
        }).toArray();

        scope.isTall = ( typeof attrs.tall !== 'undefined' );

        scope.next = function () {
          scope.state.index += 1;
        };

        scope.prev = function () {
          scope.state.index -= 1;
        };

        scope.state = {
          index: 0,
          total: scope.items.length - 1
        };

        scope.isNearby = function (index) {
          return Math.abs(scope.state.index - index) <= 1;
        };

        // replace existed content with our template
        element.html(
          $compile( $templateCache.get('ljGallery.ng.tmpl') )(scope)
        );
      }
    };
}])
.directive('ljSuggest', ['Api', function (Api) {
  return {
    templateUrl: 'ljSuggest.ng.tmpl',
    scope: {
      itemId: '@ljSuggest'
    },
    link: function (scope) {
      Api.call('discovery.suggest', { itemid: scope.itemId }, {cache: true})
        .then(function (response) {
          scope.suggest = response.items;
        });
    }
  };
}])
.directive('ljWidgetAuthorsPosts', ['Api', function (Api) {
  return {
    templateUrl: 'posts.ng.tmpl',
    scope: {
      userId: '@ljWidgetAuthorsPosts',
      itemId: '@ljWidgetAuthorsPostsExclude'
    },
    link: function (scope) {
      scope.state = {
        isLoading: true
      };

      Api.call('discovery.author_posts', {
          itemid: scope.itemId,
          userid: scope.userId
        }, {
        cache: true
      }).then(function (response) {
          scope.state.isLoading = false;
          scope.posts = response.items;
        });

    }
  };
}]);
;

/* file-end: js/discovery/directives.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/ljMemories.js 
*/



Site.page.template['angular/memories.ng.tmpl'] = '<div ng-controller=\"MemoriesCtrl\">\n\n    <div\n        class=\"b-addtomemories\"\n        ng-class=\"{ \'b-addtomemories-loading\': loading }\"\n        >\n\n        <!-- head -->\n        <h3\n            class=\"b-addtomemories-head\"\n            lj-ml=\"memories.title\"\n            ></h3>\n\n        <!-- intro -->\n        <p class=\"b-addtomemories-intro\">\n            <span\n                ng-show=\"!security\"\n                lj-ml=\"memories.title.add\"\n                ></span>\n            <span\n                ng-show=\"security\"\n                lj-ml=\"memories.title.edit\"\n                ></span>\n        </p>\n\n        <!-- items -->\n        <ul class=\"b-addtomemories-items\">\n\n            <li class=\"b-addtomemories-item\">\n                <label class=\"b-addtomemories-label\">\n                    <input\n                        type=\"radio\"\n                        name=\"security\"\n                        class=\"b-addtomemories-radio\"\n                        value=\"public\"\n                        ng-model=\"security\"\n                        ng-change=\"update()\"\n                        >\n                    <span\n                        class=\"b-addtomemories-title\"\n                        lj-ml=\"memories.security.public\"\n                        ></span>\n                </label>\n            </li>\n\n            <li class=\"b-addtomemories-item\">\n                <label class=\"b-addtomemories-label\">\n                    <input\n                        type=\"radio\"\n                        name=\"security\"\n                        class=\"b-addtomemories-radio\"\n                        value=\"friends\"\n                        ng-model=\"security\"\n                        ng-change=\"update()\"\n                        >\n                    <span\n                        class=\"b-addtomemories-title\"\n                        lj-ml=\"memories.security.friends\"\n                        ></span>\n                </label>\n            </li>\n\n            <li class=\"b-addtomemories-item\">\n                <label class=\"b-addtomemories-label\">\n                    <input\n                        type=\"radio\"\n                        name=\"security\"\n                        class=\"b-addtomemories-radio\"\n                        value=\"private\"\n                        ng-model=\"security\"\n                        ng-change=\"update()\"\n                        >\n                    <span\n                        class=\"b-addtomemories-title\"\n                        lj-ml=\"memories.security.private\"\n                        ></span>\n                </label>\n            </li>\n\n        </ul><!-- /items -->\n\n        <!-- footer -->\n        <div\n            class=\"b-addtomemories-footer\"\n            ng-show=\"removeButton\"\n            >\n            <button\n                class=\"\n                    b-flatbutton\n                    b-flatbutton-simple\n                    b-flatbutton-red\n                    \"\n                ng-click=\"remove()\"\n                lj-ml=\"memories.remove\"\n                ></button>\n        </div><!-- /footer -->\n\n        <p class=\"b-addtomemories-options\">\n            <a\n                ng-href=\"{{siteroot}}/tools/memadd.bml?journal={{bubble.options.journal}}&amp;itemid={{bubble.options.ditemid}}\"\n                target=\"_blank\"\n                lj-ml=\"memories.options\"\n                ></a>\n        </p>\n\n    </div><!-- /addtomemories -->\n\n</div>\n';
LJ.injectStyle('/* LJSUP-17006: [S1 entry, memories] Popup in S1 entries */\n/* Add to Memories */\n\n.b-addtomemories {\n    width: 150px;\n    margin: 0;\n    padding: 0;\n    text-align: left;\n    }\n    .b-addtomemories-head {\n        margin: 0 0 0.5em;\n        padding: 0;\n        font: bold 1.13em/1.1 Arial,sans-serif;\n        color: #000;\n        }\n    .b-addtomemories-intro {\n        margin: 0 0 0.3em;\n        }\n    .b-addtomemories-items {\n        margin: 0;\n        padding: 0;\n        list-style: none;\n        }\n        .b-addtomemories-item {\n            margin: 0;\n            padding: 0;\n            }\n            .b-addtomemories-label {\n                display: block;\n                margin: 0 -5px;\n                padding: 5px;\n                cursor: pointer;\n                }\n            .b-addtomemories-item:hover .b-addtomemories-label {\n                background: #C8E6FF;\n                }\n    .b-addtomemories-footer {\n        margin: 1em 0;\n        }\n    .b-addtomemories-options {\n        margin: 0.3em -5px 0;\n        padding: 0.3em 5px 0;\n        border-top: 1px solid #DAE3E6;\n        }\n.b-addtomemories-loading {\n    background: url(/img/preloader/preloader-blue-gray.gif?v=16423) no-repeat 50% 50%;\n    }\n    .b-addtomemories-loading .b-addtomemories-head,\n    .b-addtomemories-loading .b-addtomemories-intro,\n    .b-addtomemories-loading .b-addtomemories-items,\n    .b-addtomemories-loading .b-addtomemories-footer,\n    .b-addtomemories-loading .b-addtomemories-options {\n        visibility: hidden;\n        }\n\n');
(function($) {

angular.module('LJ.Memories', ['LJ.Bubble', 'LJ.Api'])

/**
* Directive build memories popup
*
* Usage:
*   <a
*     href="#"
*     lj-memories="{}"
*     >
*   </a>
*
* or
*
*   <a
*     href="#"
*     lj-memories="getOptions(element)"
*     >
*   </a>
*
* @authors
*   Georgii Kats (g.kats@sup.com)
*/
.directive('ljMemories', ['$parse', '$timeout', 'Bubble', function ($parse, $timeout, Bubble) {
  return {
    scope: {
      ljMemories: '&'
    },
    link: function (scope, element) {
      var options;

      function clickHandler (event) {
        event.preventDefault();

        if ( !options ) {
          options = ( typeof scope.ljMemories === 'function' ) ?
                    scope.ljMemories({ element: element }) :
                    scope.ljMemories;
        }

        Bubble.open('memories', options, $(element));
        scope.$apply();
      }

      element.on('click', clickHandler);

      scope.$on('$destroy', function () {
        element.off('click', clickHandler);
      });
    }
  };

}])
.controller('MemoriesCtrl', ['$scope', 'Api',
                    function( $scope ,  Api ) {

  var bubble = $scope.bubble;

  $scope.security = null;

  // bubble size could change because of button, reposition
  $scope.$watch('removeButton', function() {
    $(window).trigger('resize');
  });

  $scope.$on('bubble:open:memories', function() {
    Api.call('memories.get', bubble.options, function(result) {
      $scope.security = result.result ? result.result.security : null;

      $scope.removeButton = Boolean($scope.security);
    });
  });

  $scope.$on('bubble:close:memories', function() {
    $scope.removeButton = false;
  });

  $scope.siteroot = LJ.get('siteroot');

  $scope.update = function() {
    Api.call('memories.set', {
      journal:     bubble.options.journal,
      ditemid:     bubble.options.ditemid,
      description: bubble.options.journal + ': ' + bubble.options.title,

      security:    $scope.security
    }, function(result) {
      $scope.security = result;
      bubble.close();
      $scope.removeButton = true;
    });
  };

  $scope.remove = function() {
    Api.call('memories.remove', {
      journal: bubble.options.journal,
      ditemid: bubble.options.ditemid
    }, function() {
      $scope.security = null;
      bubble.close();
      $scope.removeButton = false;
    });
  };

  LJ.Event.on('api:request:change', function(method, state) {
    if (/^memories/.test(method)) {
      $scope.loading = state;
    }
  });

}]);

})(jQuery);
;

/* file-end: js/core/angular/ljMemories.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/share.js 
*/



/* ---------------------------------------------------------------------------------
   file-start: js/core/string.js 
*/

;(function () {
    'use strict';

    LJ.define('LJ.String');

   /**
     * Add leading zeros to number until it will have correct length
     * @param  {*}      str     Any string or value that will be stringified
     * @param  {Number} length  Needed length
     * @param  {String} symbol  Symbol for padding
     * @return {String}         Padded value
     *
     * @example
     * var padded = LJ.string.pad('hello', 8, ' '); // => '   hello';
     */
    LJ.String.pad = function (str, length, symbol) {
        str = str.toString();

        if (typeof length === 'undefined') {
            throw new Error('You should provide padding string length');
        }

        if (typeof symbol === 'undefined') {
            throw new Error('You should provide padding symbol');
        }

        if (str.length >= length) {
            return str;
        }

        while (str.length < length) {
            str = symbol + str;
        }

        return str.length === length ? str : str.slice(-length);
    };

    /**
     * Capitalize string
     * @param  {String} str String to be capitalized
     * @return {String}     Capitalized string
     *
     * @example
     * LJ.String.capitalize('HELLO'); // => "Hello"
     */
    LJ.String.capitalize = function (str) {
        var length;

        if (typeof str !== 'string') {
            throw new Error('You should provide string as argument');
        }

        length = str.length;

        if (length === 0) {
            return str;
        } else if (length === 1) {
            return str.toUpperCase();
        } else {
            return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
        }
    };

    /**
     * Add http:// if not present
     * @param  {String} str Input string
     *
     * @return {String}     Link with default protocol (http://) if needed
     */
    LJ.String.linkify = function(str) {
        var rxLink = new RegExp('^(?:([a-zA-Z]+):)?//'),
            alternative = /^[a-zA-Z]+:/, // mailto:
            rxEmptyProtocol = /^:\/\//;  // ://yandex.ru

        var defaultProtocol = alternative.test(str) ? '' : 'http://';

        return rxLink.test(str) ?
            str :
            defaultProtocol + (rxEmptyProtocol.test(str) ? str.replace('://', '') : str);
    };

    /**
     * Split by char(s), trim all values, remove empty elements
     *
     * @param  {String} str       String to split
     * @param  {String} separator Separator to use for splitting
     * @return {Array}            Array of splitted values
     */
    LJ.String.smartSplit = function(str, separator) {
        if (typeof separator === 'undefined') {
            separator = ',';
        }

        return str.split(separator).map(function(item) {
            return item.trim();
        }).filter(Boolean);
    };

    LJ.String.encodeHTML = function(str) {
        var encodeMap = {
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            '\'': '&apos;'
        };

        return str.replace(/([<>&\"\'])/g, function(m, c) {
            return encodeMap[c] ? encodeMap[c] : c;
        });
    };
}());
;

/* file-end: js/core/string.js 
----------------------------------------------------------------------------------*/

Site.page.template['angular/share.ng.tmpl'] = '<p\n    class=\"b-sharethis-head\"\n    lj-ml=\"sharing.popup.title\"\n    ></p>\n\n<ul\n    ng-controller=\"ShareBubbleCtrl as share\"\n    class=\"\n        b-sharethis-services\n        b-sharethis-services-v3\n        \"\n    >\n    <li\n        ng-repeat=\"service in share.services\"\n        class=\"\n            b-sharethis-services-item\n            b-sharethis-{{ service.name }}\n            \"\n        >\n        <a\n            target=\"_blank\"\n            class=\"b-sharethis-services-link\"\n            ng-click=\"share.openPopup($event, service.name, bubble.options.params);\"\n            ng-href=\"{{ service.link }}\"\n            ng-bind=\"service.title\"\n            ></a>\n    </li>\n</ul>\n';
//= require_ml sharing.popup.title

;(function () {
  'use strict';

/**
 * Options:
 *   [lj-share-scrollable] - position of bubble will be recalculated on scroll if provided.
 *                           It's actual bubble setting - `recalculateOnScroll`
 *   [lj-share-services] - services to show. If not provided - services from server config will be shown
 *   [lj-share-services-exclude] - exclude services from bubble
 *
 *
 * @example
 *   <a
 *     href="javascript:void(0)"
 *     lj-share="{
 *       url: item.url,
 *       title: item.subject,
 *       text: item.lead,
 *       hashtags: item.hashtags
 *     }"
 *     lj-share-services-exclude="'facebook,twitter,google'"
 *     lj-share-scrollable
 *   >Share me</a>
 */

angular.module('LJ.Share', [
  'LJ.Directives',
  'LJ.Templates',
  'LJ.Bubble'
  ])
  .directive('ljShare', ['Bubble', function (Bubble) {
    return {
      restrict: 'A',
      scope: true,
      link: function ($scope, element, $attrs) {
        var params = $scope.$eval( $attrs.ljShare );

        // string with comma separated services to show in the bubble
        var services = $scope.$eval( $attrs.ljShareServices );

        // string with comma separated services to exclude from bubble
        var exclude  = $scope.$eval( $attrs.ljShareServicesExclude );

        services = services ? LJ.String.smartSplit( services ) : LJ.Social.Share.services();
        exclude = exclude ? LJ.String.smartSplit( exclude ) : [];

        if ( exclude.length ) {
          services = services.filter(function (service) {
            return exclude.indexOf(service) === -1;
          });
        }

        function share() {
          Bubble.open('share', {
            params:   params,
            services: services
          }, element);
          $scope.$apply();
        }

        // no services to show - do nothing
        if ( !services.length ) {
          return;
        }

        var unregisterBubble = Bubble.register({
          name: 'share',
          template: 'share.ng.tmpl',
          recalculateOnScroll: $attrs.hasOwnProperty('ljShareScrollable')
        });

        element.on('click', share);
        $scope.$on('$destroy', function () {
          element.off('click', share);
          unregisterBubble();
        });
      }
    };
  }])

  .controller('ShareBubbleCtrl', ['$scope', 'Bubble', function ($scope, Bubble) {
    var that = this;

    $scope.$on('bubble:open:share', function() {
      that.services = $scope.bubble.options.services.map(function(service) {
        return {
          name:  service,
          link:  LJ.Social.Share.getUrl(service, $scope.bubble.options.params),
          title: LJ.Social.Share.getTitle(service)
        };
      });
    });

    that.openPopup = function(event, service, params) {
      if ( LJ.Social.Share.isTab(service) ) {
        Bubble.close('share');
        return;
      }

      event.preventDefault();
      LJ.Social.Share.openPopup(service, params);
      Bubble.close('share');
    };

  }]);
}());
;

/* file-end: js/core/angular/share.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/ljRemoveRepost.js 
*/



Site.page.template['angular/ljRemoveRepost.ng.tmpl'] = '<div ng-controller=\"RemoveRepostCtrl as remove\">\n\n    <div\n        class=\"b-removerepost\"\n        ng-class=\"{ \'b-removerepost-loading\': loading }\"\n        >\n        <!-- intro -->\n        <p class=\"b-removerepost-intro\">\n            <span\n                lj-ml=\"repost.confirm.delete\"\n                ></span>\n        </p>\n\n        <!-- footer -->\n         <div\n            class=\"b-removerepost-footer\"\n            >\n            <div class=\"b-popup-submit-options\">\n                <span class=\"b-popup-preloader\">\n                    <span\n                        class=\"b-popup-preloader-inner\"\n                        >\n                        <button\n                            class=\"\n                                b-flatbutton\n                                b-flatbutton-simple\n                                \"\n                            type=\"button\"\n                            ng-click=\"remove.submit()\"\n                            lj-ml=\"confirm.bubble.yes\"\n                            ></button>\n                        <i class=\"preloader\"></i>\n                    </span>\n                    <button\n                        href=\"\"\n                        class=\"\n                            b-flatbutton\n                            b-flatbutton-simple\n                            b-flatbutton-neutral\n                            \"\n                        ng-click=\"remove.cancel()\"\n                        lj-ml=\"confirm.bubble.no\"\n                        ></button>\n                </span>\n            </div>\n        </div>\n    </div>\n</div>\n';
//= require_ml repost.confirm.delete
//= require_ml confirm.bubble.yes
//= require_ml confirm.bubble.no

LJ.injectStyle('.b-removerepost {\n    width: 200px;\n    margin: 0;\n    padding: 0;\n    text-align: left;\n    }\n    .b-removerepost-head {\n        margin: 0 0 0.5em;\n        padding: 0;\n        font: bold 1.13em/1.1 Arial,sans-serif;\n        color: #000;\n        }\n    .b-removerepost-intro {\n        margin: 0 0 0.3em;\n        }\n    .b-removerepost-footer {\n        margin: 1em 0 0;\n        }\n.b-removerepost-loading {\n    background: url(/img/preloader/preloader-blue-gray.gif?v=16423) no-repeat 50% 50%;\n    }\n    .b-removerepost-loading .b-removerepost-head,\n    .b-removerepost-loading .b-removerepost-intro,\n    .b-removerepost-loading .b-removerepost-footer {\n        visibility: hidden;\n        }\n\n');
;(function () {
  'use strict';

  angular.module('LJ.RemoveRepost', ['LJ.Bubble', 'LJ.Api'])

  .run(['Bubble', function (Bubble) {
    Bubble.register({
      name: 'removeRepost',
      template: 'ljRemoveRepost.ng.tmpl',
      recalculateOnScroll: true,
      alwaysBottom: true
    });
  }])

  /**
  * Directive build memories popup
  *
  * Usage:
  *   <button
  *     lj-remove-post="post"
  *     >
  *   </button>
  *
  * @authors
  *   Georgii Kats (g.kats@sup.com)
  */
  .directive('ljRemoveRepost', ['Api', 'Bubble', function (Api, Bubble) {
    return {
      scope: {
        post: '=ljRemoveRepost'
      },
      link: function ($scope, $element) {
        function onClick (event) {
          event.preventDefault();

          Bubble.open('removeRepost', { post: $scope.post }, $element);
          $scope.$apply();
        }

        $element.on('click', onClick);

        $scope.$on('$destroy', function () {
          $element.off('click', onClick);
        });
      }
    };
  }])
  .controller('RemoveRepostCtrl', ['$scope', '$rootScope', 'Api', function ($scope, $rootScope, Api) {
    var bubble = $scope.bubble;
    var post;

    $scope.$on('bubble:open:removeRepost', function (event, name, params) {
      post = params.post;
    });

    this.submit = function () {
      Api.call('repost.delete', { url: post.permalink_url }).then(function () {
        $rootScope.$emit('feed:item:remove', post.itemid);
        bubble.close();
      });
    };

    this.cancel = function () {
      bubble.close();
    };
  }]);

})(jQuery);
;

/* file-end: js/core/angular/ljRemoveRepost.js 
----------------------------------------------------------------------------------*/

;(function ($) {
    'use strict';

    angular.module('S2Layout', ['Discovery.Tags', 'LJ.Memories', 'LJ.Share', 'LJ.RemoveRepost'])
      .value('$anchorScroll', null)
      // HTML5 mode is on to keep anchor links working
      // by LJSV-2932
      .run(function () {

        // fix html5mode anchor scrolling on page load
        $('a:not([target])').attr('target', '_self');
      })
      .config([ '$locationProvider',
        function($locationProvider) {

          // Fix IE redirect to the main page: angular redirects us on base url /
          if ( !LJ.Support.history && angular.element('base').length === 0 ) {
              angular.element('<base />')
                .attr('href', location.href)
                .appendTo('head');
          } else {
              $locationProvider.html5Mode(true);
          }
      }]);

    LJ.Event.on('page_load', function() {
        var sidebarCalendar = $('.sidebar-cal');

        /* Nothing to do if widget was not loaded */
        if ( !$.fn.hasOwnProperty('inlineCalendar') ) {
            return;
        }

        // inline calendar could not be available for the style
        sidebarCalendar
            .inlineCalendar( {
                selectors: {
                    month: '.sbar-cal-nav-month',
                    year:  '.sbar-cal-nav-year',

                    prevMonth: '.sbar-cal-nav-month .sbar-cal-nav-prev',
                    nextMonth: '.sbar-cal-nav-month .sbar-cal-nav-next',
                    prevYear:  '.sbar-cal-nav-year .sbar-cal-nav-prev',
                    nextYear:  '.sbar-cal-nav-year .sbar-cal-nav-next',

                    monthLabel: '.sbar-cal-nav-month .sbar-cal-month',
                    yearLabel: '.sbar-cal-nav-year .sbar-cal-year'
                },
                classNames: {
                    current  : 'today',
                    nextDisabled : 'disabled',
                    prevDisabled : 'disabled'
                },
                dayRef: LJ.get('currentJournalBase') + '/%Y/%M/%D',
                monthRef: LJ.get('currentJournalBase') + '/%Y/%M',
                yearRef: LJ.get('currentJournalBase') + '/%Y',
                endMonth: new Date(),
                startAtSunday: true
            }).on('daySelected', function (event) {
                event.preventDefault();
            });

        // calendar events should be available
        if ( $.fn.hasOwnProperty('calendarEvents') ) {
            sidebarCalendar.calendarEvents({
                calendarType: 'inlineCalendar'
            });
        }
    });

    LJ.Event.on('page_load', function () {
        var className = 'hover',
            tabElements = $('.sidebar dl'),
            tabHeaders = $('.sidebar dt'),
            preventClose = false;

        if ($('.sidebar-friendstimes').length === 0) { return; }

        if (LJ.Support.touch) {
            tabHeaders.on('touchstart', function () {
                $(this).parent()
                    .toggleClass(className)
                    .siblings()
                    .removeClass(className);
            });
            tabElements.on('touchstart', function () {
                preventClose = true;
            });
            $(document).on('touchstart', function () {
                if (preventClose) {
                    preventClose = false;
                } else {
                    tabElements.removeClass(className);
                }
            });
        } else {
            tabElements.on({
                mouseenter: function () {
                    $(this).addClass('hover');
                },

                mouseleave: function () {
                    $(this).removeClass('hover');
                }
            });
        }
    });

    // S2 comments
    LJ.Event.on('page_load', function () {
        if (LJ.get('LJ_cmtinfo')) {
            window.LJ_cmtinfo = LJ.get('LJ_cmtinfo');
        }

        if ($.fn.subjecticons) {
            $('.b-subjecticons').subjecticons();
        }

        if ($.fn.commentator && $.fn.authtype && $.fn.quotescreator) {
            $('#postform-wrapper')
                .commentator({
                    publicKey: LJ.get('captcha_public'),
                    captchaContainerId: 'captcha-container'
                })
                .authtype({
                    forceStartupCaptcha: !!(Number(LJ.get('need_captcha'))),
                    selectors: {
                        authTypeRadios: '.b-postform-login-{authType} .b-postform-login-radio'
                    }
                })
                .quotescreator();
        }

        if ($.fn.placeholder) {
            $('#cookieusername').placeholder();
        }

        // Scroll to top
        $(document.body).on('click', '[data-s2-helper-scrollTop]', function(event) {
            event.preventDefault();
            $('body,html').animate({ scrollTop: 0 }, 500);
        });
    });

    $(function () {
        // Switch to new feed version on /friends
        // Notice: code below is only needed for old friends feed that
        // relies on S2 and hasn't it's own JS file
        $('body').on('click', '.b-lenta-msg-close', function (e) {
            e.preventDefault();

            LJ.Api.call('friendsfeed.close_friendsfeed_line', {}, function () {
              $('.b-lenta-msg').remove();
              $('body').addClass('b-lenta-msg-hidden');
            });
        });
    });
}(jQuery));
;

/* file-end: js/s2.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/esn.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/lj_ippu.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/deprecated/dom.js 
*/

/**
 * All deprecated manipulations with the DOM will be here
 */

// handy utilities to create elements with just text in them
function _textSpan() {
    return _textElements('span', arguments);
}
function _textDiv() {
    return _textElements('div', arguments);
}

function _textElements(eleType, txts) {
    var ele = [];
    for (var i = 0; i < txts.length; i++) {
        var node = document.createElement(eleType);
        node.innerHTML = txts[i];
        ele.push(node);
    }

    return ele.length == 1 ? ele[0] : ele;
}
;

/* file-end: js/deprecated/dom.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/ippu.js 
*/

function changeOpac(a,b){var c=$(a);if(c&&c.style){var d=c.style;d&&(IPPU.isSafari()&&b>=100&&(b=99.99),d.filters&&(d.filters.alpha.opacity=100*b),d.opacity=b)}}IPPU=new Class(Object,{setFixedPosition:function(a){IPPU.isIE()||(this.fixedPosition=a,this.updateContent())},clickHandler:function(a){if(this.clickToClose&&this.visible()){a=Event.prep(a);var b=a.target;DOM.getAncestorsByClassName(b,"ippu",!0).length>0||this.cancel()}},setCancelledCallback:function(a){this.cancelledCallback=a},cancel:function(){this.cancelledCallback&&this.cancelledCallback(),this.hide()},setHiddenCallback:function(a){this.hiddenCallback=a},setupClickCapture:function(){if(this.visible()&&!this.clickHandlerSetup&&(this.clickToClose||this.modal)){if(this.clickHandlerFunc=this.clickHandler.bindEventListener(this),this.modal){if(this.overlay)return;this.overlay=document.createElement("div"),this.overlay.style.left="0px",this.overlay.style.top="0px",this.overlay.style.margin="0px",this.overlay.style.padding="0px",this.overlay.style.backgroundColor="#000000",this.overlay.style.zIndex="900",IPPU.isIE()?(this.overlay.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=50)",this.overlay.style.position="absolute",this.overlay.style.width=document.body.scrollWidth,this.overlay.style.height=document.body.scrollHeight):this.overlay.style.position="fixed",this.ele.parentNode.insertBefore(this.overlay,this.ele),this.updateOverlay(),DOM.addEventListener(this.overlay,"click",this.clickHandlerFunc)}else DOM.addEventListener(document,"click",this.clickHandlerFunc);this.clickHandlerSetup=!0}},updateOverlay:function(){if(this.overlay){var a=DOM.getClientDimensions();this.overlay.style.width=a.x-1+"px",IPPU.isIE()||(this.overlay.style.height=a.y-1+"px"),this.visibleOverlay?(this.overlay.backgroundColor="#000000",changeOpac(this.overlay,.5)):(this.overlay.backgroundColor="#FFFFFF",changeOpac(this.overlay,0))}},resizeHandler:function(){this.updateContent()},removeClickHandlers:function(){if(this.clickHandlerSetup){DOM.removeEventListener(document,"click",this.clickHandlerFunc,!1),this.overlay&&(DOM.removeEventListener(this.overlay,"click",this.clickHandlerFunc,!0),this.overlay.parentNode.removeChild(this.overlay),this.overlay=void 0),this.clickHandlerFunc=void 0,this.clickHandlerSetup=!1}},setClickToClose:function(a){if(this.clickToClose=a,!this.clickHandlerSetup&&a&&this.visible()){var b=this.setupClickCapture.bind(this);window.setTimeout(b,100)}else!a&&this.clickHandlerSetup&&this.removeClickHandlers();this.updateContent()},setModal:function(a){var b=this.modal==a;a&&this.setClickToClose(!1),this.modal=a,b&&(this.removeClickHandlers(),this.updateContent())},setOverlayVisible:function(a){this.visibleOverlay=a,this.updateContent()},updateContent:function(){this.autoCenter(),this.updateTitlebar(),this.updateOverlay(),this.titlebar&&this.setTitlebarClass(this.titlebar.className);var a=this.setupClickCapture.bind(this);window.setTimeout(a,100),this.fixedPosition&&"fixed"!=this.ele.style.position?this.ele.style.position="fixed":this.fixedPosition||"fixed"!=this.ele.style.position||(this.ele.style.position="absolute")},getTitlebarElement:function(){return this.titlebar},setTitlebarClass:function(a){this.titlebar&&(this.titlebar.className=a)},setOverflow:function(a){this.ele&&(this.ele.style.overflow=a)},visible:function(){return this.shown},setTitlebar:function(a){if(this.showTitlebar=a,a){if(!this.titlebar){var b=document.createElement("div");if(!b)return;b.style.width="100%",this.title&&(b.innerHTML=this.title),this.ele.insertBefore(b,this.content),this.titlebar=b}}else this.titlebar&&(this.ele.removeChild(this.titlebar),this.titlebar=!1)},setTitle:function(a){this.title=a,this.updateTitlebar()},updateTitlebar:function(){this.showTitlebar&&this.titlebar&&this.title!=this.titlebar.innerHTML&&(this.titlebar.innerHTML=this.title)},addClass:function(a){DOM.addClassName(this.ele,a)},removeClass:function(a){DOM.removeClassName(this.ele,a)},setAutoCenterCallback:function(a){this.autoCenterCallback=a},autoCenter:function(){if(this.visible&&this.visible()){if(this.autoCenterCallback)return void this.autoCenterCallback(this);this.autoCenterX&&this.centerX(),this.autoCenterY&&this.centerY()}},center:function(){this.centerX(),this.centerY()},centerOnWidget:function(a,b,c){b=b||0,c=c||0,this.setAutoCenter(!1,!1),this.setAutoCenterCallback(null);var d=DOM.getAbsoluteDimensions(a),e=DOM.getAbsoluteDimensions(this.ele),f=d.absoluteRight-d.offsetWidth/2-e.offsetWidth/2+c,g=d.absoluteBottom-d.offsetHeight/2-e.offsetHeight/2+b;f=0>f?0:f,g=0>g?0:g,DOM.setLeft(this.ele,f),DOM.setTop(this.ele,g)},centerX:function(){if(this.visible&&this.visible()){var a=DOM.getClientDimensions(),b=a.x/2-this.ele.offsetWidth/2;if(!this.fixedPosition){var c=DOM.getWindowScroll();b+=c.left}DOM.setLeft(this.ele,b)}},centerY:function(){if(this.visible&&this.visible()){var a=DOM.getClientDimensions(),b=a.y/2-this.ele.offsetHeight/2;if(!this.fixedPosition){var c=DOM.getWindowScroll();b+=c.top}DOM.setTop(this.ele,b)}},setAutoCenter:function(a,b){return this.autoCenterX=a||!1,this.autoCenterY=b||!1,a||b?void this.autoCenter():void this.setAutoCenterCallback(null)},setDimensions:function(a,b){a+="",b+="",a.match(/^\d+$/)&&(a+="px"),b.match(/^\d+$/)&&(b+="px"),this.ele.style.width=a,this.ele.style.height=b},moveForward:function(a){a||(a=1),this.ele&&(this.ele.style.zIndex+=a)},moveBackward:function(a){a||(a=1),this.ele&&(this.ele.style.zIndex-=a)},setLocation:function(a,b){this.setLeft(a),this.setTop(b)},setTop:function(a){"string"!=typeof a&&(a+="px"),this.ele.style.top=a},setLeft:function(a){"string"!=typeof a&&(a+="px"),this.ele.style.left=a},getElement:function(){return this.ele},setContent:function(a){this.content.innerHTML=a},setContentElement:function(a){for(;this.content.firstChild;)this.content.removeChild(this.content.firstChild);this.content.appendChild(a)},setFadeIn:function(a){this.fadeIn=a},setFadeOut:function(a){this.fadeOut=a},setFadeSpeed:function(a){this.fadeSpeed=a},show:function(){if(this.shown=!0,this.fadeIn){var a=.01;changeOpac(this.ele,a)}document.body.appendChild(this.ele),this.ele.style.position="absolute",(this.autoCenterX||this.autoCenterY)&&this.center(),this.updateContent(),this.resizeHandlerFunc||(this.resizeHandlerFunc=this.resizeHandler.bindEventListener(this),DOM.addEventListener(window,"resize",this.resizeHandlerFunc,!1)),this.fadeIn&&this.fade("in"),this.hideSelects()},fade:function(a,b){var c,d,e=10;"in"==a?(d=1/e,c=.1):(c=this.ele.style.opacity?finiteFloat(this.ele.style.opacity):.99,d=-1/e);var f=this.fadeSpeed;f||(f=1);var g=e/f*5;this.fadeMode=a;var h=this,i=function(){return c+=d,h.fadeMode&&h.fadeMode!=a?void(b&&b.call(h,[])):.1>=c?(b&&b.call(h,[]),void(h.fadeMode=null)):c>=1?(b&&b.call(h,[]),void(h.fadeMode=null)):(changeOpac(h.ele,c),void window.setTimeout(i,g))};i()},hide:function(){this.visible()&&(this.fadeOut&&this.ele?this.fade("out",this._hide.bind(this)):this._hide())},_hide:function(){this.hiddenCallback&&this.hiddenCallback(),this.shown=!1,this.removeClickHandlers(),this.ele&&document.body.removeChild(this.ele),this.resizeHandlerFunc&&DOM.removeEventListener(window,"resize",this.resizeHandlerFunc),this.showSelects()},setAutoHideSelects:function(a){this.autoHideSelects=a,this.updateContent()},hideSelects:function(){if(this.autoHideSelects&&IPPU.isIE())for(var a,b=document.getElementsByTagName("select"),c=0;c<b.length;c++)a=b[c],a&&(DOM.getAncestorsByClassName(a,"ippu",!0).length>0||"hidden"!=a.style.visibility&&(a.style.visibility="hidden",this.hiddenSelects.push(a)))},showSelects:function(){if(this.autoHideSelects)for(var a;a=this.hiddenSelects.pop();)a.style.visibility=""},init:function(a){var b=document.createElement("div");this.ele=b,this.shown=!1,this.autoCenterX=!1,this.autoCenterY=!1,this.titlebar=null,this.title="",this.showTitlebar=!1,this.clickToClose=!1,this.modal=!1,this.clickHandlerSetup=!1,this.docOverlay=!1,this.visibleOverlay=!1,this.clickHandlerFunc=!1,this.resizeHandlerFunc=!1,this.fixedPosition=!1,this.autoCenterCallback=null,this.cancelledCallback=null,this.autoHideSelects=!1,this.hiddenCallback=null,this.fadeOut=!1,this.fadeIn=!1,this.hiddenSelects=[],this.fadeMode=null,b.style.position="absolute",b.style.top=0,b.style.zIndex="1000",DOM.addClassName(b,"ippu"),this.content=document.createElement("div"),this.content.innerHTML=a,this.ele.appendChild(this.content)}}),IPPU.center=function(a){a.centerX(),a.centerY()},IPPU.centerX=function(a){a.centerX()},IPPU.centerY=function(a){a.centerY()},IPPU.isIE=function(){var a=navigator.userAgent.toLowerCase();return-1!=a.indexOf("msie")?!0:!1},IPPU.isSafari=function(){var a=navigator.userAgent.toLowerCase();return-1!=a.indexOf("safari")?!0:!1};;

/* file-end: js/ippu.js 
----------------------------------------------------------------------------------*/

LJ_IPPU = new Class ( IPPU, {
  init: function(title) {
    if (!title)
      title = "";

    LJ_IPPU.superClass.init.apply(this, []);

    this.uniqId = this.generateUniqId();
    this.cancelThisFunc = this.cancel.bind(this);

    this.setTitle(title);
    this.setTitlebar(true);
    this.setTitlebarClass("lj_ippu_titlebar");

    this.addClass("lj_ippu");
    this.setAutoCenterCallback(IPPU.center);
    this.setDimensions(514, "auto");
    //this.setOverflow("hidden");

    this.setFixedPosition(true);
    this.setClickToClose(true);
    this.setAutoHideSelects(true);
 },

  setTitle: function (title) {
    var titlebarContent = "\
      <div style='float:right; padding-right: 8px'>" +
      "<img src='" + Site.imgprefix + "/CloseButton.gif?v=7618' width='15' height='15' id='" + this.uniqId + "_cancel' /></div>" + title;

    LJ_IPPU.superClass.setTitle.apply(this, [titlebarContent]);
  },

  generateUniqId: function() {
    var theDate = new Date();
    return "lj_ippu_" + theDate.getHours() + theDate.getMinutes() + theDate.getMilliseconds();
  },

  show: function() {
    LJ_IPPU.superClass.show.apply(this);
    var setupCallback = this.setup_lj_ippu.bind(this);
    this.timerSetup = window.setTimeout(setupCallback, 300);
  },

  setup_lj_ippu: function (evt) {
    var cancelCallback = this.cancelThisFunc;
   $(this.uniqId + "_cancel").onclick = function(){
	    cancelCallback();
    };
  },

  hide: function() {
    clearInterval(this.timerSetup);
    LJ_IPPU.superClass.hide.apply(this);
  }
} );

// Class method to show a popup to show a note to the user
// note = message to show
// underele = element to display the note underneath
LJ_IPPU.showNote = function (note, underele, timeout, style) {
    var noteElement = document.createElement("div");
    noteElement.innerHTML = note;

    return LJ_IPPU.showNoteElement(noteElement, underele, timeout, style);
};

LJ_IPPU.showErrorNote = function (note, underele, timeout) {
    return LJ_IPPU.showNote(note, underele, timeout, "ErrorNote");
};

LJ_IPPU.showNoteElement = function (noteEle, underele, timeout, style) {
    var notePopup = new IPPU();
    notePopup.init();

    var inner = document.createElement("div");
    DOM.addClassName(inner, "Inner");
    inner.appendChild(noteEle);
    notePopup.setContentElement(inner);

    notePopup.setTitlebar(false);
    notePopup.setFadeIn(true);
    notePopup.setFadeOut(true);
    notePopup.setFadeSpeed(4);
    notePopup.setDimensions("auto", "auto");
    if (!style) style = "Note";
    notePopup.addClass(style);

    var dim;
    if (underele) {
        // pop up the box right under the element
        dim = DOM.getAbsoluteDimensions(underele);
        if (!dim) return;
    }

    var bounds = DOM.getClientDimensions();
    if (!bounds) return;

    if (!dim) {
        // no element specified to pop up on, show in the middle
        // notePopup.setModal(true);
        // notePopup.setOverlayVisible(true);
        notePopup.setAutoCenter(true, true);
        notePopup.show();
    } else {
        // default is to auto-center, don't want that
        notePopup.setAutoCenter(false, false);
        notePopup.setLocation(dim.absoluteLeft, dim.absoluteBottom + 4);
        notePopup.show();

        var popupBounds = DOM.getAbsoluteDimensions(notePopup.getElement());
        if (popupBounds.absoluteRight > bounds.x) {
            notePopup.setLocation(bounds.x - popupBounds.offsetWidth - 30, dim.absoluteBottom + 4);
        }
    }

    notePopup.setClickToClose(true);
    notePopup.moveForward();

    if (timeout === undefined) {
        timeout = 5000;
    }

    if (timeout) {
        window.setTimeout(function () {
            if (notePopup)
                notePopup.hide();
        }, timeout);
    }

    return notePopup;
};

LJ_IPPU.textPrompt = function (title, prompt, callback, options) {
		options = options || {};

    title += '';
    var notePopup = new LJ_IPPU(title);

    var inner = document.createElement("div");
    DOM.addClassName(inner, "ljippu_textprompt");

    // label
    if (prompt)
        inner.appendChild(_textDiv(prompt));

    // text field
    var field = document.createElement("textarea");
    DOM.addClassName(field, "htmlfield");
    field.cols = 40;
    field.rows = 5;
    inner.appendChild(field);

    // submit btn
    var btncont = document.createElement("div");
    DOM.addClassName(btncont, "submitbtncontainer");
    var btn = document.createElement("input");
    DOM.addClassName(btn, "submitbtn");
    btn.type = "button";
    btn.value = "Insert";
    btncont.appendChild(btn);
    inner.appendChild(btncont);

    notePopup.setContentElement(inner);

    notePopup.setAutoCenter(true, true);
    notePopup.setDimensions(options.width || "60%", "auto");
    notePopup.show();
    field.focus();

    DOM.addEventListener(btn, "click", function (e) {
        notePopup.hide();
        if (callback)
            callback.apply(null, [field.value]);
    });
}
;

/* file-end: js/lj_ippu.js 
----------------------------------------------------------------------------------*/


var ESN = {};
(function ($, ESN) {
    // When page loads, set up "check all" checkboxes
    ESN.initCheckAllBtns = function () {
      var ntids  = $("ntypeids");
      var catids = $("catids");

      if (!ntids || !catids)
        return;

      ntidList  = ntids.value;
      catidList = catids.value;

      if (!ntidList || !catidList)
        return;

      ntids  = ntidList.split(",");
      catids = catidList.split(",");

      catids.forEach( function (catid) {
        ntids.forEach( function (ntypeid) {
          var className = "SubscribeCheckbox-" + catid + "-" + ntypeid;

          var cab = new CheckallButton();
          cab.init({
            "class": className,
              "button": $("CheckAll-" + catid + "-" + ntypeid),
              "parent": $("CategoryRow-" + catid)
              });
        });
      });
    }

    // attach event handlers to all track buttons
    ESN.initTrackBtns = function (node) {

        // don't do anything if no remote
        if ( !LJ.get('remote') ) {
            return;
        }

        node = node || document;
        var trackBtns = DOM.getElementsByTagAndClassName(node, 'img', 'TrackButton');

        trackBtns.forEach(function (trackBtn) {
            if (!trackBtn || !trackBtn.getAttribute) return;

            if (!trackBtn.getAttribute("lj_subid") && !trackBtn.getAttribute("lj_journalid")) return;
            if (trackBtn.getAttribute("lj_dtalkid") && !LJ.get('remote_can_track_threads') ) return;

            DOM.addEventListener(trackBtn, 'click', ESN.trackBtnClickHandler.bindEventListener(trackBtn));
        });
    };

    ESN.trackBtnClickHandler = function (evt) {
        var trackBtn = evt.target;
        if (! trackBtn || trackBtn.tagName.toLowerCase() != "img") return true;

        Event.stop(evt);

        var btnInfo = {};

        ['arg1', 'arg2', 'etypeid', 'newentry_etypeid', 'newentry_token', 'newentry_subid',
         'journalid', 'subid', 'auth_token'].forEach(function (arg) {
            btnInfo[arg] = trackBtn.getAttribute("lj_" + arg);
        });

        // pop up little dialog to either track by inbox/email or go to more options
        var dlg = document.createElement("div");
        var title = _textDiv("Email me when");
        DOM.addClassName(title, "track_title");
        dlg.appendChild(title);

        var TrackCheckbox = function (title, checked) {
            var checkContainer = document.createElement("div");

            var newCheckbox = document.createElement("input");
            newCheckbox.type = "checkbox";
            newCheckbox.id = "newentrytrack" + Unique.id();
            var newCheckboxLabel = document.createElement("label");
            newCheckboxLabel.setAttribute("for", newCheckbox.id);
            newCheckboxLabel.innerHTML = title;

            checkContainer.appendChild(newCheckbox);
            checkContainer.appendChild(newCheckboxLabel);
            dlg.appendChild(checkContainer);

            newCheckbox.checked = checked ? true : false;

            return newCheckbox;
        };

        // global trackPopup so we can only have one
        if (ESN.trackPopup) {
            ESN.trackPopup.hide();
            ESN.trackPopup = null;
        }

        var saveChangesBtn = document.createElement("input");
        saveChangesBtn.type = "button";
        saveChangesBtn.value = "Save Changes";
        DOM.addClassName(saveChangesBtn, "track_savechanges");

        var trackingNewEntries  = Number(btnInfo['newentry_subid']) ? 1 : 0;
        var trackingNewComments = Number(btnInfo['subid']) ? 1 : 0;

        var newEntryTrackBtn;
        var commentsTrackBtn;

        if (trackBtn.getAttribute("lj_dtalkid")) {
            // this is a thread tracking button
            // always checked: either because they're subscribed, or because
            // they're going to subscribe.
            commentsTrackBtn = TrackCheckbox("someone replies in this comment thread", 1);
        } else {
            // entry tracking button
            newEntryTrackBtn = TrackCheckbox(trackBtn.getAttribute('lj_username') + ' posts a new entry', trackingNewEntries);
            commentsTrackBtn = TrackCheckbox("someone comments on this post", trackingNewComments);
        }

        DOM.addEventListener(saveChangesBtn, "click", function () {
            ESN.toggleSubscriptions(btnInfo, evt, trackBtn, {
                newEntry: newEntryTrackBtn ? newEntryTrackBtn.checked : false,
                newComments: commentsTrackBtn.checked
            });
            if (ESN.trackPopup) ESN.trackPopup.hide();
        });

        var btnsContainer = document.createElement("div");
        DOM.addClassName(btnsContainer, "track_btncontainer");
        dlg.appendChild(btnsContainer);

        btnsContainer.appendChild(saveChangesBtn);

        var custTrackLink = document.createElement("a");
        custTrackLink.href = trackBtn.parentNode.href;
        btnsContainer.appendChild(custTrackLink);
        custTrackLink.innerHTML = "More Options";
        DOM.addClassName(custTrackLink, "track_moreopts");

        ESN.trackPopup = new LJ_IPPU.showNoteElement(dlg, trackBtn, 0);

        DOM.addEventListener(custTrackLink, "click", function (evt) {
            Event.stop(evt);
            document.location.href = trackBtn.parentNode.href;
            if (ESN.trackPopup) ESN.trackPopup.hide();
            return false;
        });

        return false;
    }

    // toggles subscriptions
    ESN.toggleSubscriptions = function (subInfo, evt, btn, subs) {
        subInfo["subid"] = Number(subInfo["subid"]);
        if ((subInfo["subid"] && ! subs["newComments"])
            || (! subInfo["subid"] && subs["newComments"])) {
            ESN.toggleSubscription(subInfo, evt, btn, "newComments");
        }

        subInfo["newentry_subid"] = Number(subInfo["newentry_subid"]);
        if ((subInfo["newentry_subid"] && ! subs["newEntry"])
            || (! subInfo["newentry_subid"] && subs["newEntry"])) {
                var newentrySubInfo = new Object(subInfo);
                newentrySubInfo["subid"] = Number(btn.getAttribute("lj_newentry_subid"));
                ESN.toggleSubscription(newentrySubInfo, evt, btn, "newEntry");
        }
    };

    // (Un)subscribes to an event
    ESN.toggleSubscription = function (subInfo, evt, btn, sub) {
        var action = "";
        var params = {
            auth_token: sub == "newEntry" ? subInfo.newentry_token : subInfo.auth_token
        };

        if (Number(subInfo.subid)) {
            // subscription exists
            action = "delsub";
            params.subid = subInfo.subid;
        } else {
            // create a new subscription
            action = "addsub";

            var param_keys;
            if (sub == "newEntry") {
                params.etypeid = subInfo.newentry_etypeid;
                param_keys = ["journalid"];
            } else {
                param_keys = ["journalid", "arg1", "arg2", "etypeid"];
            }

            param_keys.forEach(function (param) {
                if (Number(subInfo[param]))
                    params[param] = parseInt(subInfo[param]);
            });
        }

        params.action = action;

        var reqInfo = {
            "method": "POST",
            "url":    LiveJournal.getAjaxUrl('esn_subs'),
            "data":   HTTPReq.formEncoded(params)
        };

        var gotInfoCallback = function (info) {
            if (! info) return LJ_IPPU.showNote("Error changing subscription", btn);

            if (info.error) return LJ_IPPU.showNote(info.error, btn);

            if (info.success) {
                if (info.msg)
                    LJ_IPPU.showNote(info.msg, btn);

                if (info.subscribed) {
                    if (info.subid)
    					btn.setAttribute('lj_subid', info.subid);
                    if (info.newentry_subid)
    					btn.setAttribute('lj_newentry_subid', info.newentry_subid);

    				btn.setAttribute('title', 'Untrack This');

                    // update subthread tracking icons
                    var dtalkid = btn.getAttribute("lj_dtalkid");
                    if (dtalkid)
                        ESN.updateThreadIcons(dtalkid, "on");
                    else // not thread tracking button
                        btn.src = LJ.get('imgprefix') + "/btn_tracking.gif?v=17312";
                } else {
                    if (info["event_class"] == "LJ::Event::JournalNewComment")
    					btn.setAttribute('lj_subid', 0);
                    else if (info["event_class"] == "LJ::Event::JournalNewEntry")
    					btn.setAttribute('lj_newentry_subid', 0);

    				btn.setAttribute('title', 'Track This');

                    // update subthread tracking icons
                    var dtalkid = btn.getAttribute("lj_dtalkid");
                    if (dtalkid) {
                        // set state to "off" if no parents tracking this,
                        // otherwise set state to "parent"
                        var state = "off";
                        var parentBtn;
                        var parent_dtalkid = dtalkid;
                        while (parentBtn = ESN.getThreadParentBtn(parent_dtalkid)) {
                            parent_dtalkid = parentBtn.getAttribute("lj_dtalkid");
                            if (! parent_dtalkid) {
                                break;
                            }

                            if (! Number(parentBtn.getAttribute("lj_subid")))
                                continue;
                            state = "parent";
                            break;
                        }

                        ESN.updateThreadIcons(dtalkid, state);
                    } else {
                        // not thread tracking button
                        btn.src = LJ.get('imgprefix') + "/btn_track.gif?v=17312";
                    }
                }

                if (info.auth_token)
    				btn.setAttribute('lj_auth_token', info.auth_token);
                if (info.newentry_token)
    				btn.setAttribute('lj_newentry_token', info.newentry_token);
            }
        };

        reqInfo.onData = gotInfoCallback;
        reqInfo.onError = function (err) { LJ_IPPU.showNote("Error: " + err) };

        HTTPReq.getJSON(reqInfo);
    };

    // given a dtalkid, find the track button for its parent comment (if any)
    ESN.getThreadParentBtn = function (dtalkid) {
        var cmtInfo = LJ_cmtinfo[dtalkid + ""];
        if (! cmtInfo) {
            return null;
        }

        var parent_dtalkid = cmtInfo.parent;
        if (! parent_dtalkid)
            return null;

        return $("lj_track_btn_" + parent_dtalkid);
    };

    // update all the tracking icons under a parent comment
    ESN.updateThreadIcons = function (dtalkid, tracking) {
        var btn = $("lj_track_btn_" + dtalkid);
        if (! btn) {
            return;
        }

        var cmtInfo = LJ_cmtinfo[dtalkid + ""];
        if (! cmtInfo) {
            return;
        }

        if (Number(btn.getAttribute("lj_subid")) && tracking != "on") {
            // subscription already exists on this button, don't mess with it
            return;
        }

        if (cmtInfo.rc && cmtInfo.rc.length) {
            // update children
            cmtInfo.rc.forEach(function (child_dtalkid) {
                window.setTimeout(function () {
                    var state;
                    switch (tracking) {
                    case "on":
                        state = "parent";
                        break;
                    case "off":
                        state = "off";
                        break;
                    case "parent":
                        state = "parent";
                        break;
                    default:
                        alert("Unknown tracking state " + tracking);
                        break;
                    }
                    ESN.updateThreadIcons(child_dtalkid, state);
                }, 300);
            });
        }

        // update icon
        var uri;
        switch (tracking) {
            case "on":
                uri = "/btn_tracking.gif?v=17312";
                break;
            case "off":
                uri = "/btn_track.gif?v=17312";
                break;
            case "parent":
                uri = "/btn_tracking_thread.gif?v=17312";
                break;
            default:
                alert("Unknown tracking state " + tracking);
                break;
        }

        btn.src = LJ.get('imgprefix') + uri;
    };

    jQuery(function($)
    {
        ESN.initCheckAllBtns();
        ESN.initTrackBtns();

        $('#settings_form').on('click', 'a.delete-group', function(e) {

            var match = this.search.match(/delete_group=([-\d]+)/),
                group = match ? match[1] : null;

            e.preventDefault();

            if (!group) {
                return;
            }

            $.post(location.href, {
                delete_group: group
            });

            $(this).closest('tr').remove();
        });
    });
}(DOM.getElement, ESN));
;

/* file-end: js/esn.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.confirmbubble.js 
*/

LJ.UI.registerTemplate('templates-Widgets-popupcontent', "<div class=\"b-popup-content {{if $data.options_centered}}b-popup-options-centered{{/if}}\"> {{if $data.show_header}} <div class=\"b-popup-content-header\"> <span> {{html $data.header_text}} </span> </div> {{/if}} {{html $data.confirm_text}} {{if $data.show_check}} <div class=\"b-popup-content-inner\"> <input id=\"b-popup-check\" type=\"checkbox\" class=\"b-popup-check\"> <label for=\"b-popup-check\" class=\"b-popup-check-text\"> {{html $data.check_text}} </label> </div> {{/if}} <div class=\"b-popup-submit-options\"> <span class=\"b-popup-preloader\"> <span class=\"b-popup-preloader-inner\"> <button class=\"b-popup-btn\" type=\"button\">{{html $data.yes_text}}</button> <i class=\"preloader\"></i> </span> <a href=\"javascript: void(0);\" class=\"b-popup-cancel\">{{html $data.no_text}}</a> </span> </div> </div> ", 'JQuery.stat');
!function(a){a.widget("lj.confirmbubble",a.lj.basicWidget,{options:{selectors:{ok:".b-popup-btn",cancel:".b-popup-cancel",check:".b-popup-check"},templates:{content:"templates-Widgets-popupcontent"},confirm:jQuery.noop,confirmText:"",yesText:"",noText:"",checkText:"",headerText:"",showCheck:!1,showHeader:!1},_create:function(){a.lj.basicWidget.prototype._create.apply(this),this._content=this._tmpl("content",{confirm_text:this.options.confirmText,yes_text:this.options.confirmYes||LJ.ml("confirm.bubble.yes"),no_text:this.options.confirmNo||LJ.ml("confirm.bubble.no"),show_check:this.options.showCheck,show_header:this.options.showHeader,header_text:this.options.headerText,check_text:this.options.checkText}),this._bindControls(),this._content.bubble({showOn:"click",target:this.element}),this.options.showCheck&&this._content.find(this._s("ok")).attr("disabled",!0),Function.defer(this._content.bubble.bind(this._content,"show"))},_bindControls:function(){var b=this,c=this._content,d=c.find(this._s("ok")),e=this.options;a.lj.basicWidget.prototype._bindControls.apply(this),c.on("click",this._s("ok"),function(){c.bubble("hide"),e.confirm()}).on("change",this._s("check"),function(){a(this).attr("checked")?d.removeAttr("disabled"):d.attr("disabled",!0)}).on("click",this._s("cancel"),function(){c.bubble("hide")}).on("bubblehide",function(){b._trigger("hide")}).on("bubbleshow",function(){b._trigger("show")})},show:function(){this._content.bubble("show")},hide:function(){this._content.bubble("hide")}})}(jQuery,this);;

/* file-end: js/jquery/jquery.lj.confirmbubble.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.ljcut.js 
*/

/**
 * @author Valeriy Vasin (valeriy.vasin@sup.com)
 * @name $.lj.ljcut
 * @requires $.ui.core, $.ui.widget, $.lj.basicWidget, LJ
 * @class The widget is responsible for expanding cuts
 */
;(function ($) {
  'use strict';

  $.widget('lj.ljcut', $.lj.basicWidget, {
    options: {
      // journal identifier (comes from server)
      journalid: null,
      // post identifier (comes from server)
      ditemid: null,
      // cut identifier inside of the post (comes from server)
      cutid: null,
      // server request param: use placeholders or not (1 or 0). Comes from server
      placeholders: 0,

      sticky: false,

      selectors: {
        expand: '.ljcut-link-expand',
        collapse: '.ljcut-link-collapse',

        // bottom collapse link
        collapseLink: '.ljcut-pseudolink-collapse',

        // sticky collapse link
        stickyLink: '.b-sticky-cut-link'
      },

      classNames: {
        'preloader': 'ljcut-link-expanding',
        'expanded': 'ljcut-expanded',
        'sticky-cut-visible': 'b-sticky-cut-visible',
        'cut': '.b-sticky-cut'
      }
    },

    _create: function () {
      $.lj.basicWidget.prototype._create.apply(this);

      this._window = $(window);

      this.cut = $(this._cl('cut'));

      // use current this in handler
      this._stickyCollapseHandler = this._collapse.bind(this);

      // jQuery element that will contain loaded content of the cut
      this.content = null;
      // test OS for Mac
      this._isMac = (/Mac/).test(navigator.userAgent);
      // $.browser.opera is deprecated
      this._isOpera = (/Opera/.test(navigator.userAgent));

      // create collapse node that will be cloned and appended into each ljcut
      this._collapseNode = $('<span class="ljcut-pseudolink"><span class="ljcut-decor"><span class="ljcut-pseudolink-collapse">{close}</span></span></span>'.supplant({close: this._ml('collapse')}));

      this._bindControls();
    },

    _bindControls: function () {
      var tapping = false;
      var buttons = [this._s('expand'), this._s('collapse')].join(', ');

      $.lj.basicWidget.prototype._bindControls.apply(this);
      this.element.on('click', this._s('expand'), this._expand.bind(this));
      this.element.on('click', this._s('collapse'), this._collapse.bind(this));


      // Add fast click for iOS
      this.element.on('touchstart', buttons, function() {
        tapping = true;
      });

      this.element.on('touchmove', buttons, function() {
        tapping = false;
      });

      this.element.on('touchend', buttons, function(e) {
        if (tapping) {
          $(e.target).trigger('click');
        }
      });

      $(document).on('keydown', this._shortcuts.bind(this));
      this._window.on('scroll', this._scrolling.bind(this));
    },

    /**
      * Shortcuts handler
      * @param  {Object} e jQuery event object
      */
    _shortcuts: function (e) {
      var ctrl = (this._isMac && this._isOpera) ? e.metaKey : e.ctrlKey,
        alt = e.altKey;

      if (!ctrl || !alt) {
        return;
      }

      switch (e.which) {
        // expand: ctrl + alt + "+"
        case 61: // FireFox, IE
          // fall through
        case 187: // Opera, Chrome, Safari
          this.expand();
          break;

        // collapse: ctrl + alt + "-"
        case 173: // FireFox
          // fall through
        case 31: // Opera Mac
          // fall through
        case 109: // Opera Windows
          // fall through
        case 189: // Chrome, Safari
          this.collapse();
          break;

        // no default
      }
      e.preventDefault();
    },

    /**
      * Show or hide preloader
      * @param  {Boolean} state Preloader state: True (show) or False (hide)
      */
    _togglePreloader: function (state) {
      this.element.toggleClass( this._cl('preloader'), state );
    },

    /**
      * Toggle content state
      * @param  {Boolean} state State of content: expand (true) or collapse (false)
      */
    _toggleContent: function (state, callback) {
      var that = this,
          _top;

      if (this.locked() || !this.content) {
        return;
      }

      this._lock();

      if (typeof callback !== 'function') {
        callback = $.noop;
      }

      this.element.toggleClass( that._cl('expanded'), state );

      if (state) {
        this._showContent(callback);
      } else {
        _top = this.element.offset().top - 30;

        if ( !this.element.is(':screenable') ) {
            $('body,html').animate({ scrollTop: _top }, 300, function () {
                //delay before collapsing to let user know what is happening
                setTimeout(that._hideContent.bind(that, callback), 50);
            });
        } else {
          this._hideContent(callback);
        }

      }

    },

    /**
      * Show content state
      */
    _showContent: function (callback) {
        var that = this;

        this.content.slideDown('fast', function () {
          that._trigger('show', null, that);
          callback();
          that._unlock();
        });
    },

    /**
      * Hide content state
      */
    _hideContent: function (callback) {
        var that = this;

        this.content.slideUp(50, function () {
            that._trigger('hide', null, that);
            callback();
            that._unlock();
        });
    },

    /**
      * Request server for the cut content
      * @param  {Object} data Data that is needed for request
      */
    _requestContent: function (data) {
      var that = this;

      this._lock();
      this._togglePreloader(true);
      LJ.Api.call('event.get_lj_cut', data, function (response) {
        that.content = $('<div />', { html: response.text }).hide();
        that.element.after( that.content );
        that._unlock();
        that._togglePreloader(false);

        // add handlers after content becomes visible
        that._toggleContent(true, that._addHandlers.bind(that));

        // statistic
        if (response.counter_image_url) {
          LJ.Stat.addCounter(response.counter_image_url);
        }
      });
    },

    /**
      * Provide dynamic behavior for the content (javascript handlers)
      * @private
      */
    _addHandlers: function () {
      this.content.ljLikes();
      LJ.Event.trigger('social:widgets:parse');
    },

    /**
      * Expand content
      */
    expand: function () {
      if ( this.locked() ) {
        return;
      }
      if ( this.content ) {
        this._toggleContent(true);
      } else {
        this._requestContent({
          journalid: this.options.journalid,
          ditemid: this.options.ditemid,
          cutid: this.options.cutid,
          placeholders: this.options.placeholders
        });
      }
    },

    /**
      * Collapse content (for external usage)
      */
    collapse: function () {
      if ( !this.locked() ) {
        this._toggleContent(false);
        this._toggleStickyClass(false);
      }
    },

    /**
      * Expand link click handler
      * @param  {Object} e jQuery event object
      */
    _expand: function (e) {
      // open link in new tab
      if (e.metaKey || e.ctrlKey) {
        return true;
      }

      e.preventDefault();
      this.expand();
    },

    /**
      * Collapse link click handler
      * @param  {Object} e jQuery event object
      */
    _collapse: function (e) {
      // open link in new tab
      if (e.metaKey || e.ctrlKey) {
        return true;
      }

      e.preventDefault();
      this.collapse();
    },

    /**
     * Handler for scrolling event
     */
    _scrolling: function () {
        this._updateStickyCutState();
    },

    /**
     * Check if a sticky cut element is needed to be displayed on the screen and show/hide it
     *
     */
    _updateStickyCutState: function () {
        var viewportHeight,
            viewportTop,
            contentHeight,
            contentTop,
            contentBottom,
            state,
            collapse;

        if ( this._isExpanded() && this.options.sticky && this.content ) {
          viewportHeight = this._window.height();
          viewportTop = $(document).scrollTop();
          contentHeight = this.content.height();
          contentTop = this.content.offset().top;
          contentBottom = contentTop + contentHeight;
          collapse = this.element.find( this._s('collapse') );
          state = contentTop < viewportTop && contentBottom - viewportHeight > viewportTop;

          this._toggleStickyClass(state);
        }
    },

    /**
     * Toggle class of the sticky cut
     *
     * @param {Boolean} state  if `true` - show sticky, cut. Otherwise: hide
     */
    _toggleStickyClass: function (state) {
        this.cut.toggleClass( this._cl('sticky-cut-visible'), state );

        if (state) {
          $(document).on('click', this._s('stickyLink'), this._stickyCollapseHandler);
        } else {
          $(document).off('click', this._s('stickyLink'), this._stickyCollapseHandler);
        }
    },

    /**
     * Extend lj-cut functionality with bottom collapse link and it's handlers
     */
    _addBottomCollapser: function () {
        if ( !this._bottomCloser && this.options.sticky) {
            this._bottomCloser = this._collapseNode.appendTo(this.content);

            this._bottomCloser
                .find( this._s('collapseLink') )
                .on('click', this._bottomCloserClickHandler.bind(this));
        }

        return this._bottomCloser;
    },

    _bottomCloserClickHandler: function () {
        event.preventDefault();
        this.collapse();
    },

    _isExpanded: function () {
        return this.element.hasClass( this._cl('expanded') );
    },

    _isCollapsed: function () {
        return !this._isExpanded();
    }
});
}(jQuery));
;

/* file-end: js/jquery/jquery.lj.ljcut.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/fb-select-image.js 
*/

jQuery(function(){function a(a,b){jQuery("<div>"+b+"</div>").find("img").each(function(){a.push(this.src)})}function b(){n.close()}var c=$("repost_facebook"),d=$("repost_facebook_thumbnail"),e=$("select-fb-thumbnail"),f=$("select-fb-thumbnail-comments"),g=$("userpic_preview_image"),h=$("fbimg_select_window"),i=$("fbimg_select_window_nav"),j=e||f,k="nothumb",l="userpic";if(null!=j){var m={};m=e?{getText:function(){return window.switchedRteOn?CKEDITOR.instances.draft.getData():jQuery("#draft").val()},getUserPic:function(){return g?g.src:""}}:{getText:function(){var a=$("commenttext")||$("body");return a.value},getUserPic:function(){var a=jQuery("#userpics > [name=prop_picture_keyword]");if(0==a.length&&(a=jQuery("#prop_picture_keyword")),0==a.length)return"";var b=a.val();return b in userpicmap?userpicmap[b]:defaultpicurl||""}};var n={init:function(){this.opened=!1,this.page=1,this.totalImages=1,this.pager={prev:jQuery(i).children(".i-repost-nav-prev"),next:jQuery(i).children(".i-repost-nav-next"),counter:jQuery(i).children(".i-repost-nav-counter")},this.listWrapper=jQuery(h).children(".b-repost-pics-wrapper"),this.list=this.listWrapper.children(".b-repost-pics-items"),this.pagerSize=4,this.pagesNum=1,this.cellWidth=0,this.pager.prev.click(function(){n.changePage(-1)}),this.pager.next.click(function(){n.changePage(1)}),this.firstLi=this.list.children("span:first").click(function(){n.setPicture(k)})},setPicture:function(a){d.value=a,this.close()},updatePager:function(){i.style.display=this.totalImages<this.pagerSize?"none":"block",this.pager.prev[1==this.page?"addClass":"removeClass"]("i-repost-nav-prev-dis"),this.pager.next[this.page==this.pagesNum?"addClass":"removeClass"]("i-repost-nav-next-dis"),this.pager.counter.html(this.page+"/"+this.pagesNum)},makeListItem:function(a,b,c){var d=c?"b-repost-pics-active":"";return jQuery("<span>").addClass(d).append(jQuery("<img>").attr("src",a)).click(function(){n.setPicture(b)})},open:function(a){this.list.children("span:gt(0)").remove(),this.totalImages=a.length,this.page=1,0!=a.length&&-1!=jQuery.inArray(d.value,a)||d.value==l||d.value==k||(d.value="");var b=m.getUserPic();if(b.length>0){var c=b;this.makeListItem(c,l,l==d.value).appendTo(this.list),this.totalImages++}this.pagesNum=Math.ceil((this.totalImages+1)/this.pagerSize),this.totalImages>1&&""==d.value&&(d.value=a[0]);for(var e=1,f=0;f<a.length;++f)a[f]==d.value&&(e=Math.floor((f+1+(b.length>0?1:0))/this.pagerSize)+1),this.makeListItem(a[f],a[f],a[f]==d.value).appendTo(this.list);this.firstLi[this.totalImages<=1&&""==d.value||d.value==k?"addClass":"removeClass"]("b-repost-pics-active"),h.style.display="block",this.opened=!0,this.firstLi.each(function(){n.cellWidth=this.offsetWidth+this.offsetLeft});var g=this.pagerSize>this.totalImages?this.cellWidth*(this.totalImages+1)+"px":"";this.listWrapper.css("width",g),this.changePage(e-1)},changePage:function(a){this.page+=a,this.page=this.page<1?1:this.page>this.pagesNum?this.pagesNum:this.page;var b=-this.cellWidth*(this.page-1)*this.pagerSize;this.list.css("left",b+"px"),this.updatePager()},close:function(){h.style.display="none",this.opened=!1}};n.init(),h.onmousedown=function(a){a=a||window.event,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},j.onmousedown=function(a){a=a||window.event,n.opened&&(a.stopPropagation?a.stopPropagation():a.cancelBubble=!0)},j.onclick=function(d){d=d||window.event;var e=[];(null===c.getAttribute("disabled")||c.getAttribute("disabled")===!1)&&(n.opened?b():(e.length=0,a(e,m.getText()),n.open(e),setTimeout(function(){DOM.addEventListener(document,"mousedown",b,!1)},0))),d.preventDefault?d.preventDefault():d.returnValue=!1}}});;

/* file-end: js/fb-select-image.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/apps.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/ljwidget_ippu.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/ljwidget.js 
*/

LJWidget=new Class(Object,{updateContent:function(a){a||(a={}),this._show_frame=a.showFrame,a.method&&(method=a.method),a._widget_update=1,this.doAjaxRequest(a)&&this.hilightFrame()},getWidget:function(){return $(this.widgetId)},doPost:function(a){a||(a={}),this._show_frame=a.showFrame;var b={},c=this.widgetClass;c="Widget["+c.replace(/::/g,"_")+"]_";for(var d in a){var e=d;d.match(/^Widget\[/)||"lj_form_auth"==d||d.match(/^_widget/)||(e=c+d),b[e]=a[d]}b._widget_post=1,this.doAjaxRequest(b)},doPostAndUpdateContent:function(a){a||(a={}),a._widget_update=1,this.doPost(a)},postForm:function(a){if(!a)return!1;for(var b={},c=0;c<a.elements.length;c++){var d=a.elements[c],e=d.name,f=d.value;b[e]=f}this.doPost(b)},init:function(a,b,c){LJWidget.superClass.init.apply(this,arguments),this.widgetId=a,this.widgetClass=b,this.authToken=c},hilightFrame:function(){if(1==this._show_frame&&!this._frame){var a=this.getWidget();if(a){var b=a.parentNode;if(b){var c=document.createElement("fieldset");c.style.borderColor="red";var d=document.createElement("legend");d.innerHTML="Updating...",c.appendChild(d),b.appendChild(c),c.appendChild(a),this._frame=c}}}},removeHilightFrame:function(){if(1==this._show_frame){var a=this.getWidget();if(a&&this._frame){var b=this._frame.parentNode;b&&(b.appendChild(a),b.removeChild(this._frame),this._frame=null)}}},method:"POST",endpoint:"widget",requestParams:{},doAjaxRequest:function(a){if(a||(a={}),this._ajax_updating)return!1;this._ajax_updating=!0,a._widget_id=this.widgetId,a._widget_class=this.widgetClass,a.auth_token=this.authToken,$("_widget_authas")&&(a.authas=$("_widget_authas").value);var b={method:this.method,data:HTTPReq.formEncoded(a),url:LiveJournal.getAjaxUrl(this.endpoint),onData:this.ajaxDone.bind(this),onError:this.ajaxError.bind(this)};for(var c in a)b[c]=a[c];return HTTPReq.getJSON(b),!0},ajaxDone:function(a){if(this._ajax_updating=!1,this.removeHilightFrame(),a._widget_body&&a._widget_body.match(/ajax:.[^"]+/)&&(this.authToken=a._widget_body.match(/ajax:.[^"]+/)[0]),a.auth_token&&(this.authToken=a.auth_token),a.errors&&""!=a.errors)return this.ajaxError(a.errors);if(a.error)return this.ajaxError(a.error);if(this.onData&&this.onData(a),a._widget_body){var b=this.getWidget();if(!b)return;b.innerHTML=a._widget_body,this.onRefresh&&this.onRefresh()}},ajaxError:function(a){this._ajax_updating=!1,this.onError?this.onError(a):LiveJournal.ajaxError(a)}}),LJWidget.widgets=[];;

/* file-end: js/ljwidget.js 
----------------------------------------------------------------------------------*/


LJWidgetIPPU=new Class(LJWidget,{init:function(a,b){var c=a.title,d=a.widgetClass,e=a.authToken,f=a.nearElement,g=a.not_view_close;b||(b={}),this.reqParams=b;var h=new LJ_IPPU(c,f);this.ippu=h;var i=document.createElement("div");i.id="LJWidgetIPPU_"+Unique.id(),h.setContentElement(i),a.width&&a.height&&h.setDimensions(a.width,a.height),a.overlay&&(IPPU.isIE()?(this.ippu.setModal(!0),this.ippu.setOverlayVisible(!0),this.ippu.setClickToClose(!1)):(this.ippu.setModal(!0),this.ippu.setOverlayVisible(!0))),a.center&&h.center(),h.show(),g&&(h.titlebar.getElementsByTagName("img")[0].style.display="none");var j=document.createElement("div");j.style.fontSize="1.5em",j.style.fontWeight="bold",j.style.margin="5px",j.style.textAlign="center",j.innerHTML="Loading...",this.loadingText=j,i.appendChild(j);var k=[i.id,d,e];LJWidgetIPPU.superClass.init.apply(this,k);var l=this;return h.setCancelledCallback(function(){l.cancel&&l.cancel()}),d?(this.widgetClass=d,this.authToken=e,this.title=c,this.nearEle=f,window.setInterval(this.animateLoading.bind(this),20),this.loaded=!1,this.loadContent(),this):null},animateCount:0,animateLoading:function(a){var b=this.loadingText;if(this.loaded||!b)return void window.clearInterval(a);this.animateCount+=.05;var c=(Math.sin(this.animateCount)+1)/2*255,d=Math.round(c).toString(16);1==d.length&&(d="0"+d),d+=d+d,b.style.color="#"+d,this.ippu.center()},doAjaxRequest:function(a){a||(a={}),a._widget_ippu=1,document.getElementById("LJ__Setting__InvisibilityGuests_invisibleguests_self")&&(a["Widget[IPPU_SettingProd]_LJ__Setting__InvisibilityGuests_invisibleguests"]=1==document.getElementById("LJ__Setting__InvisibilityGuests_invisibleguests_self").checked?1:1==document.getElementById("LJ__Setting__InvisibilityGuests_invisibleguests_anon").checked?2:0),LJWidgetIPPU.superClass.doAjaxRequest.apply(this,[a])},close:function(){this.ippu.hide()},loadContent:function(){var a=this.reqParams;this.updateContent(a)},method:"POST",onData:function(){this.loaded=!0},render:function(){}});;

/* file-end: js/ljwidget_ippu.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.itemlist.js 
*/

!function(a){a.widget("lj.itemList",a.lj.basicWidget,{options:{classNames:{hover:"ljappippu_share_person_hover",lastItem:"ljappippu_share_person_last"},selectors:{last:":last",item:"li"},onNewElement:function(a){return a},onSelect:function(){},items:[]},_create:function(){if(this.items={},this._length=0,this.options.items.length>0){for(var a=0;a<this.options.items.length;++a)this.add(this.options.items[a]);this.updateLast()}},add:function(b,c){if(!this.hasItem(b)){var c=c||this.options.onNewElement(b);if(c.length){var d=this.options.hoverClass;c.unbind(".itemList"),d&&c.bind("mouseover.itemList",function(){a(this).addClass(d)}).bind("mouseout.itemList",function(){a(this).removeClass(d)}),c.bind("click.itemList",b,this.options.onSelect),this.element[0]!=c[0].parentNode&&this.element.append(c),this.items[b]=c,this._length++}}},hasItem:function(a){return a in this.items},updateLast:function(){if(this.options.classNames.lastItem){this._lastItem&&this._lastItem.removeClass(this.options.classNames.lastItem);var a=this.element.children(this.options.selectors.last);a.size()>0?(this._lastItem=a,this._lastItem.addClass(this.options.classNames.lastItem)):this._lastItem=null}},nodes:function(){var a=jQuery();for(var b in this.items)this.items.hasOwnProperty(b)&&(a=a.add(this.items[b]));return a.length>0?a:null},remove:function(a){this.hasItem(a)&&(this.items[a].unbind(".itemList").remove(),delete this.items[a],this._length--)},empty:function(){for(var a in this.items)this.remove(a)},length:function(){return this._length},item:function(a){return this.items[a]||jQuery()}})}(jQuery);;

/* file-end: js/jquery/jquery.lj.itemlist.js 
----------------------------------------------------------------------------------*/

/*
 * Note: js/ljwidget_ippu.js is needed for appcontainer.js,
 * which is built and minified. See LJ/Widget/ApplicationBase.pm.
 */

var appManager = (function ($) {
	return {
		CONFIG : {
			// LiveJournal API namespace
			globalLJVarName : 'LiveJournal',
			accessRequestElemId : 'appPopup_accessRequest',
			accessSubmitElemId : 'appPopup_accessSubmit',
			accessCancelElemId : 'appPopup_accessCancel',
			accessTitleElemId : 'appPopup_accessTitle',
			accessDescElemId : 'appPopup_accessDesc'
		},

		init : function (opt) {
			var CONFIG = this.CONFIG;

			$.extend(CONFIG, opt);

			var elems = this.quiz.elems;
			elems.container = $('#' + CONFIG.accessRequestElemId);
			elems.submit = $('#' + CONFIG.accessSubmitElemId);
			elems.cancel = $('#' + CONFIG.accessCancelElemId);
			elems.title = $('#' + CONFIG.accessTitleElemId);
			elems.desc = $('#' + CONFIG.accessDescElemId);

			elems.buttons = elems.submit.add(elems.cancel).removeAttr('disabled');

			elems.userAccessField = elems.container.find('input[name=user_access]');
			elems.idField = elems.container.find('input[name=id]');
			elems.actionField = elems.container.find('input[name=action]');
			elems.extraField = elems.container.find('input[name=extra]');
			elems.userAccessCheckboxes = elems.container.find('input[name=user_access_cb]');

			this.queryArgs = window[CONFIG.globalLJVarName].parseGetArgs(window.location.href);
			this.action = this.queryArgs.act;
			this.extra = this.queryArgs.extra || '';
			this.returnTo = this.queryArgs['return'] || '';

			this.bindEvents();

			this.startDialog();
		},

		startDialog : function () {
			this.quiz.appId = this.queryArgs.id;
			this.quiz.elems.formToSend = this.quiz.elems.container;

			this.quiz.action = this.action;
			this.quiz.extra = this.extra;
			this.quiz.returnTo = this.returnTo;

			this.quiz.start();
		},

		bindEvents : function () {
			var that = this;

			this.quiz.elems.submit.click(function (e) {
				e.preventDefault();

				that.quiz.sendResults();
			});

			this.quiz.elems.userAccessCheckboxes.change( function() {
				var boxes = that.quiz.elems.userAccessCheckboxes,
					accessArray = [];

				boxes.filter(':checked').each( function() {
					accessArray.push( this.value );
				} );

				that.quiz.results = accessArray.join( "," );
			} ).change();

			this.quiz.elems.cancel.click(function (e) {
				e.preventDefault();
				that.quiz.stop();
			});
		},

		quiz : {
			appsUrl: '/games',
			appsSettingsUrl: '/manage/settings/?cat=userapps',
			appId : '',
			action : '',
			elems : {},
			results : [],

			start : function () {
			},
			stop : function () {
				this.action = 'cancel';
				//this.sendResults();
				this.cancelAction();
			},
			cancelAction : function () {
				if( this.returnTo.length > 0 && this.returnTo == 'settings' ) {
					document.location = this.appsSettingsUrl;
				} else {
					document.location = this.appsUrl;
				}
			},
			sendResults : function () {
				this.elems.buttons.attr('disabled', 'disabled');

				this.elems.userAccessField.val(this.results);
				this.elems.idField.val(this.appId);
				this.elems.actionField.val(this.action);
				this.elems.extraField.val(this.extra);

				this.elems.formToSend.submit();
			}
		}
	};
})(jQuery);

/**
 * Script for displaying recipients list in request share dialog in applications.
 * Current version refreshes all list on every change.
 * Current version can handle only one list on the page.
 */
var recipientsSelector  = (function ($) {
		var CONFIG = {
			perPage: 20, //if zero, we display all persons on a single page
			personsContainerSelector: '.ljappippu_share_persons',
			personsTpl: '#ljappippu_share_person',
			firstLink: ".i-qotd-nav-first",
			lastLink: ".i-qotd-nav-last",
			prevLink: ".i-qotd-nav-prev",
			nextLink: ".i-qotd-nav-next",
			firstLinkDis: "i-qotd-nav-first-dis",
			lastLinkDis: "i-qotd-nav-last-dis",
			prevLinkDis: "i-qotd-nav-prev-dis",
			nextLinkDis: "i-qotd-nav-next-dis",
			counterCurrent: ".i-pages-current",
			counterTotal: ".i-pages-total",
			onSelect: function( friendObject ){}
		};

		/**
		 * Internal class, responsible to handle friends list taking into account their visibility
		 */
		function FriendList()
		{
			this._friends = [];
			//array to store visible items references
			this._visibleArr = [];
			this._needRebuild = true;
		}

		/** If item visibilite had changed we rebuild all helper array */
		FriendList.prototype._rebuildVisible = function() {
			this._visibleArr = [];

			for( var i = 0; i < this._friends.length; ++i ) {
				if( this._friends[ i ].visible && this._friends[ i ].filtered ) {
					this._visibleArr.push( this._friends[ i ]);
				}
			}
			this._needRebuild = false;
		}

		FriendList.prototype.add = function( name, visible ) {
			this._friends.push( {
				username: name,
				visible: visible,
				filtered: true //if false we also hide this item
			} )

			if( visible ) {
				//this items will be the last visible, so no need to rebuild
				this._visibleArr.push( this._friends)
			}
		}

		FriendList.prototype.setVisible = function( name, visible ) {
			var friend = this.getFriend( name );

			if( friend && friend.username === name ) {
				if( friend.visible != visible ) {
					friend.visible = visible;
					this._needRebuild = true;
					return true;
				}
				return false;
			}
		}

		FriendList.prototype.getVisibleLength = function() {
			if( this._needRebuild ) {
				this._rebuildVisible();
			}

			return this._visibleArr.length;
		}

		FriendList.prototype.getVisibleFriend = function( idx ) {
			if( this._needRebuild ) {
				this._rebuildVisible();
			}

			if( idx >= 0 && idx < this._visibleArr.length ) {
				return $.extend( {}, this._visibleArr[ idx ] );
			}

			return null;
		}

		FriendList.prototype.getFriend = function( name ) {
			for( var i = 0; i < this._friends.length; ++i ) {
				if( this._friends[ i ].username === name ) {
					return this._friends[ i ];
				}
			}

			return null;
		}

		FriendList.prototype.filterFriends = function( mask ) {
			mask = mask || "";
			var needRebuild = false,
				oldVal, friend;

			for( var i = 0; i < this._friends.length; ++i ) {
				friend = this._friends[ i ];
				oldVal = friend.filtered;
				friend.filtered = ( mask.length > 0 ) ? ( friend.username.indexOf( mask ) !== -1 ) : true;

				if( oldVal !== friend.filtered ) {
					this._needRebuild = true;
				}
			}

			if( this._needRebuild ) {
				this._rebuildVisible();
			}
		}

		var options, list, currentPage, friends;

		function showPage( num ) {
			if( num <= 0 ) { return; }
			var items = fetchFriendsList( num );
			if( !items ) {
				if( num === 1 ) {
					list.itemList( 'empty' );
				} else {
					showPage( num - 1 );
				}
				updatePager();
				return;
			}

			currentPage = num;
			list.itemList( 'empty' );
			for( var i = 0; i < items.length; ++i ) {
				list.itemList( 'add', items[ i ] );
			}
			list.itemList( 'updateLast' );

			updatePager();
		}

		function fetchFriendsList( page ) {
			var start, end;

			if( options.perPage === 0 ) {
				start = 0;
				end = friends.getVisibleLength();
			} else {
				start = ( page - 1 ) * options.perPage;
				end = page * options.perPage;
			}

			if( start >= friends.getVisibleLength() ) {
				return false;
			}

			var list = [];
			var f;
			for( var i = start; i < end; ++i ) {
				f = friends.getVisibleFriend( i );
				if( f ) {
					list.push( f.username );
				} else {
					break;
				}
			}

			return ( list.length === 0 ) ? false : list;
		}

		function updatePager() {
			//probably there is no pager if we show all items
			if( options.perPage === 0 ) {
				return;
			}
			var pagesTotal = Math.ceil( friends.getVisibleLength() / options.perPage );
			el.counterTotal.html( pagesTotal );
			el.counterCurrent.html( currentPage || 0 );

			el.firstLink[ ( pagesTotal === 0 || currentPage === 1 ) ? "addClass" : "removeClass" ]( options.firstLinkDis );
			el.lastLink[ ( pagesTotal === 0 || currentPage === pagesTotal ) ? "addClass" : "removeClass" ]( options.lastLinkDis );
			el.prevLink[ ( pagesTotal === 0 || currentPage === 1 ) ? "addClass" : "removeClass" ]( options.prevLinkDis );
			el.nextLink[ ( pagesTotal === 0 || currentPage === pagesTotal ) ? "addClass" : "removeClass" ]( options.nextLinkDis );
		}

		function updateState() {
			showPage( currentPage );
		}

		function bindControls() {
			el.firstLink.mousedown( function( ev ) {
				showPage(1);
				ev.preventDefault();
			} );
			el.lastLink.mousedown( function( ev ) {
				var pagesTotal = Math.ceil( friends.getVisibleLength() / options.perPage );
				showPage( pagesTotal );
				ev.preventDefault();
			} );
			el.prevLink.mousedown( function( ev ) {
				showPage( currentPage - 1);
				ev.preventDefault();
			} );
			el.nextLink.mousedown( function( ev ) {
				showPage( currentPage + 1);
				ev.preventDefault();
			} );
		}

		function filter( mask ) {
			friends.filterFriends( mask );
			showPage( currentPage );
		}

		return {
			init: function( opts ) {
				options = $.extend( {}, CONFIG, opts );
				el = {
					firstLink: $( options.firstLink ),
					lastLink: $( options.lastLink ),
					prevLink: $( options.prevLink ),
					nextLink: $( options.nextLink ),
					counterCurrent: $( options.counterCurrent ),
					counterTotal: $( options.counterTotal ),
					personsContainer: $( options.personsContainer ),
					personsTpl: $( options.personsTpl )
				}

				list = $( '.ljappippu_share_persons' ).itemList( {
					classNames: {
						hover: "ljappippu_share_person_hover"
					},
					onNewElement: function( item ) {
						return el.personsTpl.tmpl( { username: item } );
					},
					onSelect: function( ev ) {
						var item = ev.data;
						options.onSelect( friends.getFriend( item ) );
						if( friends.setVisible( item, false ) ) {
							updateState();
						}

						ev.preventDefault();
					}
				} );

				friends = new FriendList();
				for( var i = 0; i < options.friends.length; ++i ) {
					friends.add( options.friends[ i ].display_name, !options.friends[ i ].selected );
				}

				bindControls();
				showPage( 1 );
			},
			add: function( item ) {
				if( friends.setVisible( item, true ) ){
					updateState();
				}
			},

			filter: function( mask ) {
				filter( mask );
			}
		};
})(jQuery);
;

/* file-end: js/apps.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/apps/appcontainer.js 
*/

var gadgets=window.gadgets||{},shindig=window.shindig||{},osapi=window.osapi||{},livejournal=window.livejournal||{};gadgets.util=gadgets.util||{};gadgets.util.makeClosure=function(a,b){for(var c=[],d=2,e=arguments.length;d<e;++d)c.push(arguments[d]);return function(){for(var f=c.slice(),i=0,h=arguments.length;i<h;++i)f.push(arguments[i]);return b.apply(a,f)}};gadgets.util.makeEnum=function(a){var b,c,d={};for(b=0;c=a[b];++b)d[c]=c;return d};gadgets.util=gadgets.util||{};
(function(){gadgets.util.createElement=function(a){var b;if(!document.body||document.body.namespaceURI)try{b=document.createElementNS("http://www.w3.org/1999/xhtml",a)}catch(c){}return b||document.createElement(a)};gadgets.util.createIframeElement=function(a){var b=gadgets.util.createElement("iframe");try{var c,d=["<","iframe"],e=a||{},f;for(f in e)if(e.hasOwnProperty(f)){d.push(" ");d.push(f);d.push('="');d.push(gadgets.util.escapeString(e[f]));d.push('"')}d.push("></");d.push("iframe");d.push(">");
c=d.join("");var i=gadgets.util.createElement(c);if(i&&(!b||i.tagName==b.tagName&&i.namespaceURI==b.namespaceURI))b=i}catch(h){}c=b;a=a||{};for(var k in a)if(a.hasOwnProperty(k))c[k]=a[k];return b};gadgets.util.getBodyElement=function(){if(document.body)return document.body;try{var a=document.getElementsByTagNameNS("http://www.w3.org/1999/xhtml","body");if(a&&a.length==1)return a[0]}catch(b){}return document.documentElement||document}})();gadgets.util=gadgets.util||{};gadgets.util.attachBrowserEvent=function(a,b,c,d){if(typeof a.addEventListener!="undefined")a.addEventListener(b,c,d);else typeof a.attachEvent!="undefined"?a.attachEvent("on"+b,c):gadgets.warn("cannot attachBrowserEvent: "+b)};gadgets.util.removeBrowserEvent=function(a,b,c,d){if(a.removeEventListener)a.removeEventListener(b,c,d);else a.detachEvent?a.detachEvent("on"+b,c):gadgets.warn("cannot removeBrowserEvent: "+b)};gadgets.util=gadgets.util||{};(function(){var a=[];gadgets.util.registerOnLoadHandler=function(b){a.push(b)};gadgets.util.runOnLoadHandlers=function(){for(var b=0,c=a.length;b<c;++b)a[b]()}})();gadgets.util=gadgets.util||{};
(function(){function a(c,d){return String.fromCharCode(d)}var b={0:false,10:true,13:true,34:true,39:true,60:true,62:true,92:true,8232:true,8233:true,65282:true,65287:true,65308:true,65310:true,65340:true};gadgets.util.escape=function(c,d){if(c)if(typeof c==="string")return gadgets.util.escapeString(c);else if(typeof c==="array")for(var e=0,f=c.length;e<f;++e)c[e]=gadgets.util.escape(c[e]);else{if(typeof c==="object"&&d){e={};for(f in c)if(c.hasOwnProperty(f))e[gadgets.util.escapeString(f)]=gadgets.util.escape(c[f],
true);return e}}else return c;return c};gadgets.util.escapeString=function(c){if(!c)return c;for(var d=[],e,f,i=0,h=c.length;i<h;++i){e=c.charCodeAt(i);f=b[e];if(f===true)d.push("&#",e,";");else f!==false&&d.push(c.charAt(i))}return d.join("")};gadgets.util.unescapeString=function(c){if(!c)return c;return c.replace(/&#([0-9]+);/g,a)}})();gadgets.util=gadgets.util||{};
(function(){var a=null;gadgets.util.getUrlParameters=function(b){var c=typeof b==="undefined";if(a!==null&&c)return a;var d={};b=b||document.location.href;var e=b.indexOf("?"),f=b.indexOf("#");b=(f===-1?b.substr(e+1):[b.substr(e+1,f-e-1),"&",b.substr(f+1)].join("")).split("&");e=window.decodeURIComponent?decodeURIComponent:unescape;f=0;for(var i=b.length;f<i;++f){var h=b[f].indexOf("=");if(h!==-1){var k=b[f].substring(0,h);h=b[f].substring(h+1);h=h.replace(/\+/g," ");try{d[k]=e(h)}catch(j){}}}if(c)a=
d;return d}})();gadgets.util.getUrlParameters();gadgets.util=gadgets.util||{};(function(){function a(d){b=d["core.util"]||{}}var b={},c={};gadgets.config&&gadgets.config.register("core.util",null,a);gadgets.util.getFeatureParameters=function(d){return typeof b[d]==="undefined"?null:b[d]};gadgets.util.hasFeature=function(d){return typeof b[d]!=="undefined"};gadgets.util.getServices=function(){return c}})();if(window.JSON&&window.JSON.parse&&window.JSON.stringify)gadgets.json=function(){function a(c){return this[c]}var b=/___$/;return{parse:function(c){try{return window.JSON.parse(c)}catch(d){return false}},stringify:function(c){function d(h){return e.call(this,h,a)}var e=window.JSON.stringify,f=Array.prototype.toJSON&&e([{x:1}])==='"[{\\"x\\": 1}]"'?d:e;try{return f(c,function(h,k){return!b.test(h)?k:void 0})}catch(i){return null}}}}();if(!(window.JSON&&window.JSON.parse&&window.JSON.stringify))gadgets.json=function(){function a(d){return d<10?"0"+d:d}function b(d){var e,f,i;e=/[\"\\\x00-\x1f\x7f-\x9f]/g;switch(typeof d){case "string":return e.test(d)?'"'+d.replace(e,function(h){var k=c[h];if(k)return k;k=h.charCodeAt();return"\\u00"+Math.floor(k/16).toString(16)+(k%16).toString(16)})+'"':'"'+d+'"';case "number":return isFinite(d)?String(d):"null";case "boolean":case "null":return String(d);case "object":if(!d)return"null";e=[];
if(typeof d.length==="number"&&!d.propertyIsEnumerable("length")){i=d.length;for(f=0;f<i;f+=1)e.push(b(d[f])||"null");return"["+e.join(",")+"]"}for(f in d)if(!/___$/.test(f))if(d.hasOwnProperty(f))if(typeof f==="string")(i=b(d[f]))&&e.push(b(f)+":"+i);return"{"+e.join(",")+"}"}return""}Date.prototype.toJSON=function(){return[this.getUTCFullYear(),"-",a(this.getUTCMonth()+1),"-",a(this.getUTCDate()),"T",a(this.getUTCHours()),":",a(this.getUTCMinutes()),":",a(this.getUTCSeconds()),"Z"].join("")};var c=
{"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:b,parse:function(d){if(/^[\],:{}\s]*$/.test(d.replace(/\\["\\\/b-u]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return eval("("+d+")");return false}}}();gadgets.json.flatten=function(a){var b={};if(a===null||a===undefined)return b;for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];null===d||undefined===d||(b[c]=typeof d==="string"?d:gadgets.json.stringify(d))}return b};gadgets.log=function(){function a(e,f){if(!(e<c||!d))if(e===2&&d.warn)d.warn(f);else if(e===3&&d.error)d.error(f);else d.log&&d.log(f)}var b=function(e){a(1,e)};gadgets.warn=function(e){a(2,e)};gadgets.error=function(e){a(3,e)};gadgets.setLogLevel=function(e){c=e};b.INFO=1;b.WARNING=2;b.NONE=4;var c=1,d=window.console?window.console:window.opera?window.opera.postError:undefined;return b}();if(!window.gadgets.config)gadgets.config=function(){function a(k,j){for(var m in j)if(j.hasOwnProperty(m))if(typeof k[m]==="object"&&typeof j[m]==="object")a(k[m],j[m]);else k[m]=j[m]}function b(){var k=document.scripts||document.getElementsByTagName("script");if(!k||k.length==0)return null;var j;if(f.u)for(var m=0;!j&&m<k.length;++m){var l=k[m];if(l.src&&l.src.indexOf(f.u)==0)j=l}j||(j=k[k.length-1]);if(!j.src)return null;return j}function c(k){var j="";if(k.nodeType==3||k.nodeType==4)j=k.nodeValue;
else if(k.innerText)j=k.innerText;else if(k.innerHTML)j=k.innerHTML;else if(k.firstChild){j=[];for(k=k.firstChild;k;k=k.nextSibling)j.push(c(k));j=j.join("")}return j}function d(k){var j=b();if(j){var m;j=c(j);try{m=(new Function("return ("+j+"\n)"))()}catch(l){}if(typeof m==="object")m=m;else{try{m=(new Function("return ({"+j+"\n})"))()}catch(o){}m=typeof m==="object"?m:{}}if(f.f&&f.f.length==1)if(!m[f.f[0]]){j={};j[f.f[0]]=m;m=j}a(k,m);(m=window.___cfg)&&a(k,m)}}function e(k){for(var j in i)if(i.hasOwnProperty(j))for(var m=
i[j],l=0,o=m.length;l<o;++l)k(j,m[l])}var f,i={},h={};return{register:function(k,j,m,l){var o=i[k];if(!o){o=[];i[k]=o}o.push({validators:j||{},callback:m,callOnUpdate:l})},get:function(k){if(k)return h[k]||{};return h},init:function(k,j){f=window.___jsl||{};a(h,k);d(h);a(h,window.___config||{});e(function(m,l){var o=h[m];if(o&&!j){var r=l.validators,q;for(q in r)if(r.hasOwnProperty(q))if(!r[q](o[q]))throw Error('Invalid config value "'+o[q]+'" for parameter "'+q+'" in component "'+m+'"');}l.callback&&
l.callback(h)})},update:function(k,j){var m=[];e(function(r,q){if(k.hasOwnProperty(r)||j&&h&&h[r])q.callback&&q.callOnUpdate&&m.push(q.callback)});h=j?{}:h||{};a(h,k);for(var l=0,o=m.length;l<o;++l)m[l](h)}}}();gadgets.io=function(){function a(){var j;if(typeof shindig!="undefined"&&shindig.xhrwrapper&&shindig.xhrwrapper.createXHR)return shindig.xhrwrapper.createXHR();else if(typeof ActiveXObject!="undefined"){(j=new ActiveXObject("Msxml2.XMLHTTP"))||(j=new ActiveXObject("Microsoft.XMLHTTP"));return j}else if(typeof XMLHttpRequest!="undefined"||window.XMLHttpRequest)return new window.XMLHttpRequest;else throw"no xhr available";}function b(j,m){if(j.readyState!==4)return true;try{if(j.status!==200){var l=
""+j.status;if(j.responseText)l=l+" "+j.responseText;m({errors:[l],rc:j.status,text:j.responseText});return true}}catch(o){m({errors:[o.number+" Error not specified"],rc:o.number,text:o.description});return true}return false}function c(j,m,l,o){b(o,m)||m(e(l,{body:o.responseText}))}function d(j,m,l,o){if(!b(o,m)){o=o.responseText;var r=o.indexOf(k)+k.length;if(!(r<k.length)){o=o.substr(r);o=eval("("+o+")");o=o[j];if(o.oauthState)h=o.oauthState;o.st&&shindig.auth.updateSecurityToken(o.st);m(e(l,o))}}}
function e(j,m){var l={text:m.body,rc:m.rc||200,headers:m.headers,oauthApprovalUrl:m.oauthApprovalUrl,oauthError:m.oauthError,oauthErrorText:m.oauthErrorText,oauthErrorTrace:m.oauthErrorTrace,oauthErrorUri:m.oauthErrorUri,oauthErrorExplanation:m.oauthErrorExplanation,errors:[]};if(l.rc<200||l.rc>=400)l.errors=[l.rc+" Error"];else if(l.text){if(l.rc>=300&&l.rc<400)j.CONTENT_TYPE="TEXT";switch(j.CONTENT_TYPE){case "JSON":case "FEED":l.data=gadgets.json.parse(l.text);if(!l.data){l.errors.push("500 Failed to parse JSON");
l.rc=500;l.data=null}break;case "DOM":var o;if(typeof ActiveXObject!="undefined"){o=new ActiveXObject("Microsoft.XMLDOM");o.async=false;o.validateOnParse=false;o.resolveExternals=false;if(o.loadXML(l.text))l.data=o;else{l.errors.push("500 Failed to parse XML");l.rc=500}}else{o=(new DOMParser).parseFromString(l.text,"text/xml");if("parsererror"===o.documentElement.nodeName){l.errors.push("500 Failed to parse XML");l.rc=500}else l.data=o}break;default:l.data=l.text}}return l}function f(j,m,l,o,r,q,
t,p){var z=a();if(m.indexOf("//")==0)m=document.location.protocol+m;z.open(r,m,true);if(l)z.onreadystatechange=gadgets.util.makeClosure(null,t,j,l,q,z);if(o!==null){j="application/x-www-form-urlencoded";if(typeof p==="string"){j=p;p={}}p=p||{};p["Content-Type"]||(p["Content-Type"]=j);for(var x in p)z.setRequestHeader(x,p[x])}z.send(o)}var i={},h,k="throw 1; < don't be evil' >";gadgets.config.register("core.io",null,function(j){i=j["core.io"]||{}});return{makeRequest:function(j,m,l){l=l||{};var o=
l.METHOD||"GET",r=l.REFRESH_INTERVAL,q,t;if(l.AUTHORIZATION&&l.AUTHORIZATION!=="NONE"){q=l.AUTHORIZATION.toLowerCase();t=shindig.auth.getSecurityToken()}else if(o==="GET"&&r===undefined)r=3600;var p=true;if(typeof l.OWNER_SIGNED!=="undefined")p=l.OWNER_SIGNED;var z=true;if(typeof l.VIEWER_SIGNED!=="undefined")z=l.VIEWER_SIGNED;var x=l.HEADERS||{};if(o==="POST"&&!x["Content-Type"])x["Content-Type"]="application/x-www-form-urlencoded";var A=gadgets.util.getUrlParameters();t={url:j,httpMethod:o,headers:gadgets.io.encodeValues(x,
false),postData:l.POST_DATA||"",authz:q||"",st:t||"",contentType:l.CONTENT_TYPE||"TEXT",numEntries:l.NUM_ENTRIES||"3",getSummaries:!!l.GET_SUMMARIES,signOwner:p,signViewer:z,gadget:A.url,container:A.container||A.synd||"default",bypassSpecCache:gadgets.util.getUrlParameters().nocache||"",getFullHeaders:!!l.GET_FULL_HEADERS};if(q==="oauth"||q==="signed"||q==="oauth2"){if(gadgets.io.oauthReceivedCallbackUrl_){t.OAUTH_RECEIVED_CALLBACK=gadgets.io.oauthReceivedCallbackUrl_;gadgets.io.oauthReceivedCallbackUrl_=
null}t.oauthState=h||"";for(var v in l)if(l.hasOwnProperty(v))if(v.indexOf("OAUTH_")===0||v==="code")t[v]=l[v]}q=i.jsonProxyUrl.replace("%host%",document.location.host);a:{if(gadgets.io.preloaded_&&t.httpMethod==="GET")for(v=0;v<gadgets.io.preloaded_.length;v++)if((p=gadgets.io.preloaded_[v])&&p.id===t.url){delete gadgets.io.preloaded_[v];if(p.rc!==200)m({rc:p.rc,errors:[p.rc+" Error"]});else{if(p.oauthState)h=p.oauthState;m(e(l,{body:p.body,rc:p.rc,headers:p.headers,oauthApprovalUrl:p.oauthApprovalUrl,
oauthError:p.oauthError,oauthErrorText:p.oauthErrorText,oauthErrorTrace:p.oauthErrorTrace,oauthErrorUri:p.oauthErrorUri,oauthErrorExplanation:p.oauthErrorExplanation,errors:[]}))}v=true;break a}v=false}if(!v)if(o==="GET"&&r>0){o="?refresh="+r+"&"+gadgets.io.encodeValues(t);f(j,q+o,m,null,"GET",l,d)}else f(j,q,m,gadgets.io.encodeValues(t),"POST",l,d)},makeNonProxiedRequest:function(j,m,l,o){l=l||{};f(j,j,m,l.POST_DATA,l.METHOD,l,c,o)},clearOAuthState:function(){h=undefined},encodeValues:function(j,
m){var l=!m,o=[],r=false,q;for(q in j)if(j.hasOwnProperty(q)&&!/___$/.test(q)){if(r)o.push("&");else r=true;o.push(l?encodeURIComponent(q):q);o.push("=");o.push(l?encodeURIComponent(j[q]):j[q])}return o.join("")},getProxyUrl:function(j,m){var l=i.proxyUrl;if(!l)return l;var o=m||{},r=o.REFRESH_INTERVAL;if(r===undefined)r="3600";var q=gadgets.util.getUrlParameters();o=o.rewriteMime?"&rewriteMime="+encodeURIComponent(o.rewriteMime):"";l=l.replace("%url%",encodeURIComponent(j)).replace("%host%",document.location.host).replace("%rawurl%",
j).replace("%refresh%",encodeURIComponent(r)).replace("%gadget%",encodeURIComponent(q.url)).replace("%container%",encodeURIComponent(q.container||q.synd||"default")).replace("%rewriteMime%",o);if(l.indexOf("//")==0)l=window.location.protocol+l;return l}}}();
gadgets.io.RequestParameters=gadgets.util.makeEnum(["METHOD","CONTENT_TYPE","POST_DATA","HEADERS","AUTHORIZATION","NUM_ENTRIES","GET_SUMMARIES","GET_FULL_HEADERS","REFRESH_INTERVAL","OAUTH_SERVICE_NAME","OAUTH_USE_TOKEN","OAUTH_TOKEN_NAME","OAUTH_REQUEST_TOKEN","OAUTH_REQUEST_TOKEN_SECRET","OAUTH_RECEIVED_CALLBACK"]);gadgets.io.MethodType=gadgets.util.makeEnum(["GET","POST","PUT","DELETE","HEAD"]);gadgets.io.ContentType=gadgets.util.makeEnum(["TEXT","DOM","JSON","FEED"]);
gadgets.io.AuthorizationType=gadgets.util.makeEnum(["NONE","SIGNED","OAUTH","OAUTH2"]);gadgets.rpctx=gadgets.rpctx||{};
if(!gadgets.rpctx.wpm)gadgets.rpctx.wpm=function(){function a(f,i,h){if(typeof window.addEventListener!="undefined")window.addEventListener(f,i,h);else typeof window.attachEvent!="undefined"&&window.attachEvent("on"+f,i)}function b(f){var i=gadgets.json.parse(f.data);if(i&&i.f){var h=gadgets.rpc.getTargetOrigin(i.f);e&&(typeof f.origin!=="undefined"?f.origin!==h:f.domain!==/^.+:\/\/([^:]+).*/.exec(h)[1])||c(i,f.origin)}}var c,d,e=true;return{getCode:function(){return"wpm"},isParentVerifiable:function(){return true},
init:function(f,i){gadgets.config.register("rpc",null,function(h){if(String((h?h.rpc:{}).disableForceSecure)==="true")e=false});c=f;d=i;a("message",b,false);d("..",true);return true},setup:function(f){d(f,true);return true},call:function(f,i,h){var k=gadgets.rpc.getTargetOrigin(f),j=gadgets.rpc._getTargetWin(f);k?window.setTimeout(function(){j.postMessage(gadgets.json.stringify(h),k)},0):gadgets.error("No relay set (used as window.postMessage targetOrigin), cannot send cross-domain message");return true}}}();gadgets.rpctx=gadgets.rpctx||{};
if(!gadgets.rpctx.nix)gadgets.rpctx.nix=function(){function a(){var h=e[".."];if(!h)if(++i>c){gadgets.warn("Nix transport setup failed, falling back...");f("..",false)}else{if(!h&&window.opener&&"GetAuthToken"in window.opener){h=window.opener;if(h.GetAuthToken()==gadgets.rpc.getAuthToken("..")){var k=gadgets.rpc.getAuthToken("..");h.CreateChannel(window[b]("..",k),k);e[".."]=h;window.opener=null;f("..",true);return}}window.setTimeout(function(){a()},d)}}var b="GRPC____NIXVBS_get_wrapper",c=10,d=500,
e={},f,i=0;return{getCode:function(){return"nix"},isParentVerifiable:function(){return false},init:function(h,k){f=k;if(typeof window[b]!=="unknown"){window.GRPC____NIXVBS_handle_message=function(l){window.setTimeout(function(){h(gadgets.json.parse(l))},0)};window.GRPC____NIXVBS_create_channel=function(l,o,r){if(gadgets.rpc.getAuthToken(l)===r){e[l]=o;f(l,true)}};var j="Class GRPC____NIXVBS_wrapper\n Private m_Intended\nPrivate m_Auth\nPublic Sub SetIntendedName(name)\n If isEmpty(m_Intended) Then\nm_Intended = name\nEnd If\nEnd Sub\nPublic Sub SetAuth(auth)\n If isEmpty(m_Auth) Then\nm_Auth = auth\nEnd If\nEnd Sub\nPublic Sub SendMessage(data)\n GRPC____NIXVBS_handle_message(data)\nEnd Sub\nPublic Function GetAuthToken()\n GetAuthToken = m_Auth\nEnd Function\nPublic Sub CreateChannel(channel, auth)\n Call GRPC____NIXVBS_create_channel(m_Intended, channel, auth)\nEnd Sub\nEnd Class\nFunction "+
b+"(name, auth)\nDim wrap\nSet wrap = New GRPC____NIXVBS_wrapper\nwrap.SetIntendedName name\nwrap.SetAuth auth\nSet "+b+" = wrap\nEnd Function";try{window.execScript(j,"vbscript")}catch(m){return false}}return true},setup:function(h,k){if(h===".."){a();return true}try{var j=document.getElementById(h),m=window[b](h,k);j.contentWindow.opener=m}catch(l){return false}return true},call:function(h,k,j){try{e[h]&&e[h].SendMessage(gadgets.json.stringify(j))}catch(m){return false}return true}}}();if(!window.gadgets.rpc){gadgets.rpc=function(){function a(g,n){if(!H[g]){var u=E;n||(u=J);H[g]=u;for(var s=I[g]||[],y=0;y<s.length;++y){var w=s[y];w.t=A[g];u.call(g,w.f,w)}I[g]=[]}}function b(){function g(){Q=true}if(!R){if(typeof window.addEventListener!="undefined")window.addEventListener("unload",g,false);else typeof window.attachEvent!="undefined"&&window.attachEvent("onunload",g);R=true}}function c(g,n,u,s,y){if(!A[n]||A[n]!==u){gadgets.error("Invalid auth token. "+A[n]+" vs "+u);K(n,M)}y.onunload=
function(){if(B[n]&&!Q){K(n,S);gadgets.rpc.removeReceiver(n)}};b();s=gadgets.json.parse(decodeURIComponent(s))}function d(g,n){if(g&&typeof g.s==="string"&&typeof g.f==="string"&&g.a instanceof Array){if(A[g.f])if(A[g.f]!==g.t){gadgets.error("Invalid auth token. "+A[g.f]+" vs "+g.t);K(g.f,M)}if(g.s==="__ack")window.setTimeout(function(){a(g.f,true)},0);else{if(g.c)g.callback=function(y){gadgets.rpc.call(g.f,"__cb",null,g.c,y)};if(n){var u=e(n);g.origin=n;var s=g.r;if(!s||e(s)!=u)s=n;g[t]=s}u=(p[g.s]||
p[""]).apply(g,g.a);g.c&&typeof u!=="undefined"&&gadgets.rpc.call(g.f,"__cb",null,g.c,u)}}}function e(g){if(!g)return"";g=g.toLowerCase();if(g.indexOf("//")==0)g=window.location.protocol+g;if(g.indexOf("://")==-1)g=window.location.protocol+"//"+g;var n=g.substring(g.indexOf("://")+3),u=n.indexOf("/");if(u!=-1)n=n.substring(0,u);g=g.substring(0,g.indexOf("://"));u="";var s=n.indexOf(":");if(s!=-1){var y=n.substring(s+1);n=n.substring(0,s);if(g==="http"&&y!=="80"||g==="https"&&y!=="443")u=":"+y}return g+
"://"+n+u}function f(g){if(g.charAt(0)=="/"){var n=g.indexOf("|"),u=n>0?g.substring(1,n):g.substring(1);g=n>0?g.substring(n+1):null;return{id:u,origin:g}}else return null}function i(g){if(typeof g==="undefined"||g==="..")return window.parent;var n=f(g);if(n)return window.top.frames[n.id];g=String(g);if(n=window.frames[g])return n;if((n=document.getElementById(g))&&n.contentWindow)return n.contentWindow;return null}function h(g,n){if(B[g]!==true){if(typeof B[g]==="undefined")B[g]=0;var u=i(g);if(g===
".."||u!=null)if(E.setup(g,n)===true){B[g]=true;return}if(B[g]!==true&&B[g]++<10)window.setTimeout(function(){h(g,n)},500);else{H[g]=J;B[g]=true}}}function k(g){if((g=z[g])&&g.substring(0,1)==="/")g=g.substring(1,2)==="/"?document.location.protocol+g:document.location.protocol+"//"+document.location.host+g;return g}function j(g,n,u){if(!/http(s)?:\/\/.+/.test(n))if(n.indexOf("//")==0)n=window.location.protocol+n;else if(n.charAt(0)=="/")n=window.location.protocol+"//"+window.location.host+n;else if(n.indexOf("://")==
-1)n=window.location.protocol+"//"+n;z[g]=n;if(typeof u!=="undefined")x[g]=!!u}function m(g,n){n=n||"";A[g]=String(n);h(g,n)}function l(g){g=(g.passReferrer||"").split(":",2);L=g[0]||"none";N=g[1]||"origin"}function o(g){if(String(g.useLegacyProtocol)==="true"){E=gadgets.rpctx.ifpc;E.init(d,a)}}function r(g,n){function u(s){s=s?s.rpc:{};l(s);var y=s.parentRelayUrl||"";y=e(G.parent||n)+y;j("..",y,String(s.useLegacyProtocol)==="true");o(s);m("..",g)}!G.parent&&n?u({}):gadgets.config.register("rpc",
null,u)}function q(g,n,u){if(g==="..")r(u||G.rpctoken||G.ifpctok||"",n);else a:{var s=null;if(g.charAt(0)!="/"){if(!gadgets.util)break a;s=document.getElementById(g);if(!s)throw Error("Cannot set up gadgets.rpc receiver with ID: "+g+", element not found.");}s=s&&s.src;n=n||gadgets.rpc.getOrigin(s);j(g,n);n=gadgets.util.getUrlParameters(s);m(g,u||n.rpctoken)}}var t="referer",p={},z={},x={},A={},v=0,C={},B={},D={},G={},H={},I={},L=null,N=null,U=window.top!==window.self,O=window.name,K=function(){},
S=1,M=2,P=window.console,T=P&&P.log&&function(g){P.log(g)}||function(){},J=function(){function g(n){return function(){T(n+": call ignored")}}return{getCode:function(){return"noop"},isParentVerifiable:function(){return true},init:g("init"),setup:g("setup"),call:g("call")}}();if(gadgets.util)G=gadgets.util.getUrlParameters();var Q=false,R=false,E=function(){if(G.rpctx=="flash")return gadgets.rpctx.flash;if(G.rpctx=="rmr")return gadgets.rpctx.rmr;return typeof window.postMessage==="function"?gadgets.rpctx.wpm:
typeof window.postMessage==="object"?gadgets.rpctx.wpm:window.ActiveXObject?gadgets.rpctx.flash?gadgets.rpctx.flash:gadgets.rpctx.nix:navigator.userAgent.indexOf("WebKit")>0?gadgets.rpctx.rmr:navigator.product==="Gecko"?gadgets.rpctx.frameElement:gadgets.rpctx.ifpc}();p[""]=function(){T("Unknown RPC service: "+this.s)};p.__cb=function(g,n){var u=C[g];if(u){delete C[g];u.call(this,n)}};return{config:function(g){if(typeof g.securityCallback==="function")K=g.securityCallback},register:function(g,n){if(g===
"__cb"||g==="__ack")throw Error("Cannot overwrite callback/ack service");if(g==="")throw Error("Cannot overwrite default service: use registerDefault");p[g]=n},unregister:function(g){if(g==="__cb"||g==="__ack")throw Error("Cannot delete callback/ack service");if(g==="")throw Error("Cannot delete default service: use unregisterDefault");delete p[g]},registerDefault:function(g){p[""]=g},unregisterDefault:function(){delete p[""]},forceParentVerifiable:function(){if(!E.isParentVerifiable())E=gadgets.rpctx.ifpc},
call:function(g,n,u){g=g||"..";var s="..";if(g==="..")s=O;else if(g.charAt(0)=="/"){s=gadgets.rpc.getOrigin(window.location.href);s="/"+O+(s?"|"+s:"")}++v;if(u)C[v]=u;var y={s:n,f:s,c:u?v:0,a:Array.prototype.slice.call(arguments,3),t:A[g],l:!!x[g]},w;a:if(L==="bidir"||L==="c2p"&&g===".."||L==="p2c"&&g!==".."){w=window.location.href;var F="?";if(N==="query")F="#";else if(N==="hash"){w=w;break a}F=w.lastIndexOf(F);F=F===-1?w.length:F;w=w.substring(0,F)}else w=null;if(w)y.r=w;if(!(g!==".."&&f(g)==null&&
!document.getElementById(g))){a:{w=g;if(typeof D[w]==="undefined"){D[w]=false;F=k(w);if(e(F)!==e(window.location.href)){w=false;break a}F=i(w);try{D[w]=F.gadgets.rpc.receiveSameDomain}catch(V){}}if(typeof D[w]==="function"){D[w](y);w=true}else w=false}if(!w){w=H[g];if(!w&&f(g)!==null)w=E;if(w){if(x[g])w=gadgets.rpctx.ifpc;if(w.call(g,s,y)===false){H[g]=J;E.call(g,s,y)}}else if(I[g])I[g].push(y);else I[g]=[y]}}},getRelayUrl:k,setRelayUrl:j,setAuthToken:m,setupReceiver:q,getAuthToken:function(g){return A[g]},
removeReceiver:function(g){delete z[g];delete x[g];delete A[g];delete B[g];delete D[g];delete H[g]},getRelayChannel:function(){return E.getCode()},receive:function(g,n){g.length>4?E._receiveMessage(g,d):c.apply(null,g.concat(n))},receiveSameDomain:function(g){g.a=Array.prototype.slice.call(g.a);window.setTimeout(function(){d(g)},0)},getOrigin:e,getTargetOrigin:function(g){var n=null;if(n=k(g))n=n;else n=(n=f(g))?n.origin:g==".."?G.parent:document.getElementById(g).src;return e(n)},init:function(){if(E.init(d,
a)===false)E=J;U?q(".."):gadgets.config.register("rpc",null,function(g){g=g.rpc||{};l(g);o(g)})},_getTargetWin:i,_parseSiblingId:f,ACK:"__ack",RPC_ID:O||"..",SEC_ERROR_LOAD_TIMEOUT:0,SEC_ERROR_FRAME_PHISH:S,SEC_ERROR_FORGED_MSG:M}}();gadgets.rpc.init()};gadgets.views=function(){function a(f){if(!f)f=window.event;var i;if(f.target)i=f.target;else if(f.srcElement)i=f.srcElement;if(i.nodeType===3)i=i.parentNode;if(i.nodeName.toLowerCase()==="a")if((i=i.getAttribute("href"))&&i[0]!=="#"&&i.indexOf("://")===-1){gadgets.views.requestNavigateTo(c,i);f.stopPropagation&&f.stopPropagation();f.preventDefault&&f.preventDefault();f.returnValue=false;f.cancelBubble=true;return false}return false}var b={},c=null,d={},e={};gadgets.config.register("views",null,function(f){f=
f.views||{};for(var i in f)if(f.hasOwnProperty(i))if(i!="rewriteLinks"){var h=f[i],k=i.toUpperCase();b[k]=k;if(h){d[i]=new gadgets.views.View(i,h.isOnlyVisible);k=h.aliases||[];for(var j=0,m;m=k[j];++j)d[m]=new gadgets.views.View(i,h.isOnlyVisible)}}i=gadgets.util.getUrlParameters();if(i["view-params"]){e=gadgets.json.parse(decodeURIComponent(i["view-params"]))||e;e.hasOwnProperty("app_id")&&delete e.app_id}c=d[i.view]||d["default"];f.rewriteLinks&&gadgets.util.attachBrowserEvent(document,"click",
a,false)});return{bind:function(f,i){function h(v,C){return i.hasOwnProperty(v)?i[v]:C}function k(v){if(!(p=v.match(m)))throw Error("Invalid variable : "+v);}function j(v,C,B){var D=v.split(",");for(v=0;v<D.length;++v){k(D[v]);if(B(C,h(p[1]),p[1]))break}return C}if(typeof f!=="string")throw Error("Invalid urlTemplate");if(typeof i!=="object")throw Error("Invalid environment");for(var m=/^([a-zA-Z0-9][a-zA-Z0-9_\.\-]*)(=([a-zA-Z0-9\-\._~]|(%[0-9a-fA-F]{2}))*)?$/,l=RegExp("\\{([^}]*)\\}","g"),o=/^-([a-zA-Z]+)\|([^|]*)\|(.+)$/,
r=[],q=0,t,p,z,x,A;t=l.exec(f);){r.push(f.substring(q,t.index));q=l.lastIndex;if(p=t[1].match(m)){t=p[1];z=p[2]?p[2].substr(1):"";r.push(h(t,z))}else if(p=t[1].match(o)){x=p[1];t=p[2];A=p[3];z=0;switch(x){case "neg":z=1;case "opt":j(A,{flag:z},function(v,C){var B;if(B=typeof C!=="undefined"){a:if(typeof C==="object"||typeof C==="function"){for(var D in C)if(C.hasOwnProperty(D)){B=false;break a}B=true}else B=false;B=!B}if(B){v.flag=!v.flag;return 1}return 0}).flag&&r.push(t);break;case "join":r.push(j(A,
[],function(v,C,B){if(typeof C==="string")v.push(B+"="+C);else if(typeof C==="object")for(var D in C)C.hasOwnProperty(D)&&v.push(D+"="+C[D])}).join(t));break;case "list":k(A);x=h(p[1]);typeof x==="object"&&typeof x.join==="function"&&r.push(x.join(t));break;case "prefix":z=1;case "suffix":k(A);x=h(p[1],p[2]&&p[2].substr(1));if(typeof x==="string")r.push(z?t+x:x+t);else if(typeof x==="object"&&typeof x.join==="function")r.push(z?t+x.join(t):x.join(t)+t);break;default:throw Error("Invalid operator : "+
x);}}else throw Error("Invalid syntax : "+t[0]);}r.push(f.substr(q));return r.join("")},requestNavigateTo:function(f,i,h){if(typeof f!=="string")f=f.getName();gadgets.rpc.call(null,"requestNavigateTo",null,f,i,h)},getCurrentView:function(){return c},getSupportedViews:function(){return d},getParams:function(){return e},ViewType:b}}();gadgets.views.View=function(a,b){this.name_=a;this.isOnlyVisible_=!!b};gadgets.views.View.prototype.getName=function(){return this.name_};
gadgets.views.View.prototype.getUrlTemplate=function(){return gadgets.config&&gadgets.config.views&&gadgets.config.views[this.name_]&&gadgets.config.views[this.name_].urlTemplate};gadgets.views.View.prototype.bind=function(a){return gadgets.views.bind(this.getUrlTemplate(),a)};gadgets.views.View.prototype.isOnlyVisibleGadget=function(){return this.isOnlyVisible_};LJAPP_IPPU=new Class(IPPU,{init:function(a){a||(a="");LJAPP_IPPU.superClass.init.apply(this,[]);this.uniqId=this.generateUniqId();this.setTitle(a);this.setTitlebar(true);this.setTitlebarClass("lj_ippu_titlebar");this.addClass("lj_ippu lj_ippu_app");this.setAutoCenterCallback(IPPU.center);this.setDimensions(514,"auto");this.setFixedPosition(true);this.setOverlayVisible(false);this.setModal(true)},setTitle:function(a){LJAPP_IPPU.superClass.setTitle.apply(this,["<div class='ljappippu_button' id='"+this.uniqId+
"_cancel'></div>"+a]);this.setup_lj_ippu()},updateTitlebar:function(){if(this.showTitlebar&&this.titlebar&&this.title!=this.titlebar.innerHTML){this.titlebar.innerHTML=this.title;this.setup_lj_ippu()}},generateUniqId:function(){var a=new Date;return"lj_ippu_"+a.getHours()+a.getMinutes()+a.getMilliseconds()},show:function(){LJAPP_IPPU.superClass.show.apply(this)},setup_lj_ippu:function(){var a=this.cancel.bind(this);jQuery(this.ele).find("#"+this.uniqId+"_cancel").click(a)},hide:function(){clearInterval(this.timerSetup);
LJAPP_IPPU.superClass.hide.apply(this)}});LJAppWidget=new Class(Object,{init:function(a,b){var c=a.title,d=a.authToken;this.templateID=a.templateID||"";this.finishCallback=a.finishCallback||null;this.widgetName=a.widgetName||"LJAppwidget";b||(b={});this.reqParams=b;var e=new LJAPP_IPPU(c);this.ippu=e;this.widgetId="LJAppWidget_"+Unique.id();var f=document.createElement("div");f.id=this.widgetId;this.widgetNode=f;e.setContentElement(f);e.setModal(true);e.setOverlayVisible(true);e.setClickToClose(false);e.setDimensions("60%","auto");e.setAutoCenter(true,
true);var i=this;this.ippu.setCancelledCallback(function(){i.cancel()});this.cancelOnEscape();a.center&&e.center();this.authToken=d;this.title=c;this.loaded=false;return this},getWidget:function(){return this.widgetNode},loadContent:function(a){var b=this;a=a||"request";this.makeRequest(a,function(c){b.contentLoaded(c)})},submitData:function(a,b){var c=this;a=a||"set";b=b||null;this.makeRequest(a,function(d){c.onData(d)},b)},makeRequest:function(a,b,c){if(!c)c=this.reqParams;c=jQuery.extend({},c);
c.auth_token=this.authToken;c.action=a;url="/__rpc_ljapp_"+this.widgetName;var d=this;jQuery.post(url,c,function(e){e.status==="ERROR"?d.onError(e):b(e)},"json")},cancelOnEscape:function(){var a=this;jQuery(window).add(document).keydown(function(b){b.keyCode===27&&a.ippu.visible()&&a.cancel()})},cancel:function(){this.onError({code:"canceled"});this.close()},onData:function(a){this.onReturn("OK",a)},onError:function(a){this.onReturn("ERROR",a)},onReturn:function(a,b,c){c=c||false;b=b||{};b.status=
a;this.finishCallback&&this.finishCallback(b);c&&this.close()},contentLoaded:function(a){a=a||{};a.messages=a.messages||{};if("auth_token"in a)this.authToken=a.auth_token;var b=jQuery.tmpl(jQuery("#"+this.templateID),a);jQuery(this.getWidget()).empty().append(b);this.loaded=true;this.ippu.center();"title"in a.messages&&this.ippu.setTitle(a.messages.title);this.bindControls();this.ippu.show();this.verifyFocus()},verifyFocus:function(){jQuery("<input>").css({position:"fixed",left:"-30000em",top:"0em"}).appendTo(jQuery(document.body)).focus().remove()},
bindControls:function(){},close:function(){this.ippu.hide()}});LJAppWidget_RequestPermission=new Class(LJAppWidget,{init:function(a){a.templateID="ljappippu_confirm";a.widgetName="permissions";LJAppWidget_RequestPermission.superClass.init.apply(this,arguments)},bindControls:function(){var a=jQuery(this.getWidget()),b=this;a.find("input.ljappippu_confirm_ok").click(function(){b.submitData()});a.find("input.ljappippu_confirm_reject").click(function(){b.cancel()});LJAppWidget_RequestPermission.superClass.bindControls.apply(this)},onData:function(a){this.onReturn("OK",
a,true)},contentLoaded:function(a){a=a||{};this.reqParams.permissions=a.permissions.join(",");LJAppWidget_RequestPermission.superClass.contentLoaded.call(this,a)}});(function(a){LJAppWidget_RequestShareApp=new Class(LJAppWidget,{init:function(b,c){b.templateID="ljappippu_share";b.widgetName="share_app";this.extra=c.extra;delete c.extra;LJAppWidget_RequestShareApp.superClass.init.apply(this,arguments);this.friends={};this.selectedCount=0;this.cachedData={}},initRecipientsList:function(b){var c=this,d=a(".ljappippu_share_selected").itemList({hoverClass:"ljappippu_share_selected_hover",onNewElement:function(f){return jQuery("#ljappippu_share_person").tmpl({username:f,
hasCloseButton:true})},onSelect:function(f){var i=f.data;d.itemList("remove",i).itemList("updateLast");if(i in c.friends){c.selectedCount--;c.friends[i]=0;c.updateSendButton()}b&&b(i);f.preventDefault();f.stopPropagation()}});this.selectedCount=0;for(var e in this.friends)if(this.friends[e].selected){d.itemList("add",e);this.selectedCount++}d.itemList("updateLast");this.updateSendButton();return d},setupFirstStage:function(b){var c=jQuery("#ljappippu_share_choose").tmpl(b),d=this.getWidget(),e=this;
jQuery(d).find(".ljappippu_share_content").empty().append(c);d.className="firstStage";recipientsSelector.init({perPage:0,friends:b.friends,onSelect:function(j){f.itemList("add",j.username).itemList("updateLast");if(j.username in e.friends){e.friends[j.username].selected=1;e.selectedCount++;e.updateSendButton()}}});jQuery("#filter").placeholder().input(function(){recipientsSelector.filter(this.value)});var f=this.initRecipientsList(function(j){recipientsSelector.add(j)}),i=false;jQuery("#ljappippu_share_message").keypress(function(j){i&&
j.preventDefault();var m=this;setTimeout(function(){if(m.value.length>120){m.value=m.value.substring(0,120);i=true;setTimeout(function(){i=false},300)}},0)});jQuery(".ljappippu_share_send").click(function(j){e.sendInvitations();j.preventDefault()});var h=jQuery("#ljappippu_share_message").labeledPlaceholder(),k=jQuery("#ljappippu_share_message").height()+"px";h.css({height:"1.5em"}).focus(function(){h.stop().animate({height:k},200)}).blur(function(){this.value.length===0&&h.stop().animate({height:"1.5em"},
200)});this.ippu.center()},updateSendButton:function(){jQuery(".ljappippu_share_send").attr("disabled",this.selectedCount===0)},setupSecondStage:function(){var b=jQuery("#ljappippu_share_invite").tmpl(),c=this.getWidget();jQuery(c).find(".ljappippu_share_content").empty().append(b);c.className="secondStage";this.ippu.center();var d=this;setTimeout(function(){d.close()},3E3)},sendInvitations:function(){var b=jQuery("#ljappippu_share_message").val()||"",c=[],d;for(d in this.friends)this.friends[d].selected&&
c.push(this.friends[d].userid);b={message:b,recipients:c.join(",")};if(this.extra.length>0)b.extra=this.extra;this.submitData("send",jQuery.extend({},this.reqParams,b))},onData:function(b){this.setupSecondStage();this.onReturn("OK",b,false)},loadContent:function(){LJAppWidget_RequestShareApp.superClass.loadContent.call(this,"select")},contentLoaded:function(b){b=b||{};b.messages=b.messages||{};b.messages.title=b.messages.header;this.cachedData=b;LJAppWidget_RequestShareApp.superClass.contentLoaded.call(this,
b);this.friends={};for(var c=0;c<b.friends.length;++c)this.friends[b.friends[c].display_name]=b.friends[c];b.messages.isEmptyList=b.friends.length===0;this.setupFirstStage(b)}})})(jQuery,window);(function(a){LJAppWidget_RequestPayment=new Class(LJAppWidget,{init:function(b){b.templateID="ljappippu_payment";b.widgetName="payments";this.payment=b.payment;this.balance=0;this.paymentMade=false;this.onSubmitPayment=b.onSubmitPayment||null;"stoken"in this.payment&&delete this.payment.stoken;LJAppWidget_RequestPayment.superClass.init.apply(this,arguments)},bindControls:function(){var b=this;jQuery(this.getWidget()).delegate(".ljappippu_payment_ok","click",function(){b.onSubmitPayment&&b.onSubmitPayment(+new Date);
var c=a.extend({},b.reqParams,{payment:gadgets.json.stringify(b.payment)});b.submitData("pay",c)}).delegate(".ljappippu_payment_reject","click",function(){b.cancel()}).delegate(".ljappippu_payment_add","click",function(){var c=window.open(Site.siteroot+"/shop/tokens.bml");b.checkIfClosed(c)});LJAppWidget_RequestPayment.superClass.bindControls.apply(this)},checkIfClosed:function(b){var c=this,d=false;try{d=b.closed}catch(e){d=true}d?this.refreshDialog():setTimeout(function(){c.checkIfClosed(b)},100)},
refreshDialog:function(){this.loadContent("balance")},loadContent:function(b){if(this.isCorrectPayment()){this.paymentMade=false;LJAppWidget_RequestPayment.superClass.loadContent.call(this,b)}else{gadgets.log("malformed payment");this.onReturn("MALFORMED_REQUEST")}},contentLoaded:function(b){b=b||{};this.balance=parseInt(b.balance,10);a.extend(b,{balance:this.balance,payment:this.payment});LJAppWidget_RequestPayment.superClass.contentLoaded.call(this,b)},onData:function(b){var c=jQuery("#ljappippu_payment_result").tmpl({hasErrors:b.responseCode!==
"OK",isDelivered:b.state==="delivered"}),d=this.getWidget();jQuery(d).find(".ljappippu_inner").empty().append(c);this.ippu.center();this.paymentMade=true;if(b.responseCode==="OK"){var e=this;setTimeout(function(){e.close()},3E3)}this.onReturn("OK",b,false)},isCorrectPayment:function(){if(!("amount"in this.payment))return false;for(var b=this.payment.amount,c=0;c<this.payment.items.length;++c)b-=this.payment.items[c].count*this.payment.items[c].price;return Math.floor(b)===0},cancel:function(){this.paymentMade||
this.onReturn("USER_CANCELLED",null,true)}})})(jQuery,window);(function(){LJAppWidget_RequestPaymentRecords=new Class(LJAppWidget,{init:function(a){a.templateID="ljappippu_payment_records";a.widgetName="payments";LJAppWidget_RequestPaymentRecords.superClass.init.apply(this,arguments)},contentLoaded:function(a){if(a.payments)for(var b=0;b<a.payments.length;++b)a.payments[b].orderedTimeStr=(new Date(a.payments[b].orderedTime)).toLocaleString();LJAppWidget_RequestPaymentRecords.superClass.contentLoaded.apply(this,arguments)}})})(jQuery,window);LJAppWidget_RequestCreatePost=new Class(LJAppWidget,{init:function(a,b){a.templateID="ljappippu_post_event";a.widgetName="post_event";this.post=this._parsePost(a.post);var c=this.post.journal;if(c)b.journal=c;LJAppWidget_RequestCreatePost.superClass.init.apply(this,arguments)},bindControls:function(){var a=this;jQuery(this.getWidget()).find("input.ljappippu_createpost_ok").click(function(){var b=jQuery.extend({},a.reqParams,a.post);b.also_my_journal=jQuery(".ljappippu_event_alsoinmy").prop("checked")?
"1":"0";a.submitData("post",b)});LJAppWidget_RequestCreatePost.superClass.bindControls.apply(this)},onData:function(a){this.onReturn("OK",a,true)},refreshDialog:function(){this.loadContent("preview")},contentLoaded:function(a){a=jQuery.extend({},a,this.post);LJAppWidget_RequestCreatePost.superClass.contentLoaded.call(this,a)},_parsePost:function(a){var b=a.tags;b=b&&b.join(", ")||"";return{journal:a.journal||"",subject:a.subject||"",event:a.body||"",taglist:b}}});LJAppWidget_RequestCreateComment=new Class(LJAppWidget,{init:function(a,b){a.templateID="ljappippu_post_comment";a.widgetName="post_comment";this.comment=this._parseComment(a.comment);b=jQuery.extend({},b,this.comment);LJAppWidget_RequestCreateComment.superClass.init.apply(this,arguments)},bindControls:function(){var a=this;jQuery(this.getWidget()).find("input.ljappippu_createcomment_ok").click(function(){a.submitData("post")});LJAppWidget_RequestCreateComment.superClass.bindControls.apply(this)},
onData:function(a){this.onReturn("OK",a,true)},refreshDialog:function(){this.loadContent("preview")},contentLoaded:function(a){a=jQuery.extend({},a,this.comment);LJAppWidget_RequestCreatePost.superClass.contentLoaded.call(this,a)},_parseComment:function(a){return{journal:a.journal||"",subject:a.subject||"",comment:a.body||"",ditemid:a.ditemid||"",dtalkid:a.dtalkid||""}}});LJAppWidget_OpenGadget=new Class(LJAppWidget,{init:function(a){a.templateID="ljappippu_open_gadget";a.widgetName="open_gadget";LJAppWidget_OpenGadget.superClass.init.apply(this,arguments);this.dialogId=a.dialogId},onData:function(a){this.onReturn("OK",a,true)},close:function(){LJAppWidget_OpenGadget.superClass.close.apply(this,arguments)},cancel:function(){shindig.container.gadgetService.close(this.dialogId)},contentLoaded:function(a){LJAppWidget_OpenGadget.superClass.contentLoaded.apply(this,arguments);
var b=this._iframe=jQuery(a.element),c=jQuery(this.getWidget());this.frameId=b.prop("id");c.append(b);this.setHeight();shindig.container.createGadget(b,"popup",this);b=shindig.container.gadgetService.getGadgetIdFromModuleId(b.prop("id"));c=shindig.container.getGadget(b);c.dialog_id=this.dialogId;c.frame_id=b},setHeight:function(a){if(a&&a>=300){a=a>=300?a:300;this._iframe.height(a);a=a}else a=this._iframe.height();var b=100,c=this._iframe.width();jQuery(this.getWidget());var d=jQuery(window).height();
b=100;a>d-b&&this._iframe.height(d-b);this.ippu.setDimensions(c,"auto");this.ippu.center()},setWidth:function(){},setTitle:function(a){this.ippu.setTitle(a)},refreshDialog:function(){this.loadContent("preview")}});var opensocial=opensocial||{};opensocial.requestShareApp=function(a,b,c,d){opensocial.Container.get().requestShareApp(a,b,c,d)};opensocial.hasPermission=function(a){return opensocial.Container.get().hasPermission(a)};opensocial.requestPermission=function(a,b,c){opensocial.Container.get().requestPermission(a,b,c)};opensocial.EscapeType={HTML_ESCAPE:"htmlEscape",NONE:"none"};
Function.prototype.inherits=function(a){function b(){}this.superClass_=b.prototype=a.prototype;this.prototype=new b;this.prototype.constructor=this};opensocial.Container=function(){};opensocial.Container.container_=null;opensocial.Container.setContainer=function(a){opensocial.Container.container_=a};opensocial.Container.get=function(){return opensocial.Container.container_};opensocial.Container.prototype.requestShareApp=function(a,b,c){c&&window.setTimeout(function(){c(new opensocial.ResponseItem(null,null,opensocial.ResponseItem.Error.NOT_IMPLEMENTED,null))},0)};opensocial.Container.prototype.hasPermission=function(){return false};
opensocial.Container.prototype.requestPermission=function(a,b,c){c&&window.setTimeout(function(){c(new opensocial.ResponseItem(null,null,opensocial.ResponseItem.Error.NOT_IMPLEMENTED,null))},0)};opensocial.Container.isArray=function(a){return a instanceof Array};opensocial.Container.getField=function(a,b,c){return opensocial.Container.escape(a[b],c,false)};
opensocial.Container.escape=function(a,b,c){return b&&b[opensocial.DataRequest.DataRequestFields.ESCAPE_TYPE]==opensocial.EscapeType.NONE?a:gadgets.util.escape(a,c)};opensocial.ResponseItem=function(a,b,c,d){this.originalDataRequest_=a;this.data_=b;this.errorCode_=c;this.errorMessage_=d};opensocial.ResponseItem.prototype.hadError=function(){return!!this.errorCode_};opensocial.ResponseItem.Error={NOT_IMPLEMENTED:"notImplemented",UNAUTHORIZED:"unauthorized",FORBIDDEN:"forbidden",BAD_REQUEST:"badRequest",INTERNAL_ERROR:"internalError",LIMIT_EXCEEDED:"limitExceeded",CANCELED:"canceled"};opensocial.ResponseItem.prototype.getErrorCode=function(){return this.errorCode_};
opensocial.ResponseItem.prototype.getErrorMessage=function(){return this.errorMessage_};opensocial.ResponseItem.prototype.getOriginalDataRequest=function(){return this.originalDataRequest_};opensocial.ResponseItem.prototype.getData=function(){return this.data_};opensocial.BillingItem=function(a){this.fields_=a||{};this.fields_[opensocial.BillingItem.Field.COUNT]=this.fields_[opensocial.BillingItem.Field.COUNT]||1};opensocial.BillingItem.Field={SKU_ID:"skuId",PRICE:"price",COUNT:"count",DESCRIPTION:"description",IMAGE_URL:"imageUrl",IMAGE_WIDTH:"imageWidth",IMAGE_HEIGHT:"imageHeight"};opensocial.BillingItem.prototype.getField=function(a,b){return opensocial.Container.getField(this.fields_,a,b)};
opensocial.BillingItem.prototype.setField=function(a,b){return this.fields_[a]=b};opensocial.Payment=function(a){this.fields_=a||{};this.fields_[opensocial.Payment.Field.PAYMENT_TYPE]=this.fields_[opensocial.Payment.Field.PAYMENT_TYPE]||opensocial.Payment.PaymentType.PAYMENT};opensocial.Payment.prototype.isPayment=function(){return this.fields_[opensocial.Payment.Field.PAYMENT_TYPE]==opensocial.Payment.PaymentType.PAYMENT};opensocial.Payment.prototype.isCredit=function(){return this.fields_[opensocial.Payment.Field.PAYMENT_TYPE]==opensocial.Payment.PaymentType.CREDIT};
opensocial.Payment.prototype.isComplete=function(){return!!this.fields_[opensocial.Payment.Field.PAYMENT_COMPLETE]};opensocial.Payment.Field={SANDBOX:"sandbox",ITEMS:"items",AMOUNT:"amount",MESSAGE:"message",PARAMETERS:"parameters",PAYMENT_TYPE:"paymentType",ORDER_ID:"orderId",ORDERED_TIME:"orderedTime",SUBMITTED_TIME:"submittedTime",EXECUTED_TIME:"executedTime",RESPONSE_CODE:"responseCode",RESPONSE_MESSAGE:"responseMessage",PAYMENT_COMPLETE:"paymentComplete"};
opensocial.Payment.prototype.getField=function(a,b){return opensocial.Container.getField(this.fields_,a,b)};opensocial.Payment.prototype.setField=function(a,b){return this.fields_[a]=b};opensocial.Payment.PaymentType={PAYMENT:"payment",CREDIT:"credit"};
opensocial.Payment.ResponseCode={APP_LOGIC_ERROR:"appLogicError",APP_NETWORK_FAILURE:"appNetworkFailure",INSUFFICIENT_MONEY:"insufficientMoney",INVALID_TOKEN:"invalidToken",MALFORMED_REQUEST:"malformedRequest",NOT_IMPLEMENTED:"notImplemented",OK:"ok",PAYMENT_ERROR:"paymentError",PAYMENT_PROCESSOR_ALREADY_OPENED:"paymentProcessorAlreadyOpened",UNKNOWN_ERROR:"unknownError",USER_CANCELLED:"userCancelled"};
opensocial.Payment.RecordsRequestFields={MAX:"max",IS_COMPLETE:"is_complete",START_TIME:"start_time",TYPE:"type"};var JsonPayment=function(a,b){a=a||{};b||JsonPayment.constructArrayObject(a,"items",JsonBillingItem);opensocial.Payment.call(this,a)};JsonPayment.inherits(opensocial.Payment);JsonPayment.prototype.toJsonObject=function(){for(var a=JsonPayment.copyFields(this.fields_),b=a.items||[],c=[],d=0;d<b.length;d++)c[d]=b[d].toJsonObject();a.items=c;return a};var JsonBillingItem=function(a){opensocial.BillingItem.call(this,a)};JsonBillingItem.inherits(opensocial.BillingItem);
JsonBillingItem.prototype.toJsonObject=function(){return JsonPayment.copyFields(this.fields_)};JsonPayment.constructArrayObject=function(a,b,c){if(a=a[b])for(b=0;b<a.length;b++)a[b]=new c(a[b])};JsonPayment.copyFields=function(a){var b={},c;for(c in a)b[c]=a[c];return b};opensocial.requestPayment=function(a,b){opensocial.Container.get().requestPayment(a,b)};opensocial.requestPaymentRecords=function(a,b){opensocial.Container.get().requestPaymentRecords(a,b)};opensocial.newPayment=function(a){return opensocial.Container.get().newPayment(a)};opensocial.newBillingItem=function(a){return opensocial.Container.get().newBillingItem(a)};shindig=shindig||{};
shindig.paymentprocessor=function(){function a(i){var h=null;h={};h.frameId=i;return h}function b(i,h){if(d)h.responseCode="PAYMENT_PROCESSOR_ALREADY_OPENED";if(!h.amount||h.amount<=0)h.responseCode="MALFORMED_REQUEST";f.paymentOpen||(h.responseCode="NOT_IMPLEMENTED");e=a(this.f);if("stoken"in h)e.stoken=h.stoken;if(e==null)h.responseCode="NOT_IMPLEMENTED";if(h.responseCode&&h.responseCode!="OK")try{gadgets.rpc.call(this.f,"shindig.requestPayment_callback",null,i,h)}finally{return}d=true;h.orderedTime=
(new Date).getTime();h.message=gadgets.util.escapeString(h.message);e.callbackId=i;e.payment=h;f.paymentOpen()}function c(i,h){var k={payments:{}};if(d)k.responseCode="PAYMENT_PROCESSOR_ALREADY_OPENED";f.paymentRecordsOpen||(k.responseCode="NOT_IMPLEMENTED");if(k.responseCode&&k.responseCode!="OK")try{gadgets.rpc.call(this.f,"shindig.requestPaymentRecords_callback",null,i,k)}finally{return}d=true;e=a(this.f);e.callbackId=i;e.records=k;e.reqParams=h;f.paymentRecordsOpen()}var d=false,e=null,f={};return{initPayment:function(i,
h){f.paymentOpen=i;f.paymentClose=h;gadgets.rpc.register("shindig.requestPayment",b)},initPaymentRecords:function(i,h){f.paymentRecordsOpen=i;f.paymentRecordsClose=h;gadgets.rpc.register("shindig.requestPaymentRecords",c)},openPayment:b,closePayment:function(){if(d){f.paymentClose&&f.paymentClose();try{gadgets.rpc.call(e.frameId,"shindig.requestPayment_callback",null,e.callbackId,e.payment)}catch(i){}finally{d=false;e=null}}},openPaymentRecords:c,closePaymentRecords:function(){if(d){f.paymentRecordsClose&&
f.paymentRecordsClose();try{gadgets.rpc.call(e.frameId,"shindig.requestPaymentRecords_callback",null,e.callbackId,e.records)}finally{d=false;e=null}}},getParam:function(i){if(!i)return null;var h=null;try{var k=i.split(".");if(k.length>0){i=e;for(var j=0;j<k.length;j++)i=i[k[j]];h=i}}catch(m){h=null}return h},setParam:function(i,h){if(i){var k=i.split(".");if(k.length>1){for(var j=e,m=0;m<k.length-1;m++)j=j[k[m]];j[k[k.length-1]]=h}}}}}();var paymentProcessor=function(){function a(){var i=e.getParam("frameId");i=shindig.container.gadgetService.getGadgetIdFromModuleId(i);return shindig.container.getGadget(i)}function b(){var i=e.getParam("payment.stoken"),h=a();e.setParam("payment.stoken",null);f=new LJAppWidget_RequestPayment({title:paymentProcessor.requestPaymentTitle,finishCallback:c,payment:e.getParam("payment"),onSubmitPayment:function(k){e.setParam("payment.submittedTime",k)},authToken:h.auth_token},{app_id:h.app_id,st:i});f.loadContent("balance")}
function c(i){var h=i.responseCode||i.status;e.setParam("payment.responseCode",h);e.setParam("payment.responseMessage",i.responseMessage);if(h=="OK"){e.setParam("payment.paymentComplete",i.state==="delivered");e.setParam("payment.executedTime",i.executedTime);e.setParam("payment.orderId",i.orderId);LiveJournal.run_hook("update_wallet_balance")}e.closePayment()}function d(){var i=e.getParam("reqParams.stoken"),h=a();e.setParam("reqParams.stoken",null);f=new LJAppWidget_RequestPaymentRecords({title:paymentProcessor.requestPaymentRecordsTitle,
finishCallback:function(){e.closePaymentRecords()},authToken:h.auth_token},{app_id:h.app_id,st:i,payment:gadgets.json.stringify(e.getParam("reqParams.payment")),type:e.getParam("reqParams.type"),max:e.getParam("reqParams.max"),start_time:e.getParam("reqParams.start_time"),is_complete:e.getParam("reqParams.is_complete")});f.loadContent("history")}var e,f;return{init:function(){e=shindig.paymentprocessor;e.initPayment(b);e.initPaymentRecords(d)}}}();paymentProcessor.init();(function(){osapi.newBatch=function(a){var b={},c=[],d=a||null,e=function(f){var i={method:f.request.method,id:f.key};if(f.request.rpc)i.params=f.request.rpc;return i};b.execute=function(f){for(var i={},h={},k=0,j=[],m=0;m<c.length;m++){var l=c[m].request.transport;if(!h[l.name]){j.push(l);k++}h[l.name]=h[l.name]||[];h[l.name].push(e(c[m]))}m=function(o){if(o.error)i.error=o.error;for(var r=0;r<c.length;r++){var q=c[r].key,t=o[q];if(t)i[q]=t.error?t:t.data||t.result}k--;k===0&&f(i)};for(l=0;l<j.length;l++)j[l].execute(h[j[l].name],
m,d);k==0&&window.setTimeout(function(){f(i)},0)};b.add=function(f,i){i&&f&&c.push({key:f,request:i});return b};return b}})();osapi._registerMethod=function(a,b){if(a!=="newBatch"){for(var c=a.split("."),d=osapi,e=0;e<c.length-1;e++){d[c[e]]=d[c[e]]||{};d=d[c[e]]}var f=c[c.length-1],i;if(d[f])i=d[f];d[f]=function(h,k,j){h=h||{};h.userId=h.userId||"@viewer";h.groupId=h.groupId||"@self";if(osapi.container){h=new osapi._BoundCall(a,b,h,j);h.execute(k)}else return h=new osapi._BoundCall(a,b,h)};if(typeof tamings___!=="undefined"){c=function(){caja___.markTameAsFunction(d[f],a)};if(i&&i.__taming_index){d[f].__taming_index=i.__taming_index;
tamings___[i.__taming_index]=c}else{d[f].__taming_index=tamings___.length;tamings___.push(c)}}}};osapi._BoundCall=function(a,b,c,d){this.method=a;this.transport=b;this.rpc=c;this.token=d};osapi._BoundCall.prototype.execute=function(a){var b=typeof caja___!=="undefined"&&caja___.getUseless&&caja___.getUseless(),c=b?caja___.getUseless():this,d=b?caja___.untame(a):a;a=osapi.newBatch(this.token);a.add(this.method,this);a.execute(function(e){e.error?d.call(c,e.error):d.call(c,e[c.method])})};(function(){function a(d,e,f){d={POST_DATA:gadgets.json.stringify(d),CONTENT_TYPE:"JSON",METHOD:"POST",AUTHORIZATION:"SIGNED"};var i={"Content-Type":"application/json"},h=this.name;if(f)if(c)i.Authorization="OAuth2 "+f;else{h+="?st=";h+=encodeURIComponent(f)}gadgets.io.makeNonProxiedRequest(h,function(k){if(k.errors[0])e({error:{code:k.rc,message:k.text}});else{k=k.result||k.data;if(k.error)e(k);else{for(var j={},m=0;m<k.length;m++)j[k[m].id]=k[m];e(j)}}},d,i)}function b(d){var e=d["osapi.services"];
c=d["osapi.useOAuth2"];if(e)for(var f in e)if(e.hasOwnProperty(f))if(f.indexOf("http")==0||f.indexOf("//")==0){d={name:f.replace("%host%",document.location.host),execute:a};for(var i=e[f],h=0;h<i.length;h++)osapi._registerMethod(i[h],d)}}var c;gadgets.config&&gadgets.config.register("osapi.services",null,b)})();shindig.errors={};shindig.errors.SUBCLASS_RESPONSIBILITY="subclass responsibility";shindig.errors.TO_BE_DONE="to be done";shindig.callAsyncAndJoin=function(a,b,c){for(var d=a.length,e=[],f=0;f<a.length;f++)(function(i){var h=a[i];if(typeof h==="string")h=c[h];h.call(c,function(k){e[i]=k;--d===0&&b(e)})})(f)};shindig.Extensible=function(){};shindig.Extensible.prototype.setDependencies=function(a){for(var b in a)this[b]=a[b]};shindig.Extensible.prototype.getDependencies=function(a){return this[a]};
shindig.UserPrefStore=function(){};shindig.UserPrefStore.prototype.getPrefs=function(){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.UserPrefStore.prototype.savePrefs=function(){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.DefaultUserPrefStore=function(){shindig.UserPrefStore.call(this)};shindig.DefaultUserPrefStore.inherits(shindig.UserPrefStore);shindig.DefaultUserPrefStore.prototype.getPrefs=function(){};shindig.DefaultUserPrefStore.prototype.savePrefs=function(){};
shindig.GadgetService=function(){};shindig.GadgetService.prototype.setHeight=function(){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.GadgetService.prototype.setTitle=function(){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.GadgetService.prototype.setUserPref=function(){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};
shindig.IfrGadgetService=function(){shindig.GadgetService.call(this);gadgets.rpc.register("resize_iframe",this.setHeight);gadgets.rpc.register("set_pref",this.setUserPref);gadgets.rpc.register("set_title",this.setTitle);gadgets.rpc.register("requestNavigateTo",this.requestNavigateTo);gadgets.rpc.register("requestSendMessage",this.requestSendMessage)};shindig.IfrGadgetService.inherits(shindig.GadgetService);
shindig.IfrGadgetService.prototype.setHeight=function(a){if(a>shindig.container.maxheight_)a=shindig.container.maxheight_;var b=document.getElementById(this.f);if(b)b.style.height=a+"px"};shindig.IfrGadgetService.prototype.setTitle=function(a){var b=document.getElementById(this.f+"_title");if(b)b.innerHTML=a.replace(/&/g,"&amp;").replace(/</g,"&lt;")};
shindig.IfrGadgetService.prototype.setUserPref=function(){var a=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);a=shindig.container.getGadget(a);for(var b=1,c=arguments.length;b<c;b+=2)this.userPrefs[arguments[b]].value=arguments[b+1];a.saveUserPrefs()};shindig.IfrGadgetService.prototype.requestSendMessage=function(a,b,c){c&&window.setTimeout(function(){c(new opensocial.ResponseItem(null,null,opensocial.ResponseItem.Error.NOT_IMPLEMENTED,null))},0)};
shindig.IfrGadgetService.prototype.requestNavigateTo=function(a,b){shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);var c=shindig.container.gadgetService.getUrlForView(a);if(b){var d=gadgets.json.stringify(b);if(d.length>0)c+="&appParams="+encodeURIComponent(d)}if(c&&document.location.href.indexOf(c)==-1)document.location.href=c};shindig.IfrGadgetService.prototype.getUrlForView=function(a){return a==="canvas"?"/canvas":a==="profile"?"/profile":null};
shindig.IfrGadgetService.prototype.getGadgetIdFromModuleId=function(a){return parseInt(a.match(/_([0-9]+)$/)[1],10)};shindig.LayoutManager=function(){};shindig.LayoutManager.prototype.getGadgetChrome=function(){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.StaticLayoutManager=function(){shindig.LayoutManager.call(this)};shindig.StaticLayoutManager.inherits(shindig.LayoutManager);shindig.StaticLayoutManager.prototype.setGadgetChromeIds=function(a){this.gadgetChromeIds_=a};
shindig.StaticLayoutManager.prototype.getGadgetChrome=function(a){return(a=this.gadgetChromeIds_[a.id])?document.getElementById(a):null};shindig.FloatLeftLayoutManager=function(a){shindig.LayoutManager.call(this);this.layoutRootId_=a};shindig.FloatLeftLayoutManager.inherits(shindig.LayoutManager);
shindig.FloatLeftLayoutManager.prototype.getGadgetChrome=function(){var a=document.getElementById(this.layoutRootId_);if(a){var b=document.createElement("div");b.className="gadgets-gadget-chrome";b.style.cssFloat="left";a.appendChild(b);return b}else return null};shindig.Gadget=function(a){this.userPrefs={};if(a)for(var b in a)if(a.hasOwnProperty(b))this[b]=a[b];if(!this.secureToken)this.secureToken="john.doe:john.doe:appid:cont:url:0:default"};
shindig.Gadget.prototype.setServerBase=function(a){this.serverBase_=a};shindig.Gadget.prototype.getServerBase=function(){return this.serverBase_};shindig.Gadget.prototype.getUserPrefs=function(){return this.userPrefs};shindig.Gadget.prototype.saveUserPrefs=function(){shindig.container.userPrefStore.savePrefs(this)};shindig.Gadget.prototype.getUserPrefValue=function(a){a=this.userPrefs[a];return typeof a.value!="undefined"&&a.value!=null?a.value:a["default"]};
shindig.Gadget.prototype.render=function(a){if(a){var b=this;this.getContent(function(c){a.innerHTML=c;b.finishRender(a)})}};shindig.Gadget.prototype.getContent=function(a){shindig.callAsyncAndJoin(["getTitleBarContent","getUserPrefsDialogContent","getMainContent"],function(b){a(b.join(""))},this)};shindig.Gadget.prototype.getTitleBarContent=function(){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};
shindig.Gadget.prototype.getUserPrefsDialogContent=function(){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Gadget.prototype.getMainContent=function(){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Gadget.prototype.finishRender=function(){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Gadget.prototype.getAdditionalParams=function(){return""};
shindig.BaseIfrGadget=function(a){shindig.Gadget.call(this,a);if(this.serverBase_){if(this.serverBase_.indexOf("/gadgets")<0)this.serverBase_+="/gadgets/"}else this.serverBase_="/gadgets/";this.queryIfrGadgetType_()};shindig.BaseIfrGadget.inherits(shindig.Gadget);shindig.BaseIfrGadget.prototype.GADGET_IFRAME_PREFIX_="remote_iframe_";shindig.BaseIfrGadget.prototype.CONTAINER="default";shindig.BaseIfrGadget.prototype.cssClassGadget="gadgets-gadget";shindig.BaseIfrGadget.prototype.cssClassTitleBar="gadgets-gadget-title-bar";
shindig.BaseIfrGadget.prototype.cssClassTitle="gadgets-gadget-title";shindig.BaseIfrGadget.prototype.cssClassTitleButtonBar="gadgets-gadget-title-button-bar";shindig.BaseIfrGadget.prototype.cssClassGadgetUserPrefsDialog="gadgets-gadget-user-prefs-dialog";shindig.BaseIfrGadget.prototype.cssClassGadgetUserPrefsDialogActionBar="gadgets-gadget-user-prefs-dialog-action-bar";shindig.BaseIfrGadget.prototype.cssClassTitleButton="gadgets-gadget-title-button";
shindig.BaseIfrGadget.prototype.cssClassGadgetContent="gadgets-gadget-content";shindig.BaseIfrGadget.prototype.rpcToken=2147483647*Math.random()|0;shindig.BaseIfrGadget.prototype.rpcRelay="../container/rpc_relay.html";
shindig.BaseIfrGadget.prototype.getTitleBarContent=function(a){var b=this.hasViewablePrefs_()?'<a href="#" onclick="shindig.container.getGadget('+this.id+').handleOpenUserPrefsDialog();return false;" class="'+this.cssClassTitleButton+'">settings</a> ':"";a('<div id="'+this.cssClassTitleBar+"-"+this.id+'" class="'+this.cssClassTitleBar+'"><span id="'+this.getIframeId()+'_title" class="'+this.cssClassTitle+'">'+(this.title?this.title:"Title")+'</span> | <span class="'+this.cssClassTitleButtonBar+'">'+
b+'<a href="#" onclick="shindig.container.getGadget('+this.id+').handleToggle();return false;" class="'+this.cssClassTitleButton+'">toggle</a></span></div>')};shindig.BaseIfrGadget.prototype.getUserPrefsDialogContent=function(a){a('<div id="'+this.getUserPrefsDialogId()+'" class="'+this.cssClassGadgetUserPrefsDialog+'"></div>')};shindig.BaseIfrGadget.prototype.getMainContent=function(a){var b=this;window.setTimeout(function(){b.getMainContent(a)},0)};
shindig.BaseIfrGadget.prototype.getIframeId=function(){return this.GADGET_IFRAME_PREFIX_+this.id};shindig.BaseIfrGadget.prototype.getUserPrefsDialogId=function(){return this.getIframeId()+"_userPrefsDialog"};shindig.BaseIfrGadget.prototype.getUserPrefsParams=function(){var a="",b;for(b in this.getUserPrefs())a+="&up_"+encodeURIComponent(b)+"="+encodeURIComponent(this.getUserPrefValue(b));return a};
shindig.BaseIfrGadget.prototype.handleToggle=function(){var a=document.getElementById(this.getIframeId());if(a){a=a.parentNode;a.style.display=a.style.display?"":"none"}};shindig.BaseIfrGadget.prototype.hasViewablePrefs_=function(){for(var a in this.getUserPrefs())if(this.userPrefs[a].type!="hidden")return true;return false};
shindig.BaseIfrGadget.prototype.handleOpenUserPrefsDialog=function(){if(this.userPrefsDialogContentLoaded)this.showUserPrefsDialog();else{var a=this;window["ig_callback_"+this.id]=function(c){a.userPrefsDialogContentLoaded=true;a.buildUserPrefsDialog(c);a.showUserPrefsDialog()};var b=document.createElement("script");b.src="http://www.gmodules.com/ig/gadgetsettings?mid="+this.id+"&output=js"+this.getUserPrefsParams()+"&url="+this.specUrl;document.body.appendChild(b)}};
shindig.BaseIfrGadget.prototype.buildUserPrefsDialog=function(a){var b=document.getElementById(this.getUserPrefsDialogId());b.innerHTML=a+'<div class="'+this.cssClassGadgetUserPrefsDialogActionBar+'"><input type="button" value="Save" onclick="shindig.container.getGadget('+this.id+').handleSaveUserPrefs()"> <input type="button" value="Cancel" onclick="shindig.container.getGadget('+this.id+').handleCancelUserPrefs()"></div>';b.childNodes[0].style.display=""};
shindig.BaseIfrGadget.prototype.showUserPrefsDialog=function(a){document.getElementById(this.getUserPrefsDialogId()).style.display=a||a===undefined?"":"none"};shindig.BaseIfrGadget.prototype.hideUserPrefsDialog=function(){this.showUserPrefsDialog(false)};
shindig.BaseIfrGadget.prototype.handleSaveUserPrefs=function(){this.hideUserPrefsDialog();for(var a=document.getElementById("m_"+this.id+"_numfields").value,b=0;b<a;b++){var c=document.getElementById("m_"+this.id+"_"+b);this.userPrefs[c.name.substring(("m_"+this.id+"_up_").length)].value=c.value}this.saveUserPrefs();this.refresh()};shindig.BaseIfrGadget.prototype.handleCancelUserPrefs=function(){this.hideUserPrefsDialog()};
shindig.BaseIfrGadget.prototype.refresh=function(){var a=this.getIframeId();document.getElementById(a).src=this.getIframeUrl(Math.random())};
shindig.BaseIfrGadget.prototype.queryIfrGadgetType_=function(){var a={CONTENT_TYPE:"JSON",METHOD:"POST",POST_DATA:gadgets.json.stringify({context:{country:"default",language:"default",view:"default",container:"default"},gadgets:[{url:this.specUrl,moduleId:1}]})};gadgets.io.makeNonProxiedRequest(this.serverBase_+"metadata?st="+this.secureToken,function(c){var d=false;c=c.data.gadgets[0].features;for(var e=0;e<c.length;e++)if(c[e]==="pubsub-2"){d=true;break}d=d?shindig.OAAIfrGadget:shindig.IfrGadget;
for(var f in d)if(d.hasOwnProperty(f))b[f]=d[f]},a,{"Content-Type":"application/javascript"});var b=this};
shindig.IfrGadget={getMainContent:function(a){var b=this.getIframeId();gadgets.rpc.setRelayUrl(b,this.serverBase_+this.rpcRelay);gadgets.rpc.setAuthToken(b,this.rpcToken);a('<div class="'+this.cssClassGadgetContent+'"><iframe id="'+b+'" name="'+b+'" class="'+this.cssClassGadget+'" src="about:blank" frameborder="no" scrolling="no"'+(this.height?' height="'+this.height+'"':"")+(this.width?' width="'+this.width+'"':"")+"></iframe></div>")},finishRender:function(){window.frames[this.getIframeId()].location=
this.getIframeUrl()},getIframeUrl:function(a){return this.serverBase_+"ifr?container="+this.CONTAINER+"&mid="+this.id+"&nocache="+shindig.container.nocache_+"&country="+shindig.container.country_+"&lang="+shindig.container.language_+"&view="+shindig.container.view_+(this.specVersion?"&v="+this.specVersion:"")+(shindig.container.parentUrl_?"&parent="+encodeURIComponent(shindig.container.parentUrl_):"")+(this.debug?"&debug=1":"")+this.getAdditionalParams()+this.getUserPrefsParams()+(this.secureToken?
"&st="+this.secureToken:"")+"&url="+encodeURIComponent(this.specUrl)+(this.viewParams?"&view-params="+encodeURIComponent(gadgets.json.stringify(this.viewParams)):"")+(a?"&r="+a:"")+"#rpctoken="+this.rpcToken+(this.hashData?"&"+this.hashData:"")}};
shindig.OAAIfrGadget={getMainContent:function(a){a('<div id="'+this.cssClassGadgetContent+"-"+this.id+'" class="'+this.cssClassGadgetContent+'"></div>')},finishRender:function(){var a={className:this.cssClassGadget,frameborder:"no",scrolling:"no"};if(this.height)a.height=this.height;if(this.width)a.width=this.width;new OpenAjax.hub.IframeContainer(gadgets.pubsub2router.hub,this.getIframeId(),{Container:{onSecurityAlert:function(b,c){gadgets.error("Security error for container "+b.getClientID()+" : "+
c);b.getIframe().src="about:blank"}},IframeContainer:{parent:document.getElementById(this.cssClassGadgetContent+"-"+this.id),uri:this.getIframeUrl(),tunnelURI:shindig.uri(this.serverBase_+this.rpcRelay).resolve(shindig.uri(window.location.href)),iframeAttrs:a}})},getIframeUrl:function(a){return this.serverBase_+"ifr?container="+this.CONTAINER+"&mid="+this.id+"&nocache="+shindig.container.nocache_+"&country="+shindig.container.country_+"&lang="+shindig.container.language_+"&view="+shindig.container.view_+
(this.specVersion?"&v="+this.specVersion:"")+(this.debug?"&debug=1":"")+this.getAdditionalParams()+this.getUserPrefsParams()+(this.secureToken?"&st="+this.secureToken:"")+"&url="+encodeURIComponent(this.specUrl)+(this.viewParams?"&view-params="+encodeURIComponent(gadgets.json.stringify(this.viewParams)):"")+(a?"&r="+a:"")+(this.hashData?"#"+this.hashData:"")}};
shindig.Container=function(){this.gadgets_={};this.parentUrl_="http://"+document.location.host;this.language_=this.country_="ALL";this.view_="default";this.nocache_=1;this.maxheight_=2147483647};shindig.Container.inherits(shindig.Extensible);shindig.Container.prototype.gadgetClass=shindig.Gadget;shindig.Container.prototype.userPrefStore=new shindig.DefaultUserPrefStore;shindig.Container.prototype.gadgetService=new shindig.GadgetService;shindig.Container.prototype.layoutManager=new shindig.StaticLayoutManager;
shindig.Container.prototype.setParentUrl=function(a){this.parentUrl_=a};shindig.Container.prototype.setCountry=function(a){this.country_=a};shindig.Container.prototype.setNoCache=function(a){this.nocache_=a};shindig.Container.prototype.setLanguage=function(a){this.language_=a};shindig.Container.prototype.setView=function(a){this.view_=a};shindig.Container.prototype.setMaxHeight=function(a){this.maxheight_=a};shindig.Container.prototype.getGadgetKey_=function(a){return"gadget_"+a};
shindig.Container.prototype.getGadget=function(a){return this.gadgets_[this.getGadgetKey_(a)]};shindig.Container.prototype.createGadget=function(a){return new this.gadgetClass(a)};shindig.Container.prototype.addGadget=function(a){a.id=this.getNextGadgetInstanceId();this.gadgets_[this.getGadgetKey_(a.id)]=a};shindig.Container.prototype.addGadgets=function(a){for(var b=0;b<a.length;b++)this.addGadget(a[b])};shindig.Container.prototype.renderGadgets=function(){for(var a in this.gadgets_)this.renderGadget(this.gadgets_[a])};
shindig.Container.prototype.renderGadget=function(){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY);};shindig.Container.prototype.nextGadgetInstanceId_=0;shindig.Container.prototype.getNextGadgetInstanceId=function(){return this.nextGadgetInstanceId_++};shindig.Container.prototype.refreshGadgets=function(){for(var a in this.gadgets_)this.gadgets_[a].refresh()};shindig.IfrContainer=function(){shindig.Container.call(this)};shindig.IfrContainer.inherits(shindig.Container);
shindig.IfrContainer.prototype.gadgetClass=shindig.BaseIfrGadget;shindig.IfrContainer.prototype.gadgetService=new shindig.IfrGadgetService;shindig.IfrContainer.prototype.setParentUrl=function(a){a.match(/^http[s]?:\/\//)||(a=document.location.href.match(/^[^?#]+\//)[0]+a);this.parentUrl_=a};if(gadgets&&gadgets.rpc){osapi._handleGadgetRpcMethod=function(a,b){for(var c=Array(a.length),d=0,e=this.callback,f=function(m,l){l({})},i=0;i<a.length;i++){var h=osapi;if(a[i].method.indexOf("_")==-1)for(var k=a[i].method.split("."),j=0;j<k.length;j++)if(h.hasOwnProperty(k[j]))h=h[k[j]];else{h=f;break}else h=f;h(a[i].params,function(m){return function(l){c[m]={id:a[m].id,data:l};d++;d==a.length&&e(c)}}(i),b)}};osapi.container={};osapi.container.listMethods=function(a,b){var c=[];recurseNames(osapi,
"",5,c);b(c)};var recurseNames=function(a,b,c,d){if(c!=0)for(var e in a)if(a.hasOwnProperty(e))if(e.indexOf("_")==-1){var f=typeof a[e];if(f=="function")d.push(b+e);else f=="object"&&recurseNames(a[e],b+e+".",c-1,d)}};gadgets.rpc.register("osapi._handleGadgetRpcMethod",osapi._handleGadgetRpcMethod)};osapi.container={};osapi.container.MetadataParam={LOCAL_EXPIRE_TIME:"localExpireTimeMs",URL:"url"};osapi.container.MetadataResponse={IFRAME_URL:"iframeUrl",NEEDS_TOKEN_REFRESH:"needsTokenRefresh",VIEWS:"views",EXPIRE_TIME_MS:"expireTimeMs",FEATURES:"features",HEIGHT:"height",MODULE_PREFS:"modulePrefs",PREFERRED_HEIGHT:"preferredHeight",PREFERRED_WIDTH:"preferredWidth",RESPONSE_TIME_MS:"responseTimeMs",WIDTH:"width"};osapi.container.TokenResponse={TOKEN:"token"};
osapi.container.NavigateTiming={URL:"url",ID:"id",START:"start",XRT:"xrt",SRT:"srt",DL:"dl",OL:"ol",PRT:"prt"};osapi.container.RenderParam={ALLOW_DEFAULT_VIEW:"allowDefaultView",CAJOLE:"cajole",CLASS:"class",DEBUG:"debug",HEIGHT:"height",NO_CACHE:"nocache",TEST_MODE:"testmode",USER_PREFS:"userPrefs",VIEW:"view",WIDTH:"width"};osapi.container.ViewParam={VIEW:"view"};osapi.container.CallbackType={ON_PRELOADED:"onPreloaded",ON_NAVIGATED:"onNavigated",ON_CLOSED:"onClosed",ON_UNLOADED:"onUnloaded",ON_RENDER:"onRender"};osapi.container.util={};osapi.container.util.getSafeJsonValue=function(a,b,c){return a[b]!=undefined&&a[b]!=null?a[b]:c};osapi.container.util.mergeJsons=function(a,b){var c={},d;for(d in a)c[d]=a[d];for(d in b)c[d]=b[d];return c};
osapi.container.util.newMetadataRequest=function(a){osapi.container.util.isArray(a)||(a=[a]);return{container:window.__CONTAINER,ids:a,fields:["iframeUrl","modulePrefs.*","needsTokenRefresh","userPrefs.*","views.preferredHeight","views.preferredWidth","expireTimeMs","responseTimeMs","rpcServiceIds"]}};osapi.container.util.newTokenRequest=function(a){osapi.container.util.isArray(a)||(a=[a]);return{container:window.__CONTAINER,ids:a,fields:["token"]}};
osapi.container.util.toArrayOfJsonKeys=function(a){var b=[],c;for(c in a)b.push(c);return b};osapi.container.util.isArray=function(a){return Object.prototype.toString.call(a)=="[object Array]"};osapi.container.util.isEmptyJson=function(a){for(var b in a)return false;return true};osapi.container.util.warn=function(a){console&&console.warn&&console.warn(a)};osapi.container.util.getCurrentTimeMs=function(){return(new Date).getTime()};
osapi.container.util.createIframeHtml=function(a){var b=[];b.push("<iframe ");for(var c in a){var d=a[c];if(d){b.push(c);b.push('="');b.push(d);b.push('" ')}}b.push("></iframe>");return b.join("")};osapi.container.Service=function(a){a=this.config_=a||{};this.registerOsapiServices();this.onConstructed(a)};osapi.container.Service.prototype.onConstructed=function(){};osapi.container.Service.prototype.registerOsapiServices=function(){gadgets.config.init({rpc:{parentRelayUrl:""},views:gadgets.config.views,"osapi.services":{"http://%host%/__api_endpoint/os/1.0/rpc":["people.get","people.getViewer","people.getViewerFriends","people.getOwner","people.getOwnerFriends"]}})};osapi.container.Container=function(a){a=this.config_=a||{};this.service_=new osapi.container.Service(a);this.initializeMixins_();this.onConstructed(a)};osapi.container.Container.prototype.onConstructed=function(){};osapi.container.Container.addMixin=function(a,b){osapi.container.Container.prototype.mixins_[a]=b};osapi.container.Container.prototype.mixins_={};osapi.container.Container.prototype.initializeMixins_=function(){for(var a in this.mixins_)this[a]=new this.mixins_[a](this)};shindig.LJIfrGadgetService=function(){shindig.IfrGadgetService.call(this);this.bindRpcMethods()};shindig.LJIfrGadgetService.inherits(shindig.IfrGadgetService);(function(){var a={};shindig.LJIfrGadgetService.registerRpcMethod=function(b,c){var d;if(arguments.length===1)d=b;else{d={};d[b]=c}for(var e in d)if(d.hasOwnProperty(e))a[e]=d[e]};shindig.LJIfrGadgetService.prototype.bindRpcMethods=function(){for(var b in a)a.hasOwnProperty(b)&&gadgets.rpc.register(b,this[a[b]])}})();
shindig.LJIfrGadgetService.registerRpcMethod({resize_iframe:"setHeight",set_title:"setTitle",requestNavigateTo:"requestNavigateTo","shindig.requestPermission":"requestPermission","shindig.requestShareApp":"requestShareApp","shindig.refreshSecurityToken":"refreshSecurityToken",set_pref:"setUserPref",requestSendMessage:"requestSendMessage"});shindig.LJIfrGadgetService.prototype.setHeight=function(a){var b=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);shindig.container.getGadget(b).setHeight(a)};
shindig.LJIfrGadgetService.prototype.setTitle=function(a){var b=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);shindig.container.getGadget(b).setTitle(a)};
shindig.LJIfrGadgetService.prototype.requestNavigateTo=function(a,b,c){var d=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);d=shindig.container.getGadget(d);var e=gadgets.views.getSupportedViews();c=c||d.owner_name;jQuery("#"+this.f);a=a.toUpperCase();if(!e.hasOwnProperty(a)||jQuery.inArray(a,d.available_views)===-1)return null;a=shindig.container._getUrlForView(a,d,c,b);b=b||{};b.app_id=d.app_id;for(var f in b)b.hasOwnProperty(f)&&!b[f]&&delete b[f];b=gadgets.json.stringify(b);f=
(f=/#(.+)$/.exec(a))&&f[0]||"";a=a.replace(f,"");if(b.length>0)a+=(a.indexOf("?")===-1?"?":"&")+"appParams="+encodeURIComponent(b);a+=f;if(a)document.location.href=a};
shindig.LJIfrGadgetService.prototype.requestPermission=function(a,b,c,d){var e=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);e=shindig.container.getGadget(e);var f=e.app_id,i=this.f;(new LJAppWidget_RequestPermission({title:"Ask Permission",finishCallback:function(h){h.status=="ERROR"?gadgets.rpc.call(i,"shindig.requestPermission_callback",null,a,h.code,h.message):gadgets.rpc.call(i,"shindig.requestPermission_callback",null,a,0,"",h.permissions)},authToken:e.auth_token},{reason:c||
"",permissions:b.join(","),app_id:f,st:d})).loadContent()};
shindig.LJIfrGadgetService.prototype.requestShareApp=function(a,b,c,d){var e=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);e=shindig.container.getGadget(e);var f=e.app_id,i=this.f;(new LJAppWidget_RequestShareApp({title:"Ask Share App",finishCallback:function(h){gadgets.rpc.call(i,"shindig.requestShareApp_callback",null,a,h.code,h.message,h.recipients)},authToken:e.auth_token},{extra:c||"",recipients:b.join(","),app_id:f,st:d})).loadContent()};
shindig.LJIfrGadgetService.prototype.refreshSecurityToken=function(a,b){var c=this.f,d=Site.siteroot.replace(/^http:\/\/www/,"http://api")+"/st/refresh/?st="+b+"&callback=?";jQuery.getJSON(d,function(e){gadgets.rpc.call(c,"shindig.refreshSecurityToken_callback",null,a,e,e.error)})};shindig.LJIfrGadgetService.prototype.setUserPref=function(){throw Error(shindig.errors.TO_BE_DONE);};shindig.LJIfrGadgetService.prototype.requestSendMessage=function(){throw Error(shindig.errors.TO_BE_DONE);};(function(){var a={},b=0;this.openGadget=function(c,d){var e=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f),f=shindig.container.getGadget(e);e=this.f;var i={app_id:f.app_id,st:c,owner_id:f.owner_id,module_id:shindig.container.getMaxModuleId(),viewer_id:Site.remoteUser};if(b>0)gadgets.rpc.call(this.f,"gadgets.views.openGadget.result_callback",null,"already_opened");else if(!(e in a)){if(d.view)i.view=d.view;if(d.viewParams)i.params=d.viewParams;f=new LJAppWidget_OpenGadget({dialogId:e,
authToken:f.auth_token},i);f.loadContent();a[e]={widget:f,opener_id:this.f,returnValue:null};b++;gadgets.rpc.call(this.f,"gadgets.views.openGadget.navigate_callback",null,e)}};this.close=function(c){var d;if(!c){c=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);c=shindig.container.getGadget(c);if(!c||!c.dialog_id)return;c=c.dialog_id;d=this.f}var e=a[c];if(e)if(!(!d&&e.opener_id!==c)){e.widget.close();d=d||e.widget.frameId;shindig.container.removeGadgetByFrameId(d);gadgets.rpc.call(e.opener_id,
"gadgets.views.openGadget.result_callback",null,e.returnValue);delete a[c];b--}};this.setReturnValue=function(c){var d=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);if((d=shindig.container.getGadget(d).dialog_id)&&a[d])a[d].returnValue=c};shindig.LJIfrGadgetService.registerRpcMethod({"gadgets.views.openGadget":"openGadget","gadgets.views.close":"close","gadgets.views.setReturnValue":"setReturnValue"})}).apply(shindig.LJIfrGadgetService.prototype);(function(){gadgets=gadgets||{};gadgets.config=gadgets.config||{};gadgets.config.views={CANVAS:{isOnlyVisible:true,urlTemplate:"http://{APP_SUBDOMAIN}.{DOMAIN}/{APP_KEY}"},SETTINGS:{urlTemplate:"{SITEROOT}/manage/settings/?cat=userapps&appid={APP_ID}"},ABOUT:{urlTemplate:"{SITEROOT}/games/#app_{APP_ID}"},INSTALL:{urlTemplate:"{SITEROOT}/games/install.bml?id={APP_ID}&act=install"},HOME:{urlTemplate:"{SITEROOT}#app_{APP_ID}"},COMMUNITY:{urlTemplate:"http://{COMMUNITY_NAME}.{DOMAIN}"},"COMMUNITY.PROFILE":{urlTemplate:"http://{COMMUNITY_NAME}.{DOMAIN}/profile"},
"COMMUNITY.ENTRY":{urlTemplate:"http://{COMMUNITY_NAME}.{DOMAIN}/{DITEMID}.html"},PROFILE:{urlTemplate:"http://{OWNER_NAME}.{DOMAIN}/profile"},JOURNAL:{urlTemplate:"http://{OWNER_NAME}.{DOMAIN}"},"JOURNAL.ENTRY":{urlTemplate:"http://{OWNER_NAME}.{DOMAIN}/{DITEMID}.html"},"JOURNAL.FRIENDS":{urlTemplate:"http://{OWNER_NAME}.{DOMAIN}/friends"},"EMBEDDED.ENTRY":{urlTemplate:"http://{JOURNAL_NAME}.{DOMAIN}/{DITEMID}.html"},"EMBEDDED.COMMENT":{urlTemplate:"http://{JOURNAL_NAME}.{DOMAIN}/{DITEMID}.html?thread={DTALKID}#t{DTALKID}"},
"EMBEDDED.MESSAGE":{urlTemplate:"{SITEROOT}/inbox/"},"EMBEDDED.ACTIVITY":{urlTemplate:"{SITEROOT}/games/info.bml?user={OWNER_NAME}"}}})();shindig.LJGadget=function(a,b){this.id=shindig.container.gadgetService.getGadgetIdFromModuleId(a);this.gadgetId=a;if(b)for(var c in b)if(b.hasOwnProperty(c))this[c]=b[c]};shindig.LJGadget.inherits(shindig.Extensible);shindig.LJGadget.prototype.setHeight=function(a){var b=jQuery("#"+this.gadgetId);if(a>shindig.container.maxheight_)a=shindig.container.maxheight_;b.length>0&&b.height(a)};
shindig.LJGadget.prototype.setTitle=function(a){var b=jQuery(".b-catalogue-app h1");b.length>0&&b.text(a.replace(/&/g,"&amp;").replace(/</g,"&lt;"))};shindig.LJPopupGadget=function(a,b,c){shindig.LJGadget.call(this,a,c);this.widget_=b};shindig.LJPopupGadget.inherits(shindig.LJGadget);shindig.LJPopupGadget.prototype.setHeight=function(a){this.widget_.setHeight(a)};shindig.LJPopupGadget.prototype.setTitle=function(a){this.widget_.setTitle(a)};shindig.LJIfrGadgetContainer=function(){shindig.IfrContainer.call(this)};
shindig.LJIfrGadgetContainer.inherits(shindig.IfrContainer);shindig.LJIfrGadgetContainer.prototype.gadgetClass=shindig.LJGadget;shindig.LJIfrGadgetContainer.prototype.gadgetService=new shindig.LJIfrGadgetService;
shindig.LJIfrGadgetContainer.prototype._getUrlForView=function(a,b,c,d){b={APP_ID:b.app_id,SITEROOT:Site.siteroot,DOMAIN:Site.siteroot.replace(/http:\/\/www\./g,""),APP_KEY:b.key,APP_SUBDOMAIN:b.app_domain,COMMUNITY_NAME:b.community_name,OWNER_NAME:c};c=gadgets.views.getSupportedViews()[a].getUrlTemplate();d=d||{};for(var e in d){a=e.toUpperCase();b.hasOwnProperty(a)||(b[a.toUpperCase()]=d[e])}return gadgets.views.bind(c,b)};
shindig.LJIfrGadgetContainer.prototype._getViewFromString=function(a){if(a.indexOf(".")==-1)return{surface:a};a=a.split(".");return{surface:a[0],secondary:a[1]}};shindig.LJIfrGadgetContainer.prototype.addGadget=function(a){if(!a.id)a.id=this.getNextGadgetInstanceId();this.gadgets_[this.getGadgetKey_(a.id)]=a};shindig.LJIfrGadgetContainer.prototype.removeGadget=function(a){a=this.getGadgetKey_(a);a in this.gadgets_&&delete this.gadgets_[a]};
shindig.LJIfrGadgetContainer.prototype.removeGadgetByFrameId=function(a){this.removeGadget(shindig.container.gadgetService.getGadgetIdFromModuleId(a))};shindig.LJIfrGadgetContainer.prototype.getMaxModuleId=function(){var a=0,b;for(b in this.gadgets_)if(this.gadgets_.hasOwnProperty(b))a=Math.max(a,+this.gadgets_[b].module_id);return a};
shindig.LJIfrGadgetContainer.prototype.findGadgets=function(){var a=this;jQuery("iframe.ljapp").filter(function(){if(!this.id)return false;var b=shindig.container.gadgetService.getGadgetIdFromModuleId(this.id);return!shindig.container.getGadget(b)}).each(function(){a.createGadget(this)})};
shindig.LJIfrGadgetContainer.prototype.createGadget=function(a,b){var c=jQuery(a);if(c.length===1){var d=gadgets.json.parse(decodeURIComponent(c.attr("data-view"))),e=c.prop("id");c=c.prop("src");var f=shindig.container.gadgetService.getGadgetIdFromModuleId(e);f=shindig.container.getGadget(f);if(!f){if(b&&b==="popup"){if(arguments.length<3)throw Error("widget must be passed  to the LJPopupGadget constructor");f=new shindig.LJPopupGadget(e,arguments[2],d)}else f=new shindig.LJGadget(e,d);shindig.container.addGadget(f);
gadgets.rpc.setupReceiver(e,c)}}};shindig.container=new shindig.LJIfrGadgetContainer;var commonContainer=new osapi.container.Container({});LiveJournal.register_hook("page_load",function(){shindig.container.findGadgets()});
;

/* file-end: js/apps/appcontainer.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.journalPromoStrip.js 
*/

!function(a){"use strict";a.widget("lj.journalPromoStrip",a.lj.basicWidget,{options:{selectors:{popupInfo:".journalpromo-popup-content-info",popupDelete:".journalpromo-popup-content-delete",button:"#journalpromo-popup-btn",iconClose:".b-journalpromo-actions-close",options:".b-journalpromo-header-options",promoItem:".b-journalpromo-item",iconDelete:".b-journalpromo-actions-delete",info:".journalpromo-popup-info-action",spinner:".journalpromo-popup-spinner",error:".journalpromo-popup-info-error",errorContent:".journalpromo-popup-info-error-content",ban:"#journalpromo-user-ban"},classNames:{iconInfo:".journalpromo-info-icon",iconDelete:".b-journalpromo-actions-delete",noPromo:"b-journalpromo-item-nopromotion"},template:"<dt><a href='{rules_link}'>{subject}</a> {ljuser}</dt><dd>{body}</dd>"},_create:function(){var b=this;a.lj.basicWidget.prototype._create.apply(this),this._el("spinner"),this._el("info"),this._el("button"),this._el("iconClose"),this._el("error"),b._el("promoItem"),this._el("iconDelete"),this._el("popupDelete"),this._el("errorContent"),this._el("iconDelete")[0]&&(this._deleteBubble=this._popupDelete.bubble({target:this._cl("iconDelete"),showOn:"click"})),this._el("popupInfo").bubble({target:this._cl("iconInfo"),showOn:"hover",closeControl:!1,showDelay:500}),this._bindControls()},_toggleSpinner:function(a){this._spinner.toggle(a),this._info.toggle(!a)},_toggleError:function(a,b){this._error.toggle(a),this._info.toggle(!a),b&&this._errorContent.text(b)},_updateBlock:function(a){a.object[0].object_url?this._promoItem.html(this.options.template.supplant({rules_link:a.object[0].object_url,subject:a.object[0].subject,body:a.object[0].body,ljuser:a.object[0].ljuser_display})):this._promoItem.html('<span class="b-journalpromo-item-message">'+a.object[0].body+"</span>").addClass(this._cl("noPromo"))},_closeClick:function(){var a=this;return"#__debug"===location.hash?this._debug():(a._toggleSpinner(!0),void LJ.Api.call("journalpromo.admin_cancel",{object_url:a.options.url,user:Site.currentJournal,get_slot:1,ban_user:document.getElementById("journalpromo-user-ban").checked},function(b){if(a._toggleSpinner(!1),console.dir(b),b.error&&b.error.data&&b.error.data.entry)return a._updated=b.error.data.entry[0],a._toggleError(!0,b.error.message),void console.error(b.error.message);if(!b.error&&b.entry){var c=b.entry[0];if(!c||!c.object||!c.object[0])return void console.error("Wrong data",b);a._updateBlock(c),a._iconDelete.hide()}a._deleteBubble.bubble("hide")}))},_disableClick:function(){var a=this;LJ.Api.call("journalpromo.disable_promo_announce",{journal:LJ.get("currentJournal")},function(b){b.error||a.element.slideUp("fast")})},_bindControls:function(){var b=this;a.lj.basicWidget.prototype._bindControls.apply(this),this._button.on("click",this._closeClick.bind(this)),this._iconClose.on("click",this._disableClick.bind(this)),this._deleteBubble&&this._deleteBubble.bind("bubblehide",function(){b._toggleError(!1),b._updated&&(b._updateBlock(b._updated),b._iconDelete.hide())})},_debug:function(){var a=this;a._toggleSpinner(!0),setTimeout(function(){a._toggleSpinner(!1),a._toggleError(!0,"Sample error")},1e3)}})}(jQuery,window);;

/* file-end: js/jquery/jquery.lj.journalPromoStrip.js 
----------------------------------------------------------------------------------*/
